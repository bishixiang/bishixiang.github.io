<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>wekan开源kanban系统部署</title>
    <url>/wekan%E5%BC%80%E6%BA%90kanban%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Open-Source kanban.</p></blockquote><a id="more"></a><h1 id="关键安装步骤"><a href="#关键安装步骤" class="headerlink" title="关键安装步骤"></a>关键安装步骤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum --showduplicates list snapd |expand</span><br><span class="line"></span><br><span class="line">yum -y install snapd-2.30-0.el7.centos.1.x86_64 snapd-selinux-2.30-0.el7.centos.1.noarch snap-confine-2.30-0.el7.centos.1.x86_64</span><br><span class="line"></span><br><span class="line">snap install wekan</span><br><span class="line"></span><br><span class="line"> snap list</span><br><span class="line"></span><br><span class="line">查看wekan配置</span><br><span class="line">snap get wekan</span><br><span class="line"></span><br><span class="line">snap info wekan</span><br><span class="line">snap services</span><br><span class="line"></span><br><span class="line">snap 安装指定修订版本应用</span><br><span class="line">snap refresh wekan --revision=581 --stable</span><br></pre></td></tr></table></figure><h1 id="安装后配置"><a href="#安装后配置" class="headerlink" title="安装后配置"></a>安装后配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">snap set wekan caddy-bind-port=&apos;80&apos;</span><br><span class="line">snap set wekan caddy-enabled=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;cn\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan mail-from=&apos;username &lt;username@xxxx.com&gt;&apos;</span><br><span class="line">snap set wekan mail-url=&apos;smtp://username:passwd@mail.xxxx.com:25&apos;</span><br><span class="line">snap set wekan mongodb-bind-ip=&apos;127.0.0.1&apos;</span><br><span class="line">snap set wekan port=&apos;3001&apos;</span><br><span class="line">snap set wekan root-url=&apos;http://domainname&apos;</span><br><span class="line">#-----------------------------</span><br><span class="line">snap set wekan ldap-enable=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-port=&apos;389&apos;</span><br><span class="line">snap set wekan ldap-host=&apos;ldap.xxxx.com&apos;</span><br><span class="line">snap set wekan ldap-basedn=&apos;OU=user,OU=xxxx,DC=xxxx,DC=com&apos;</span><br><span class="line">snap set wekan ldap-login-fallback=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reconnect=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-idle-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-vonnect-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-authentication=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-authentication-userdn=&apos;cn=xxxx,ou=Special_Account,ou=user,ou=xxxx,dc=xxxx,dc=com&apos;</span><br><span class="line">snap set wekan ldap-authentication-password=&apos;passwd&apos;</span><br><span class="line">snap set wekan ldap-internal-log-level=&apos;debug&apos;</span><br><span class="line">snap set wekan ldap-background-sync=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-background-sync-interval=&apos;100&apos;</span><br><span class="line">snap set wekan ldap-encryption=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reject-unauthorized=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-group-filter-enable=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-search-page-size=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-search-size-limit=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-user-search-filter=&apos;&apos;</span><br><span class="line">snap set wekan ldap-user-search-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-user-search-scope=&apos;&apos;</span><br><span class="line">snap set wekan ldap-unique-identifier-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-username-field=&apos;displayName&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data=&apos;false&apos;</span><br><span class="line"># snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;cn\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;displayName\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-merge-existing-users=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-utf8-names-slugify=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-fullname-field=displayName</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap set wekan default-authentication-method=&apos;ldap&apos;</span><br></pre></td></tr></table></figure><h1 id="备份与恢复数据"><a href="#备份与恢复数据" class="headerlink" title="备份与恢复数据"></a>备份与恢复数据</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备份：</span><br><span class="line">/var/lib/snapd/snap/bin/wekan.database-backup &gt;/dev/null 2&gt;&amp;1 &amp;&amp; mv /var/snap/wekan/common/db-backups/* /data/wekan/db-backups/</span><br><span class="line"></span><br><span class="line">恢复</span><br><span class="line">wekan.database-restore /var/snap/wekan/common/db-backups/wekan-20190806T103004.backup</span><br></pre></td></tr></table></figure><h1 id="操作历史"><a href="#操作历史" class="headerlink" title="操作历史"></a>操作历史</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">diff /etc/yum.repos.d/ngompa-snapcore-el7-epel-7.repo /etc/yum.repos.d/_copr_ngompa-snapcore-el7.repo</span><br><span class="line"> rm -rf /etc/yum.repos.d/ngompa-snapcore-el7-epel-7.repo</span><br><span class="line">sudo yum install snapd</span><br><span class="line">snap install wekan</span><br><span class="line">systemctl enable --now snapd.socket</span><br><span class="line">snap install wekan</span><br><span class="line">snap set wekan root-url=&quot;http://0.0.0.0:3000/&quot;</span><br><span class="line">lsof -i :3000</span><br><span class="line">snap set wekan root-url=&quot;http://10.153.43.151:3000/wekan&quot;</span><br><span class="line">snap set wekan port=&apos;3001&apos;</span><br><span class="line">systemctl restart snap.wekan.wekan</span><br><span class="line">systemctl status snap.wekan.wekan</span><br><span class="line">snap set wekan.help</span><br><span class="line">wekan.help</span><br><span class="line">ll /snapcat /etc/systemd/system/snap.wekan.wekan.service</span><br><span class="line">cat /etc/systemd/system/snap.wekan.wekan.service</span><br><span class="line">sudo snap set wekan mail-url=&apos;smtp://username:passwd@mail.xxx-inc.com:25&apos;</span><br><span class="line">sudo snap set wekan mail-from=&apos;xxx &lt;xxx@xxx-inc.com&gt;&apos;</span><br><span class="line">systemctl restart snap.wekan.caddy.service</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.mongodb.service</span><br><span class="line">journalctl -af -u snap.wekan.caddy.service</span><br><span class="line">vim /etc/systemd/system/snap.wekan.caddy.service</span><br><span class="line"> /usr/bin/snap run wekan.caddy</span><br><span class="line">snap set wekan caddy-bind-port=80</span><br><span class="line">snap set wekan caddy-enabled=true</span><br><span class="line">systemctl status snap.wekan.caddy.service</span><br><span class="line">vim /var/snap/wekan/common/Caddyfile</span><br><span class="line">vim /var/snap/wekan/common/Caddyfile</span><br><span class="line">snap set wekan caddy-bind-port=80</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap get wekan</span><br><span class="line">snap set wekan root-url=http://10.153.43.151:3001/dashboard</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.mongodb.service</span><br><span class="line">snap set wekan caddy-enabled=false</span><br><span class="line">snap set wekan port=80</span><br><span class="line">snap set wekan root-url=http://domainname/dashboard</span><br><span class="line">snap set wekan port=3001</span><br><span class="line">snap set wekan root-url=http://domainname</span><br><span class="line">snap set wekan mongodb-bind-ip=127.0.0.1</span><br><span class="line">systemctl restart snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br></pre></td></tr></table></figure><h1 id="LDAP配置"><a href="#LDAP配置" class="headerlink" title="LDAP配置"></a>LDAP配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">snap set wekan ldap-port=&apos;389&apos;</span><br><span class="line">snap set wekan ldap-host=&apos;ldap.xxx-inc.com&apos;</span><br><span class="line">snap set wekan ldap-basedn=&apos;OU=user,OU=xxx,DC=xxx-inc,DC=com&apos;</span><br><span class="line">snap set wekan ldap-login-fallback=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reconnect=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-idle-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-vonnect-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-authentication=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-authentication-userdn=&apos;cn=xxxxxx,ou=xxxxxx,ou=user,ou=xxx,dc=xxx-inc,dc=com&apos;</span><br><span class="line">snap set wekan ldap-authentication-password=&apos;passwd&apos;</span><br><span class="line">snap set wekan ldap-internal-log-level=&apos;debug&apos;</span><br><span class="line">snap set wekan ldap-background-sync=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-background-sync-interval=&apos;100&apos;</span><br><span class="line">snap set wekan ldap-encryption=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reject-unauthorized=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-group-filter-enable=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-search-page-size=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-search-size-limit=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-user-search-filter=&apos;&apos;</span><br><span class="line">snap set wekan ldap-user-search-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-user-search-scope=&apos;&apos;</span><br><span class="line">snap set wekan ldap-unique-identifier-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-username-field=&apos;displayName&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;displayName\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-merge-existing-users=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-utf8-names-slugify=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-fullname-field=displayName</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap set wekan default-authentication-method=&apos;ldap&apos;</span><br><span class="line">EOF |bash</span><br></pre></td></tr></table></figure><h1 id="nginx代理"><a href="#nginx代理" class="headerlink" title="nginx代理"></a>nginx代理</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; wekan.conf &lt;&lt; EOF</span><br><span class="line">upstream task &#123;</span><br><span class="line">	server 10.0.0.1:3001;</span><br><span class="line">&#125;</span><br><span class="line"># this section is needed to proxy web-socket connections</span><br><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &apos;&apos;      close;</span><br><span class="line">&#125;</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">	include vhosts/vhosts.listen.addr;</span><br><span class="line"></span><br><span class="line">	server_name wekan.webserver;</span><br><span class="line">	access_log logs/$&#123;server_name&#125;_access_log main;</span><br><span class="line">	access_log logs/status_log mini;</span><br><span class="line">	charset  utf-8;</span><br><span class="line"></span><br><span class="line">	error_page  404           /404.html;</span><br><span class="line">	error_page   500 502 503 504  /50x.html;</span><br><span class="line"></span><br><span class="line">	location = /50x.html</span><br><span class="line">	&#123;</span><br><span class="line">		root   html;</span><br><span class="line">	&#125;</span><br><span class="line">	location /server-status</span><br><span class="line">	&#123;</span><br><span class="line">		stub_status on;</span><br><span class="line">		allow 10.0.0.0/8;</span><br><span class="line">		deny all;</span><br><span class="line">	&#125;</span><br><span class="line">	location /</span><br><span class="line">	&#123;</span><br><span class="line">      		proxy_set_header   Host              $host;</span><br><span class="line">      		proxy_set_header   X-Real-IP         $remote_addr;</span><br><span class="line">      		proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;</span><br><span class="line">      		proxy_set_header   X-Forwarded-Proto $scheme;</span><br><span class="line">      		proxy_max_temp_file_size 0;</span><br><span class="line">		proxy_set_header Upgrade $http_upgrade; # allow websockets</span><br><span class="line">        	proxy_set_header Connection $connection_upgrade;</span><br><span class="line">      		proxy_pass         http://task;</span><br><span class="line"></span><br><span class="line">      		#this is the maximum upload size</span><br><span class="line">      		client_max_body_size       10m;</span><br><span class="line">      		client_body_buffer_size    128k;</span><br><span class="line"></span><br><span class="line">      		proxy_connect_timeout      90;</span><br><span class="line">      		proxy_send_timeout         90;</span><br><span class="line">      		proxy_read_timeout         90;</span><br><span class="line">      		proxy_buffering            off;</span><br><span class="line">      		proxy_request_buffering    off; # Required for HTTP CLI commands in Jenkins &gt; 2.54</span><br><span class="line">      		proxy_set_header Connection &quot;&quot;; # Clear for keepalive</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">30 10 * * * /var/lib/snapd/snap/bin/wekan.database-backup &gt;/dev/null 2&gt;&amp;1 &amp;&amp; mv /var/snap/wekan/common/db-backups/* /data/wekan/db-backups/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">我们可以看到图中的loo0-loop11占用100%,我们只要清理掉一下就可以了.</span><br><span class="line">命令:</span><br><span class="line">sudo apt autoremove --purge snapd</span><br><span class="line">　命令:</span><br><span class="line">　　sudo apt autoremove --purge snapd</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://github.com/wekan/wekan-snap/wiki/Install" target="_blank" rel="noopener">官方安装文档</a></li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>wekan</tag>
        <tag>kanban</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcat调优实践</title>
    <url>/tomcat%E8%B0%83%E4%BC%98%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>持续整理中</p></blockquote><a id="more"></a><h1 id="调优思路"><a href="#调优思路" class="headerlink" title="调优思路"></a>调优思路</h1><ul><li><p>清空webapps</p></li><li><p>隐藏tomcat版本号</p></li><li><p>开启apr</p></li><li><p>修改随机数生成器</p></li><li><p>修改8005重启命令</p></li><li><p>禁用8009</p></li><li><p>Connector和exec优化</p></li><li><p>开机启动</p></li><li><p>systemd支持</p></li><li><p>cron自动重启自动清理日志</p></li><li><p>关闭autoDeploy</p></li><li><p>使用LD_LIBRARY_PATH替换java.library.path</p></li></ul><h1 id="关闭autoDeploy"><a href="#关闭autoDeploy" class="headerlink" title="关闭autoDeploy"></a>关闭autoDeploy</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;</span><br><span class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;false&quot;&gt;</span><br></pre></td></tr></table></figure><h1 id="使用LD-LIBRARY-PATH替换java-library-path"><a href="#使用LD-LIBRARY-PATH替换java-library-path" class="headerlink" title="使用LD_LIBRARY_PATH替换java.library.path"></a>使用LD_LIBRARY_PATH替换java.library.path</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=$CATALINA_HOME/extra/lib</span><br><span class="line">会覆盖系统环境变量：</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH/path/to//so-lib</span><br></pre></td></tr></table></figure><ul><li>添加多个值 <code>-Djava.library.path=/opt/hdf-java/build/bin:/opt/opencv-2.4.10/build/lib</code></li></ul><h1 id="隐藏版本"><a href="#隐藏版本" class="headerlink" title="隐藏版本"></a>隐藏版本</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd apache-tomcat/lib/</span><br><span class="line">unzip catalina.jar</span><br><span class="line">修改 org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">增量更新jar包: jar -uvf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br></pre></td></tr></table></figure><h1 id="自定义header-Server"><a href="#自定义header-Server" class="headerlink" title="自定义header Server"></a>自定义header Server</h1><p>conf/server.xml</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;  </span><br><span class="line">                    connectionTimeout=&quot;20000&quot; </span><br><span class="line">                    redirectPort=&quot;8443&quot;  </span><br><span class="line">                    URIEncoding=&quot;UTF-8&quot; </span><br><span class="line">                    useBodyEncodingForURI=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">修改后如下：</span><br><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;  </span><br><span class="line">                     connectionTimeout=&quot;20000&quot; </span><br><span class="line">                     redirectPort=&quot;8443&quot;  </span><br><span class="line">                     URIEncoding=&quot;UTF-8&quot; </span><br><span class="line">                     useBodyEncodingForURI=&quot;true&quot; </span><br><span class="line">                     server=&quot;Microsoft-IIS/6.5&quot;/&gt;</span><br></pre></td></tr></table></figure><h1 id="开启apr"><a href="#开启apr" class="headerlink" title="开启apr"></a>开启apr</h1><p>LD_LIBRARY_PATH是Linux环境变量名，该环境变量主要用于指定查找共享库（动态链接库）时除了默认路径之外的其他路径。<br>LD_RUN_PATH环境变量, 它也是把路径编译进可执行文件内，不同的是它只设置RPATH<br>这么多搜索路径，他们有个先后顺序如下<br>1、RUMPATH 优先级最高<br>2、RPATH 其次<br>3、LD_LIBRARY_PATH<br>4、/etc/ld.so.cache<br>5、/usr/lib/ /lib/</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install apr-devel</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/apr/lib</span><br><span class="line">或者：</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=/usr/local/apr/lib&quot;</span><br></pre></td></tr></table></figure><h1 id="bin-catalina-sh-stop-不生效问题"><a href="#bin-catalina-sh-stop-不生效问题" class="headerlink" title="bin/catalina.sh stop 不生效问题"></a>bin/catalina.sh stop 不生效问题</h1><p>在读取时，/dev/random设备会返回小于熵池噪声总数的随机字节。<br>/dev/random可生成高随机性的公钥或一次性密码本。若熵池空了，对/dev/random的读操作将会被阻塞，直到收集到了足够的环境噪声为止。\这样的设计使得/dev/random是真正的随机数发生器，提供了最大可能的随机数据熵，建议在需要生成高强度的密钥时使用。</p><p>/dev/random的一个副本是/dev/urandom（“unblocked”，非阻塞的随机数发生器），它会重复使用熵池中的数据以产生伪随机数据。<br>这表示对/dev/urandom的读取操作不会产生阻塞，但其输出的熵可能小于/dev/random的。它可以作为生成较低强度密码的伪随机数生成器，不建议用于生成高强度长期密码。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;s/securerandom.source=file:\/dev\/random/securerandom.source=file:\/dev\/urandom/g&apos; /usr/java/jdk1.8.0_192/jre/lib/security/java.security</span><br><span class="line">或</span><br><span class="line">-Djava.security.egd=file:/dev/./urandom</span><br></pre></td></tr></table></figure><h1 id="使bin-catalina-sh-stop-force生效"><a href="#使bin-catalina-sh-stop-force生效" class="headerlink" title="使bin/catalina.sh stop -force生效"></a>使bin/catalina.sh stop -force生效</h1><p>cat &gt;&gt; /search/odin/webserver/tomcat/bin/setenv.sh &lt;&lt; EOF<br>#!/bin/bash<br>CATALINA_PID=$CATALINA_HOME/bin/catalina.map.pid<br>EOF</p><h1 id="Connector优化"><a href="#Connector优化" class="headerlink" title="Connector优化"></a>Connector优化</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">           maxThreads=&quot;5000&quot; </span><br><span class="line">           minSpareThreads=&quot;2500&quot; </span><br><span class="line">           maxSpareThreads=&quot;3750&quot;</span><br><span class="line">           enableLookups=&quot;false&quot;  //禁用dns解析</span><br><span class="line">           edirectPort=&quot;8443&quot; </span><br><span class="line">           acceptCount=&quot;1024&quot;</span><br><span class="line">           debug=&quot;0&quot; </span><br><span class="line">           connectionTimeout=&quot;10000&quot;</span><br><span class="line">           disableUploadTimeout=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure><h1 id="prometheus监控jmx"><a href="#prometheus监控jmx" class="headerlink" title="prometheus监控jmx"></a>prometheus监控jmx</h1><ul><li><p><a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/collector/0.12.0/collector-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/collector/0.12.0/collector-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.12.0/jmx_prometheus_javaagent-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.12.0/jmx_prometheus_javaagent-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar</a></p></li><li><p><a href="https://github.com/prometheus/jmx_exporter/tree/master/example_configs" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter/tree/master/example_configs</a></p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- cat jmx.sh</span><br><span class="line">#!/usr/bin/env bash</span><br><span class="line"># Script to run a java application for testing jmx4prometheus.</span><br><span class="line"># Note: You can use localhost:5556 instead of 5556 for configuring socket hostname.</span><br><span class="line">java -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5555 -jar ./jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar 5556 ./tomcat.yml</span><br></pre></td></tr></table></figure><ul><li><p>cat setenv.sh</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">CATALINA_PID=$CATALINA_HOME/bin/catalina.map.pid</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=$CATALINA_HOME/extra/apr/lib</span><br><span class="line">-Djava.security.egd=file:/dev/./urandom</span><br><span class="line">-Djava.awt.headless=true&quot;</span><br><span class="line">[ -f $CATALINA_HOME/extra/catalina_opts.sh ] &amp;&amp; source $CATALINA_HOME/extra/catalina_opts.sh</span><br><span class="line">[ -f $CATALINA_HOME/extra/jmx_exporter_opts.sh ] &amp;&amp; source $CATALINA_HOME/extra/jmx_exporter_opts.sh</span><br></pre></td></tr></table></figure></li><li><p>cat jmx_exporter_opts.sh</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -javaagent:/search/odin/webserver/tomcat/extra/jmx_exporter/jmx_prometheus_javaagent-0.12.0.jar=7788:/search/odin/webserver/tomcat/extra/jmx_exporter/tomcat.yml&quot;</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.ibm.com/support/knowledgecenter/zh/SSHS8R_8.0.0/com.ibm.worklight.installconfig.doc/install_config/t_optional_config_app_server_tomcat.html" target="_blank" rel="noopener">tomcat开启jmx</a></p></li></ul><h1 id="解决验证码不显示的问题"><a href="#解决验证码不显示的问题" class="headerlink" title="解决验证码不显示的问题"></a>解决验证码不显示的问题</h1><ul><li>Headless模式是一种系统配置模式。在该模式下，系统缺少了显示设备、键盘或鼠标，一般Linux服务端使用headless mode。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.awt.headless=true&quot;</span><br><span class="line">或</span><br><span class="line">System.setProperty(&quot;java.awt.headless&quot;, &quot;true&quot;);</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://cloud.tencent.com/developer/article/1404206" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1404206</a></p></li><li><p><a href="http://lovesoo.org/tomcat-process-fails-to-stop-problem-solving.html?zyvufk=zcpgj2&amp;emjyvm=yr0rj2" target="_blank" rel="noopener">http://lovesoo.org/tomcat-process-fails-to-stop-problem-solving.html?zyvufk=zcpgj2&amp;emjyvm=yr0rj2</a></p></li><li><p><a href="https://rorschachchan.github.io/2019/09/30/Tomcat8%E9%85%8D%E7%BD%AEapr/" target="_blank" rel="noopener">https://rorschachchan.github.io/2019/09/30/Tomcat8%E9%85%8D%E7%BD%AEapr/</a></p></li><li><p><a href="http://www.laruence.com/2010/01/27/1265.html" target="_blank" rel="noopener">http://www.laruence.com/2010/01/27/1265.html</a></p></li><li><p><a href="https://www.sohu.com/a/204046542_355142" target="_blank" rel="noopener">https://www.sohu.com/a/204046542_355142</a></p></li><li><p><a href="https://www.bbsmax.com/A/o75NLyZXzW/" target="_blank" rel="noopener">关于 Tomcat 的线程池的理解</a></p></li><li><p><a href="https://www.w3cschool.cn/tomcat/5tqv1k9w.html" target="_blank" rel="noopener">https://www.w3cschool.cn/tomcat/5tqv1k9w.html</a></p></li><li><p><a href="https://www.alibabacloud.com/help/zh/faq-detail/37421.htm" target="_blank" rel="noopener">Tomcat服务安全加固</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1173187" target="_blank" rel="noopener">tomcat安全加固</a></p></li><li><p><a href="https://www.yuque.com/idevops/slhwwz/mfvpl0" target="_blank" rel="noopener">prometheus 监控 tomcat</a></p></li><li><p><a href="http://xieyufei.com/2017/01/08/SERVER-OPEN-GZIP.html" target="_blank" rel="noopener">服务器开启GZIP</a></p></li><li><p><a href="https://tomcat.apache.org/tomcat-9.0-doc/config/http.html" target="_blank" rel="noopener">Apache Tomcat·The HTTP Connector</a></p></li><li><p><a href="https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Access_Logging" target="_blank" rel="noopener">Access Logging</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1103077" target="_blank" rel="noopener">详解 Tomcat 的连接数与线程池</a></p></li><li><p><a href="https://blog.51cto.com/meiling/1826588" target="_blank" rel="noopener">Tomcat优化配置</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzAwNTM5Njk3Mw==&mid=2247483768&idx=1&sn=23fb8e372719b626a5f5c5a6c98cfb72&chksm=9b1c01faac6b88ec2c3b975b03d50b4a7cdef5d0c84ec4d686abd93464d60f779a1373fa7f64&mpshare=1&scene=24&srcid=1115o7YJ3T32liFwWOetxYqe&sharer_sharetime=1573785651091&sharer_shareid=49ca04d76869dc1e522c1a1b20a84c86&key=a942e04100fd18a078c9258af003e3080d124c9a352555786f1ba968e08e029e37ef17fc36615f987a85542332b8032d41a00435f94369e8b31014f8c10abe7501042c6063477d314b8037e76c530ced&ascene=14&uin=MjU4NTIwODY2MA%3D%3D&devicetype=Windows+10&version=62070158&lang=zh_CN&pass_ticket=z2BrPOXYDDwdKGKf8dnPrjuybJjyK869CeFHtJoQXp9eq0XjxSciWNxP9e%2BEjhod" target="_blank" rel="noopener">Tomcat性能调优及JVM内存工作原理</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU0NTk2MjQyOA==&mid=2247484611&idx=1&sn=39c36f2bbabd87d47b1c8d4eb2cf9776&chksm=fb65a410cc122d0613c4f55e76a527acd5a45a66fdd071d243ac21c315ce1e2d6e840651f260&mpshare=1&scene=24&srcid=11141emsLAqdabcKtAQE6L0u&sharer_sharetime=1573745704644&sharer_shareid=49ca04d76869dc1e522c1a1b20a84c86&key=3486ba94f9a3c84a9daa93a3b19f3e84d39750a0c02d5b1307f993bb98f946ecc3c6fbb5fc3e37203e2e5d6f01fc5195c3ce4bc3e62f2de0ba2ba25cc207c7723bcde53e2dc13a3562957998878bd27c&ascene=14&uin=MjU4NTIwODY2MA%3D%3D&devicetype=Windows+10&version=62070158&lang=zh_CN&pass_ticket=z2BrPOXYDDwdKGKf8dnPrjuybJjyK869CeFHtJoQXp9eq0XjxSciWNxP9e%2BEjhod" target="_blank" rel="noopener">tomcat 调优-生产环境必备</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5NTAzNjM0Mw==&mid=2247485907&idx=2&sn=53818bc549bf40ded1a03841d5a7be7c&chksm=fe79580bc90ed11d5c0311f556addf497bdb3fe618d82057c97541dc6bc77cd4cfc59eef1981&scene=1&subscene=10000&clicktime=1574088752&enterid=1574088752&ascene=0&devicetype=android-28&version=27000834&nettype=cmnet&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&pass_ticket=3bM%2FBKwG9HXfHMZLcUxTc7IYYXA6GqQhW%2FoLrNbJazmkYAdXv%2B0Uzi%2B3NB5K3nQM&wx_header=1" target="_blank" rel="noopener">小计Tomcat的调优思路 | 必学必知</a></p></li></ul>]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title>pandoc+revealjs使用Markdown编写在线PPT</title>
    <url>/pandoc-revealjs%E4%BD%BF%E7%94%A8markdown%E7%BC%96%E5%86%99%E5%9C%A8%E7%BA%BFppt/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>学什么PPT，学reveal.js就够了！</p></blockquote><a id="more"></a><h2 id="revealjs"><a href="#revealjs" class="headerlink" title="revealjs"></a>revealjs</h2><iframe src="https://revealjs.com/#/" height="400px" width="95%"></iframe><h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2><ul><li><p>文档头部元数据</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">% 标题</span><br><span class="line">% 作者</span><br><span class="line">% 日期</span><br></pre></td></tr></table></figure></li><li><p>分页</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--- 横向强制分页</span><br><span class="line">-- 纵向分页，通常一列可以作为一个章节。</span><br></pre></td></tr></table></figure></li></ul><h2 id="pandoc"><a href="#pandoc" class="headerlink" title="pandoc"></a>pandoc</h2><blockquote><p>pandoc是一个神奇而强大的工具，非常强大。具体使用方法，参见<a href="https://pandoc.org/MANUAL.html" target="_blank" rel="noopener">官方文档</a>。使用范例，后面再陆续总结。。。</p></blockquote><h2 id="转换命令"><a href="#转换命令" class="headerlink" title="转换命令"></a>转换命令</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pandoc slides.md -o slides.html -t revealjs -s -V theme=beige</span><br><span class="line"></span><br><span class="line">pandoc 2019Mid-yearSummary.md -o 2019.html -t revealjs -s -V theme=sky</span><br></pre></td></tr></table></figure><h2 id="常用主题"><a href="#常用主题" class="headerlink" title="常用主题"></a>常用主题</h2><ul><li>default：（默认）深灰色背景，白色文字</li><li>beige：米色背景，深色文字</li><li>sky：天蓝色背景，白色细文字</li><li>night：黑色背景，白色粗文字</li><li>serif：浅色背景，灰色衬线文字</li><li>simple：白色背景，黑色文字</li><li>solarized：奶油色背景，深青色文字</li></ul><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul><li><code>p</code>：上一页</li><li><code>n</code>：下一页</li><li><code>s</code>：演示模式</li><li><code>f</code>: 全屏模式</li><li><code>b(/.)</code>: 黑屏暂停</li><li><code>o</code>: 概览模式</li><li><code>Esc</code>：退出全屏/概览模式</li><li><code>?</code>: 快捷键帮助</li><li><code>Alt + 鼠标单击</code>：放大显示</li></ul><h2 id="演示备注"><a href="#演示备注" class="headerlink" title="演示备注"></a>演示备注</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;aside class=&quot;notes&quot;&gt;</span><br><span class="line">   备注内容</span><br><span class="line">&lt;/aside&gt;</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://www.lfhacks.com/s/revealjs.html" target="_blank" rel="noopener">https://www.lfhacks.com/s/revealjs.html</a></li><li><a href="https://palmer.arkstack.cn/2017/05/RevealJs-slides%E6%BC%94%E7%A4%BA%E5%B7%A5%E5%85%B7-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/" target="_blank" rel="noopener">https://palmer.arkstack.cn/2017/05/RevealJs-slides%E6%BC%94%E7%A4%BA%E5%B7%A5%E5%85%B7-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/</a></li><li><a href="https://vxhly.github.io/archives/8bdf06de.html" target="_blank" rel="noopener">https://vxhly.github.io/archives/8bdf06de.html</a></li><li><a href="https://amito.me/2018/Using-Pandoc-to-Make-HTML-and-Beamer-Slides/" target="_blank" rel="noopener">https://amito.me/2018/Using-Pandoc-to-Make-HTML-and-Beamer-Slides/</a></li><li><a href="https://github.com/luckylooke/revealjsBallTheme" target="_blank" rel="noopener">https://github.com/luckylooke/revealjsBallTheme</a></li><li><a href="https://crazy-max.github.io/php7-presentation/#/" target="_blank" rel="noopener">https://crazy-max.github.io/php7-presentation/#/</a></li><li><a href="https://github.com/denehyg/reveal.js-menu" target="_blank" rel="noopener">https://github.com/denehyg/reveal.js-menu</a></li><li><a href="https://github.com/denehyg/reveal.js-toolbar" target="_blank" rel="noopener">https://github.com/denehyg/reveal.js-toolbar</a></li><li><a href="https://github.com/byteclubfr/uncloak" target="_blank" rel="noopener">https://github.com/byteclubfr/uncloak</a></li><li><a href="https://linux.cn/article-10228-1.html" target="_blank" rel="noopener">https://linux.cn/article-10228-1.html</a></li><li><a href="https://pandoc.org/MANUAL.html" target="_blank" rel="noopener">https://pandoc.org/MANUAL.html</a></li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>pandoc</tag>
        <tag>revealjs</tag>
        <tag>ppt</tag>
      </tags>
  </entry>
  <entry>
    <title>prometheus监控实践</title>
    <url>/prometheus%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Power your metrics and alerting with a leading open-source monitoring solution.</p></blockquote><a id="more"></a><h1 id="prometheus-server端配置范例"><a href="#prometheus-server端配置范例" class="headerlink" title="prometheus server端配置范例"></a>prometheus server端配置范例</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># my global config</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     60s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">  evaluation_interval: 60s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">  # scrape_timeout is set to the global default (10s).</span><br><span class="line"></span><br><span class="line"># Alertmanager configuration</span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      # - alertmanager:9093</span><br><span class="line"></span><br><span class="line"># Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.</span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first_rules.yml&quot;</span><br><span class="line">  # - &quot;second_rules.yml&quot;</span><br><span class="line">  # - compute_metrics.rules</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line"># ================================================================</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line"></span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    # static_configs:</span><br><span class="line"></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/node.d/*.yml&apos;]</span><br><span class="line"></span><br><span class="line">  - job_name: &apos;metricslogfile&apos;</span><br><span class="line">    metrics_path: &apos;/metrics/logfile&apos;</span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    # static_configs:</span><br><span class="line"></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/node.d/*.yml&apos;]</span><br><span class="line"></span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;blackbox&apos;</span><br><span class="line">    metrics_path: /probe</span><br><span class="line">    params:</span><br><span class="line">      module: [http_2xx]  # Look for a HTTP 200 response.</span><br><span class="line">    # static_configs:</span><br><span class="line">    #   - targets:</span><br><span class="line">    #     - https://123.xxxx.com    # Target to probe with http.</span><br><span class="line">    #     - http://map.xxxx.com</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/blackbox.d/*.yml&apos;]</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: slavedb.dt.zw.ted:19115  # The blackbox exporter&apos;s real hostname:port.</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;mobile.xxxx.com&apos;</span><br><span class="line">    metrics_path: /probe</span><br><span class="line">    params:</span><br><span class="line">      module: [http_2xx_mobile_zhushou_sogou_com]  # Look for a HTTP 200 response.</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/importantServices.d/xxxx.yml&apos;]</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: slavedb.dt.zw.ted:19115  # The blackbox exporter&apos;s real hostname:port.</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;nginxstatus&apos;</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/nginx.d/*.yml&apos;]</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;jenkins&apos;</span><br><span class="line">    metrics_path: /prometheus</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - &apos;10.142.112.144:8080&apos;</span><br><span class="line">      labels:</span><br><span class="line">        cluster: &apos;业务&apos;</span><br><span class="line">        group: &apos;产品&apos;</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;prometheustatus&apos;</span><br><span class="line">    metrics_path: /metrics</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - &apos;127.0.0.1:19090&apos;</span><br><span class="line">      labels:</span><br><span class="line">        cluster: &apos;Prometheus&apos;</span><br><span class="line">        group: &apos;生产环境&apos;</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;etcd&apos;</span><br><span class="line">    metrics_path: /metrics</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/etcd.d/*.yml&apos;]</span><br></pre></td></tr></table></figure><h2 id="子配置范例"><a href="#子配置范例" class="headerlink" title="子配置范例"></a>子配置范例</h2><ul><li><p>node</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">        &apos;10.0.0.1:9100&apos;,</span><br><span class="line">        &apos;10.0.0.2:9100&apos;,</span><br><span class="line">        &apos;10.0.0.3:9100&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li><li><p>blackbox</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">&apos;http://www.xxxx.com/&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li><li><p>etcd监控</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">    &apos;etcd01.localhost:2379&apos;,</span><br><span class="line">    &apos;etcd02.localhost:2379&apos;,</span><br><span class="line">    &apos;etcd03.localhost:2379&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;etcd.业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><h2 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a>prometheus</h2><ul><li><a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="noopener">exporters</a></li><li><h2 id="grafana模板"><a href="#grafana模板" class="headerlink" title="grafana模板"></a>grafana模板</h2><h3 id="prometheus-1"><a href="#prometheus-1" class="headerlink" title="prometheus"></a>prometheus</h3><ul><li><a href="https://grafana.com/grafana/dashboards/8919" target="_blank" rel="noopener">Node Exporter 0.16 + for Prometheus 监控展示看板</a></li><li><a href="https://grafana.com/grafana/dashboards/1860" target="_blank" rel="noopener">Node Exporter Full</a></li><li><a href="https://github.com/rfrail3/grafana-dashboards" target="_blank" rel="noopener">CentOS5版本监控</a></li><li><a href="https://grafana.com/grafana/dashboards/405" target="_blank" rel="noopener">Node Exporter Server Metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/306" target="_blank" rel="noopener">jenkins状态监控</a></li></ul></li></ul><p>#￥# blackbox</p><ul><li><a href="https://grafana.com/grafana/dashboards/5345" target="_blank" rel="noopener">Blackbox Exporter Overview</a></li><li><a href="https://grafana.com/grafana/dashboards/7587" target="_blank" rel="noopener"></a></li><li><a href="https://grafana.com/grafana/dashboards/9965" target="_blank" rel="noopener">Blackbox Exporter 0.14 for Prometheus 监控展示看板</a></li></ul><h3 id="telegraf-influxdb"><a href="#telegraf-influxdb" class="headerlink" title="telegraf + influxdb"></a>telegraf + influxdb</h3><ul><li><a href="https://grafana.com/grafana/dashboards/61" target="_blank" rel="noopener">Telegraf metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/5955" target="_blank" rel="noopener">Telegraf - system metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/914" target="_blank" rel="noopener">Telegraf system overview</a></li><li><a href="https://grafana.com/grafana/dashboards/317" target="_blank" rel="noopener">influxdb状态监控</a></li></ul>]]></content>
      <categories>
        <category>prometheus</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>监控</tag>
        <tag>prometheus</tag>
      </tags>
  </entry>
  <entry>
    <title>ngxtop应用实践</title>
    <url>/ngxtop%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>挺实用。。。</p></blockquote><a id="more"></a><ul><li>操作范例<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/opt/python/bin/ngxtop top remote_addr -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/opt/python/bin/ngxtop -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><ul><li><p>查看前30条</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/opt/python/bin/ngxtop -n 30 -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>安装报错<br>ImportError: No module named ‘config_parser’</p></li><li><p>解决方法</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/lebinh/ngxtop.git</span><br><span class="line">cd ngxtop</span><br><span class="line">pip install .</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=403732461&amp;idx=1&amp;sn=355c5b2c4eea5fc667d910a976bc23d9&amp;scene=7&amp;key=b00bc6577437f0f5637ec152e1a9885b06338b95d65135e74cbc78d69c09655b0695f143dcfbb99626af16ddd5291d68c8441d2f8d77b962377edc86a1dc1478a07d1c4eeba5bd828e99a530ed574c7b&amp;ascene=0&amp;uin=MjU4NTIwODY2MA%3D%3D&amp;devicetype=Windows+10&amp;version=62060844&amp;lang=zh_CN&amp;pass_ticket=VJ5qyiMQOdr7Vx9dh33jjUe53zQKR3FhJuWiKB%2ButNzqA0ZJO83cJfRurzxTLSbl" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=403732461&amp;idx=1&amp;sn=355c5b2c4eea5fc667d910a976bc23d9&amp;scene=7&amp;key=b00bc6577437f0f5637ec152e1a9885b06338b95d65135e74cbc78d69c09655b0695f143dcfbb99626af16ddd5291d68c8441d2f8d77b962377edc86a1dc1478a07d1c4eeba5bd828e99a530ed574c7b&amp;ascene=0&amp;uin=MjU4NTIwODY2MA%3D%3D&amp;devicetype=Windows+10&amp;version=62060844&amp;lang=zh_CN&amp;pass_ticket=VJ5qyiMQOdr7Vx9dh33jjUe53zQKR3FhJuWiKB%2ButNzqA0ZJO83cJfRurzxTLSbl</a></p></li><li><p><a href="https://www.vpser.net/manage/ngxtop.html" target="_blank" rel="noopener">https://www.vpser.net/manage/ngxtop.html</a></p></li></ul>]]></content>
      <categories>
        <category>工具控</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>ngxtop</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoDB基础实践</title>
    <url>/mongodb%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>边用边总结</p></blockquote><a id="more"></a><h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="mongo连接"><a href="#mongo连接" class="headerlink" title="mongo连接"></a>mongo连接</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongo --host 127.0.0.1 --port 27017</span><br><span class="line">或</span><br><span class="line">mongo &quot;mongodb://127.0.0.1:27017&quot;</span><br></pre></td></tr></table></figure><h2 id="升级操作"><a href="#升级操作" class="headerlink" title="升级操作"></a>升级操作</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.adminCommand( &#123; setFeatureCompatibilityVersion: &quot;4.0&quot; &#125; )</span><br></pre></td></tr></table></figure><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>启用用户认证必须修改配置文件/etc/mongod.conf为：并重启服务</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">security.authorization : enabled</span><br></pre></td></tr></table></figure><ul><li><p>创建管理员用户</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123; user: &quot;admin&quot;, pwd: &quot;passwd&quot;, roles: [&#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br><span class="line">db.auth(&quot;admin&quot;, &quot;adminPassword?&quot;)</span><br><span class="line">db.getUsers()</span><br></pre></td></tr></table></figure></li><li><p>创建备份用户</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use testdb</span><br><span class="line">db.createUser(&#123; user: &quot;backup&quot;, pwd: &quot;passwd&quot;, roles: [&#123; role: &quot;backup&quot;, db: &quot;admin&quot; &#125;, &#123; role: &quot;restore&quot;, db: &quot;admin&quot; &#125;] &#125;)  # role中的db必须为admin</span><br></pre></td></tr></table></figure></li><li><p>查看用户</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.system.users.find().pretty()</span><br><span class="line">use testdb</span><br><span class="line">show users</span><br></pre></td></tr></table></figure></li></ul><h2 id="开启-关闭监控"><a href="#开启-关闭监控" class="headerlink" title="开启/关闭监控"></a>开启/关闭监控</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.enableFreeMonitoring()</span><br><span class="line">db.disableFreeMonitoring()</span><br></pre></td></tr></table></figure><h2 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show dbs;</span><br><span class="line">db.getCollectionNames();   #show collections;</span><br><span class="line">help</span><br><span class="line"></span><br><span class="line">删除数据库</span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><h2 id="查询范例"><a href="#查询范例" class="headerlink" title="查询范例"></a>查询范例</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.getCollection(&apos;gd_event&apos;).aggregate([&#123;$group:&#123;_id:&quot;$eid&quot;,count:&#123;$sum:1&#125;&#125;&#125;,&#123; $match:&#123;count:&#123;$gt:1&#125;&#125;&#125;])</span><br><span class="line">类似sql：</span><br><span class="line">select eid as _id,count(eid) as count from gd_event group by eid having count&gt;1</span><br><span class="line"></span><br><span class="line">两个条件或运算：</span><br><span class="line">db.getCollection(&apos;gd_event_log&apos;).find(&#123;$or:[&#123;&quot;detail&quot;:&#123;$regex:&quot;冷月无声&quot;&#125;&#125;,&#123;&quot;info&quot;:&#123;$regex:&quot;冷月无声&quot;&#125;&#125;]&#125;)</span><br></pre></td></tr></table></figure><h2 id="mongo查询包含"><a href="#mongo查询包含" class="headerlink" title="mongo查询包含"></a>mongo查询包含</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.getCollection(&apos;cards&apos;).find(&#123;title:/scribe/&#125;)</span><br><span class="line">db.getCollection(&apos;cards&apos;).find(&#123;title:/导航/&#125;)</span><br></pre></td></tr></table></figure><h2 id="mongo启用全文索引"><a href="#mongo启用全文索引" class="headerlink" title="mongo启用全文索引"></a>mongo启用全文索引</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; db.adminCommand( &#123; setParameter : 1, textSearchEnabled : true &#125; )</span><br><span class="line">&#123; &quot;was&quot; : false, &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><ul><li>默认是关闭的。否则会报错”err” : “text search not enabled”</li></ul><h2 id="索引语言支持"><a href="#索引语言支持" class="headerlink" title="索引语言支持"></a>索引语言支持</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">db.de.ensureIndex( &#123;txt: &quot;text&quot;&#125;, &#123;default_language: &quot;german&quot;&#125; )</span><br></pre></td></tr></table></figure><ul><li>如果希望使用其他语言，需要在创建索引时指定要使用的语言。默认是支持英文的。</li></ul><h1 id="mongdb客户端工具"><a href="#mongdb客户端工具" class="headerlink" title="mongdb客户端工具"></a>mongdb客户端工具</h1><ul><li><a href="http://robomongo.org/" target="_blank" rel="noopener">http://robomongo.org/</a></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://www.jianshu.com/p/f5afc6488f9e" target="_blank" rel="noopener">https://www.jianshu.com/p/f5afc6488f9e</a></li><li><a href="https://docs.mongodb.com/manual/reference/built-in-roles/#backup-and-restoration-roles" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/built-in-roles/#backup-and-restoration-roles</a></li><li><a href="https://docs.mongodb.com/manual/reference/configuration-options/#security.authorization" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/configuration-options/#security.authorization</a></li></ul>]]></content>
      <categories>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>nosql</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux内核崩溃分析</title>
    <url>/linux%E5%86%85%E6%A0%B8%E5%B4%A9%E6%BA%83%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>持续整理中。。。</p></blockquote><a id="more"></a><h1 id="崩溃现场"><a href="#崩溃现场" class="headerlink" title="崩溃现场"></a>崩溃现场</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[@bjsjs_42_92 ~]# crash /usr/lib/debug/lib/modules/3.10.0-327.el7.x86_64/vmlinux /opt/var/crash/127.0.0.1-2019-08-06-10\:16\:35/vmcore</span><br><span class="line"></span><br><span class="line">crash 7.1.2-3.el7_2.1</span><br><span class="line">Copyright (C) 2002-2014  Red Hat, Inc.</span><br><span class="line">Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation</span><br><span class="line">Copyright (C) 1999-2006  Hewlett-Packard Co</span><br><span class="line">Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited</span><br><span class="line">Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.</span><br><span class="line">Copyright (C) 2005, 2011  NEC Corporation</span><br><span class="line">Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.</span><br><span class="line">Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.</span><br><span class="line">This program is free software, covered by the GNU General Public License,</span><br><span class="line">and you are welcome to change it and/or distribute copies of it under</span><br><span class="line">certain conditions.  Enter &quot;help copying&quot; to see the conditions.</span><br><span class="line">This program has absolutely no warranty.  Enter &quot;help warranty&quot; for details.</span><br><span class="line"></span><br><span class="line">GNU gdb (GDB) 7.6</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class="line">and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-unknown-linux-gnu&quot;...</span><br><span class="line"></span><br><span class="line">      KERNEL: /usr/lib/debug/lib/modules/3.10.0-327.el7.x86_64/vmlinux</span><br><span class="line">    DUMPFILE: /opt/var/crash/127.0.0.1-2019-08-06-10:16:35/vmcore  [PARTIAL DUMP]</span><br><span class="line">        CPUS: 40</span><br><span class="line">        DATE: Tue Aug  6 10:16:27 2019</span><br><span class="line">      UPTIME: 390 days, 14:40:34</span><br><span class="line">LOAD AVERAGE: 81.55, 29.79, 16.87</span><br><span class="line">       TASKS: 2448</span><br><span class="line">    NODENAME: bjsjs_42_92</span><br><span class="line">     RELEASE: 3.10.0-327.el7.x86_64</span><br><span class="line">     VERSION: #1 SMP Thu Nov 19 22:10:57 UTC 2015</span><br><span class="line">     MACHINE: x86_64  (2199 Mhz)</span><br><span class="line">      MEMORY: 127.9 GB</span><br><span class="line">       PANIC: &quot;kernel BUG at fs/buffer.c:1280!&quot;</span><br><span class="line">         PID: 57502</span><br><span class="line">     COMMAND: &quot;java&quot;</span><br><span class="line">        TASK: ffff88201a2eb980  [THREAD_INFO: ffff880f7566c000]</span><br><span class="line">         CPU: 26</span><br><span class="line">       STATE:  (PANIC)</span><br><span class="line"></span><br><span class="line">crash&gt; bt</span><br><span class="line">PID: 57502  TASK: ffff88201a2eb980  CPU: 26  COMMAND: &quot;java&quot;</span><br><span class="line"> #0 [ffff880f7566f5a8] machine_kexec at ffffffff81051beb</span><br><span class="line"> #1 [ffff880f7566f608] crash_kexec at ffffffff810f2542</span><br><span class="line"> #2 [ffff880f7566f6d8] oops_end at ffffffff8163e1a8</span><br><span class="line"> #3 [ffff880f7566f700] die at ffffffff8101859b</span><br><span class="line"> #4 [ffff880f7566f730] do_trap at ffffffff8163d860</span><br><span class="line"> #5 [ffff880f7566f780] do_invalid_op at ffffffff81015204</span><br><span class="line"> #6 [ffff880f7566f830] invalid_op at ffffffff8164701e</span><br><span class="line">    [exception RIP: check_irqs_on+4]</span><br><span class="line">    RIP: ffffffff816326d1  RSP: ffff880f7566f8e8  RFLAGS: 00010046</span><br><span class="line">    RAX: 0000000000000096  RBX: ffff8810092d9110  RCX: ffff880ee7d05800</span><br><span class="line">    RDX: 0000000000001000  RSI: 000000000090014a  RDI: ffff880f8cf4b740</span><br><span class="line">    RBP: ffff880f7566f8e8   R8: 0000000000000004   R9: 0000000000000004</span><br><span class="line">    R10: ffff880ee7d05800  R11: ffff880f7566f9e8  R12: ffff880f8cf4b740</span><br><span class="line">    R13: 0000000000001000  R14: ffff8801df370800  R15: 0000000000000010</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018</span><br><span class="line"> #7 [ffff880f7566f8f0] __find_get_block at ffffffff81212c85</span><br><span class="line"> #8 [ffff880f7566f910] __getblk at ffffffff81212cb5</span><br><span class="line"> #9 [ffff880f7566f970] __ext4_get_inode_loc at ffffffffa0373030 [ext4]</span><br><span class="line">#10 [ffff880f7566f9d8] ext4_get_inode_loc at ffffffffa0374dbd [ext4]</span><br><span class="line">#11 [ffff880f7566f9e8] ext4_reserve_inode_write at ffffffffa0376906 [ext4]</span><br><span class="line">#12 [ffff880f7566fa18] ext4_mark_inode_dirty at ffffffffa03769d3 [ext4]</span><br><span class="line">#13 [ffff880f7566fa70] ext4_writepages at ffffffffa0377567 [ext4]</span><br><span class="line">#14 [ffff880f7566fba8] do_writepages at ffffffff811758fe</span><br><span class="line">#15 [ffff880f7566fbb8] __filemap_fdatawrite_range at ffffffff8116a685</span><br><span class="line">#16 [ffff880f7566fc08] filemap_flush at ffffffff8116a74c</span><br><span class="line">#17 [ffff880f7566fc18] ext4_alloc_da_blocks at ffffffffa0374a8c [ext4]</span><br><span class="line">#18 [ffff880f7566fc38] ext4_release_file at ffffffffa036df89 [ext4]</span><br><span class="line">#19 [ffff880f7566fc60] __fput at ffffffff811e0329</span><br><span class="line">#20 [ffff880f7566fca8] ____fput at ffffffff811e05ee</span><br><span class="line">#21 [ffff880f7566fcb8] task_work_run at ffffffff810a22f4</span><br><span class="line">#22 [ffff880f7566fce8] do_exit at ffffffff810815eb</span><br><span class="line">#23 [ffff880f7566fd78] do_group_exit at ffffffff81081dff</span><br><span class="line">#24 [ffff880f7566fda8] get_signal_to_deliver at ffffffff81092c10</span><br><span class="line">#25 [ffff880f7566fe40] do_signal at ffffffff81014417</span><br><span class="line">#26 [ffff880f7566ff30] do_notify_resume at ffffffff81014adf</span><br><span class="line">#27 [ffff880f7566ff50] retint_signal at ffffffff8163d1fc</span><br><span class="line">    RIP: 00007f3db495ee17  RSP: 00007f3cbc8a20f0  RFLAGS: 00010246</span><br><span class="line">    RAX: 0000000000000006  RBX: 00007f3cbc8a2430  RCX: 0000000000000001</span><br><span class="line">    RDX: 00007f3cbc99f700  RSI: 0000000000000008  RDI: 0000000000000000</span><br><span class="line">    RBP: 00007f3cbc8a2220   R8: 00007f3cbc8a25f0   R9: 00007f3cbc8a24c0</span><br><span class="line">    R10: 00000000fffffe00  R11: 0000000000000000  R12: 000000000000000b</span><br><span class="line">    R13: 00007f3cbc8a24c0  R14: 00007f3cbc8a2430  R15: 00007f3db48ee2c5</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0033  SS: 002b</span><br><span class="line">crash&gt;</span><br></pre></td></tr></table></figure><h1 id="字段解释"><a href="#字段解释" class="headerlink" title="字段解释"></a>字段解释</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">KERNEL: 系统崩溃时运行的 kernel 文件</span><br><span class="line"></span><br><span class="line">DUMPFILE: 内核转储文件</span><br><span class="line"></span><br><span class="line">CPUS: 所在机器的 CPU 数量</span><br><span class="line"></span><br><span class="line">DATE: 系统崩溃的时间</span><br><span class="line"></span><br><span class="line">TASKS: 系统崩溃时内存中的任务数</span><br><span class="line"></span><br><span class="line">NODENAME: 崩溃的系统主机名</span><br><span class="line"></span><br><span class="line">RELEASE: 和 VERSION: 内核版本号</span><br><span class="line"></span><br><span class="line">MACHINE: CPU 架构</span><br><span class="line"></span><br><span class="line">MEMORY: 崩溃主机的物理内存</span><br><span class="line"></span><br><span class="line">PANIC: 崩溃类型，常见的崩溃类型包括：</span><br><span class="line"></span><br><span class="line">SysRq (System Request)：通过魔法组合键导致的系统崩溃，通常是测试使用。通过 echo c &gt; /proc/sysrq-trigger，就可以触发系统崩溃。</span><br><span class="line"></span><br><span class="line">oops：可以看成是内核级的 Segmentation Fault。应用程序如果进行了非法内存访问或执行了非法指令，会得到 Segfault 信号，一般行为是 coredump，应用程序也可以自己截获 Segfault 信号，自行处理。如果内核自己犯了这样的错误，则会弹出 oops 信息。</span><br></pre></td></tr></table></figure><h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/yum.repos.d/CentOS-Debug.repo  &lt;&lt;EOF</span><br><span class="line">[CentOS-Debug]</span><br><span class="line">name=CentOS-$releasever - DebugInfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/\$releasever/\$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">protect=1</span><br><span class="line">priority=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum --enablerepo=CentOS-Debug install -y kernel-debuginfo-$(uname -r)</span><br><span class="line"></span><br><span class="line">debuginfo-install glibc</span><br><span class="line"></span><br><span class="line">vmcore crash</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564573323&amp;ver=1762&amp;signature=eYQiG0V4e3pgc5iydmtd*UEuhY7rohGi9zaL*RC0WEfAiCVkC4t1brOW0hsLGkaT3Fb54tubjVVihDE24JBc3TDelUB8VS3dXWmA5oQSE8HyC*j7Cu8KTjfSmoYkL3wN&amp;new=1" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564573323&amp;ver=1762&amp;signature=eYQiG0V4e3pgc5iydmtd*UEuhY7rohGi9zaL*RC0WEfAiCVkC4t1brOW0hsLGkaT3Fb54tubjVVihDE24JBc3TDelUB8VS3dXWmA5oQSE8HyC*j7Cu8KTjfSmoYkL3wN&amp;new=1</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564546192&amp;ver=1761&amp;signature=4arrExz*PZo7Q3bQh5JnHWGSHOFGVdyWcc-WLOHUnHdNZoX6C0Abn*ENOjxlyt50u03ahhItFz7sj7wdGswCnLgOJ-HJBX1lEp8K2IlHxBggA8ZbcfAWj76YroR6wifv&amp;new=1" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564546192&amp;ver=1761&amp;signature=4arrExz*PZo7Q3bQh5JnHWGSHOFGVdyWcc-WLOHUnHdNZoX6C0Abn*ENOjxlyt50u03ahhItFz7sj7wdGswCnLgOJ-HJBX1lEp8K2IlHxBggA8ZbcfAWj76YroR6wifv&amp;new=1</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump1/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump1/index.html</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump3/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump3/index.html</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump4/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump4/index.html</a></p></li><li><p><a href="https://www.jianshu.com/p/5b4ef8112b97" target="_blank" rel="noopener">https://www.jianshu.com/p/5b4ef8112b97</a></p></li><li><p><a href="https://linux.cn/article-8737-1.html" target="_blank" rel="noopener">https://linux.cn/article-8737-1.html</a></p></li><li><p><a href="https://blog.csdn.net/yuanfang_way/article/details/77987399" target="_blank" rel="noopener">https://blog.csdn.net/yuanfang_way/article/details/77987399</a></p></li><li><p><a href="https://yq.aliyun.com/articles/483967" target="_blank" rel="noopener">https://yq.aliyun.com/articles/483967</a></p></li><li><p><a href="https://xiaoyeshiyu.github.io/linux/fae/2017/05/11/%E5%AE%9E%E4%BE%8B%E4%BD%BF%E7%94%A8crash%E5%88%86%E6%9E%90Kdump%E8%BD%AC%E5%82%A8kernel%E5%B4%A9%E6%BA%83%E5%86%85%E6%A0%B8/" target="_blank" rel="noopener">https://xiaoyeshiyu.github.io/linux/fae/2017/05/11/%E5%AE%9E%E4%BE%8B%E4%BD%BF%E7%94%A8crash%E5%88%86%E6%9E%90Kdump%E8%BD%AC%E5%82%A8kernel%E5%B4%A9%E6%BA%83%E5%86%85%E6%A0%B8/</a></p></li></ul>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>crash</tag>
      </tags>
  </entry>
  <entry>
    <title>常用Notebook使用笔记</title>
    <url>/%E5%B8%B8%E7%94%A8notebook%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>基础备忘</p></blockquote><a id="more"></a><h1 id="jupyter"><a href="#jupyter" class="headerlink" title="jupyter"></a>jupyter</h1><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul><li><p>列出主题</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jt -l</span><br></pre></td></tr></table></figure></li><li><p>选择主题</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jt -t grade3     #白</span><br><span class="line">jt -t solarizedl #浅土黄</span><br><span class="line">jt -t gruvboxl   #深土黄</span><br><span class="line">jt -t chesterish #深蓝</span><br><span class="line">jt -t solarizedd #深绿</span><br><span class="line">jt -t oceans16   #深灰</span><br><span class="line">jt -t monokai    #黑白</span><br><span class="line">jt -t gruvboxd   #黑黄</span><br><span class="line">jt -t onedork    #黑灰</span><br></pre></td></tr></table></figure></li><li><p>代码转PPT</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jupyter nbconvert *.ipynb --to slides --post serve</span><br></pre></td></tr></table></figure></li><li><p>绑定IP端口启动服务</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jupyter notebook --ip=10.0.0.1 --port=10001</span><br></pre></td></tr></table></figure></li><li><p>指定目录<br>jupyter notebook –ip=10.0.0.1 –port=10001 nibilaoyedenotebook</p></li><li><p>创建密码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br><span class="line">jupyter notebook password --ip=10.0.0.1 --port=10001</span><br></pre></td></tr></table></figure></li></ul><h1 id="zeppelin"><a href="#zeppelin" class="headerlink" title="zeppelin"></a>zeppelin</h1><h2 id="ldap-认证"><a href="#ldap-认证" class="headerlink" title="ldap 认证"></a>ldap 认证</h2><ul><li>userDnTemplate中的{0}表示登录时输入的用户名,</li><li>conf/zeppelin-site.xml修改zeppelin.anonymous.allowed属性为false</li><li>ldapRealm.contextFactory.authenticationMechanism后面的赋值选项<ul><li>none</li><li>simple</li><li>SASL</li><li>DIGEST-MD5<ul><li><a href="https://github.com/apache/zeppelin/pull/2331" target="_blank" rel="noopener">https://github.com/apache/zeppelin/pull/2331</a></li></ul></li></ul></li></ul><h2 id="nginx代理关键配置"><a href="#nginx代理关键配置" class="headerlink" title="nginx代理关键配置"></a>nginx代理关键配置</h2><ul><li><p>zeppelin</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat conf/zeppelin-site.xml</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;zeppelin.server.context.path&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/zeppelin/&lt;/value&gt;</span><br><span class="line">  &lt;description&gt;Context Path of the Web Application&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure></li><li><p>nginx</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream zeppelin &#123;</span><br><span class="line">        server 10.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location /zeppelin</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http://zeppelin;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br><span class="line">location /zeppelin/ws &#123;  # For websocket support</span><br><span class="line">    proxy_pass http://zeppelin;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Upgrade websocket;</span><br><span class="line">    proxy_set_header Connection upgrade;</span><br><span class="line">    proxy_read_timeout 86400;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><p>-<a href="https://nbviewer.jupyter.org/" target="_blank" rel="noopener">upyter Notebooks 共享社区</a></p><ul><li><p><a href="https://jupyter-notebook.readthedocs.io/en/stable/security.html#alternatives-to-token-authentication" target="_blank" rel="noopener">https://jupyter-notebook.readthedocs.io/en/stable/security.html#alternatives-to-token-authentication</a></p></li><li><p><a href="https://zeppelin.apache.org/docs/0.8.0/setup/security/shiro_authentication.html" target="_blank" rel="noopener">https://zeppelin.apache.org/docs/0.8.0/setup/security/shiro_authentication.html</a></p></li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>jupyter</tag>
        <tag>zeppelin</tag>
      </tags>
  </entry>
  <entry>
    <title>自签ssl证书</title>
    <url>/%E8%87%AA%E7%AD%BEssl%E8%AF%81%E4%B9%A6/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>devops 必备技能</p></blockquote><a id="more"></a><ul><li><p>查看当前系统使用的 OpenSSL 版本</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">openssl version</span><br></pre></td></tr></table></figure></li><li><p>获取完整的版本信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">openssl version -a</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>X.509 是密码学里公钥证书的格式标准。一般包含三类文件，key，csr，crt。</p></blockquote><ul><li>key是私用密钥，openssl格式，通常是rsa算法。</li><li>csr是证书请求文件，用于申请证书。在制作csr文件的时候，必须使用自己的私钥来签署申请，还可以设定一个密钥。</li><li>crt是CA认证后的证书文件（windows下面的csr，其实是crt），签署人用自己的key给你签署的凭证。</li></ul><h1 id="证书创建过程"><a href="#证书创建过程" class="headerlink" title="证书创建过程"></a>证书创建过程</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir /usr/local/nginx/conf/cert</span><br><span class="line">cd /usr/local/nginx/conf/cert</span><br><span class="line"></span><br><span class="line">#创建RSA私有密钥</span><br><span class="line">openssl genrsa  -out domainName.key 2048</span><br><span class="line"># 创建CSR(为申请数字服务器证书而发送至证书颁发机构 (CA) 的文件)</span><br><span class="line">openssl req -out domainName.csr -key domainName.key -new -sha256</span><br><span class="line">mv domainName.key domainName.origin.key</span><br><span class="line"># 删除RSA私钥密码</span><br><span class="line">openssl rsa -in domainName.origin.key -out domainName.key</span><br><span class="line"># 请使用 openssl x509 对证书进行签名(使用私钥和签名请求创建的公有证书)</span><br><span class="line">openssl x509 -req -sha256 -days 3650 -in domainName.csr -signkey domainName.key -out domainName.crt</span><br></pre></td></tr></table></figure><h1 id="nginx相关配置"><a href="#nginx相关配置" class="headerlink" title="nginx相关配置"></a>nginx相关配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">   listen 443 ssl;</span><br><span class="line">   ssl_certificate     /usr/local/nginx/conf/cert/domainName.crt;</span><br><span class="line">   ssl_certificate_key  /usr/local/nginx/conf/cert/domainName.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx" target="_blank" rel="noopener">certbot生成CentOS7证书</a></li><li><a href="https://certbot.eff.org/docs/using.html#nginx" target="_blank" rel="noopener">certbot官方文档</a></li><li><a href="https://www.openssl.org/docs/man1.1.1/man1/" target="_blank" rel="noopener">OpenSSL commands·官方文档</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/configuring-https-ssl.html" target="_blank" rel="noopener">创建和签名 X509 证书</a></li><li><a href="https://www.jianshu.com/p/f5d9d778d9dc" target="_blank" rel="noopener">openssl 生成nginx 证书</a></li></ul>]]></content>
      <tags>
        <tag>openssl</tag>
        <tag>https</tag>
      </tags>
  </entry>
  <entry>
    <title>开源论坛技术栈</title>
    <url>/%E5%BC%80%E6%BA%90%E8%AE%BA%E5%9D%9B%E6%8A%80%E6%9C%AF%E6%A0%88/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>摘要内容</p></blockquote><a id="more"></a><h1 id="nodebb"><a href="#nodebb" class="headerlink" title="nodebb"></a>nodebb</h1><h2 id="命令行安装-启-停插件"><a href="#命令行安装-启-停插件" class="headerlink" title="命令行安装/启/停插件"></a>命令行安装/启/停插件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 列出插件列表</span><br><span class="line">./nodebb plugins</span><br><span class="line">npm install nodebb-plugin-office-ldap</span><br><span class="line">./nodebb reset --plugin nodebb-plugin-office-ldap</span><br><span class="line">./nodebb restart</span><br><span class="line">./nodebb activate nodebb-plugin-office-ldap</span><br><span class="line">./nodebb restart</span><br></pre></td></tr></table></figure><h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">crontab:</span><br><span class="line">*/2 * * * * /data/nodebb/nodebb.mongo.backup.sh &gt;&gt; /data/nodebb/backupLogs/backup.log.$(date &quot;+\%Y\%m\%d\%H\%M\%S&quot;) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">cat nodebb.mongo.backup.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">backupDir=/data/nodebb/db-backups/mongo.backup.v$(date &quot;+%Y%m%d_%H%M%S&quot;)</span><br><span class="line">mkdir -v $&#123;backupDir&#125;</span><br><span class="line">/usr/bin/mongodump -h 127.0.0.1:27017 -d nodebb -o $&#123;backupDir&#125;</span><br><span class="line">cd $(dirname $&#123;backupDir&#125;)</span><br><span class="line">tar -czf  $(basename $&#123;backupDir&#125;).tar.gz $(basename $&#123;backupDir&#125;)</span><br><span class="line">rm -rvf $(basename $&#123;backupDir&#125;)</span><br></pre></td></tr></table></figure><h2 id="中文搜索支持"><a href="#中文搜索支持" class="headerlink" title="中文搜索支持"></a>中文搜索支持</h2><p>nodebb-plugin-solr</p><h2 id="solr部署"><a href="#solr部署" class="headerlink" title="solr部署"></a>solr部署</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http://apache.mirrors.lucidnetworks.net/lucene/solr/8.2.0/solr-8.2.0.tgz -O - |tar -zx</span><br><span class="line">ulimit -u 65000</span><br><span class="line">cd /path/to/solr/server/solr</span><br><span class="line">/path/to/solr/bin/solr create_core -c nodebb            #创建核心</span><br><span class="line">/path/to/solr/bin/solr create_collection -c nodebb      #cloud模式下</span><br><span class="line">/path/to/solr/bin/solr delete -c nodebb                 # 删除核心创建核心</span><br><span class="line">/path/to/solr/bin/solr status                           # 查看solr节点信息</span><br><span class="line">./bin/solr start</span><br><span class="line">/path/to/solr/bin/solr start -e cloud                   #以cloud实例模式运行</span><br><span class="line">/path/to/solr/bin/solr create_collection -c nodebb -s 3 -rf 3</span><br><span class="line">/path/to/solr/bin/solr auth enable -type basicAuth -credentials admin:nodebbAdmin</span><br><span class="line">/path/to/solr/bin/solr auth disable</span><br></pre></td></tr></table></figure><ul><li><a href="https://www.w3cschool.cn/solr_doc/solr_doc-emn62fs5.html" target="_blank" rel="noopener">以示例配置运行</a></li></ul><h1 id="discourse"><a href="#discourse" class="headerlink" title="discourse"></a>discourse</h1><p>官方仅提供docker部署方式</p><h1 id="Flarum"><a href="#Flarum" class="headerlink" title="Flarum"></a>Flarum</h1><p>Beta版本，功能和易用性相对较差</p><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://docs.archive.nodebb.org/zh_CN/latest/configuring/databases/mongo.html" target="_blank" rel="noopener">nodebb官方文档</a></p></li><li><p><a href="https://docs.nodebb.org/installing/os/centos/" target="_blank" rel="noopener">https://docs.nodebb.org/installing/os/centos/</a></p></li><li><p><a href="https://hearrain.com/2015/12/847" target="_blank" rel="noopener">https://hearrain.com/2015/12/847</a></p></li><li><p><a href="https://www.rosehosting.com/blog/how-to-install-nodebb-on-a-centos-7-vps/" target="_blank" rel="noopener">https://www.rosehosting.com/blog/how-to-install-nodebb-on-a-centos-7-vps/</a></p></li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>开源工具</tag>
        <tag>nodebb</tag>
      </tags>
  </entry>
  <entry>
    <title>基于scrcpy远程操控android设备</title>
    <url>/%E5%9F%BA%E4%BA%8Escrcpy%E8%BF%9C%E7%A8%8B%E6%93%8D%E6%8E%A7android%E8%AE%BE%E5%A4%87/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>非常酷炫的操作。。。</p></blockquote><a id="more"></a><h1 id="USB模式"><a href="#USB模式" class="headerlink" title="USB模式"></a>USB模式</h1><blockquote><p>需要通过USB线直连Android设备。</p></blockquote><h2 id="打开开发者选项"><a href="#打开开发者选项" class="headerlink" title="打开开发者选项"></a>打开开发者选项</h2><blockquote><p>当手机开发者选项隐藏关闭时，需要打开开发者选项，设置&gt;系统&gt;关于手机&gt;版本号，<a href="https://developer.android.com/studio/debug/dev-options?hl=zh-CN" target="_blank" rel="noopener">点击版本号信息7次</a>,返回上一屏幕，在底部附近可以找到开发者选项</p></blockquote><h2 id="打开USB调试"><a href="#打开USB调试" class="headerlink" title="打开USB调试"></a>打开USB调试</h2><blockquote><p>设置&gt;系统&gt;开发者选项&gt;USB调试，打开USB调试</p></blockquote><h2 id="打开”仅充电”模式下允许ADB调试"><a href="#打开”仅充电”模式下允许ADB调试" class="headerlink" title="打开”仅充电”模式下允许ADB调试"></a>打开”仅充电”模式下允许ADB调试</h2><blockquote><p>设置&gt;系统&gt;开发者选项&gt;”仅充电”模式下允许ADB调试，打开”仅充电”模式下允许ADB调试</p></blockquote><h2 id="执行-scrcpy-exe-即可"><a href="#执行-scrcpy-exe-即可" class="headerlink" title="执行 scrcpy.exe, 即可"></a>执行 <code>scrcpy.exe</code>, 即可</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\scrcpy-win64-v1.10&gt; .\scrcpy.exe</span><br><span class="line">INFO: scrcpy 1.10 &lt;https://github.com/Genymobile/scrcpy&gt;</span><br><span class="line">E:\PortableSoftwares\scrcpy-win64-v1.10\scrcpy-server.jar: 1 file pushed. 0.0 MB/s (22546 bytes in 0.435s)</span><br><span class="line">INFO: Initial texture: 1080x1920</span><br></pre></td></tr></table></figure><h1 id="wifi模式"><a href="#wifi模式" class="headerlink" title="wifi模式"></a>wifi模式</h1><blockquote><p>前三步和USB模式相同，同时要求，adb调试设备和被调试设备在同一WLAN网络</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS C:\WINDOWS\system32&gt; adb tcpip 5555</span><br><span class="line">PS C:\WINDOWS\system32&gt; adb connect 10.10.10.2:5555</span><br><span class="line">connected to 10.10.10.2:5555</span><br><span class="line"># 至此可拔掉USB连接线</span><br><span class="line">PS C:\WINDOWS\system32&gt; cd C:\scrcpy-win64-v1.10</span><br><span class="line">PS C:\scrcpy-win64-v1.10&gt; .\scrcpy.exe</span><br><span class="line">INFO: scrcpy 1.10 &lt;https://github.com/Genymobile/scrcpy&gt;</span><br><span class="line">E:\PortableSoftwares\scrcpy-win64-v1.10\scrcpy-server.jar: 1 file pushed. 0.0 MB/s (22546 bytes in 0.431s)</span><br><span class="line">INFO: Initial texture: 1080x1920</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://github.com/Genymobile/scrcpy" target="_blank" rel="noopener">scrcpy</a></p></li><li><p><a href="https://github.com/Tomotoes/scrcpy-gui" target="_blank" rel="noopener">scrcpy-gui</a></p></li><li><p><a href="https://developer.android.com/studio/command-line/adb.html#Enabling" target="_blank" rel="noopener">android开发者文档·在设备上启用 adb 调试</a></p></li><li><p><a href="https://developer.android.com/studio/releases/platform-tools.html" target="_blank" rel="noopener">Android SDK Platform-Tools下载·adb命令</a></p></li></ul>]]></content>
      <categories>
        <category>工具控</category>
      </categories>
      <tags>
        <tag>scrcpy</tag>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux开机启动的多种实现方式</title>
    <url>/linux%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>开机启动是运维自动化的重要组成部分。</p></blockquote><a id="more"></a><h1 id="etc-rc-local"><a href="#etc-rc-local" class="headerlink" title="/etc/rc.local"></a>/etc/rc.local</h1><blockquote><p>可将开机启动命令追加到/etc/rc.local中</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># readlink /etc/rc.local</span><br><span class="line">rc.d/rc.local         // /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><h1 id="chkconfig"><a href="#chkconfig" class="headerlink" title="chkconfig"></a>chkconfig</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># readlink /etc/init.d</span><br><span class="line">rc.d/init.d           // /etc/rc.d/init.d/</span><br><span class="line"></span><br><span class="line">chkconfig --add servicename             # 使服务会被在/etc/rc.d/rcN.d中赋予K/S入口</span><br><span class="line">chkconfig --level 35 servicename on 或 sudo update-rc.d servicename defaults 95</span><br><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure><ul><li><p>服务脚本必须存放在/etc/ini.d/目录下</p></li><li><p>/etc/ini.d/下的脚本最开始必须包含以下三行</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line"># chkconfig: - 58 74    # 分别代表运行级别，启动优先权，关闭优先权，此行代码必须</span><br><span class="line"># description:</span><br></pre></td></tr></table></figure></li></ul><h1 id="etc-profile-d"><a href="#etc-profile-d" class="headerlink" title="/etc/profile.d/"></a>/etc/profile.d/</h1><ul><li><p>登陆自动执行(/etc/profile.d/)，不仅仅是开机自动执行。</p></li><li><p>必须是.sh后缀的脚本文件</p></li></ul><h1 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl list-unit-files --type=service | grep enabled         # 查看允许开机启动的服务进程</span><br><span class="line">systemctl list -units --type=service                            # 查看所有已启动的服务</span><br><span class="line">systemctl mask daemon.service                                   # 在任何情况下系统启动时都不启动该进程</span><br><span class="line">systemctl enable daemon.service                                 # 设置开机启动</span><br><span class="line">systemctl disable daemon.service                                # 禁止开机启动</span><br><span class="line">systemctl is-enabled daemon.service                             # 确认服务是否开机启动</span><br><span class="line">ll  /etc/systemd/system/multi-user.target.wants/                # 查看所有开启启动的服务</span><br></pre></td></tr></table></figure><h1 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@reboot root ( sleep 30; sh /path/to/script.sh )    # 经验证，cron配置中支持小括号</span><br></pre></td></tr></table></figure><ul><li>cron支持的关键字<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@reboot at startup</span><br><span class="line">@yearly once a year</span><br><span class="line">@annually ( == @yearly)</span><br><span class="line">@monthly once a month</span><br><span class="line">@weekly once a week</span><br><span class="line">@daily once a day</span><br><span class="line">@midnight ( == @daily)</span><br><span class="line">@hourly once an hour</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>chkconfig</tag>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux环境中精确控制普通用户的sudo权限</title>
    <url>/linux%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%B2%BE%E7%A1%AE%E6%8E%A7%E5%88%B6%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%9A%84sudo%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<p>精准施控才能游刃有余。</p><a id="more"></a><h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><blockquote><p>在持续集成的实践中,为了保障生产环境安全可靠避免意外事故的发生。需要限制用户的操作权限，又要满足构建需要，因此需要对持续集成过程中的操作命令权限进行精准控制。实现最小权限开放，最大灵活性保障。</p></blockquote><h1 id="sudo配置"><a href="#sudo配置" class="headerlink" title="sudo配置"></a>sudo配置</h1><ul><li><p>配置文件名不能包含.后缀(文件名中不能包含.)，否则配置不生效。</p></li><li><p>生成配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt; /etc/sudoers.d/jenkins_deploy &lt;&lt; EOF</span><br><span class="line">Host_Alias     JENKINS_SERVERS = $(echo -n $(ip addr show dev eth0 | awk &apos;/inet/ &#123;sub(/\//, &quot; &quot;); print $2&#125;&apos;|head -1)), 127.0.0.1</span><br><span class="line">Cmnd_Alias      JENKINS_CMD = $(which rsync), $(which ln), $(which unlink), $(which readlink), $(which test), $(which mv), $(which mkdir)</span><br><span class="line">Defaults:jenkins        !requiretty</span><br><span class="line">Defaults!JENKINS_CMD	  !syslog</span><br><span class="line">jenkins         JENKINS_SERVERS=(root)      NOPASSWD: JENKINS_CMD</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>配置范例</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Host_Alias     JENKINS_SERVERS = 10.0.0.1, 127.0.0.1</span><br><span class="line">Cmnd_Alias      JENKINS_CMD = /usr/bin/rsync, /bin/ln, /bin/unlink, /usr/bin/readlink, /usr/bin/test, /bin/mv, /bin/mkdir</span><br><span class="line">Defaults:jenkins	    !requiretty</span><br><span class="line">Defaults!JENKINS_CMD	!syslog</span><br><span class="line">jenkins		JENKINS_SERVERS=(root)      NOPASSWD: JENKINS_CMD</span><br></pre></td></tr></table></figure></li></ul><blockquote><ul><li>主机别名定义 sudo 用户有权在哪个服务器（或特定范围内的服务器）上发出命令。在主机别名中，可以使用 DNS 名称或 IP 地址，或者指定整个网络范围（例如 172.17.12.0/24）。要限制访问范围，应该仅指定群集节点的主机名。别名必须全部而且只能使用大写英文字母的组合</li><li>centos 5 的默认版本sudo-1.7.2p1-14.el5_8.4 不支持JENKINS_SERVERS中使用网段掩码</li></ul></blockquote><h1 id="ALL-ALL-ALL-ALL-配置字段解释"><a href="#ALL-ALL-ALL-ALL-配置字段解释" class="headerlink" title="ALL ALL=(ALL) ALL 配置字段解释"></a>ALL ALL=(ALL) ALL 配置字段解释</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALL ALL=(ALL) ALL</span><br><span class="line">The first ALL is the users allowed</span><br><span class="line">The second one is the hosts</span><br><span class="line">The third one is the user as you are running the command</span><br><span class="line">The last one is the commands allowed</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="https://unix.stackexchange.com/questions/201858/what-does-all-all-all-all-mean-in-sudoers" target="_blank" rel="noopener">What does “ALL ALL=(ALL) ALL” mean in sudoers?</a></p></li><li><p><a href="https://wiki.archlinux.org/index.php/Sudo" target="_blank" rel="noopener">archlinux·sudo</a></p></li></ul>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>权限管理</tag>
        <tag>sudoers</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache No space left on device</title>
    <url>/apache-no-space-left-on-device/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Inter-Process Communication，进程间通信</p></blockquote><a id="more"></a><h1 id="报错信息"><a href="#报错信息" class="headerlink" title="报错信息"></a>报错信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /var/logs/httpd/error_log |grep -i device</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] create_server_temp_conf begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] create_server_temp_conf end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] Digest: generating secret for digest authentication ...</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] Digest: done</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_mc_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_qdb_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_socket_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_schat_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: for loop i=0, server_no:1,0,900,1000</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [warn] pid file /etc/httpd/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [emerg] (28)No space left on device: Couldn&apos;t create accept lock (/etc/httpd/logs/accept.lock.23014) (5)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ipcs -s</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 65273857   apache    600        1</span><br><span class="line">0x00000000 65372162   apache    600        1</span><br><span class="line">0x00000000 65470467   apache    600        1</span><br><span class="line">0x00000000 65568772   apache    600        1</span><br><span class="line">0x00000000 65667077   apache    600        1</span><br><span class="line">0x00000000 65765382   apache    600        1</span><br><span class="line">0x00000000 65863687   apache    600        1</span><br><span class="line">0x00000000 65961992   apache    600        1</span><br><span class="line">0x00000000 66060297   apache    600        1</span><br><span class="line">0x00000000 66158602   apache    600        1</span><br><span class="line">0x00000000 66256907   apache    600        1</span><br><span class="line">0x00000000 66355212   apache    600        1</span><br><span class="line">0x00000000 66453517   apache    600        1</span><br><span class="line">0x00000000 66551822   apache    600        1</span><br><span class="line">0x00000000 66650127   apache    600        1</span><br><span class="line">0x00000000 66748432   apache    600        1</span><br><span class="line">0x00000000 66846737   apache    600        1</span><br><span class="line">0x00000000 66945042   apache    600        1</span><br><span class="line">0x00000000 67043347   apache    600        1</span><br><span class="line">0x00000000 67141652   apache    600        1</span><br><span class="line">0x00000000 67239957   apache    600        1</span><br><span class="line">0x00000000 67338262   apache    600        1</span><br><span class="line">0x00000000 67436567   apache    600        1</span><br><span class="line">0x00000000 67534872   apache    600        1</span><br><span class="line">0x00000000 67633177   apache    600        1</span><br><span class="line">0x00000000 67731482   apache    600        1</span><br><span class="line">0x00000000 67829787   apache    600        1</span><br><span class="line">0x00000000 67928092   apache    600        1</span><br><span class="line">0x00000000 68026397   apache    600        1</span><br><span class="line">0x00000000 68124702   apache    600        1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ipcs -l</span><br><span class="line"></span><br><span class="line">------ Shared Memory Limits --------</span><br><span class="line">max number of segments = 4096</span><br><span class="line">max seg size (kbytes) = 67108864</span><br><span class="line">max total shared memory (kbytes) = 17179869184</span><br><span class="line">min seg size (bytes) = 1</span><br><span class="line"></span><br><span class="line">------ Semaphore Limits --------</span><br><span class="line">max number of arrays = 512</span><br><span class="line">max semaphores per array = 25032000</span><br><span class="line">max semaphores system wide = 32</span><br><span class="line">max ops per semop call = 512</span><br><span class="line">semaphore max value = 32767</span><br><span class="line"></span><br><span class="line">------ Messages: Limits --------</span><br><span class="line">max queues system wide = 16</span><br><span class="line">max size of message (bytes) = 65536</span><br><span class="line">default max size of queue (bytes) = 65536</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ipcs -a</span><br><span class="line"></span><br><span class="line">------ Shared Memory Segments --------</span><br><span class="line">key        shmid      owner      perms      bytes      nattch     status</span><br><span class="line">0x74008327 3440640    root      600        4          0</span><br><span class="line">0x740082fd 4128769    root      600        4          0</span><br><span class="line">0x00000000 4489218    root      644        80         2</span><br><span class="line">0x740082fc 4096003    root      600        4          0</span><br><span class="line">0x00000000 4521988    root      644        16384      2</span><br><span class="line">0x00000000 4554757    root      644        280        2</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 170524673  apache    600        1</span><br><span class="line">0x00000000 170557442  apache    600        1</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br></pre></td></tr></table></figure><h1 id="处理方案"><a href="#处理方案" class="headerlink" title="处理方案"></a>处理方案</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># for i in $(/usr/bin/ipcs -s | awk &apos;/apache/ &#123;print $2&#125;&apos;); do /usr/bin/ipcrm -s $i; done</span><br><span class="line"># ipcs -s</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 170524673  apache    600        1</span><br><span class="line">0x00000000 170557442  apache    600        1</span><br></pre></td></tr></table></figure><h1 id="linux-unix下的进程间两类通信方式"><a href="#linux-unix下的进程间两类通信方式" class="headerlink" title="linux/unix下的进程间两类通信方式"></a>linux/unix下的进程间两类通信方式</h1><h2 id="基于文件的IPC"><a href="#基于文件的IPC" class="headerlink" title="基于文件的IPC"></a>基于文件的IPC</h2><ul><li>基于普通文件的IPC</li><li>基于管道文件的IPC<ul><li>普通管道</li><li>匿名管道<ul><li>匿名管道只能使用在父子进程之间</li></ul></li></ul></li><li>基于socket文件的IPC<ul><li>对等模型<ul><li>对等模型主要用于udp编程</li></ul></li><li>C/S模型<ul><li>C/S模型主要用于TCP编程</li></ul></li></ul></li></ul><h2 id="基于内存的IPC"><a href="#基于内存的IPC" class="headerlink" title="基于内存的IPC"></a>基于内存的IPC</h2><ul><li>基于共享内存的IPC，</li><li>基于共享队列的IPC，</li><li>基于信号量的IPC。</li><li>内核内存的工具（ipcs）<blockquote><p>ipcs命令往标准输出写入一些关于活动进程间通信设施的信息.</p><ul><li>ipcs可以指定查看的具体信息，<ul><li>如ipcs -m 查看共享内存，</li><li>-q：查看共享队列，</li><li>ipcs -s查看共享信号量，</li><li>以上3中都不指定时则是查看共享内存、共享队列和共享信号量</li></ul></li></ul></blockquote></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><p><a href="https://major.io/2007/08/24/apache-no-space-left-on-device-couldnt-create-accept-lock/" target="_blank" rel="noopener">Apache: No space left on device: Couldn’t create accept lock</a></p></li><li><p><a href="http://www.voidcn.com/article/p-xilljgvz-ms.html" target="_blank" rel="noopener">ipcs命令详解</a></p></li></ul>]]></content>
      <categories>
        <category>IPC</category>
      </categories>
      <tags>
        <tag>Apache</tag>
        <tag>httpd</tag>
        <tag>IPC</tag>
      </tags>
  </entry>
  <entry>
    <title>应用开发的12要素</title>
    <url>/%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E7%9A%8412%E8%A6%81%E7%B4%A0/</url>
    <content><![CDATA[<p>12-Factor 为构建 SaaS 应用提供方法论。</p><a id="more"></a><ul><li><p>基准代码</p><blockquote><p>一份基准代码，多份部署</p></blockquote></li><li><p>依赖</p><blockquote><p>显式声明依赖关系</p></blockquote></li><li><p>配置</p><blockquote><p>在环境中存储配置</p></blockquote></li><li><p>后端服务</p><blockquote><p>把后端服务当作附加资源</p></blockquote></li><li><p>构建，发布，运行</p><blockquote><p>严格分离构建和运行</p></blockquote></li><li><p>进程</p><blockquote><p>以一个或多个无状态进程运行应用</p></blockquote></li><li><p>端口绑定</p><blockquote><p>通过端口绑定提供服务</p></blockquote></li><li><p>并发</p><blockquote><p>通过进程模型进行扩展</p></blockquote></li><li><p>易处理</p><blockquote><p>快速启动和优雅终止可最大化健壮性</p></blockquote></li><li><p>开发环境与线上环境等价</p><blockquote><p>尽可能的保持开发，预发布，线上环境相同</p></blockquote></li><li><p>日志</p><blockquote><p>把日志当作事件流</p></blockquote></li><li><p>管理进程</p><blockquote><p>后台管理任务当作一次性进程运行</p></blockquote></li></ul><h1 id="转载自"><a href="#转载自" class="headerlink" title="转载自"></a>转载自</h1><ul><li><a href="https://www.12factor.net/zh_cn/" target="_blank" rel="noopener">THE TWELVE-FACTOR APP</a></li></ul>]]></content>
      <categories>
        <category>12factor</category>
      </categories>
      <tags>
        <tag>12factor</tag>
      </tags>
  </entry>
  <entry>
    <title>git基础实践</title>
    <url>/git%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Git 是 Linus Torvalds为了帮助管理Linux内核开发而开发的一个开放源码的版本控制软件。</p></blockquote><a id="more"></a><h1 id="git常用命令"><a href="#git常用命令" class="headerlink" title="git常用命令"></a>git常用命令</h1><ul><li><p>列出当前配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure></li><li><p>列出repository配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --local --list</span><br></pre></td></tr></table></figure></li><li><p>列出全局配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global --list</span><br></pre></td></tr></table></figure></li><li><p>列出系统配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --system --list</span><br></pre></td></tr></table></figure></li><li><p>配置用户名</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;your name&quot;</span><br></pre></td></tr></table></figure></li><li><p>配置用户邮箱</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.email &quot;youremail@github.com&quot;</span><br></pre></td></tr></table></figure></li><li><p>配置git命令输出为彩色</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global color.ui auto</span><br></pre></td></tr></table></figure></li><li><p>查看当前工作区的所有文件的状态</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure></li><li><p>查看提交历史：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure></li><li><p>参数-p展开每次提交的内容差异，如-2显示最近的两次更新</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log -p -2;</span><br></pre></td></tr></table></figure></li><li><p>提交工作区所有文件到暂存区</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure></li><li><p>删除工作区文件并且也从暂存区删除对应文件的记录</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rm &lt;file1&gt; &lt;file2&gt;</span><br></pre></td></tr></table></figure></li><li><p>比较工作区中当前文件和暂存区之间的差异</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git diff &lt;file-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>隐藏当前变更</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure></li><li><p>查看当前所有的储藏</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure></li><li><p>应用最新的储藏</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git stash apply</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>将暂存区中的文件提交到本地仓库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;commit_info&quot;</span><br></pre></td></tr></table></figure></li><li><p>将所有已经使用git管理过的文件暂存并提交,相当于执行git add和git commit</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit -a -m &quot;commit_info&quot;</span><br></pre></td></tr></table></figure></li><li><p>撤销上一次提交</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>比较暂存区与上一版本的差异</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure></li><li><p>指定文件在暂存区和本地仓库的不同</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git diff &lt;file-name&gt; --cached</span><br></pre></td></tr></table></figure></li><li><p>列出现在所有的标签</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></li><li><p>使用特定的搜索模式列出符合条件的标签</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git tag -l &quot;v1.*&quot;</span><br></pre></td></tr></table></figure></li><li><p>创建一个含附注类型的标签，加-a参数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git tag -a v1.4 -m &quot;my version 1.4&quot;</span><br></pre></td></tr></table></figure></li><li><p>使用git show命令查看相应标签的版本信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git show v2.0</span><br></pre></td></tr></table></figure></li><li><p>将标签推送到远程仓库中</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin</span><br><span class="line">eg: git push origin v2.0</span><br></pre></td></tr></table></figure></li><li><p>将本地所有的标签全部推送到远程仓库中：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure></li><li><p>创建分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>切换分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>创建并切换到分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b &lt;new branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>删除分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -d &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>将当前分支与指定分支进行合并</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge &lt;another branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>显示本地仓库的所有分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure></li><li><p>显示各个分支最新一次提交对象的信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch -v</span><br></pre></td></tr></table></figure></li><li><p>查看哪些分支已经合并到了当前分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch --merged</span><br></pre></td></tr></table></figure></li><li><p>查看哪些分支还没有合并到当前分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch --no-merged</span><br></pre></td></tr></table></figure></li><li><p>把远程分支合并到当前分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge &lt;remote-name&gt;/&lt;branch name&gt;</span><br><span class="line">eg:</span><br><span class="line">git merge origin/devel</span><br></pre></td></tr></table></figure></li><li><p>在远程分支的基础上创建新的本地分支(跟踪分支)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git checkout -b &lt;branch name&gt; &lt;remote-name&gt;/&lt;branch name&gt;</span><br><span class="line">eg:</span><br><span class="line">git checkout -b devel orgin/devel</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>查看本地仓库关联的远程仓库，-v参数会显示远程仓库的url地址</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure></li><li><p>添加远程仓库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote add &lt;remote-name&gt; &lt;url&gt;</span><br><span class="line">eg:</span><br><span class="line">git remote add blog https://github.com/blog/blog.git</span><br></pre></td></tr></table></figure></li><li><p>从远程仓库中拉取更新</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git fetch &lt;remote-name&gt;</span><br><span class="line">git fetch origin</span><br></pre></td></tr></table></figure><ul><li>git fetch 只会讲远端数据拉到本地仓库，并不会自动合并到当前工作分支，需要人为合并，如果设置了某个分支关联到远程仓库的某个分支可以使用<code>git pull</code>来拉取远程分支的数据自动合并到当前分支；</li></ul></li><li><p>将本地仓库分支推送到远程仓库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push &lt;remote name&gt; &lt;branch name&gt;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></li><li><p>将本地分支推送到远程仓库不同名分支</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push &lt;remote name&gt; &lt;local branch&gt;:&lt;remote branch&gt;</span><br></pre></td></tr></table></figure></li><li><p>删除远程分支(本地内容为空)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git push &lt;remote name&gt; :&lt;remote branch&gt;</span><br><span class="line">git push origin</span><br></pre></td></tr></table></figure></li><li><p>查看远程仓库的详细信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote show origin</span><br></pre></td></tr></table></figure></li><li><p>修改远程仓库在本地的简称</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote rename &lt;old name&gt; &lt;new name&gt;</span><br><span class="line">git remote rename origin ori</span><br></pre></td></tr></table></figure></li><li><p>移除远程仓库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote rm &lt;remote name&gt;</span><br></pre></td></tr></table></figure></li><li><p>git clone 指定分支:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone -b stable-2.2 https://github.com/ansible/ansible-modules-core.git</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>git 回滚版本</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git reset --hard sha</span><br><span class="line">git push origin HEAD --force</span><br></pre></td></tr></table></figure></li><li><p>合并到主分支</p></li></ul><ul><li>git rebase和git merge的区别</li></ul><h1 id="常见报错处理"><a href="#常见报错处理" class="headerlink" title="常见报错处理"></a>常见报错处理</h1><ul><li><p>报错内容</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fatal: unable to access &apos;https://github.com/xxxx/xxxx.github.io.git/&apos;: SSL certificate problem: self signed certificate in certificate chain</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: fatal: unable to access &apos;https://github.com/xxxx/xxxx.github.io.git/&apos;: SSL certificate problem: self signed certificate in certificate chain</span><br><span class="line"></span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (H:\hexo-Blog\node_modules\hexo-util\lib\spawn.js:37:17)</span><br><span class="line">    at emitTwo (events.js:126:13)</span><br><span class="line">    at ChildProcess.emit (events.js:214:7)</span><br><span class="line">    at ChildProcess.cp.emit (H:\hexo-Blog\node_modules\cross-spawn\lib\enoent.js:40:29)</span><br><span class="line">    at maybeClose (internal/child_process.js:925:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:209:5)</span><br></pre></td></tr></table></figure><ul><li>解决方法<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global http.sslVerify false</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>报错内容</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Cloning into &apos;jplot&apos;...</span><br><span class="line">fatal: unable to access &apos;https://github.com/rs/jplot.git/&apos;: Peer certificate cannot be authenticated with known CA certificates</span><br></pre></td></tr></table></figure><ul><li>解决方法<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global http.sslVerify false</span><br></pre></td></tr></table></figure></li></ul></li><li><p>.gitigore不生效</p></li></ul><blockquote><p>.gitignore只能忽略那些原来没有被track的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。</p></blockquote><ul><li><p>解决方法就是先把本地缓存删除（改变成未track状态）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m &apos;update .gitignore</span><br></pre></td></tr></table></figure></li><li><p>.gitginore规则示例</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 注释内容          井号开头为注释内容</span><br><span class="line">*.md                # 忽略所有 .md 结尾的文件</span><br><span class="line">!readme.md             # 但 readme.md 除外</span><br><span class="line">/TODO              # 仅仅忽略项目根目录下的 TODO 文件，不包括 source/TODO</span><br><span class="line">node_modules/      # 忽略 node_modules/ 目录下的所有文件</span><br><span class="line">public/*.html      # 会忽略 public/index.html 但不包括 public/2019/index.html</span><br></pre></td></tr></table></figure></li></ul><h1 id="gitlab-api操作"><a href="#gitlab-api操作" class="headerlink" title="gitlab api操作"></a>gitlab api操作</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://git.sogou-inc.com/api/v4/projects?search=roadrescue1</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ee/api/projects.html#create-project</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ce/api/repository_files.html#update-existing-file-in-repository</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ce/api/tags.html#list-project-repository-tags</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://pcottle.github.com/learnGitBranching/?demo" target="_blank" rel="noopener">learn git branching</a></p></li><li><p><a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">git-fast-version-control</a></p></li><li><p><a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener">git - 简易指南</a></p></li><li><p><a href="https://githowto.com/" target="_blank" rel="noopener">githowto</a></p></li><li><p><a href="https://docs.gitlab.com/ce/api/repository_files.html#update-existing-file-in-repository" target="_blank" rel="noopener">update-existing-file-in-repository</a></p></li><li><p><a href="http://linuxwiki.github.io/ProductivityTools/git.html" target="_blank" rel="noopener">分布式管理系统 Git</a></p></li><li><p><a href="http://linuxwiki.github.io/ProductivityTools/svn.html" target="_blank" rel="noopener">版本管理工具: SVN</a></p></li></ul>]]></content>
      <categories>
        <category>git</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>版本控制</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux OOM Killer 保护机制</title>
    <url>/linux-oom-killer-%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>OOM killer（Out Of Memory killer）</p><a id="more"></a><blockquote><p>linux下允许程序申请比系统可用内存更多的内存，这个特性叫Overcommit（过度分配）。在系统内存耗尽的情况下，OOM killer机制选择性的干掉一些进程以求释放一些内存。默认具体的记录日志是在/var/log/messages中。</p></blockquote><h1 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h1><ul><li>参数/proc/sys/vm/overcommit_memory可以控制进程对内存过量使用的应对策略</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">overcommit_memory=0，这是缺省值，表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。</span><br><span class="line">overcommit_memory=1，内核会永远认为有充足的内存可用，进程申请内存时总是允许。</span><br><span class="line">overcommit_memory=2，表示系统所能分配的内存不会超过swap+RAM*系数（/proc/sys/vm/overcommit_ratio，默认50%，可以调整），如果这么多资源已经用光，那么后面任何尝试申请内存的行为都会返回错误，这通常意味着此时没法运行任何新程序。</span><br></pre></td></tr></table></figure><h1 id="内核决策依据"><a href="#内核决策依据" class="headerlink" title="内核决策依据"></a>内核决策依据</h1><ul><li><p>/proc/[pid]/oom_adj，该pid进程被oom killer杀掉的权重，一般介于 [-17,15]（具体具体权重的范围需要查看内核确认）之间，越高的权重，意味着更可能被oom killer选中，-17表示禁止被kill掉。</p></li><li><p>/proc/[pid]/oom_score，当前该pid进程的被kill的分数，越高的分数意味着越可能被kill，这个数值是根据oom_adj运算（2ⁿ，n就是oom_adj的值）后的结果，本身oom_score是不能修改值。</p></li></ul><h1 id="两种进程保护措施"><a href="#两种进程保护措施" class="headerlink" title="两种进程保护措施"></a>两种进程保护措施</h1><ul><li><p>修改权重</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo -17 &gt; /proc/[PID]/oom_adj（输入-17，禁止被OOM机制处理）</span><br></pre></td></tr></table></figure></li><li><p>开启OOM较为的保险机制</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo “vm.panic_on_oom=2” &gt;&gt; /etc/sysctl.conf</span><br><span class="line">systcl -p</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.linuxba.com/archives/7744" target="_blank" rel="noopener">https://www.linuxba.com/archives/7744</a></p>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>OOM</tag>
        <tag>kernel</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux防火墙之iptables</title>
    <url>/linux%E9%98%B2%E7%81%AB%E5%A2%99%E4%B9%8Biptables/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>iptables是Linux防火墙的管理工具，位于/sbin/iptables。真正实现防火墙功能的是位于内核空间的netfilter，它是Linux内核中实现包过滤的内部结构。</p></blockquote><a id="more"></a><blockquote><p>过滤 IPv4 数据包的代码已经内置于内核中，并且按照不同的目的被组织成<code>表</code>的集合。<br><code>表</code>由一组预先定义的<code>链</code>组成，<code>链</code>包含遍历顺序规则。<br>每一条规则包含一个谓词的潜在匹配和相应的动作(称为目标)，如果谓词为真，该动作会被执行。也就是说条件匹配。<br>iptables 是用户工具，允许用户使用<code>链</code>和<code>规则</code>。</p></blockquote><h1 id="iptables命令简介"><a href="#iptables命令简介" class="headerlink" title="iptables命令简介"></a>iptables命令简介</h1><blockquote><p>iptables [-t 表名: filter/nat/mangle/raw] 命令选项 [链名: PREROUTING/INPUT/OUTPUT/FORWARD/POSTROUTING] [条件匹配] [-j 目标动作或跳转: ACCEPT/DROP/REJECT/LOG/REDIRECT/SNAT/DNAT]</p></blockquote><ul><li>常用的命令选项<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-t：指定要操纵的表(四个表)；</span><br><span class="line">-A：向规则链中添加条目；</span><br><span class="line">-D：从规则链中删除条目；</span><br><span class="line">-i：向规则链中插入条目；</span><br><span class="line">-R：替换规则链中的条目；</span><br><span class="line">-L：显示规则链中已有的条目；</span><br><span class="line">-F：清楚规则链中已有的条目；</span><br><span class="line">-Z：清空规则链中的数据包计算器和字节计数器；</span><br><span class="line">-N：创建新的用户自定义规则链；</span><br><span class="line">-P：定义规则链中的默认目标；</span><br><span class="line">-h：显示帮助信息；</span><br><span class="line">-p：指定要匹配的数据包协议类型；</span><br><span class="line">-s：指定要匹配的数据包源；</span><br><span class="line"></span><br><span class="line">-i -in-interface 进入的网络接口</span><br><span class="line">-o --out-interface 输出的网络接口</span><br><span class="line">-m state 当与连接跟踪结合使用时，允许访问包的连接跟踪状态。</span><br><span class="line">--state state  state是一个逗号分割的匹配连接状态列表。</span><br><span class="line">    INVALID 表示包是未知连接，</span><br><span class="line">    ESTABLISHED 表示是双向传送的连接，</span><br><span class="line">    NEW 表示包 为新的连接，否则是非双向传送的，</span><br><span class="line">    RELATED 表示包由新连接开始，但是和一个已存在的连接在一起，如FTP数据传送，或者一个ICMP错误。</span><br></pre></td></tr></table></figure></li></ul><ul><li>常用的条件匹配：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、状态匹配：-m state --state 连接状态</span><br><span class="line">NEW：与任何连接无关的</span><br><span class="line">ESTABLISHED：响应请求或已建立连接的</span><br><span class="line">RELATED：与已有连接有相关性的，如FTP数据连接</span><br><span class="line"></span><br><span class="line">2、MAC地址匹配：-m mac --mac-source MAC地址</span><br><span class="line">eg：iptables -A INPUT -m mac --mac-source f0:1b:12:12:22:4f -j DROP</span><br><span class="line"></span><br><span class="line">3、IP范围匹配：-m iprange --src-range  IP范围</span><br><span class="line">eg：iptables -A FORWARD -p tcp -m iprange --src-range 192.168.0.1-192.168.0.10 -j ACCEPT</span><br><span class="line"></span><br><span class="line">4、多端口匹配：-m multiport --sports 源端口列表  和  -m multiport --sports 目的端口列表</span><br><span class="line">eg：iptables -A INPUT -p tcp -m multiport --dport 11,29,116,121 -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h1 id="iptables基础操作"><a href="#iptables基础操作" class="headerlink" title="iptables基础操作"></a>iptables基础操作</h1><blockquote><p>以下内容基于centos6系统环境。</p></blockquote><ul><li><p>服务安装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install iptables</span><br></pre></td></tr></table></figure></li><li><p>保存iptables到文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables-save &gt; ~/iptables.rules</span><br><span class="line">或</span><br><span class="line">/etc/rc.d/init.d/iptables save 默认将规则写入/etc/sysconfig/iptables</span><br><span class="line">重启service iptables restart生效</span><br></pre></td></tr></table></figure></li><li><p>从文件中还原iptables规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables-restore &lt; ~/iptables.rules</span><br></pre></td></tr></table></figure></li><li><p>监控iptables</p><ul><li><p>查看规则命中的次数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -L -v -n --line-numbers</span><br></pre></td></tr></table></figure></li><li><p>删除不必要的规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -nvL | grep -v &quot;0     0&quot;</span><br></pre></td></tr></table></figure></li><li><p>监控iptables活动</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">watch --interval=5 &apos;iptables -nvL | grep -v &quot;0     0&quot;&apos;</span><br></pre></td></tr></table></figure></li><li><p>使用FWLogwatch分析iptables日志生成报告</p></li></ul></li></ul><ul><li><p>清空所有默认规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></li><li><p>清空所有自定义规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -X</span><br></pre></td></tr></table></figure></li><li><p>所有计数器归0</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -Z</span><br></pre></td></tr></table></figure></li></ul><h1 id="iptables应用实例"><a href="#iptables应用实例" class="headerlink" title="iptables应用实例"></a>iptables应用实例</h1><h2 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a>基本规则</h2><ul><li><p>预设规则（默认为ACCEPT）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure></li><li><p>查看当前规则：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -nvL --line-number</span><br></pre></td></tr></table></figure></li><li><p>追加规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 10.1.1.1 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>插入规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -I INPUT 3 -s 10.1.1.2 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>删除规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -D INPUT -s 10.1.1.1 -j DROP</span><br><span class="line">按行号删</span><br><span class="line">iptables -D INPUT 1</span><br></pre></td></tr></table></figure></li><li><p>修改规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将第2条规则改为ACCEPT</span><br><span class="line">iptables -R INPUT 3 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>清空规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></li></ul><h2 id="规则案例"><a href="#规则案例" class="headerlink" title="规则案例"></a>规则案例</h2><h3 id="ACCEPT"><a href="#ACCEPT" class="headerlink" title="ACCEPT"></a>ACCEPT</h3><ul><li><p>放行ping</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p icmp -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许lookback</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -i lo -p all -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -p all -j ACCEPT</span><br><span class="line">或</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>放行80端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT      //如果设置了iptables -P OUTPUT DROP，需要添加该条，否则远程无法连接</span><br></pre></td></tr></table></figure></li><li><p>允许防火墙转发除ICMP协议以外的所有数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -p ! icmp -j ACCEPT</span><br><span class="line">`</span><br></pre></td></tr></table></figure><ul><li>注：”!” 条件取反</li></ul></li><li><p>允许某个特定网络 rsync 进入本机</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.1.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>仅允许来自指定网络的ssh连接请求</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.1.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>仅允许从本地发起到指定网络的SSH连接请求</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A OUTPUT -o eth0 -p tcp -d 192.168.1.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许转发来自192.168.1.0/24局域网段的DNS解析请求数据包。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.1.0/24 -p udp --dport 53 -j ACCEPT</span><br><span class="line">iptables -A FORWARD -d 192.168.1.0/24 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许本机开放从TCP端口1000-1024提供的应用服务。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 1000:1024 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 1000:1024 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>使用Multiport放行多个端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT  -p tcp -m multiport --dports 22,80,443 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --sports 22,80,443 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许防火墙本机对外开放TCP端口20、21、25、110以及被动模式FTP端口1250-1280</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m multiport --dport 20,21,25,110,1250:1280 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>注意：这里用“-m multiport –dport”来指定多个目的端口</li></ul></li><li><p>针对端口访问的过滤。下面表示除了192.168.1.1-192.168.1.10之间的ip能访问192.168.0.1机器的80端口以外，其他ip都不可以访问！</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -d 192.168.0.1 -p tcp --dport 80 -m iprange --src-range 192.168.1.1-192.168.1.10 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>只允许管理员从192.168.1.0/24网段使用SSH远程登录防火墙主机。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -s 202.13.0.0/16 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>允许192.168.1.0网段的服务器访问（-t filter表配置可以省略，默认就是这种表的配置）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s 192.168.1.0/24 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line">或者</span><br><span class="line">iptables -t filter -A INPUT -s 192.168.1.0/24 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>如果本地主机有两块网卡，一块连接内网(eth0)，一块连接外网(eth1)，那么可以使用下面的规则将eth0的数据路由到eht1：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许所有本机向外的访问</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A OUTPUT -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h3 id="DROP"><a href="#DROP" class="headerlink" title="DROP"></a>DROP</h3><ul><li><p>屏蔽环回(loopback)访问</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -i lo -j DROP</span><br><span class="line">iptables -A OUTPUT -o lo -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽 ping</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -i eth0 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽来自外部的ping，即禁止外部机器ping本机</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -A OUTPUT -p icmp --icmp-type echo-reply -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽从本机ping外部主机，禁止本机ping外部机器</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A OUTPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type echo-reply -j DROP</span><br></pre></td></tr></table></figure><ul><li>–icmp-type 8 同样表示 Echo request（Ping回显请求）</li></ul></li><li><p>允许本机 ping 别的主机；但不开放别的主机 ping 本机；</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -I INPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -I INPUT -p icmp --icmp-type echo-reply -j ACCEPT</span><br><span class="line">iptables -I INPUT -p icmp --icmp-type destination-Unreachable -j ACCEPT</span><br><span class="line">或者下面禁ping操作：</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure></li><li><p>屏蔽指定mac地址</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -m mac --mac-source 00:00:00:00:00:00 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽某个IP</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s xxx.xxx.xxx.xxx -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝转发来自192.168.0.1主机的数据</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.0.1 -j REJECT</span><br></pre></td></tr></table></figure></li><li><p>屏蔽从192.168.0.1到192.168.0.254</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -I INPUT -s 192.168.0.0/24 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>过滤源地址段：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -m iprange --src-range 192.168.1.1-192.168.1.10 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>过滤目标地址段：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -m iprange --dst-range 192.168.1.11-192.168.1.20 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>丢弃无效的数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -m conntrack --ctstate INVALID -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝转发来自192.168.1.1主机的数据，允许转发来自192.168.0.0/24网段的数据</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.1.1 -j REJECT</span><br><span class="line">iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>说明：注意一定要把拒绝的放在前面不然就不起作用了！</li></ul></li><li><p>丢弃从外网接口（eth1）进入防火墙本机的源地址为私网地址的数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP</span><br><span class="line">iptables -A INPUT -i eth1 -s 172.16.0.0/12 -j DROP</span><br><span class="line">iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝 TCP 标志位全部为 1 及全部为 0 的报文访问本机</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP</span><br></pre></td></tr></table></figure></li><li><p>禁止转发来自MAC地址为<code>aa:aa:aa:45:75:d0</code>的和主机的数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -m mac --mac-source aa:aa:aa:45:75:d0 -j DROP</span><br></pre></td></tr></table></figure><ul><li>iptables中使用“-m 模块关键字”的形式调用显示匹配。咱们这里用“-m mac –mac-source”来表示数据包的源MAC地址</li></ul></li><li><p>禁止转发源IP地址为192.168.1.1-192.168.1.100的TCP数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -p tcp -m iprange --src-range 192.168.1.1-192.168.1.100 -j DROP</span><br></pre></td></tr></table></figure><ul><li>此处用“-m iprange –src-range”指定IP范围</li></ul></li><li><p>禁止转发与正常TCP连接无关的非–syn请求数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A FORWARD -m state --state NEW -p tcp ! --syn -j DROP</span><br></pre></td></tr></table></figure><ul><li>“-m state”表示数据包的连接状态，“NEW”表示与任何连接无关的</li></ul></li><li><p>拒绝访问防火墙的新数据包，但允许响应连接或与已有连接相关的数据包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m state --state NEW -j DROP</span><br><span class="line">iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>“ESTABLISHED”表示已经响应请求或者已经建立连接的数据包，“RELATED”表示与已建立的连接有相关性的，比如FTP数据连接等</li></ul></li><li><p>为某个端口访问设置白名单</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -s &lt;YOUR_IP&gt; -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -D INPUT -p tcp -m tcp --dport 22 -j DROP</span><br><span class="line">eg:</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -s 113.128.0.0/16 -j ACCEPT;</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -s 120.0.0.0/8 -j ACCEPT;</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j DROP</span><br></pre></td></tr></table></figure></li></ul><h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><ul><li><p>防止DoS攻击</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>-m limit: 启用limit扩展，限制速度。</li><li>–limit 25/minute: 允许最多每分钟25个连接</li><li>–limit-burst 100: 当达到100个连接后，才启用上述25/minute限制（连接上限）</li></ul></li><li><p>限制并发连接数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --syn --dport 22 -m connlimit --connlimit-above 3 -j REJECT  //限制每客户端不超过 3 个连接</span><br><span class="line">iptables -A INPUT -p tcp --syn -m multiport --dport http,https –m connlimit --connlimit-above 20 -j REJECT --reject-with-tcp-reset</span><br></pre></td></tr></table></figure></li><li><p>开放本机的ssh服务给192.168.1.1-192.168.1.100 中的主机；新请求建立的速率一分钟不得超过5个；仅允许响应报文通过其服务端口离开本机；</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -m iprange --src-rang 192.168.1.1-192.168.1.100 -m limit --limit 5/m -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -m iprange --dst-rang 192.168.1.1-192.168.1.100 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h3 id="PREROUTING"><a href="#PREROUTING" class="headerlink" title="PREROUTING"></a>PREROUTING</h3><p>IPtables中可以灵活的做各种网络地址转换（NAT）。</p><ul><li><p>网络地址转换主要有两种：SNAT和DNAT</p><ul><li>SNAT是source network address translation的缩写，即源地址目标转换。<ul><li>MASQUERADE，地址伪装，在iptables中有着和SNAT相近的效果，但也有一些区别：使用SNAT的时候，出口ip的地址范围可以是一个，也可以是多个。</li></ul></li><li>DNAT是destination network address translation的缩写，即目标网络地址转换。</li></ul></li><li><p>把所有10.0.0.0网段的数据包SNAT成192.168.1.1的ip然后发出去</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j SNAT --to-source 192.168.1.1</span><br></pre></td></tr></table></figure></li><li><p>把所有10.0.0.0网段的数据包SNAT成192.168.1.1/192.168.1.2/192.168.1.3等几个ip然后发出去</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j SNAT --to-source 192.168.1.1-192.168.1.3</span><br></pre></td></tr></table></figure><ul><li>对于SNAT，不管是几个地址，必须明确的指定要SNAT的IP</li></ul></li><li><p>动态SNAT地址转换,不管现在eth0的出口获得了怎样的动态ip，MASQUERADE会自动读取eth0现在的ip地址然后做SNAT出去</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure><ul><li>MASQUERADE的作用是，从服务器的网卡上，自动获取当前ip地址来做NAT</li></ul></li><li><p>8022映射22端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp -d 192.168.1.1 --dport 8022 -j DNAT --to-destination 192.168.1.1:22</span><br></pre></td></tr></table></figure></li><li><p>将所有到达eth0网卡80端口的流量重定向转发到8080端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 89 -j REDIRECT --to-port 8080</span><br></pre></td></tr></table></figure></li><li><p>设置 8080 端口转发到 80 端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp -d 10.1.1.1 --dport 8080 -j DNAT --to 10.1.1.1:80</span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --dport 8080 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 8080 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h2 id="实践场景"><a href="#实践场景" class="headerlink" title="实践场景"></a>实践场景</h2><ul><li><p>按时段限制(需要模块支持)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables –A OUTPUT -p tcp -m multiport --dport http,https -i eth0 -o eth1 -m time --timestart 12:00 –timestop 13:00 –d 10.0.0.0/8 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m time --timestart 02:00 --timestop 03:00 -j DROP</span><br><span class="line">iptables -A INPUT -p udp -m time --timestart 02:00 --timestop 03:00 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>限制本机的web服务器在周一不允许访问；新请求的速率不能超过100个每秒；web服务器包含了admin字符串的页面不允许访问：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># web服务器仅允许响应报文离开本机；周一不允许访问</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m time ! --weekdays Mon -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"># 新请求速率不能超过100个每秒</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m limit --limit 100/s -j ACCEPT</span><br><span class="line"></span><br><span class="line"># web包含admin字符串的页面不允许访问，源端口：dport</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m string --algo bm --string &apos;admin&apos; -j REJECT</span><br><span class="line"></span><br><span class="line"># web服务器仅允许响应报文离开主机,放行端口（目标端口）：sport</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 80 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>在工作时间，即周一到周五的8:30-18:00，开放本机的ftp服务给 192.168.1.0网络中的主机访问；数据下载请求的次数每分钟不得超过5个；</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 21 -s 192.168.1.0/24 -m time ! --weekdays 6,7 -m time --timestart 8:30 --timestop 18:00 -m connlimit --connlimit-above 5 -j ACCET</span><br></pre></td></tr></table></figure></li><li><p>屏蔽ssh和rsync端口，只允许白名单机器访问</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">iptables -A INPUT -s 10.0.0.1 -p tcp --dport 22 -j ACCEPT                                       # 中控白名单</span><br><span class="line">iptables -A OUTPUT -d 10.0.0.1 -p tcp --sport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 10.0.0.2 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT      # 监控探针通过22端口连通性监控机器存活，开白名单。</span><br><span class="line">iptables -A INPUT  -p tcp -m multiport --dports 22,873 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --dports 22,873 -j DROP</span><br><span class="line">iptables -L -v -n --line-numbers</span><br><span class="line">EOF | bash</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://netfilter.org/projects/iptables/index.html" target="_blank" rel="noopener">iptables官方网站</a></li><li><a href="https://wiki.centos.org/zh/HowTos/Network/IPTables" target="_blank" rel="noopener">IPTables</a></li><li>整理过程中参考部分微信公众号文章</li></ul>]]></content>
      <categories>
        <category>iptables</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>iptables</tag>
      </tags>
  </entry>
  <entry>
    <title>rsync经典用例总结</title>
    <url>/rsync%E7%BB%8F%E5%85%B8%E7%94%A8%E4%BE%8B%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>rsync是经典的数据传输工具，但本篇博客总结的既不细致，也不全面。惭愧，惭愧。。。</p><a id="more"></a><h1 id="更新策略"><a href="#更新策略" class="headerlink" title="更新策略"></a>更新策略</h1><ul><li><p>rsync默认通过比较文件修改时间(Modify)和大小进行启发式更新</p></li><li><p>策略验证</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">mkdir /tmp/&#123;a,b&#125;</span><br><span class="line"># 文件内容不同，大小相同</span><br><span class="line">echo a &gt;/tmp/a/index.html</span><br><span class="line">sleep 1</span><br><span class="line">echo b &gt;/tmp/b/index.html</span><br><span class="line"># touch -d &quot;2019-08-27 11:35:00&quot; /tmp/&#123;a,b&#125;/*</span><br><span class="line"># 访问时间不同</span><br><span class="line">touch -ad &quot;2019-08-27 11:35:00&quot; /tmp/a/index.html</span><br><span class="line">touch -ad &quot;2019-08-27 11:36:00&quot; /tmp/b/index.html</span><br><span class="line"># Modify时间相同，change时间不同</span><br><span class="line">touch -md &quot;2019-08-27 11:35:00&quot; /tmp/a/index.html</span><br><span class="line">sleep 1</span><br><span class="line">touch -md &quot;2019-08-27 11:35:00&quot; /tmp/b/index.html</span><br><span class="line">stat /tmp/&#123;a,b&#125;/*</span><br><span class="line"># rsync没有覆盖</span><br><span class="line">rsync -avzP /tmp/a/index.html /tmp/b/index.html</span><br></pre></td></tr></table></figure></li><li><p>干预策略的参数：</p><ul><li>–size-only: 仅比较文件大小</li><li>–ignore-times或-I：无脑覆盖</li><li>–checksum或-c: 忽略时间，检查大小，大小相同时比较MD5</li><li>–whole-file或-w：禁用rsync delta算法，源和目的文件不同时，传输整个文件</li></ul></li></ul><h1 id="备份更新"><a href="#备份更新" class="headerlink" title="备份更新"></a>备份更新</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsync -avzP -b --suffix=$(date &quot;+.bak%Y%m%d%H%M%S&quot;) --backup-dir=/data/backup/  $&#123;src&#125;  $&#123;dst&#125;</span><br></pre></td></tr></table></figure><ul><li>备份目录下如果存在同名文件会被新的备份文件强制覆盖</li><li>-b –suffix 既适用推送也适用于拉取，但是都是在dest侧备份</li><li>-b –backup-dir 仅适用于拉取，推送数据时适用会报错</li><li>另外mv命令也有备份实现方案<code>alias mv=&#39;mv -v -b -S &quot;$(date &quot;+.mvbak%Y%m%d_%H%M&quot;)&quot;&#39;</code></li></ul><h1 id="递归创建目录"><a href="#递归创建目录" class="headerlink" title="递归创建目录"></a>递归创建目录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsync -avzP -R src dest</span><br></pre></td></tr></table></figure><ul><li>-R 参数会在dest目录基础上递归创建src目录路径，如<code>rsync -avzP -R 10.0.0.1::data/data/test1/test2/test3 /data/test</code>,在本地会生成路径<code>/data/test/data/test1/test2/test3</code></li></ul><h1 id="慎用–delete"><a href="#慎用–delete" class="headerlink" title="慎用–delete"></a>慎用–delete</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test /data/test        //该种写法会在/data/test下再创建一层test目录，不会删除/data/test的其它目录</span><br><span class="line">和</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/ /data/test       //该种写法会将本地/data/test目录下的文件与src目录强一致</span><br><span class="line">的效果是截然不同的，自己体会下。细思极恐。。。</span><br><span class="line"></span><br><span class="line">另外，</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/ /data/test</span><br><span class="line">和</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/* /data/test      //该种写法会将src目录下的子文件和目录和本地/data/test中的同名子文件和目录进行强一致，本地/data/test中的其它文件目录不会被删除</span><br><span class="line">的效果也不同，使用时要十分谨慎。</span><br></pre></td></tr></table></figure><h1 id="rsync认证"><a href="#rsync认证" class="headerlink" title="rsync认证"></a>rsync认证</h1><ul><li><p>RSYNC_PASSWORD仅适用于rsync协议，rsync配置中指定的用户密码，rsync服务需要通过daemon方式启动；</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export RSYNC_PASSWORD=&quot;passwd&quot;</span><br></pre></td></tr></table></figure></li><li><p>rsync协议使用的两种方式</p><ul><li><p>rsync 协议</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsync rsync://username@1.2.3.4:/abc /def</span><br><span class="line">rsync 1.2.3.4::abc/ /def</span><br></pre></td></tr></table></figure></li><li><p>ssh 协议</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsync 1.2.3.4:/abc/ /def</span><br></pre></td></tr></table></figure><ul><li>仅适用rsync客户端，通过ssh协议传输</li></ul></li></ul></li></ul><h1 id="rsync-日志"><a href="#rsync-日志" class="headerlink" title="rsync 日志"></a>rsync 日志</h1><ul><li><p>transfer logging</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">transfer logging = yes</span><br></pre></td></tr></table></figure><ul><li>配置文件中开启transfer logging，可以使rsync使用ftp格式的文件来记录下载和上载操作在单独的日志文件中</li></ul></li><li><p>log format 格式定义符</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%h 远程主机名</span><br><span class="line">%a 远程IP地址</span><br><span class="line">%l 文件长度字符数</span><br><span class="line">%p 该次rsync会话的进程id</span><br><span class="line">%o 操作类型：&quot;send&quot;或&quot;recv&quot;</span><br><span class="line">%f 文件名</span><br><span class="line">%P 模块路径</span><br><span class="line">%m 模块名</span><br><span class="line">%t 当前时间</span><br><span class="line">%u 认证的用户名(匿名时是null)</span><br><span class="line">%b 实际传输的字节数</span><br><span class="line">%c 当发送文件时，该字段记录该文件的校验码</span><br><span class="line">默认log格式为：&quot;%o %h [%a] %m (%u) %f %l&quot;,通常,在每行的头上会添加&quot;%t [%p] &quot;。</span><br></pre></td></tr></table></figure><h1 id="配置文件范例"><a href="#配置文件范例" class="headerlink" title="配置文件范例"></a>配置文件范例</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat /etc/rsyncd.conf</span><br><span class="line">address = 10.0.0.1</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use chroot = yes</span><br><span class="line">numeric ids = no</span><br><span class="line">read only = no</span><br><span class="line">max connections = 100</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">log file = /var/log/rsync.log</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line">transfer logging = yes</span><br><span class="line"></span><br><span class="line">[data1]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    path = /data</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br><span class="line"></span><br><span class="line">[data2]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    path = /</span><br><span class="line">    exclude = *</span><br><span class="line">    include = data1/***</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br><span class="line"></span><br><span class="line">[data]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    comment = data</span><br><span class="line">    path = /</span><br><span class="line">    exclude = *</span><br><span class="line">    include = data1/***</span><br><span class="line">    read only = false</span><br><span class="line">    list = false</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><p><a href="http://linuxwiki.github.io/Services/rsync.html" target="_blank" rel="noopener">http://linuxwiki.github.io/Services/rsync.html</a></p></li><li><p><a href="https://www.cnblogs.com/shihuc/p/5628893.html" target="_blank" rel="noopener">https://www.cnblogs.com/shihuc/p/5628893.html</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/111526/how-can-i-rsync-without-prompt-for-password-without-using-public-key-authentica" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/111526/how-can-i-rsync-without-prompt-for-password-without-using-public-key-authentica</a></p></li></ul>]]></content>
      <categories>
        <category>rsync</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>rsync</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux环境中alias不生效问题</title>
    <url>/linux%E7%8E%AF%E5%A2%83%E4%B8%ADalias%E4%B8%8D%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>很多时候，实际结果往往和我们的预期不一致，其中必有蹊跷。。。</p></blockquote><a id="more"></a><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>由于公司hadoop集群迁移，需要对线上几百台历史遗留的脚本进行改造，变更hadoop客户端环境。</p><p>思虑再三，借鉴python装饰器的思想，部署一个绿色版的hadoop客户端环境。再将线上各式各样的脚本统一加一行<code>alias hadoop=&quot;/path/to/hadoop&quot;</code>成本最低。</p><p>无奈alias貌似并没有生效，实际操作结果和预期不一致。。。</p><h1 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h1><p>alias 在非交互shell环境中不生效，除非手动设置<code>shopt -s expand_aliases</code></p><h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><ul><li><p><code>cat aliasVerifi.sh</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#/bin/bash</span><br><span class="line">shopt |grep -i alias</span><br><span class="line">whoami</span><br><span class="line">which whoami</span><br><span class="line">echo &quot;================&quot;</span><br><span class="line">shopt -s expand_aliases</span><br><span class="line">shopt |grep -i alias</span><br><span class="line">alias whoami=&apos;date &quot;+%Y-%m-%d %H:%M:%S&quot;&apos;</span><br><span class="line">whoami</span><br><span class="line">which whoami</span><br></pre></td></tr></table></figure></li><li><p>通过cron调用脚本并将输出写入log文件aliasVerifi.log</p></li><li><p><code>cat aliasVerifi.log</code></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">expand_aliases 	off</span><br><span class="line">root</span><br><span class="line">/usr/bin/whoami</span><br><span class="line">================</span><br><span class="line">expand_aliases 	on</span><br><span class="line">2018-11-06 22:20:01</span><br><span class="line">/usr/bin/whoami</span><br></pre></td></tr></table></figure><ul><li>此处我们注意到expand_aliases在非交互shell中默认关闭，并且用which获取该命令的绝对路径并没有发生改变，但是执行结果已经符合预期。</li></ul></li></ul><h1 id="其它说明"><a href="#其它说明" class="headerlink" title="其它说明"></a>其它说明</h1><ul><li><p>当alias的命令和sudo一起使用时alias命令不生效，此时将sudo加入alias中即可生效。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ alias mkdir=&apos;mkdir -p&apos;</span><br><span class="line">$ sudo mkdir 1/2/3</span><br><span class="line">mkdir: cannot create directory ‘1/2/3’: No such file or directory</span><br><span class="line">$ mkdir 1/2/3</span><br><span class="line">mkdir: cannot create directory ‘1’: Permission denied</span><br><span class="line">$ alias mkdir=&apos;sudo mkdir -p&apos;</span><br><span class="line">$ mkdir 1/2/3</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ alias mv=&apos;/usr/bin/mv -v -b -S $(date &quot;+.mvbak%Y%m%d_%H%M&quot;)&apos;</span><br><span class="line">$ sudo mv a.sh  b.sh</span><br><span class="line">$ alias mv=&apos;sudo /usr/bin/mv -v -b -S $(date &quot;+.mvbak%Y%m%d_%H%M&quot;)&apos;</span><br><span class="line">$ mv a.sh  b.sh</span><br><span class="line">‘a.sh’ -&gt; ‘b.sh’</span><br></pre></td></tr></table></figure><ul><li>前提，mkdir,mv命令已加入sudoers</li></ul></li><li><p>在xargs命令后命令别名也不生效，因为xargs是一个单独的应用程序，它不是shell，因此没有别名或函数的概念。但可以通过以下两种方式变相使用alias</p><ul><li>xargs ${BASH_ALIASES[alias_command]}<ul><li>${BASH_ALIASES[alias_command]}前后不能有引号</li></ul></li><li>xargs -t -i bash -ic “alias_command }”</li><li>ansible script中可以使用alias，但是xargs后面的变量${BASH_ALIASES[alias_command]}为空，不能被使用。</li></ul></li><li><p>在sshpass命令后命令别名同样不生效</p><ul><li><p>以下情况不生效alias rsync不生效</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export SSHPASS=&quot;xxxx&quot;</span><br><span class="line">alias rsync=&apos;rsync -e &quot;ssh -q -o StrictHostKeyChecking=no&quot; -avzP&apos;</span><br><span class="line">sshpass -e rsync ...</span><br></pre></td></tr></table></figure></li><li><p>可用以下方式变相实现</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export SSHPASS=&quot;xxxx&quot;</span><br><span class="line">alias rsync=&apos;sshpass -e rsync -e &quot;ssh -q -o StrictHostKeyChecking=no&quot; -avzP&apos;</span><br><span class="line">rsync ...</span><br></pre></td></tr></table></figure></li></ul></li><li><p>脚本中使用alias命令别名，通过eval调用命令别名可以生效。</p></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://ss64.com/bash/alias.html" target="_blank" rel="noopener">alias</a></li><li><a href="https://unix.stackexchange.com/questions/141367/have-xargs-use-alias-instead-of-binary" target="_blank" rel="noopener">stackoverflow·Have xargs use alias instead of binary</a></li><li><a href="https://stackoverflow.com/questions/979453/how-can-i-use-aliased-commands-with-xargs" target="_blank" rel="noopener">stackoverflow·How can I use aliased commands with xargs?</a></li></ul>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>alias</tag>
        <tag>cron</tag>
      </tags>
  </entry>
  <entry>
    <title>redmine 项目管理平台搭建过程概述</title>
    <url>/redmine-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%E8%BF%87%E7%A8%8B%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<p>Redmine是基于Ruby开发的经典项目管理平台，功能强大。</p><p>thin, A fast and very simple Ruby web server。</p><a id="more"></a><p>本文档非操作手册只列出来关键信息，需要对ruby，redmine，nginx稍有些许了解，完全按照这个文档部署大概率不会成功。。。</p><h1 id="安装-升级关键步骤"><a href="#安装-升级关键步骤" class="headerlink" title="安装/升级关键步骤"></a>安装/升级关键步骤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">git clone -b 4.0.4 https://github.com/redmine/redmine.git</span><br><span class="line">cd redmine</span><br><span class="line">gem install bundler</span><br><span class="line"> bundle install --without development test</span><br><span class="line"> bundle exec rake generate_secret_token</span><br><span class="line"> bundle exec rake redmine:plugins:migrate RAILS_ENV=production</span><br></pre></td></tr></table></figure><h1 id="升级数据库"><a href="#升级数据库" class="headerlink" title="升级数据库"></a>升级数据库</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bundle install --without development test</span><br><span class="line">bundle exec rake generate_secret_token</span><br><span class="line">bundle exec rake db:migrate RAILS_ENV=production</span><br><span class="line">bundle exec rake redmine:plugins:migrate RAILS_ENV=production</span><br><span class="line">bundle exec rake tmp:cache:clear RAILS_ENV=productionvim</span><br></pre></td></tr></table></figure><h1 id="thin-安装"><a href="#thin-安装" class="headerlink" title="thin 安装"></a>thin 安装</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo gem &quot;thin&quot; &gt;&gt; Gemfile   # 必须写入Gemfile否则启动thin过程会报错</span><br><span class="line">bundle exec rake redmine:plugins:migrate RAILS_ENV=production</span><br><span class="line">bundle exec rake redmine:plugins:migrate RAILS_ENV=production --trace</span><br><span class="line"></span><br><span class="line">gem install thin</span><br><span class="line">thin install  # 生成/etc/init.d/thin</span><br><span class="line">chkconfig --level 345 thin on</span><br></pre></td></tr></table></figure><h2 id="创建logrotate配置-etc-logrotate-d-thin"><a href="#创建logrotate配置-etc-logrotate-d-thin" class="headerlink" title="创建logrotate配置/etc/logrotate.d/thin"></a>创建logrotate配置/etc/logrotate.d/thin</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/var/log/thin/*.log &#123;</span><br><span class="line">	daily</span><br><span class="line">	missingok</span><br><span class="line">	rotate 52</span><br><span class="line">	compress</span><br><span class="line">	delaycompress</span><br><span class="line">	notifempty</span><br><span class="line">	create 640 root adm</span><br><span class="line">	sharedscripts</span><br><span class="line">	postrotate</span><br><span class="line">	/etc/init.d/thin restart &gt;/dev/null</span><br><span class="line">	endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="创建thin配置文件-etc-thin-redmine-yml"><a href="#创建thin配置文件-etc-thin-redmine-yml" class="headerlink" title="创建thin配置文件/etc/thin/redmine.yml"></a>创建thin配置文件/etc/thin/redmine.yml</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pid: /var/run/thin/thin.pid</span><br><span class="line">group: nginx</span><br><span class="line">wait: 30</span><br><span class="line">timeout: 30</span><br><span class="line">log: /var/log/thin/thin.log</span><br><span class="line">max_conns: 1024</span><br><span class="line"></span><br><span class="line">require: []</span><br><span class="line">environment: production</span><br><span class="line">max_persistent_conns: 512</span><br><span class="line">servers: 4</span><br><span class="line">daemonize: true</span><br><span class="line">user: nginx</span><br><span class="line">socket: /tmp/thin.sock</span><br><span class="line">chdir: /data/DevOps/redmine</span><br></pre></td></tr></table></figure><h2 id="nginx配置文件-etc-nginx-conf-d-redmine-conf"><a href="#nginx配置文件-etc-nginx-conf-d-redmine-conf" class="headerlink" title="nginx配置文件 /etc/nginx/conf.d/redmine.conf"></a>nginx配置文件 /etc/nginx/conf.d/redmine.conf</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream thin_cluster &#123;</span><br><span class="line">	server unix:/tmp/thin.0.sock;</span><br><span class="line">	server unix:/tmp/thin.1.sock;</span><br><span class="line">	server unix:/tmp/thin.2.sock;</span><br><span class="line">	server unix:/tmp/thin.3.sock;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  redmine.server;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    access_log  /var/log/nginx/log/redmine.access.log  main;</span><br><span class="line"></span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    client_max_body_size 10m;</span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line">    proxy_connect_timeout 90;</span><br><span class="line">    proxy_send_timeout 90;</span><br><span class="line">    proxy_read_timeout 90;</span><br><span class="line">    proxy_buffer_size 4k;</span><br><span class="line">    proxy_buffers 4 32k;</span><br><span class="line">    proxy_busy_buffers_size 64k;</span><br><span class="line">    proxy_temp_file_write_size 64k;</span><br><span class="line">    #your redmine path</span><br><span class="line">    root /data/DevOps/redmine/public;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">	try_files $uri/index.html $uri.html $uri @cluster;</span><br><span class="line">    &#125;</span><br><span class="line">    location @cluster &#123;</span><br><span class="line">	proxy_pass http://thin_cluster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">    # concurs with nginx&apos;s one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="推荐开源主题"><a href="#推荐开源主题" class="headerlink" title="推荐开源主题"></a>推荐开源主题</h1><p><a href="https://github.com/mrliptontea/PurpleMine2" target="_blank" rel="noopener">https://github.com/mrliptontea/PurpleMine2</a></p><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://code.macournoyer.com/thin/" target="_blank" rel="noopener">thin 官网</a></p></li><li><p><a href="http://www.redmine.org/boards/2/topics/37072" target="_blank" rel="noopener">Help with Ruby 2.0 + Redmine 2.30 + thin install</a></p></li><li><p><a href="https://www.redmine.org/projects/redmine/wiki/Install_Redmine_346_on_Centos_75" target="_blank" rel="noopener">redmine官方安装文档</a></p></li><li><p><a href="http://www.redmine.org/projects/redmine/wiki/RedmineUpgrade" target="_blank" rel="noopener">redmine官方升级文档</a></p></li><li><p><a href="http://rvm.io/" target="_blank" rel="noopener">Ruby Version Manager (RVM)</a></p></li></ul>]]></content>
      <categories>
        <category>redmine</category>
      </categories>
      <tags>
        <tag>redmine</tag>
        <tag>thin</tag>
        <tag>项目管理</tag>
      </tags>
  </entry>
  <entry>
    <title>sed 常见用例总结</title>
    <url>/sed-%E5%B8%B8%E8%A7%81%E7%94%A8%E4%BE%8B%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>sed 发行于1974年，作者 Lee E. McMahon。awk发行于1977年，作者 阿尔佛雷德·艾侯、彼得·温伯格以及布莱恩·柯林汉。</p><p>——源自维基百科</p></blockquote><a id="more"></a><h1 id="常见用例"><a href="#常见用例" class="headerlink" title="常见用例"></a>常见用例</h1><ul><li><p>文件最后追加</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed &apos;$ a\00 08 * * * /sbin/clock -w &gt;/dev/null 2&gt;&amp;1&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>输出满足正则的记录</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -n &apos;/正则表达式/p&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>删除满足正则的记录</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;/正则表达式/d&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>sed删除多行</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i &apos;/START/,/END/d&apos; /etc/rsyncd.conf</span><br><span class="line">eg:</span><br><span class="line">sed -i &apos;/\[root\]\s*/,/\s*hosts\s*allow\s*=\s*10.0.0.0\/8\s*192.168.0.0\/16\s*/d&apos; rsyncd.conf</span><br></pre></td></tr></table></figure></li><li><p>将所有数字版本号统一</p><ul><li><strong>sed正则中{}()需要加转义，[]则不用。<code>|</code>和<code>+</code>也需要转义，<code>$</code>不需要转义。</strong></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find /data/daemon/conf/ -name &quot;*.yaml&quot; -type f |xargs grep -irl &quot;version:v&quot; |xargs sed -i &apos;s/version:v[0-9]\&#123;1\&#125;/version:v9/g&apos;</span><br></pre></td></tr></table></figure><ul><li>将软件版本号去掉<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qa |grep someone|sed &apos;s/\([0-9]\|\.\|_\|-\)\+\.el.\+\(.x86_64\|.noarch\)/\2/g&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="备注说明"><a href="#备注说明" class="headerlink" title="备注说明"></a>备注说明</h1><ul><li>有些版本的sed正则中不支持\d，小括号和加号都要加转义符<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eg:</span><br><span class="line">rpm -qa |grep php |sed &apos;s/-[0-9]\(.*\)\+$/-flag/g;s/^php-/php71-/g&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="noopener">sed, a stream editor·官方文档</a></p></li><li><p><a href="http://www.361way.com/sed-process-lines/2263.html" target="_blank" rel="noopener">linux下在某行的前一行或后一行添加内容·运维之路</a></p></li><li><p><a href="http://www.cnblogs.com/edwardlost/archive/2010/09/17/1829145.html" target="_blank" rel="noopener">sed命令详解</a></p></li><li><p><a href="http://www.cnblogs.com/emanlee/p/3307642.html" target="_blank" rel="noopener">linux中sed的用法</a></p></li><li><p><a href="https://segmentfault.com/q/1010000006118112" target="_blank" rel="noopener">sed 命令如何替换多行内容</a></p></li><li><p><a href="http://blog.fantasy.codes/shell/2013/05/21/learn-sed/" target="_blank" rel="noopener">sed与正则表达式</a></p></li><li><p><a href="http://www.178linux.com/71180" target="_blank" rel="noopener">sed命令的入门与进阶·Linux运维部落</a></p></li></ul>]]></content>
      <categories>
        <category>sed</category>
      </categories>
      <tags>
        <tag>文本处理</tag>
        <tag>sed</tag>
      </tags>
  </entry>
  <entry>
    <title>MediaWiki配置文件</title>
    <url>/mediawiki%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<p>MediaWiki是一款优秀的开源文档系统。功能强大，插件众多，文档完善。</p><a id="more"></a><h1 id="配置文件参考"><a href="#配置文件参考" class="headerlink" title="配置文件参考"></a>配置文件参考</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mediawiki/LocalSettings.php</span><br><span class="line">&lt;?php</span><br><span class="line"># This file was automatically generated by the MediaWiki 1.26.2</span><br><span class="line"># installer. If you make manual changes, please keep track in case you</span><br><span class="line"># need to recreate them later.</span><br><span class="line">#</span><br><span class="line"># See includes/DefaultSettings.php for all configurable settings</span><br><span class="line"># and their default values, but don&apos;t forget to make changes in _this_</span><br><span class="line"># file, not there.</span><br><span class="line">#</span><br><span class="line"># Further documentation for configuration settings may be found at:</span><br><span class="line"># https://www.mediawiki.org/wiki/Manual:Configuration_settings</span><br><span class="line"></span><br><span class="line"># Protect against web entry</span><br><span class="line">if ( !defined( &apos;MEDIAWIKI&apos; ) ) &#123;</span><br><span class="line">	exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## Uncomment this to disable output compression</span><br><span class="line"># $wgDisableOutputCompression = true;</span><br><span class="line"></span><br><span class="line">$wgSitename = &quot;WIKI&quot;;</span><br><span class="line"></span><br><span class="line">## The URL base path to the directory containing the wiki;</span><br><span class="line">## defaults for all runtime URL paths are based off of this.</span><br><span class="line">## For more information on customizing the URLs</span><br><span class="line">## (like /w/index.php/Page_title to /wiki/Page_title) please see:</span><br><span class="line">## https://www.mediawiki.org/wiki/Manual:Short_URL</span><br><span class="line">$wgScriptPath = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">## The protocol and server name to use in fully-qualified URLs</span><br><span class="line">$wgServer = &quot;http://wiki.domain-name.com&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## The URL path to static resources (images, scripts, etc.)</span><br><span class="line">$wgResourceBasePath = $wgScriptPath;</span><br><span class="line">$wgArticlePath = &quot;/wiki/$1&quot;;</span><br><span class="line">$wgUsePathInfo = true;        # Ǵԃ pretty URLs</span><br><span class="line"></span><br><span class="line">## The URL path to the logo.  Make sure you change this from the default,</span><br><span class="line">## or else you&apos;ll overwrite your logo when you upgrade!</span><br><span class="line">#$wgLogo = &quot;$wgResourceBasePath/resources/assets/wiki.png&quot;;</span><br><span class="line">$wgLogo = &quot;$wgResourceBasePath/resources/assets/logo.png&quot;;</span><br><span class="line"></span><br><span class="line">## UPO means: this is also a user preference option</span><br><span class="line"></span><br><span class="line">$wgEnableEmail = true;</span><br><span class="line">$wgEnableUserEmail = true; # UPO</span><br><span class="line"></span><br><span class="line">$wgEmergencyContact = &quot;mail@domain-name.com&quot;;</span><br><span class="line">$wgPasswordSender = &quot;username@domain-name.com&quot;;</span><br><span class="line"></span><br><span class="line">$wgEnotifUserTalk = true; # UPO</span><br><span class="line">$wgEnotifWatchlist = true; # UPO</span><br><span class="line">$wgEmailAuthentication = true;</span><br><span class="line"></span><br><span class="line">## Database settings</span><br><span class="line">$wgDBtype = &quot;mysql&quot;;</span><br><span class="line">$wgDBserver = &quot;10.0.0.1&quot;;</span><br><span class="line">$wgDBname = &quot;wiki&quot;;</span><br><span class="line">$wgDBuser = &quot;root&quot;;</span><br><span class="line">$wgDBpassword = &quot;passwd&quot;;</span><br><span class="line"></span><br><span class="line"># MySQL specific settings</span><br><span class="line">$wgDBprefix = &quot;&quot;;</span><br><span class="line"></span><br><span class="line"># MySQL table options to use during installation or update</span><br><span class="line">$wgDBTableOptions = &quot;ENGINE=InnoDB, DEFAULT CHARSET=binary&quot;;</span><br><span class="line"></span><br><span class="line"># Experimental charset support for MySQL 5.0.</span><br><span class="line">$wgDBmysql5 = false;</span><br><span class="line"></span><br><span class="line">## Shared memory settings</span><br><span class="line">$wgMainCacheType = CACHE_ACCEL;</span><br><span class="line">$wgMemCachedServers = array();</span><br><span class="line"></span><br><span class="line">## To enable image uploads, make sure the &apos;images&apos; directory</span><br><span class="line">## is writable, then set this to true:</span><br><span class="line">$wgEnableUploads = true;</span><br><span class="line">#$wgUseImageMagick = true;</span><br><span class="line">#$wgImageMagickConvertCommand = &quot;/usr/bin/convert&quot;;</span><br><span class="line"></span><br><span class="line"># InstantCommons allows wiki to use images from https://commons.wikimedia.org</span><br><span class="line">$wgUseInstantCommons = true;</span><br><span class="line"></span><br><span class="line">## If you use ImageMagick (or any other shell command) on a</span><br><span class="line">## Linux server, this will need to be set to the name of an</span><br><span class="line">## available UTF-8 locale</span><br><span class="line">$wgShellLocale = &quot;en_US.utf8&quot;;</span><br><span class="line"></span><br><span class="line">## If you want to use image uploads under safe mode,</span><br><span class="line">## create the directories images/archive, images/thumb and</span><br><span class="line">## images/temp, and make them all writable. Then uncomment</span><br><span class="line">## this, if it&apos;s not already uncommented:</span><br><span class="line">#$wgHashedUploadDirectory = false;</span><br><span class="line"></span><br><span class="line">## Set $wgCacheDirectory to a writable directory on the web server</span><br><span class="line">## to make your wiki go slightly faster. The directory should not</span><br><span class="line">## be publically accessible from the web.</span><br><span class="line">#$wgCacheDirectory = &quot;$IP/cache&quot;;</span><br><span class="line"></span><br><span class="line"># Site language code, should be one of the list in ./languages/Names.php</span><br><span class="line"># $wgLanguageCode = &quot;en&quot;;</span><br><span class="line">$wgLanguageCode = &quot;zh-cn&quot;;</span><br><span class="line"></span><br><span class="line">$wgSecretKey = &quot;xxxxxxxxxxxxx&quot;;</span><br><span class="line"></span><br><span class="line"># Site upgrade key. Must be set to a string (default provided) to turn on the</span><br><span class="line"># web installer while LocalSettings.php is in place</span><br><span class="line">$wgUpgradeKey = &quot;xxxxxx&quot;;</span><br><span class="line"></span><br><span class="line">## For attaching licensing metadata to pages, and displaying an</span><br><span class="line">## appropriate copyright notice / icon. GNU Free Documentation</span><br><span class="line">## License and Creative Commons licenses are supported so far.</span><br><span class="line">$wgRightsPage = &quot;&quot;; # Set to the title of a wiki page that describes your license/copyright</span><br><span class="line">$wgRightsUrl = &quot;&quot;;</span><br><span class="line">$wgRightsText = &quot;&quot;;</span><br><span class="line">$wgRightsIcon = &quot;&quot;;</span><br><span class="line"></span><br><span class="line"># Path to the GNU diff3 utility. Used for conflict resolution.</span><br><span class="line">$wgDiff3 = &quot;/usr/bin/diff3&quot;;</span><br><span class="line"></span><br><span class="line"># The following permissions were set based on your choice in the installer</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;createaccount&apos;] = true;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;edit&apos;] = false;</span><br><span class="line">$wgWhitelistRead = array (&quot;首页&quot;,&quot;特殊:创建账户&quot;);</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;read&apos;] = false;</span><br><span class="line">#$wgGroupPermissions[&apos;sysop&apos;][&apos;edit&apos;] = true;</span><br><span class="line">#$wgGroupPermissions[&apos;sysop&apos;][&apos;read&apos;] = true;</span><br><span class="line"></span><br><span class="line">## Default skin: you can change the default skin. Use the internal symbolic</span><br><span class="line">## names, ie &apos;vector&apos;, &apos;monobook&apos;:</span><br><span class="line"># $wgDefaultSkin = &quot;vector&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;BlueSky&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;BlueSky&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;foreground&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;foreground&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;Metrolook&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;Metrolook&quot;;</span><br><span class="line"></span><br><span class="line">wfLoadSkin( &apos;Timeless&apos; );</span><br><span class="line">$wgDefaultSkin = &quot;Timeless&quot;;</span><br><span class="line"></span><br><span class="line"># Enabled skins.</span><br><span class="line"># The following skins were automatically enabled:</span><br><span class="line">wfLoadSkin( &apos;CologneBlue&apos; );</span><br><span class="line">wfLoadSkin( &apos;Modern&apos; );</span><br><span class="line">wfLoadSkin( &apos;MonoBook&apos; );</span><br><span class="line">wfLoadSkin( &apos;Vector&apos; );</span><br><span class="line"></span><br><span class="line"># Enabled Extensions. Most extensions are enabled by including the base extension file here</span><br><span class="line"># but check specific extension documentation for more details</span><br><span class="line"># The following extensions were automatically enabled:</span><br><span class="line">wfLoadExtension( &apos;Cite&apos; );</span><br><span class="line">wfLoadExtension( &apos;CiteThisPage&apos; );</span><br><span class="line">wfLoadExtension( &apos;ConfirmEdit&apos; );</span><br><span class="line">wfLoadExtension( &apos;Gadgets&apos; );</span><br><span class="line">wfLoadExtension( &apos;ImageMap&apos; );</span><br><span class="line">wfLoadExtension( &apos;InputBox&apos; );</span><br><span class="line">wfLoadExtension( &apos;Interwiki&apos; );</span><br><span class="line">wfLoadExtension( &apos;LocalisationUpdate&apos; );</span><br><span class="line">wfLoadExtension( &apos;Nuke&apos; );</span><br><span class="line">wfLoadExtension( &apos;ParserFunctions&apos; );</span><br><span class="line">wfLoadExtension( &apos;PdfHandler&apos; );</span><br><span class="line">wfLoadExtension( &apos;Poem&apos; );</span><br><span class="line">wfLoadExtension( &apos;Renameuser&apos; );</span><br><span class="line">wfLoadExtension( &apos;SpamBlacklist&apos; );</span><br><span class="line">#wfLoadExtension( &apos;SyntaxHighlight_GeSHi&apos; );</span><br><span class="line">wfLoadExtension( &apos;TitleBlacklist&apos; );</span><br><span class="line">wfLoadExtension( &apos;WikiEditor&apos; );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># End of automatically generated settings.</span><br><span class="line"># Add more configuration options below.</span><br><span class="line"></span><br><span class="line">#VisualEditor</span><br><span class="line">/*require_once &quot;$IP/extensions/VisualEditor/VisualEditor.php&quot;;</span><br><span class="line">// Enable by default for everybody</span><br><span class="line">$wgDefaultUserOptions[&apos;visualeditor-enable&apos;] = 1;</span><br><span class="line"></span><br><span class="line">// Don&apos;t allow users to disable it</span><br><span class="line">$wgHiddenPrefs[] = &apos;visualeditor-enable&apos;;</span><br><span class="line"></span><br><span class="line">// OPTIONAL: Enable VisualEditor&apos;s experimental code features</span><br><span class="line">#$wgDefaultUserOptions[&apos;visualeditor-enable-experimental&apos;] = 1;</span><br><span class="line">$wgVirtualRestConfig[&apos;modules&apos;][&apos;parsoid&apos;] = array(</span><br><span class="line">  // URL to the Parsoid instance</span><br><span class="line">  // Use port 8142 if you use the Debian package</span><br><span class="line">  &apos;url&apos; =&gt; &apos;http://127.0.0.1:8182&apos;,</span><br><span class="line">  // Parsoid &quot;domain&quot;, see below (optional)</span><br><span class="line">  &apos;domain&apos; =&gt; &apos;localhost&apos;,</span><br><span class="line">  // Parsoid &quot;prefix&quot;, see below (optional)</span><br><span class="line">  &apos;prefix&apos; =&gt; &apos;mediawiki&apos;</span><br><span class="line">);*/</span><br><span class="line"></span><br><span class="line">require_once &apos;extensions/LdapAuthentication/LdapAuthentication.php&apos;;</span><br><span class="line">#require_once &apos;includes/AuthPlugin.php&apos;;</span><br><span class="line">$wgAuth = new LdapAuthenticationPlugin();</span><br><span class="line">$wgLDAPUseLocal = true;</span><br><span class="line">$wgLDAPDomainNames = array(&quot;domain-name&quot;);</span><br><span class="line">$wgLDAPServerNames = array(&quot;domain-name&quot; =&gt; &quot;ldap.domain-name.com&quot;);</span><br><span class="line">$wgLDAPPort = array(&quot;domain-name&quot; =&gt; 389);</span><br><span class="line">$wgLDAPEncryptionType = array( &quot;domain-name&quot; =&gt; &quot;clear&quot;);</span><br><span class="line"></span><br><span class="line">#$wgLDAPProxyAgent = array(&quot;domain-name&quot;=&gt;&quot;cn=username,ou=op,ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPProxyAgent = array(&quot;domain-name&quot;=&gt;&quot;cn=username,ou=Special_Account,ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPProxyAgentPassword = array( &quot;domain-name&quot;=&gt;&quot;passwd&quot;);</span><br><span class="line">$wgLDAPGroupUseRetrievedUsername = array(&quot;domain-name&quot;=&gt;true);</span><br><span class="line">#$wgLDAPSearchAttributes = array( &quot;domain-name&quot; =&gt; &quot;uid&quot;);</span><br><span class="line">$wgLDAPSearchAttributes = array( &quot;domain-name&quot; =&gt; &quot;sAMAccountName&quot;);</span><br><span class="line">$wgLDAPBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPGroupBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;ou=maillist,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPUserBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line"></span><br><span class="line">$wgLDAPGroupUseFullDN = array( &quot;domain-name&quot;=&gt;true );</span><br><span class="line">$wgLDAPLowerCaseUsername = array( &quot;domain-name&quot;=&gt;true);</span><br><span class="line">$wgLDAPGroupObjectclass = array( &quot;domain-name&quot;=&gt;&quot;groupofuniquenames&quot; );</span><br><span class="line">$wgLDAPGroupAttribute = array( &quot;domain-name&quot;=&gt;&quot;uniquemember&quot; );</span><br><span class="line">$wgLDAPGroupNameAttribute = array( &quot;domain-name&quot;=&gt;&quot;cn&quot; );</span><br><span class="line"></span><br><span class="line">#$wgLDAPRequiredGroups = array( &quot;domain-name&quot; =&gt; array(&quot;&quot;));</span><br><span class="line">$wgLDAPGroupSearchNestedGroups = array( &quot;domain-name&quot;=&gt;false );</span><br><span class="line">$wgLDAPDebug = 5;</span><br><span class="line">$wgDebugLogGroups[&quot;ldap&quot;] = &quot;/tmp/ldap.log&quot;;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;autocreateaccount&apos;] = true;</span><br><span class="line"></span><br><span class="line">#UserMerge</span><br><span class="line">require_once &quot;$IP/extensions/UserMerge/UserMerge.php&quot;;</span><br><span class="line">// By default nobody can use this function, enable for bureaucrat?</span><br><span class="line">$wgGroupPermissions[&apos;bureaucrat&apos;][&apos;usermerge&apos;] = true;</span><br><span class="line"></span><br><span class="line">// optional: default is array( &apos;sysop&apos; )</span><br><span class="line">//$wgUserMergeProtectedGroups = array( &apos;groupname&apos; );</span><br><span class="line"># Allow all users to be merged (by default, the &apos;sysop&apos; group is unmergeable)</span><br><span class="line">//$wgUserMergeProtectedGroups = array();</span><br><span class="line"></span><br><span class="line"># Disallow merging of the users in the &apos;sysop&apos; or &apos;awesomeusers&apos; groups</span><br><span class="line">//$wgUserMergeUnmergeable = array( &apos;sysop&apos;, &apos;awesomeusers&apos; );</span><br><span class="line">#Mail</span><br><span class="line">$wgSMTP = array(</span><br><span class="line">&quot;host&quot; =&gt; &apos;mail.domain-name.com&apos;,</span><br><span class="line">&quot;IDHost&quot; =&gt; &apos;domain-name.com&apos;,</span><br><span class="line">&quot;port&quot; =&gt; &quot;25&quot;,</span><br><span class="line">&quot;auth&quot; =&gt; true,</span><br><span class="line">&quot;username&quot; =&gt; &apos;username&apos;,</span><br><span class="line">&quot;password&quot; =&gt; &apos;passpwd&apos;);</span><br><span class="line">$wgEnableUserEmail = true;</span><br><span class="line">$wgEnableEmail = true;</span><br><span class="line"></span><br><span class="line"># target set.</span><br><span class="line">$wgExternalLinkTarget = &apos;_blank&apos;;</span><br><span class="line"></span><br><span class="line">#Extension:DynamicSidebar</span><br><span class="line">wfLoadExtension( &apos;DynamicSidebar&apos; );</span><br><span class="line">// Enable debugging</span><br><span class="line">$wgDebugLogGroups[&quot;dynamic-sidebar&quot;] = &quot;/tmp/sidebar-debug.log&quot;;</span><br><span class="line"></span><br><span class="line">// Allow users to create their own custom sidebars under User:&lt;username&gt;/Sidebar</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseUserpages = true;</span><br><span class="line"></span><br><span class="line">// Allow group sidebars under MediaWiki:Sidebar/Group:&lt;group&gt;</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseGroups = true;</span><br><span class="line"></span><br><span class="line">// Allow category based sidebars under MediaWiki:Sidebar/Category:&lt;category&gt;</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseCategories = true;</span><br><span class="line"></span><br><span class="line">#Extension:CollapsibleVector &amp; TreeOfSiderbar</span><br><span class="line">wfLoadExtension( &apos;CollapsibleVector&apos; );</span><br><span class="line">$wgCollapsibleVectorFeatures[&apos;collapsiblenav&apos;][&apos;global&apos;] = true;</span><br><span class="line">$wgCollapsibleVectorFeatures[&apos;collapsiblenav&apos;][&apos;user&apos;] = true;</span><br><span class="line"></span><br><span class="line">#Extension:TreeAndMenu</span><br><span class="line">wfLoadExtension( &apos;TreeAndMenu&apos; );</span><br><span class="line"></span><br><span class="line">#MarkdownExtraParser</span><br><span class="line">/*require_once &quot;$IP/extensions/MarkdownExtraParser/MarkdownExtraParser.php&quot;;</span><br><span class="line">// MarkdownExtraParser</span><br><span class="line">$MarkdownExtraParserOptions = array(</span><br><span class="line">    &apos;use_raw_html&apos; =&gt; true,</span><br><span class="line">);*/</span><br><span class="line"></span><br><span class="line">#SimpleBatchUpload</span><br><span class="line">wfLoadExtension(&apos;SimpleBatchUpload&apos;);</span><br><span class="line"></span><br><span class="line">#Piwik</span><br><span class="line">/*</span><br><span class="line">require_once &quot;$IP/extensions/piwik-mediawiki/Piwik.php&quot;;</span><br><span class="line">$wgPiwikURL = &quot;piwik.domain-name.com/&quot;;</span><br><span class="line">$wgPiwikIDSite = &quot;1&quot;;</span><br><span class="line">$wgUseSiteJS = true;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"># MobileFrontend</span><br><span class="line">wfLoadExtension( &apos;MobileFrontend&apos; );</span><br><span class="line">$wgMFAutodetectMobileView = true;</span><br><span class="line">$wgMFNearbyEndpoint = &apos;http://en.m.wikipedia.org/w/api.php&apos;;</span><br><span class="line">$wgMFNearby = true;</span><br><span class="line"># MobileContext::singleton()-&gt;setForceMobileView( true );</span><br><span class="line"># $wgMFDefaultSkinClass = &apos;SkinVector&apos;; // use Vector skin</span><br><span class="line">$wgMFDefaultSkinClass = &apos;SkinTimeless&apos;; // use Timeless skin</span><br><span class="line"></span><br><span class="line"># GeoData</span><br><span class="line">require_once &quot;$IP/extensions/GeoData/GeoData.php&quot;;</span><br><span class="line"></span><br><span class="line"># PageImages</span><br><span class="line">require_once &quot;$IP/extensions/PageImages/PageImages.php&quot;;</span><br><span class="line"></span><br><span class="line"># Enable Semantic MediaWiki</span><br><span class="line"># require_once &quot;$IP/extensions/SemanticMediaWiki/SemanticMediaWiki.php&quot;;</span><br><span class="line">enableSemantics(&apos;wiki.domain-name.com&apos;);</span><br></pre></td></tr></table></figure><h1 id="插件列表参考"><a href="#插件列表参考" class="headerlink" title="插件列表参考"></a>插件列表参考</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Bootstrap</span><br><span class="line">Cite</span><br><span class="line">CiteThisPage</span><br><span class="line">CollapsibleVector</span><br><span class="line">ConfirmEdit</span><br><span class="line">DynamicSidebar</span><br><span class="line">Gadgets</span><br><span class="line">GeoData</span><br><span class="line">ImageMap</span><br><span class="line">InputBox</span><br><span class="line">Interwiki</span><br><span class="line">LdapAuthentication</span><br><span class="line">LocalisationUpdate</span><br><span class="line">MarkdownExtraParser</span><br><span class="line">MobileFrontend</span><br><span class="line">Nuke</span><br><span class="line">OpenLayers</span><br><span class="line">PageImages</span><br><span class="line">ParserFunctions</span><br><span class="line">PdfHandler</span><br><span class="line">piwik-mediawiki</span><br><span class="line">Poem</span><br><span class="line">README</span><br><span class="line">Renameuser</span><br><span class="line">SemanticForms</span><br><span class="line">SemanticMediaWiki</span><br><span class="line">SimpleBatchUpload</span><br><span class="line">SpamBlacklist</span><br><span class="line">SyntaxHighlight_GeSHi</span><br><span class="line">TitleBlacklist</span><br><span class="line">TreeAndMenu</span><br><span class="line">UserMerge</span><br><span class="line">VisualEditor</span><br><span class="line">WikiEditor</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>MediaWiki</category>
      </categories>
      <tags>
        <tag>MediaWiki</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown格式备注</title>
    <url>/markdown%E6%A0%BC%E5%BC%8F%E5%A4%87%E6%B3%A8/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>好的文档不仅要内容精湛，更要格式优雅。</p></blockquote><a id="more"></a><blockquote><p>基本格式就不介绍了，主要备忘一些特殊格式。对，肯定不全面，慢慢完善嘛。。。</p></blockquote><h1 id="表格设置"><a href="#表格设置" class="headerlink" title="表格设置"></a>表格设置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    table</span><br><span class="line">        width: 100%; /*表格宽度*/</span><br><span class="line">        max-width: 65em; /*表格最大宽度，避免表格过宽*/</span><br><span class="line">        border: 1px solid #dedede; /*表格外边框设置*/</span><br><span class="line">        margin: 15px auto; /*外边距*/</span><br><span class="line">        border-collapse: collapse; /*使用单一线条的边框*/</span><br><span class="line">        empty-cells: show; /*单元格无内容依旧绘制边框*/</span><br><span class="line">        tr:</span><br><span class="line">            hover &#123;background: #efefef;&#125;</span><br><span class="line">        td:</span><br><span class="line">            height: 35px; /*统一每一行的默认高度*/</span><br><span class="line">            border: 1px solid #dedede; /*内部边框样式*/</span><br><span class="line">            padding: 0 10px; /*内边距*/</span><br><span class="line">        th:</span><br><span class="line">            white-space: nowrap; /*表头内容强制在一行显示*/</span><br><span class="line">            font-weight: bold; /*加粗*/</span><br><span class="line">            text-align: center !important; /*内容居中，加上 !important 避免被 Markdown 样式覆盖*/</span><br><span class="line">            background: rgba(158,188,226,0.2); /*背景色*/</span><br><span class="line">            nth-of-type(1)&#123;width: 5%; white-space: nowrap;&#125;</span><br><span class="line">            nth-of-type(2)&#123;width: 15%;&#125;</span><br><span class="line">            nth-of-type(3)&#123;width: 70%;&#125;</span><br><span class="line">            nth-of-type(4)&#123;width: 10%;&#125;</span><br><span class="line">    tbody</span><br><span class="line">        tr:</span><br><span class="line">            nth-child(2n)&#123;background: rgba(158,188,226,0.12);&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="网址导航了表格样式"><a href="#网址导航了表格样式" class="headerlink" title="网址导航了表格样式"></a>网址导航了表格样式</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">table th &#123;</span><br><span class="line">    font-weight: bold; /*加粗*/</span><br><span class="line">    font-szie:  xx-large;</span><br><span class="line">    text-align: center !important; /*内容居中，加上 !important 避免被 Markdown 样式覆盖*/</span><br><span class="line">    background: #E0E0E0; /*背景色 rgba(158,188,226,0.2)*/</span><br><span class="line">    white-space: nowrap; /*表头内容强制在一行显示*/</span><br><span class="line">    height: 35px;</span><br><span class="line">    border: 0px;</span><br><span class="line">&#125;</span><br><span class="line">table tbody tr:nth-child(2n) &#123;</span><br><span class="line">    background: rgba(158,188,226,0.12);</span><br><span class="line">&#125;</span><br><span class="line">table tr:hover &#123;</span><br><span class="line">    background: #efefef;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="note-标签"><a href="#note-标签" class="headerlink" title="note 标签"></a>note 标签</h1><h2 id="官方"><a href="#官方" class="headerlink" title="官方"></a>官方</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">使用方式</span><br><span class="line">&#123;% note class_name %&#125; Content (md partial supported) &#123;% endnote %&#125;</span><br><span class="line">其中，class_name 可以是以下列表中的一个值：</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line">primary</span><br><span class="line">success</span><br><span class="line">info</span><br><span class="line">warning</span><br><span class="line">danger</span><br></pre></td></tr></table></figure><h2 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p id=&quot;div-border-top-green&quot;&gt;</span><br><span class="line">内容</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p id=&quot;div-border-left-red&quot;&gt;</span><br><span class="line">内容</span><br><span class="line">[shell tag](/tags/shell)标签</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line">&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;default&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">primary</span><br><span class="line">&lt;div class=&quot;note primary&quot;&gt;&lt;p&gt;primary&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">success</span><br><span class="line">&lt;div class=&quot;note success&quot;&gt;&lt;p&gt;success&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">info</span><br><span class="line">&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;info&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">warning</span><br><span class="line">&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;warning&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">danger</span><br><span class="line">&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;danger&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">danger no-icon</span><br><span class="line">&lt;div class=&quot;note danger no-icon&quot;&gt;&lt;p&gt;danger no-icon&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="可以收缩的内容"><a href="#可以收缩的内容" class="headerlink" title="可以收缩的内容"></a>可以收缩的内容</h1><ul><li>可以收缩的内容源码<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">## 标题1.1</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.1.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.1.2</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.1.3</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 标题1.2</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.2.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.2.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">* [链接2](https://www.baidu.com)</span><br><span class="line">* [链接3](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 标题1.3</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.3.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.3.2</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">* [链接2](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br></pre></td></tr></table></figure></li></ul><ul><li>可以收缩的内容效果</li></ul><h2 id="标题1-1"><a href="#标题1-1" class="headerlink" title="标题1.1"></a>标题1.1</h2><details><summary>查看详情</summary><h3 id="标题1-1-1"><a href="#标题1-1-1" class="headerlink" title="标题1.1.1"></a>标题1.1.1</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li></ul><h3 id="标题1-1-2"><a href="#标题1-1-2" class="headerlink" title="标题1.1.2"></a>标题1.1.2</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li></ul><h3 id="标题1-1-3"><a href="#标题1-1-3" class="headerlink" title="标题1.1.3"></a>标题1.1.3</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li></ul></details><h2 id="标题1-2"><a href="#标题1-2" class="headerlink" title="标题1.2"></a>标题1.2</h2><details><summary>查看详情</summary><h3 id="标题1-2-1"><a href="#标题1-2-1" class="headerlink" title="标题1.2.1"></a>标题1.2.1</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li></ul><h3 id="标题1-221"><a href="#标题1-221" class="headerlink" title="标题1.221"></a>标题1.221</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接2</a></li><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接3</a></li></ul></details><h2 id="标题1-3"><a href="#标题1-3" class="headerlink" title="标题1.3"></a>标题1.3</h2><details><summary>查看详情</summary><h3 id="标题1-3-1"><a href="#标题1-3-1" class="headerlink" title="标题1.3.1"></a>标题1.3.1</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li></ul><h3 id="标题1-3-2"><a href="#标题1-3-2" class="headerlink" title="标题1.3.2"></a>标题1.3.2</h3><ul><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a></li><li><a href="https://www.baidu.com" target="_blank" rel="noopener">链接2</a></li></ul></details><h1 id="网页表格"><a href="#网页表格" class="headerlink" title="网页表格"></a>网页表格</h1><table><tr><td align="center"><a href="https://crisp.chat/?ta=oR1nEv43TM" target="_blank"><img src="https://pbs.twimg.com/profile_images/651629444944273408/r5Kd_ifq_400x400.png" height="64"></a></td><td align="center"><a href="http://try.anyleads.com/secret" target="_blank"><img src="https://pbs.twimg.com/profile_images/838140522476761094/A4WpBe5M_400x400.jpg" height="64"></a></td><td align="center"><a href="https://hackr.io/" target="_blank"><img src="https://d1eq8vvyuam4eq.cloudfront.net/assets/images/code-images/code-apple-touch-icon-precomposed.png" height="64"></a></td><td align="center"><a href="https://learnk8s.io/" target="_blank"><img src="https://pbs.twimg.com/profile_images/925127335573114880/9yCkEIe3_400x400.jpg" height="64"></a></td></tr></table><h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><ul><li><p><a href="https://www.tablesgenerator.com/" target="_blank" rel="noopener">表格生成器</a></p></li><li><p><a href="http://pressbin.com/tools/excel_to_html_table/index.html" target="_blank" rel="noopener">http://pressbin.com/tools/excel_to_html_table/index.html</a></p></li><li><p><a href="http://www.w3school.com.cn/tags/html_ref_colornames.asp" target="_blank" rel="noopener">html 颜色名</a></p></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://moxfive.xyz/2016/03/04/markdown-table-style/" target="_blank" rel="noopener">Markdown 表格样式调整与自适应优化</a></p></li><li><p><a href="https://labrick.cc/2015/07/28/markdown-problem-answer/" target="_blank" rel="noopener">Markdown使用问题及解决办法</a></p></li><li><p><a href="https://github.com/LeCoupa/awesome-cheatsheets/blob/master/README.md" target="_blank" rel="noopener">github·awesome-cheatsheets</a></p></li><li><p><a href="http://wow.kuapp.com/markdown/" target="_blank" rel="noopener">Markdown-Syntax-CN</a></p></li><li><p><a href="https://github.com/MOxFIVE/Markdown-Archives-Backup/blob/master/_posts/2016-03-04.markdown-table-style.md" target="_blank" rel="noopener">https://github.com/MOxFIVE/Markdown-Archives-Backup/blob/master/_posts/2016-03-04.markdown-table-style.md</a></p></li></ul>]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
        <tag>Readme</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux命令行环境下进行URL解码</title>
    <url>/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%B8%8B%E8%BF%9B%E8%A1%8Curl%E8%A7%A3%E7%A0%81/</url>
    <content><![CDATA[<p>命令行环境解码url是运维的必备技能，尤其是在排查应用日志的时候。而最佳实践还是不依赖任何编程能直接敲个命令就搞定。。。</p><a id="more"></a><p>以下内容基于CentOS6.9系统环境。</p><h1 id="命令行软件包"><a href="#命令行软件包" class="headerlink" title="命令行软件包"></a>命令行软件包</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@test-204 ~]# rpm -qf /usr/bin/urlencode</span><br><span class="line">gridsite-clients-2.2.6-2.el6.x86_64</span><br><span class="line">[root@test-204 ~]#</span><br></pre></td></tr></table></figure><h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/g/gridsite-clients-2.2.6-2.el6.x86_64.rpm \</span><br><span class="line">http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/g/gridsite-libs-2.2.6-2.el6.x86_64.rpm \</span><br><span class="line">http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/c/canl-c-2.1.8-1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure><h1 id="使用查看"><a href="#使用查看" class="headerlink" title="使用查看"></a>使用查看</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 查看归档日志</span><br><span class="line">urlencode -d decode $(zcat access.log.2018_09_01_22.log.gz |awk &apos;&#123;print $7&#125;&apos; |sort |uniq -c |sort -rn |head )</span><br><span class="line"></span><br><span class="line">#查看实时日志</span><br><span class="line">tailf access.log |awk &apos;&#123;print $7&#125;&apos;|xargs urlencode -d decode</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://www.urldecoder.net/linux-urldecode" target="_blank" rel="noopener">linux-urldecode</a></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>urldecode</tag>
      </tags>
  </entry>
  <entry>
    <title>systemd配置范例</title>
    <url>/systemd%E9%85%8D%E7%BD%AE%E8%8C%83%E4%BE%8B/</url>
    <content><![CDATA[<p>systemd 是一个 Linux 系统基础组件的集合，提供了一个系统和服务管理器，运行为 PID 1 并负责启动其它程序。功能包括：支持并行化任务；同时采用 socket 式与 D-Bus 总线式激活服务；按需启动守护进程（daemon）；利用 Linux 的 cgroups 监视进程；支持快照和系统恢复；维护挂载点和自动挂载点；各服务间基于依赖关系进行精密控制。systemd 支持 SysV 和 LSB 初始脚本，可以替代 sysvinit。除此之外，功能还包括日志进程、控制基础系统配置，维护登陆用户列表以及系统账户、运行时目录和设置，可以运行容器和虚拟机，可以简单的管理网络配置、网络时间同步、日志转发和名称解析等。</p><a id="more"></a><h1 id="配置文件路径"><a href="#配置文件路径" class="headerlink" title="配置文件路径"></a>配置文件路径</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/usr/lib/systemd/system</span><br><span class="line">/run/systemd/system</span><br><span class="line">/etc/systemd/system</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Zabbix Agent</span><br><span class="line">After=syslog.target</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Environment=&quot;CONFFILE=/etc/zabbix/zabbix_agentd.conf&quot;</span><br><span class="line">EnvironmentFile=-/etc/sysconfig/zabbix-agent</span><br><span class="line">Type=forking</span><br><span class="line">Restart=on-failure</span><br><span class="line">PIDFile=/run/zabbix/zabbix_agentd.pid</span><br><span class="line">KillMode=control-group</span><br><span class="line"># ExecStartPre=-/usr/bin/chmod 777 /run/zabbix/zabbix_agentd.pid</span><br><span class="line">ExecStart=/usr/sbin/zabbix_agentd -c $CONFFILE</span><br><span class="line">ExecStop=/bin/kill -SIGTERM $MAINPID</span><br><span class="line">ExecStartPost=-/usr/bin/chown zabbix:zabbix /run/zabbix/zabbix_agentd.pid</span><br><span class="line"># ExectStopPost=-/usr/bin/chmod 777 /run/zabbix/zabbix_agentd.pid</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="centos7-兼容6的启动脚本-etc-init-d-php-fpm"><a href="#centos7-兼容6的启动脚本-etc-init-d-php-fpm" class="headerlink" title="centos7 兼容6的启动脚本/etc/init.d/php-fpm"></a>centos7 兼容6的启动脚本/etc/init.d/php-fpm</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line">#</span><br><span class="line"># chkconfig: - 84 16</span><br><span class="line"># description:	PHP FastCGI Process Manager</span><br><span class="line"># processname: php-fpm</span><br><span class="line"># config: /etc/php-fpm.conf</span><br><span class="line"># config: /etc/sysconfig/php-fpm</span><br><span class="line"># pidfile: /var/run/php-fpm/php-fpm.pid</span><br><span class="line">#</span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:          php-fpm</span><br><span class="line"># Required-Start:    $remote_fs $network</span><br><span class="line"># Required-Stop:     $remote_fs $network</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      0 1 6</span><br><span class="line"># Short-Description: starts php-fpm</span><br><span class="line"># Description:       starts the PHP FastCGI Process Manager daemon</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line"># Standard LSB functions</span><br><span class="line">#. /lib/lsb/init-functions</span><br><span class="line"></span><br><span class="line"># Source function library.</span><br><span class="line">. /etc/init.d/functions</span><br><span class="line"></span><br><span class="line"># Check that networking is up.</span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"></span><br><span class="line"># Additional environment file</span><br><span class="line">if [ -f /etc/sysconfig/php-fpm ]; then</span><br><span class="line">      . /etc/sysconfig/php-fpm</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$NETWORKING&quot; = &quot;no&quot; ]</span><br><span class="line">then</span><br><span class="line">	exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">RETVAL=0</span><br><span class="line">prog=&quot;php-fpm&quot;</span><br><span class="line">pidfile=$&#123;PIDFILE-/var/run/php-fpm/php-fpm.pid&#125;</span><br><span class="line">lockfile=$&#123;LOCKFILE-/var/lock/subsys/php-fpm&#125;</span><br><span class="line"></span><br><span class="line">start () &#123;</span><br><span class="line">	echo -n $&quot;Starting $prog: &quot;</span><br><span class="line">	dir=$(dirname $&#123;pidfile&#125;)</span><br><span class="line">	[ -d $dir ] || mkdir $dir</span><br><span class="line">	daemon --pidfile $&#123;pidfile&#125; /usr/sbin/php-fpm --daemonize</span><br><span class="line">	RETVAL=$?</span><br><span class="line">	echo</span><br><span class="line">	[ $RETVAL -eq 0 ] &amp;&amp; touch $&#123;lockfile&#125;</span><br><span class="line">&#125;</span><br><span class="line">stop () &#123;</span><br><span class="line">	echo -n $&quot;Stopping $prog: &quot;</span><br><span class="line">	killproc -p $&#123;pidfile&#125; php-fpm</span><br><span class="line">	RETVAL=$?</span><br><span class="line">	echo</span><br><span class="line">	if [ $RETVAL -eq 0 ] ; then</span><br><span class="line">		rm -f $&#123;lockfile&#125; $&#123;pidfile&#125;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart () &#123;</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reload () &#123;</span><br><span class="line">	echo -n $&quot;Reloading $prog: &quot;</span><br><span class="line">	if ! /usr/sbin/php-fpm --test ; then</span><br><span class="line">	        RETVAL=6</span><br><span class="line">	        echo $&quot;not reloading due to configuration syntax error&quot;</span><br><span class="line">	        failure $&quot;not reloading $prog due to configuration syntax error&quot;</span><br><span class="line">	else</span><br><span class="line">		killproc -p $&#123;pidfile&#125; php-fpm -USR2</span><br><span class="line">		RETVAL=$?</span><br><span class="line">	fi</span><br><span class="line">	echo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># See how we were called.</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  start)</span><br><span class="line">	start</span><br><span class="line">	;;</span><br><span class="line">  stop)</span><br><span class="line">	stop</span><br><span class="line">	;;</span><br><span class="line">  status)</span><br><span class="line">	status -p $&#123;pidfile&#125; php-fpm</span><br><span class="line">	RETVAL=$?</span><br><span class="line">	;;</span><br><span class="line">  restart)</span><br><span class="line">	restart</span><br><span class="line">	;;</span><br><span class="line">  reload|force-reload)</span><br><span class="line">	reload</span><br><span class="line">	;;</span><br><span class="line">  configtest)</span><br><span class="line"> 	/usr/sbin/php-fpm --test</span><br><span class="line">	RETVAL=$?</span><br><span class="line">	;;</span><br><span class="line">  condrestart|try-restart)</span><br><span class="line">	[ -f $&#123;lockfile&#125; ] &amp;&amp; restart || :</span><br><span class="line">	;;</span><br><span class="line">  *)</span><br><span class="line">	echo $&quot;Usage: $0 &#123;start|stop|status|restart|reload|force-reload|condrestart|try-restart|configtest&#125;&quot;</span><br><span class="line">	RETVAL=2</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">exit $RETVAL</span><br></pre></td></tr></table></figure><h2 id="centos7-systemd启动配置-usr-lib-systemd-system-php-fpm-service"><a href="#centos7-systemd启动配置-usr-lib-systemd-system-php-fpm-service" class="headerlink" title="centos7 systemd启动配置/usr/lib/systemd/system/php-fpm.service"></a>centos7 systemd启动配置/usr/lib/systemd/system/php-fpm.service</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The PHP FastCGI Process Manager</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">PIDFile=/var/run/php-fpm/php-fpm.pid</span><br><span class="line">EnvironmentFile=/etc/sysconfig/php-fpm</span><br><span class="line">ExecStart=/usr/sbin/php-fpm --nodaemonize --fpm-config /etc/php-fpm.conf</span><br><span class="line">ExecReload=/bin/kill -USR2 $MAINPID</span><br><span class="line">PrivateTmp=true</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="nginx-service【官方】"><a href="#nginx-service【官方】" class="headerlink" title="nginx.service【官方】"></a>nginx.service【官方】</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># /usr/lib/systemd/system/nginx.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx - high performance web server</span><br><span class="line">Documentation=http://nginx.org/en/docs/</span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -s TERM $MAINPID</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h2 id="tomcat-service"><a href="#tomcat-service" class="headerlink" title="tomcat.service"></a>tomcat.service</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Apache Tomcat</span><br><span class="line">Documentation=https://tomcat.apache.org/tomcat-9.0-doc/index.html</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/search/odin/webserver/tomcat/bin/catalina.map.pid</span><br><span class="line">ExecStart=/search/odin/webserver/tomcat/bin/catalina.sh start</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">ExecStop=/search/odin/webserver/tomcat/bin/catalina.sh stop</span><br><span class="line">PrivateTmp=true</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=15s</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://wiki.archlinux.org/index.php/Systemd_(简体中文)#systemd_.E5.9F.BA.E6.9C.AC.E5.B7.A5.E5.85.B7" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/Systemd_(简体中文)#systemd_.E5.9F.BA.E6.9C.AC.E5.B7.A5.E5.85.B7</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html</a></p></li><li><p><a href="http://www.jinbuguo.com/systemd/systemd.service.html" target="_blank" rel="noopener">http://www.jinbuguo.com/systemd/systemd.service.html</a></p></li><li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-8-on-centos-7" target="_blank" rel="noopener">How To Install Apache Tomcat 8 on CentOS 7</a></p></li></ul>]]></content>
      <categories>
        <category>systemd</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL基础实践</title>
    <url>/mysql%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/</url>
    <content><![CDATA[<p>持续更新中</p><a id="more"></a><h1 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h1><ul><li><p>显示数据库线程信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW FULL PROCESSLIST;</span><br></pre></td></tr></table></figure></li><li><p>输出用户信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT now(), user(), version();</span><br></pre></td></tr></table></figure></li><li><p>查看数据库变量信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW VARIABLES;</span><br></pre></td></tr></table></figure></li><li><p>过滤字段</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show variables like &apos;char%&apos;;</span><br><span class="line">SHOW VARIABLES LIKE &apos;character_set_%&apos;;</span><br></pre></td></tr></table></figure></li><li><p>查看慢查询状态</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">show global status like ‘%slow%’;</span><br><span class="line">show variables like &apos;%slow%&apos;;</span><br></pre></td></tr></table></figure></li><li><p>输出数据库信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SHOW DATABASES LIKE &apos;%wiki%&apos;;</span><br><span class="line">SHOW CREATE DATABASE mediawiki;</span><br></pre></td></tr></table></figure></li></ul><h1 id="修改数据库配置"><a href="#修改数据库配置" class="headerlink" title="修改数据库配置"></a>修改数据库配置</h1><ul><li><p>修改数据库的默认排序规则</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER DATABASE wiki CHARACTER SET utf8 COLLATE utf8_bin;</span><br></pre></td></tr></table></figure></li><li><p>授权所有主机远程连接数据库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE USER &apos;myuser&apos;@&apos;%&apos; IDENTIFIED BY &apos;passwd&apos;;</span><br><span class="line">UPDATE mysql.user SET Grant_priv=&apos;Y&apos;, Super_priv=&apos;Y&apos; WHERE User=&apos;root&apos;;  # 打开授权</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;myuser&apos;@&apos;%&apos; IDENTIFIED BY &apos;mypassword&apos; WITH GRANT OPTION;</span><br><span class="line">eg: GRANT ALL PRIVILEGES ON dbname.* TO &apos;username&apos;@&apos;%&apos; IDENTIFIED BY &apos;passwd&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure><ul><li>mysqladmin -u用户名 -p旧密码 password 新密码</li></ul></li></ul><ul><li><p>MySQL强制重置密码方法一</p><ul><li><p>停掉mysql服务</p><p>/etc/init.d/mysqld stop</p></li><li><p>强制以root身份免认证登录</p><p>/usr/sbin/mysqld –user=root –skip-grant-tables &amp;</p></li><li><p>重置密码：</p><p>update mysql.user set password=PASSWORD(‘123456’) where User=’root’;</p><p>flush privileges;</p><p>quit;</p><ul><li>启动MySQL</li></ul><p>/etc/init.d/mysql start</p></li></ul></li><li><p>MySQL强制重置密码方法二</p><p>mysqld –skip-grant-tables</p><p>mysql</p><p>use mysql;</p><p>update user set password=password(“admin10000.com”) where user=”root”;</p><p>flush privileges;</p></li></ul><ul><li><p>修改root密码</p><ul><li><p>方法一</p><p>mysqladmin -u用户名 -p旧密码 password 新密码</p></li><li><p>方法二</p><p>set password for 用户名@localhost = password(‘新密码’);</p></li><li><p>方法三</p><p>use mysql;</p><p>update user set password=password(‘新密码’) where user=’root’ and host=’localhost’;</p><p>flush privileges;</p></li></ul></li></ul><ul><li><p>MySQL5.7 关闭密码策略</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set global validate_password_policy=0;</span><br><span class="line"></span><br><span class="line">update mysql.user set authentication_string=PASSWORD(&apos;123456&apos;) where user=&apos;root&apos;;</span><br><span class="line"></span><br><span class="line">alter user &apos;root&apos;@&apos;localhost&apos; identified by &apos;passwd&apos;;</span><br></pre></td></tr></table></figure></li><li><p>设置密码永不过期</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; PASSWORD EXPIRE NEVER;</span><br></pre></td></tr></table></figure></li><li><p>远程授权：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grant all privileges on DBName.* to &apos;myuser&apos;@&apos;%&apos; identified by &apos;passwd&apos;;</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://shockerli.net/post/1000-line-mysql-note/" target="_blank" rel="noopener">一千行 MySQL 学习笔记</a></li></ul>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx访问频率限制</title>
    <url>/nginx%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87%E9%99%90%E5%88%B6/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>在nginx服务中通过限制访问频率的策略可以在一定程度上抵御DDoS攻击。</p></blockquote><a id="more"></a><h1 id="配置范例"><a href="#配置范例" class="headerlink" title="配置范例"></a>配置范例</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 白名单</span><br><span class="line"># geo $remote_addr $limited</span><br><span class="line">geo $limited</span><br><span class="line">&#123;</span><br><span class="line">    default 1;</span><br><span class="line">    10.0.0.0/8 0;</span><br><span class="line">    123.207.144.100/32 0;</span><br><span class="line">    123.123.123.248/30 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map $limited $limit &#123;</span><br><span class="line">    1 $binary_remote_addr;</span><br><span class="line">    0 &quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># nginx.conf 中的http模块中定义limit_req_zone</span><br><span class="line">limit_req_zone $limit zone=reqzone1:10m rate=20r/s;</span><br><span class="line"></span><br><span class="line"># server模块中的location规则中应用limit_req_zone(也可以直接应用到server或者http模块中)</span><br><span class="line">server&#123;</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        #limit_req zone=reqzone3 burst=20 nodelay;</span><br><span class="line">        limit_req zone=reqzone3 burst=20;</span><br><span class="line">        location xxx1 &#123;</span><br><span class="line">            ...</span><br><span class="line">            #limit_req zone=reqzone1 burst=20 nodelay;</span><br><span class="line">            limit_req zone=reqzone1 burst=20;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        location xxx2 &#123;</span><br><span class="line">            ...</span><br><span class="line">            #limit_req zone=reqzone2 burst=20 nodelay;</span><br><span class="line">            limit_req zone=reqzone2 burst=20;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"># 在http, server, location中均可定义limit_req_status code，默认503；</span><br></pre></td></tr></table></figure><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><ul><li><p>geo</p><ul><li>geo [$address] $variable { … } 定义从指定的变量获取客户端的IP地址。默认情况下，nginx从$remote_addr变量取得客户端IP地址，但也可以从其他变量获得。</li></ul></li><li><p>map</p><ul><li>map为一个变量设置的映射表，用来创建变量，映射表由两列组成，匹配模式和对应的值。但是仅在变量被接受的时候执行视图映射操作，对于处理没有引用变量的请求时，这个模块并没有性能上的缺失。</li></ul></li><li><p>limit_req_zone</p><ul><li>第一个字段定义为key，限制对象。$binary_remote_addr(\x0A\x64\xCE\x10)是4字节的IPv4地址，或者16字节的IPv6地址，32位系统上占用32或64个字节，64位系统上占用128字节，占用空间比$remote_addr少64字节。10M大概可以保存160,000条记录。<br>*limit_req_zone中如果key为””表示不对其进行频率限制，所以白名单将用户的key设置为””。</li><li>zone=reqzone1:10m，定义名为reqzone1大小为10M(漏桶算法桶的大小)的zone存储访问频率.共享内存空间被耗尽后则服务器将会对后续所有的请求返回503(Service Temporarily Unavailable)错误。</li><li>rate=20r/s，定义访问速率阈值，单位可以是r/s(次/秒)或者r/m(次/分钟)</li></ul></li><li><p>limit_req</p><ul><li>zone=reqzone1，选择应用的限制策略zone名称</li><li>burst=20，可选字段，缓冲请求数(特权令牌数，拥有特权令牌可以直接访问服务)</li><li>nodelay，可选字段，加入该字段后超出令牌数的请求直接返回503</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://nginx.org/en/docs/http/ngx_http_limit_req_module.html" target="_blank" rel="noopener">nginx Module ngx_http_limit_req_module</a></li><li><a href="https://www.w3cschool.cn/nginxsysc/nginxsysc-limit-req.html" target="_blank" rel="noopener">w3cschool·Nginx 限制IP访问频率</a></li><li><a href="http://www.nginx.cn/446.html" target="_blank" rel="noopener">nginx限制某个IP同一时间段的访问次数</a></li><li><a href="https://www.cnblogs.com/biglittleant/p/8979915.html" target="_blank" rel="noopener">死磕nginx系列–nginx 限流配置</a></li></ul>]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>DDoS</tag>
      </tags>
  </entry>
  <entry>
    <title>进程、线程、协程</title>
    <url>/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/</url>
    <content><![CDATA[<p>概念可以帮助我们更好的思考和理解。</p><a id="more"></a><h2 id="进程-process"><a href="#进程-process" class="headerlink" title="进程(process)"></a>进程(process)</h2><p>进程是正在运行的程序的实例，广义上是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。<br>进程是<strong>系统进行资源分配和调度的基本单位</strong>，是操作系统结构的基础。所有运行在Linux操作系统上的进程都使用一个名叫task_struct的结构来管理，这个结构亦被称作进程描述符(Process Descriptor)。进程描述符包括进程运行的所有信息如进程ID、进程属性和构建这个进程所需要的资源。<br>在面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，<strong>进程是程序的实体</strong>。</p><ul><li><p>特征：</p><ul><li>动态性: 动态产生、动态消亡</li><li>并发性: 并发执行</li><li>独立性: 独立运行的基本单位，系统分配资源和调度的独立单位</li><li>异步性: 按各自独立不可预知的速度向前推进</li></ul></li><li><p>结构特征：</p><p>进程由程序、数据和进程控制块三部分组成。</p></li><li><p>三种状态</p><ul><li><p>就绪状态（Ready）：<br>进程已获得除处理器外的所需资源，等待分配处理器资源；只要分配了处理器进程就可执行。</p></li><li><p>运行状态(Running)：<br>进程占用处理器资源；处于此状态的进程的数目小于等于处理器的数目。</p></li><li><p>阻塞状态(Blocked)：<br>由于进程等待某种条件(如I/O操作或进程同步),在条件满足之前无法继续执行。该事件发生前即使把处理器资源分配给该进程，也无法运行。</p></li></ul></li></ul><h2 id="线程-thread"><a href="#线程-thread" class="headerlink" title="线程(thread)"></a>线程(thread)</h2><p>线程，有时被称为轻量级进程(Lightweight Process，LWP），是程序中一个单一的顺序控制流程，是<strong>程序执行流的最小单元</strong>。<br>也是系统独立调度和分派CPU的基本单位指令运行时的程序的调度单位。它与同一进程中的其他线程并行运行。它们能共享同一资源如内存、地址空间、打开的文件等。它们能访问同样一组应用数据。</p><p>一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。</p><ul><li>特征<ul><li>线程是进程中的实体，是被系统独立调度和分派的基本单位；</li><li>一个进程可以拥有多个线程，一个线程必须有一个父进程；</li><li>线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源；</li><li>一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行；</li><li>线程也有就绪、阻塞和运行三种基本状态；</li><li>每一个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。</li></ul></li></ul><h2 id="协程-coroutine"><a href="#协程-coroutine" class="headerlink" title="协程(coroutine)"></a>协程(coroutine)</h2><p>协程不是进程或线程，其执行过程更类似于子例程，或者说不带返回值的函数调用。<br>协程也是一种程序组件。相对子例程而言，协程更为一般和灵活。</p><ul><li>特征<ul><li>一个程序可以包含多个协程，可以对比与一个进程包含多个线程；</li><li>有自己的上下文，但是其切换由自己控制，由当前协程切换到其他协程由当前协程来控制；</li><li>协程的起始处是第一个入口点，在协程里，返回点之后是接下来的入口点；</li><li>协程的生命期完全由他们的使用的需要决定；</li><li>协程可以通过yield来调用其它协程。通过yield方式转移执行权的协程之间不是调用者与被调用者的关系，而是彼此对称、平等的；</li><li>协程更适合于用来实现彼此熟悉的程序组件，如合作式多任务，迭代器，无限列表和管道。</li></ul></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/进程" target="_blank" rel="noopener">维基百科·进程</a></li><li><a href="https://zh.wikipedia.org/wiki/线程" target="_blank" rel="noopener">维基百科·线程</a></li><li><a href="https://zh.wikipedia.org/wiki/协程" target="_blank" rel="noopener">维基百科·协程</a></li><li><a href="https://baike.baidu.com/item/进程" target="_blank" rel="noopener">百度百科·进程</a></li><li><a href="https://baike.baidu.com/item/线程" target="_blank" rel="noopener">百度百科·线程</a></li><li><a href="https://baike.baidu.com/item/协程" target="_blank" rel="noopener">百度百科·协程</a></li></ul>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>进程</tag>
        <tag>线程</tag>
        <tag>协程</tag>
      </tags>
  </entry>
  <entry>
    <title>redis持久化策略</title>
    <url>/redis%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存也可以持久化的日志型、Key-Value数据库。</p></blockquote><a id="more"></a><h2 id="两种方式"><a href="#两种方式" class="headerlink" title="两种方式"></a>两种方式</h2><h3 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB(Redis DataBase)"></a>RDB(Redis DataBase)</h3><p>redis的默认持久化机制，在指定的时间间隔内将内存中的数据集快照写入磁盘。</p><h3 id="AOF-Append-Only-File"><a href="#AOF-Append-Only-File" class="headerlink" title="AOF(Append Only File)"></a>AOF(Append Only File)</h3><p>以日志的形式记录服务器所处理的每一个写操作，在Redis服务器启动之初会读取该文件来重新构建数据库，以保证启动后数据库中的数据是完整的。</p><p>Redis还可以同时使用AOF持久化和RDB持久化。<br>在这种情况下，当 Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比RDB文件所保存的数据集更完整。</p><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="RDB："><a href="#RDB：" class="headerlink" title="RDB："></a>RDB：</h3><ul><li>优点<ul><li>独立紧凑的数据文件，适用于备份和灾难恢复；</li><li>RDB在恢复大数据集时的速度比AOF的恢复速度要快。</li></ul></li><li>缺点<ul><li>服务器故障是可能丢失一个保存时间间隔的数据；</li></ul></li></ul><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF:"></a>AOF:</h3><ul><li>优点<ul><li>AOF 的默认策略为每秒钟fsync一次，在这种配置下，Redis 仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据</li></ul></li><li>缺点:<ul><li>对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积。</li><li>根据所使用的fsync策略，AOF的速度可能会慢于RDB。</li></ul></li></ul><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="开启RDB"><a href="#开启RDB" class="headerlink" title="开启RDB"></a>开启RDB</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">save 900 1            #在900秒(15分钟)内，如果至少有1个key发生变化，则dump内存快照。 </span><br><span class="line">save 300 10           #在300秒(5分钟)内，如果至少有10个key发生变化，则dump内存快照。 </span><br><span class="line">save 60 10000         #在60秒(1分钟)内，如果至少有10000个key发生变化，则dump内存快照。</span><br></pre></td></tr></table></figure><h3 id="关闭-RDB"><a href="#关闭-RDB" class="headerlink" title="关闭 RDB"></a>关闭 RDB</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-cli config set save &quot;&quot;</span><br></pre></td></tr></table></figure><ul><li>或者变更配置</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># save 900 1</span><br><span class="line"># save 300 10</span><br><span class="line"># save 60 10000</span><br></pre></td></tr></table></figure><h3 id="开启-AOF"><a href="#开启-AOF" class="headerlink" title="开启 AOF"></a>开启 AOF</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-cli config set appendonly yes</span><br><span class="line">redis-cli config appendfsync always      #每次有数据修改发生时都会写入AOF文件。 </span><br><span class="line">或者</span><br><span class="line">redis-cli config appendfsync everysec   #每秒钟同步一次，该策略为AOF的缺省策略。</span><br></pre></td></tr></table></figure><h3 id="关闭AOF"><a href="#关闭AOF" class="headerlink" title="关闭AOF"></a>关闭AOF</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">redis-cli config set appendonly no</span><br><span class="line">appendfsync no           #从不同步。高效但是数据不会被持久化。</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="http://redisdoc.com/topic/persistence.html" target="_blank" rel="noopener">redis持久化</a></li></ul>]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>持久化</tag>
        <tag>缓存</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP连接过程</title>
    <url>/tcp%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<p>传输控制协议(TCP)是一种面向连接的、可靠的、基于字节流的传输层通信协议。</p><a id="more"></a><p><img src="https://www.lengyuewusheng.com/assets/images/00043-01.png" alt="TCP连接过程"></p>]]></content>
      <categories>
        <category>TCP/IP</category>
      </categories>
      <tags>
        <tag>三次握手</tag>
        <tag>四次挥手</tag>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title>http协议头字段说明</title>
    <url>/http%E5%8D%8F%E8%AE%AE%E5%A4%B4%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>HTTP协议头字段定义了一个超文本传输协议事务中的操作参数。</p></blockquote><a id="more"></a><p>按照惯例，非标准的协议头字段是在字段名称前加上<code>X-</code>前缀来标识。</p><p>标准中没有对每个协议头字段的名称和值的大小设置任何限制，也没有限制字段的个数。在实际场景中出于安全性的考虑，大部分的服务器、客户端和代理软件都会实施一些限制。</p><h2 id="http请求字段"><a href="#http请求字段" class="headerlink" title="http请求字段"></a>http请求字段</h2><h3 id="请求字段"><a href="#请求字段" class="headerlink" title="请求字段"></a>请求字段</h3><table><thead><tr><th align="left">协议头字段名</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Accept</td><td align="left">能够接受的回应内容类型(Content-Types)。</td><td align="left">Accept: text/plain</td></tr><tr><td align="left">Accept-Charset</td><td align="left">能够接受的字符集。</td><td align="left">Accept-Charset: utf-8</td></tr><tr><td align="left">Accept-Encoding</td><td align="left">能够接受的编码方式列表。</td><td align="left">Accept-Encoding: gzip, deflate</td></tr><tr><td align="left">Accept-Language</td><td align="left">能够接受的回应内容的自然语言列表。</td><td align="left">Accept-Language: en-US</td></tr><tr><td align="left">Accept-Datetime</td><td align="left">能够接受的按照时间来表示的版本。</td><td align="left">Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</td></tr><tr><td align="left">Authorization</td><td align="left">用于超文本传输协议的认证的认证信息。</td><td align="left">Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td align="left">Cache-Control</td><td align="left">用来指定在这次的请求/响应链中的所有缓存机制 都必须 遵守的指令。</td><td align="left">Cache-Control: no-cache</td></tr><tr><td align="left">Connection</td><td align="left">该浏览器想要优先使用的连接类型。</td><td align="left">Connection: keep-alive<br>Connection: Upgrade</td></tr><tr><td align="left">Cookie</td><td align="left">之前由服务器通过Set- Cookie发送的一个超文本传输协议Cookie。</td><td align="left">Cookie: $Version=1; Skin=new;</td></tr><tr><td align="left">Content-Length</td><td align="left">以八位字节数组(8位的字节)表示的请求体的长度。</td><td align="left">Content-Length: 348</td></tr><tr><td align="left">Content-MD5</td><td align="left">请求体的内容的二进制 MD5 散列值，以 Base64 编码的结果。</td><td align="left">Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td align="left">Content-Type</td><td align="left">请求体的多媒体类型(用于POST和PUT请求中)。</td><td align="left">Content-Type: application/x-www-form-urlencoded</td></tr><tr><td align="left">Date</td><td align="left">发送该消息的日期和时间(按照 RFC 7231 中定义的”超文本传输协议日期”格式来发送)。</td><td align="left">Date: Tue, 15 Nov 1994 08:12:31 GMT</td></tr><tr><td align="left">Expect</td><td align="left">表明客户端要求服务器做出特定的行为。</td><td align="left">Expect: 100-continue</td></tr><tr><td align="left">From</td><td align="left">发起此请求的用户的邮件地址。</td><td align="left">From: <a href="mailto:user@example.com" target="_blank" rel="noopener">user@example.com</a></td></tr><tr><td align="left">Host</td><td align="left">服务器的域名(用于虚拟主机)，以及服务器所监听的传输控制协议端口号。自HTTP/1.1开始成为必需字段。</td><td align="left">Host: lengyuewusheng.com:80<br>Host: lengyuewusheng.com</td></tr><tr><td align="left">If-Match</td><td align="left">仅当客户端提供的实体与服务器上对应的实体相匹配时，才进行对应的操作。主要作用时，用作像 PUT 这样的方法中，仅当从用户上次更新某个资源以来，该资源未被修改的情况下，才更新该资源。</td><td align="left">If-Match: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td align="left">If-Modified-Since</td><td align="left">允许在对应的内容未被修改的情况下返回304未修改(304 Not Modified)。</td><td align="left">If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td align="left">If-None-Match</td><td align="left">允许在对应的内容未被修改的情况下返回304未修改(304 Not Modified)。</td><td align="left">If-None-Match: “a7dc0d7b8902e9c8c096c93eb431d19e”</td></tr><tr><td align="left">If-Range</td><td align="left">如果该实体未被修改过，则向我发送我所缺少的那一个或多个部分；否则，发送整个新的实体</td><td align="left">If-Range: “a7dc0d7b8902e9c8c096c93eb431d19e”</td></tr><tr><td align="left">If-Unmodified-Since</td><td align="left">仅当该实体自某个特定时间已来未被修改的情况下，才发送回应。</td><td align="left">If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td align="left">Max-Forwards</td><td align="left">限制该消息可被代理及网关转发的次数。</td><td align="left">Max-Forwards: 10</td></tr><tr><td align="left">Origin</td><td align="left">发起一个针对跨来源资源共享的请求(要求服务器在回应中加入一个’访问控制-允许来源’(‘Access-Control-Allow-Origin’)字段)。</td><td align="left">Origin: <a href="http://www.example-social-network.com" target="_blank" rel="noopener">http://www.example-social-network.com</a></td></tr><tr><td align="left">Pragma</td><td align="left">报文指令，与具体的实现相关，这些字段可能在请求/回应链中的任何时候产生多种效果。不常用。</td><td align="left">Pragma: no-cache</td></tr><tr><td align="left">Proxy-Authorization</td><td align="left">用来向代理进行认证的认证信息。</td><td align="left">Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td align="left">Range</td><td align="left">仅请求某个实体的一部分。字节偏移以0开始。参见字节服务。</td><td align="left">Range: bytes=500-999</td></tr><tr><td align="left">Referer</td><td align="left">表示浏览器所访问的前一个页面，正是那个页面上的某个链接将浏览器带到了当前所请求的这个页面。</td><td align="left">Referer: <a href="https://www.lengyuewusheng.com">https://www.lengyuewusheng.com</a></td></tr><tr><td align="left">TE</td><td align="left">浏览器预期接受的传输编码方式：可使用回应协议头 Transfer-Encoding 字段中的值；另外还可用”trailers”(与”分块 “传输方式相关)这个值来表明浏览器希望在最后一个尺寸为0的块之后还接收到一些额外的字段。</td><td align="left">TE: trailers, deflate</td></tr><tr><td align="left">User-Agent</td><td align="left">浏览器的浏览器身份标识字符串。</td><td align="left">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36</td></tr><tr><td align="left">Upgrade</td><td align="left">要求服务器升级到另一个协议。</td><td align="left">Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td align="left">Via</td><td align="left">向服务器告知，这个请求是由哪些代理发出的。</td><td align="left">Via: 1.0 fred, 1.1 example.com (Apache/1.1)</td></tr><tr><td align="left">Warning</td><td align="left">一个一般性的警告，告知，在实体内容体中可能存在错误。</td><td align="left">Warning: 199 Miscellaneous warning</td></tr></tbody></table><h3 id="非标准请求字段"><a href="#非标准请求字段" class="headerlink" title="非标准请求字段"></a>非标准请求字段</h3><table><thead><tr><th align="left">协议头非标准字段名</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">X-Requested-With</td><td align="left">主要用于标识 Ajax 及可扩展标记语言 请求。大部分的JavaScript框架会发送这个字段，且将其值设置为 XMLHttpRequest。</td><td align="left">X-Requested-With: XMLHttpRequest</td></tr><tr><td align="left">DNT</td><td align="left">请求某个网页应用程序停止跟踪某个用户。在火狐浏览器中，相当于X-Do-Not-Track协议头字段(自 Firefox/4.0 Beta 11 版开始支持)。Safari和Internet Explorer 9也支持这个字段。</td><td align="left">启用：DNT: 1<br>禁用：DNT: 0</td></tr><tr><td align="left">X-Forwarded-For</td><td align="left">一个事实标准 ，用于标识某个通过超文本传输协议代理或负载均衡连接到某个网页服务器的客户端的原始互联网地址。</td><td align="left">X-Forwarded-For: client1, proxy1, proxy2<br>X-Forwarded-For: 129.78.138.66, 129.78.64.103</td></tr><tr><td align="left">X-Forwarded-Host</td><td align="left">一个事实标准 ，用于识别客户端原本发出的 Host 请求头部。</td><td align="left">X-Forwarded-Host: lengyuewusheng.com:80<br>X-Forwarded-Host: lengyuewusheng.com</td></tr><tr><td align="left">X-Forwarded-Proto</td><td align="left">一个事实标准，用于标识某个超文本传输协议请求最初所使用的协议。</td><td align="left">X-Forwarded-Proto: https</td></tr><tr><td align="left">Front-End-Https</td><td align="left">被微软的服务器和负载均衡器所使用的非标准头部字段。</td><td align="left">Front-End-Https: on</td></tr><tr><td align="left">X-Http-Method-Override</td><td align="left">请求某个网页应用程序使用该协议头字段中指定的方法(一般是PUT或DELETE)来覆盖掉在请求中所指定的方法(一般是POST)。当某个浏览器或防火墙阻止直接发送PUT 或DELETE 方法时，可使用这种方式。</td><td align="left">X-HTTP-Method-Override: DELETE</td></tr><tr><td align="left">X-ATT-DeviceId</td><td align="left">使服务器更容易解读AT&amp;T设备User-Agent字段中常见的设备型号、固件信息。</td><td align="left">X-Att-Deviceid: GT-P7320/P7320XXLPG</td></tr><tr><td align="left">X-Wap-Profile</td><td align="left">链接到互联网上的一个XML文件，其完整、仔细地描述了正在连接的设备。</td><td align="left">以为AT&amp;T Samsung Galaxy S2提供的XML文件为例：x-wap-profile: <a href="http://wap.samsungmobile.com/uaprof/SGH-I777.xml" target="_blank" rel="noopener">http://wap.samsungmobile.com/uaprof/SGH-I777.xml</a></td></tr><tr><td align="left">Proxy-Connection</td><td align="left">该字段源于早期超文本传输协议版本实现中的错误。与标准的连接(Connection)字段的功能完全相同。</td><td align="left">Proxy-Connection: keep-alive</td></tr><tr><td align="left">X-Csrf-Token</td><td align="left">用于防止 跨站请求伪造。辅助用的头部有 X-CSRFToken或 X-XSRF-TOKEN。</td><td align="left">X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</td></tr></tbody></table><h2 id="http回应字段"><a href="#http回应字段" class="headerlink" title="http回应字段"></a>http回应字段</h2><h3 id="回应字段"><a href="#回应字段" class="headerlink" title="回应字段"></a>回应字段</h3><table><thead><tr><th align="left">协议头字段名</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Access-Control-Allow-Origin</td><td align="left">指定哪些网站可参与到跨来源资源共享过程中。</td><td align="left">Access-Control-Allow-Origin: *</td></tr><tr><td align="left">Accept-Patch</td><td align="left">指定服务器支持的文件格式类型。</td><td align="left">Accept-Patch: text/example;charset=utf-8</td></tr><tr><td align="left">Accept-Ranges</td><td align="left">这个服务器支持哪些种类的部分内容范围。</td><td align="left">Accept-Ranges: bytes</td></tr><tr><td align="left">Age</td><td align="left">这个对象在代理缓存中存在的时间，以秒为单位。</td><td align="left">Age: 12</td></tr><tr><td align="left">Allow</td><td align="left">对于特定资源有效的动作。针对HTTP/405这一错误代码而使用。</td><td align="left">Allow: GET, HEAD</td></tr><tr><td align="left">Cache-Control</td><td align="left">向从服务器直到客户端在内的所有缓存机制告知，它们是否可以缓存这个对象。其单位为秒。</td><td align="left">Cache-Control: max-age=3600</td></tr><tr><td align="left">Connection</td><td align="left">针对该连接所预期的选项。</td><td align="left">Connection: close</td></tr><tr><td align="left">Content-Disposition</td><td align="left">一个可以让客户端下载文件并建议文件名的头部。文件名需要用双引号引起来。</td><td align="left">Content-Disposition: attachment; filename=”fname.ext”</td></tr><tr><td align="left">Content-Encoding</td><td align="left">在数据上使用的编码类型。</td><td align="left">Content-Encoding: gzip</td></tr><tr><td align="left">Content-Language</td><td align="left">内容所使用的语言。</td><td align="left">Content-Language: da</td></tr><tr><td align="left">Content-Length</td><td align="left">回应消息体的长度，以字节(8位为一字节)为单位。</td><td align="left">Content-Length: 348</td></tr><tr><td align="left">Content-Location</td><td align="left">所返回的数据的一个候选位置。</td><td align="left">Content-Location: /index.htm</td></tr><tr><td align="left">Content-MD5</td><td align="left">回应内容的二进制 MD5 散列，以 Base64 方式编码。</td><td align="left">Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td align="left">Content-Range</td><td align="left">这条部分消息是属于某条完整消息的哪个部分。</td><td align="left">Content-Range: bytes 21010-47021/47022</td></tr><tr><td align="left">Content-Type</td><td align="left">当前内容的MIME类型。</td><td align="left">Content-Type: text/html; charset=utf-8</td></tr><tr><td align="left">Date</td><td align="left">此条消息被发送时的日期和时间(按照 RFC 7231 中定义的“超文本传输协议日期”格式来表示)</td><td align="left">Date: Tue, 15 Nov 2017 08:12:31 GMT</td></tr><tr><td align="left">ETag</td><td align="left">对于某个资源的某个特定版本的一个标识符，通常是一个 消息散列。</td><td align="left">ETag: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td align="left">Expires</td><td align="left">指定一个日期/时间，超过该时间则认为此回应已经过期。</td><td align="left">Expires: Thu, 01 Dec 1994 16:00:00 GMT</td></tr><tr><td align="left">Last-Modified</td><td align="left">所请求的对象的最后修改日期(按照 RFC 7231 中定义的“超文本传输协议日期”格式来表示)</td><td align="left">Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</td></tr><tr><td align="left">Link</td><td align="left">用来表达与另一个资源之间的类型关系。</td><td align="left">Link:; rel=”alternate”</td></tr><tr><td align="left">Location</td><td align="left">用来进行重定向，或者在创建了某个新资源时使用。</td><td align="left">Location: <a href="http://lengyuewusheng.com" target="_blank" rel="noopener">http://lengyuewusheng.com</a></td></tr><tr><td align="left">P3P</td><td align="left">用于支持设置P3P策略，标准格式为“P3P:CP=”your_compact_policy””。然而P3P规范并不成功，大部分现代浏览器没有完整实现该功能。</td><td align="left">P3P: CP=”This is not a P3P policy!”</td></tr><tr><td align="left">Pragma</td><td align="left">报文指令，与具体的实现相关，这些字段可能在请求/回应链中的任何时候产生多种效果。</td><td align="left">Pragma: no-cache</td></tr><tr><td align="left">Proxy-Authenticate</td><td align="left">要求在访问代理时提供身份认证信息。</td><td align="left">Proxy-Authenticate: Basic</td></tr><tr><td align="left">Public-Key-Pins</td><td align="left">用于缓解中间人攻击，声明网站认证使用的传输层安全协议证书的散列值。</td><td align="left">Public-Key-Pins: max-age=2592000; pin-sha256=”E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=”;</td></tr><tr><td align="left">Refresh</td><td align="left">用于设定可定时的重定向跳转。</td><td align="left">5秒后跳转，Refresh: 5; url=<a href="http://www.w3.org/pub/WWW/People.html" target="_blank" rel="noopener">http://www.w3.org/pub/WWW/People.html</a></td></tr><tr><td align="left">Retry-After</td><td align="left">如果某个实体临时不可用，则此协议头用来告知客户端日后重试。其值可以是一个特定的时间段(以秒为单位)或一个超文本传输协议日期。</td><td align="left">Example 1: Retry-After: 120<br>Example 2: Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</td></tr><tr><td align="left">Server</td><td align="left">服务器的名字。</td><td align="left">Server: Apache/2.4.1 (Unix)</td></tr><tr><td align="left">Set-Cookie</td><td align="left">HTTP cookie</td><td align="left">Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</td></tr><tr><td align="left">Status</td><td align="left">通用网关接口 协议头字段，用来说明当前这个超文本传输协议回应的 状态 。</td><td align="left">Status: 200 OK</td></tr><tr><td align="left">Strict-Transport-Security</td><td align="left">HTTP严格传输安全这一头部告知客户端缓存这一强制 HTTPS 策略的时间，以及这一策略是否适用于其子域名。</td><td align="left">Strict-Transport-Security: max-age=16070400; includeSubDomains</td></tr><tr><td align="left">Trailer</td><td align="left">这个头部数值指示了在这一系列头部信息由由分块传输编码编码。</td><td align="left">Trailer: Max-Forwards</td></tr><tr><td align="left">Transfer-Encoding</td><td align="left">用来将实体安全地传输给用户的编码形式。当前定义的方法包括：分块（chunked）、compress、deflate、gzip和identity。</td><td align="left">Transfer-Encoding: chunked</td></tr><tr><td align="left">Upgrade</td><td align="left">要求客户端升级到另一个协议。</td><td align="left">Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td align="left">Vary</td><td align="left">告知下游的代理服务器，应当如何对未来的请求协议头进行匹配，以决定是否可使用已缓存的回应内容而不是重新从原始服务器请求新的内容。</td><td align="left">Vary: *</td></tr><tr><td align="left">Via</td><td align="left">告知代理服务器的客户端，当前回应是通过什么途径发送的。</td><td align="left">Via: 1.0 fred, 1.1 example.com (Apache/1.1)</td></tr><tr><td align="left">Warning</td><td align="left">一般性的警告，告知在实体内容体中可能存在错误。</td><td align="left">Warning: 199 Miscellaneous warning</td></tr><tr><td align="left">WWW-Authenticate</td><td align="left">表明在请求获取这个实体时应当使用的认证模式。</td><td align="left">WWW-Authenticate: Basic</td></tr><tr><td align="left">X-Frame-Options</td><td align="left">点击劫持保护：<br>deny：该页面不允许在 frame 中展示，即使是同域名内；<br>sameorigin：该页面允许同域名内在 frame 中展示。<br>allow-from uri：该页面允许在指定uri的 frame 中展示。<br>allowall：允许任意位置的frame显示，非标准值。</td><td align="left">X-Frame-Options: deny</td></tr></tbody></table><h3 id="非标准回应字段"><a href="#非标准回应字段" class="headerlink" title="非标准回应字段"></a>非标准回应字段</h3><table><thead><tr><th align="left">协议头字段名</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">X-XSS-Protection</td><td align="left">跨站脚本攻击(XSS)过滤器。</td><td align="left">X-XSS-Protection: 1; mode=block</td></tr><tr><td align="left">Content-Security-Policy, X-Content-Security-Policy, X-WebKit-CSP</td><td align="left">内容安全策略定义。</td><td align="left">X-WebKit-CSP: default-src ‘self’</td></tr><tr><td align="left">X-Content-Type-Options</td><td align="left">唯一允许的数值为”nosniff”，防止 Internet Explorer 对文件进行MIME类型嗅探。这也对 Google Chrome 下载扩展时适用。</td><td align="left">X-Content-Type-Options: nosniff</td></tr><tr><td align="left">X-Powered-By</td><td align="left">表明用于支持当前网页应用程序的技术。</td><td align="left">(例如：PHP)(版本号细节通常放置在X-Runtime或X-Version中) X-Powered-By: PHP/7.1.0</td></tr><tr><td align="left">X-UA-Compatible</td><td align="left">推荐指定的渲染引擎(通常是向后兼容模式)来显示内容。也用于激活Internet Explorer中的 Chrome Frame。</td><td align="left">X-UA-Compatible: IE=EmulateIE7<br>X-UA-Compatible: IE=edge<br>X-UA-Compatible: Chrome=1</td></tr><tr><td align="left">X-Content-Duration</td><td align="left">指出音视频的长度，单位为秒。只受Gecko内核浏览器支持。</td><td align="left">X-Content-Duration: 42.666</td></tr></tbody></table><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/HTTP头字段" target="_blank" rel="noopener">wikipedia·http头字段</a></li><li><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/HTTP.md#%E5%9B%9Bhttp-%E9%A6%96%E9%83%A8" target="_blank" rel="noopener">http首部</a></li></ul>]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
        <tag>协议</tag>
      </tags>
  </entry>
  <entry>
    <title>RAID技术总结</title>
    <url>/raid%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>独立硬盘冗余阵列(RAID, Redundant Array of Independent Disks),简称磁盘阵列。简单来说，RAID把多个硬盘组合成为一个逻辑扇区，因此，操作系统只会把它当作一个硬盘。</p><a id="more"></a><style>table th:nth-of-type(7){width:30%}nth-of-type(8){width:20%}</style><h2 id="磁盘阵列比较表"><a href="#磁盘阵列比较表" class="headerlink" title="磁盘阵列比较表"></a>磁盘阵列比较表</h2><table><thead><tr><th align="left">RAID档次</th><th align="left">最少硬盘</th><th align="left">最大容错</th><th align="left">磁盘利用率</th><th align="left">读取性能</th><th align="left">写入性能</th><th align="left">安全性</th><th align="left">目的</th><th align="left">应用产业</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">2</td><td align="left">0</td><td align="left">100%</td><td align="left">n</td><td align="left">n</td><td align="left">一个硬盘异常，全部硬盘都会异常</td><td align="left">追求最大容量、速度</td><td align="left">视频剪接缓存用途</td></tr><tr><td align="left">1</td><td align="left">2</td><td align="left">n-1</td><td align="left">1/n</td><td align="left">n</td><td align="left">1</td><td align="left">最高，一个正常即可</td><td align="left">追求最大安全性</td><td align="left">个人、企业备份</td></tr><tr><td align="left">5</td><td align="left">3</td><td align="left">1</td><td align="left">(n-1)/n</td><td align="left">n-1</td><td align="left">n-1</td><td align="left">高</td><td align="left">追求最大容量、最小预算</td><td align="left">个人、企业备份</td></tr><tr><td align="left">6</td><td align="left">4</td><td align="left">2</td><td align="left">(n-2)/n</td><td align="left">n-2</td><td align="left">n-2</td><td align="left">安全性较RAID 5高</td><td align="left">同RAID 5，但较安全</td><td align="left">个人、企业备份</td></tr><tr><td align="left">10</td><td align="left">4</td><td align="left">n/2</td><td align="left">50%</td><td align="left">n/2</td><td align="left">n/2</td><td align="left">安全性高，但在同一个子组群中不能出现两颗毁损硬盘</td><td align="left">综合RAID 0/1优点，理论速度较快</td><td align="left">大型数据库、服务器</td></tr><tr><td align="left">50</td><td align="left">6</td><td align="left">n/m</td><td align="left">1-1/m</td><td align="left">n-n/m</td><td align="left">n-n/m</td><td align="left">安全性高，但在同一个子组群中不能出现两颗毁损硬盘</td><td align="left">高可靠性、高读取速度</td><td align="left">事务处理</td></tr></tbody></table><ul><li>n代表硬盘总数</li><li>m 代表 RAID 5 的组盘数量</li></ul><h2 id="特点总结"><a href="#特点总结" class="headerlink" title="特点总结"></a>特点总结</h2><ul><li>读写性能最高：RAID 0</li><li>磁盘利用率最低：RAID 1 (1/n)</li><li>可靠性最高：RAID 1</li></ul><h2 id="常见RAID级别"><a href="#常见RAID级别" class="headerlink" title="常见RAID级别"></a>常见RAID级别</h2><h3 id="RAID-0"><a href="#RAID-0" class="headerlink" title="RAID 0"></a>RAID 0</h3><p>RAID 0亦称为带区集。它将两个以上的磁盘并联起来，成为一个大容量的磁盘。</p><ul><li>读写速度最快：因为读写时都可以并行处理，所以在所有的级别中，RAID 0的速度是最快的；</li><li>无冗余无容错：RAID 0既没有冗余功能，也不具备容错能力，如果一个磁盘（物理）损坏，所有数据都会丢失。</li></ul><h3 id="RAID-1"><a href="#RAID-1" class="headerlink" title="RAID 1"></a>RAID 1</h3><p>两组以上的N个磁盘相互作镜像。在主硬盘上存放数据的同时也在镜像硬盘上写一样的数据。当主硬盘（物理）损坏时，镜像硬盘则代替主硬盘的工作。</p><ul><li>读写速度：在一些多线程操作系统中能有很好的读取速度，理论上读取速度等于硬盘数量的倍数，与RAID 0相同。写入速度有微小的降低；</li><li>可靠性最高：只要一个磁盘正常即可维持运作；</li><li>数据完全性最好：因为有镜像硬盘做数据备份；</li><li>磁盘利用率最低：无论用多少磁盘做RAID 1，仅算一个磁盘的容量；</li><li>不同大小磁盘的情况：如果用两个不同大小的磁盘建RAID 1，可用空间为较小的那个磁盘，较大的磁盘多出来的空间也可以分区成一个区来使用，不会造成浪费。</li></ul><h2 id="RAID-5"><a href="#RAID-5" class="headerlink" title="RAID 5"></a>RAID 5</h2><p>RAID 5是一种储存性能、数据安全和存储成本兼顾的存储解决方案。它使用的是Disk Striping（硬盘分区）技术。RAID 5可以理解为是RAID 0和RAID 1的折衷方案。</p><ul><li>RAID 5至少需要三个硬盘，RAID 5不是对存储的数据进行备份，而是把数据和相对应的奇偶校验信息分别存储于不同的磁盘上；</li><li>可靠性：数据保障程度要比RAID 1低；</li><li>读写速度：RAID 5具有和RAID 0相近似的数据读取速度，由于多一个奇偶校验信息，写入数据的速度相对单独写入一块硬盘的速度略慢，使用“回写缓存”可以让性能改善；</li><li>磁盘利用率：RAID 5的磁盘空间利用率要比RAID 1高。因为多个数据对应一个奇偶校验信息；</li><li>RAID 5最多支持坏一块盘。</li></ul><h3 id="RAID-6"><a href="#RAID-6" class="headerlink" title="RAID 6"></a>RAID 6</h3><p>与RAID 5相比，RAID 6增加第二个独立的奇偶校验信息块。两个独立的奇偶系统使用不同的算法。</p><ul><li>RAID 6必须具备四个以上的磁盘才能生效。</li><li>数据的可靠性：非常高，任意两块磁盘同时失效时不会影响数据完整性。</li><li>通常通过硬件方式实现：RAID 6需要分配给奇偶校验信息更大的磁盘空间和额外的校验计算，相对于RAID 5有更大的IO操作量和计算量，因此其“写性能”强烈取决于具体的实现方案。</li><li>磁盘利用率：可使用的容量为硬盘总数减去2的差，乘以最小容量。</li><li>最多容许两个磁盘损坏。</li></ul><h3 id="RAID-10-01"><a href="#RAID-10-01" class="headerlink" title="RAID 10/01"></a>RAID 10/01</h3><p>RAID 10是先镜像再分区数据，再将所有硬盘分为两组，视为是RAID 0的最低组合，然后将这两组各自视为RAID 1运作。</p><p>RAID 01则是先分区再将数据镜像到两组硬盘。它将所有的硬盘分为两组，变成RAID 1的最低组合，并将两组硬盘各自视为RAID 0运作。</p><ul><li>RAID 10有一个硬盘受损，其余硬盘会继续运作。</li><li>RAID 01只要有一个硬盘受损，同组RAID 0的所有硬盘都会停止运作，只剩下其他组的硬盘运作，可靠性较低。如果以六块硬盘建RAID 01，镜像后再用三块盘建RAID 0，那么坏一块硬盘便会有三个硬盘离线。</li><li>RAID 10远较RAID 01常用。</li></ul><h3 id="RAID-50"><a href="#RAID-50" class="headerlink" title="RAID 50"></a>RAID 50</h3><p>RAID 5与RAID 0的组合，先作RAID 5，再作RAID 0，也就是对多组RAID 5彼此构成Stripe访问。以RAID 50最小的6颗硬盘配置为例，先把6颗硬盘分为2组，每组3颗构成RAID 5，如此就得到两组RAID 5，然后再把两组RAID 5构成RAID 0。</p><ul><li>RAID 50，至少需要6颗硬盘；</li><li>数据可靠性：RAID 50在底层的任一组或多组RAID 5中出现1颗硬盘损坏时，仍能维持运作，不过如果任一组RAID 5中出现2颗或2颗以上硬盘损毁，整组RAID 50就会失效；</li><li>读写性能：RAID 50由于在上层把多组RAID 5构成Stripe，性能比起单纯的RAID 5高；</li><li>磁盘利用率：((n-m)/n)，比RAID5((n-1)/n)要低。</li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/RAID" target="_blank" rel="noopener">wikipedia·RAID</a></li><li><a href="https://baike.baidu.com/item/RAID%2050?fromtitle=raid50&fromid=8245636" target="_blank" rel="noopener">百度百科·RAID50</a></li><li><a href="http://www.hack520.com/169.html" target="_blank" rel="noopener">RAID技术全解</a></li></ul>]]></content>
      <categories>
        <category>raid</category>
      </categories>
      <tags>
        <tag>RAID</tag>
        <tag>磁盘阵列</tag>
        <tag>高可用</tag>
      </tags>
  </entry>
  <entry>
    <title>http请求常见状态码及解释</title>
    <url>/http%E8%AF%B7%E6%B1%82%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E7%A0%81%E5%8F%8A%E8%A7%A3%E9%87%8A/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>在http请求中，服务器返回的响应报文的第一行包含了状态码以及原因短语，用来告知客户端请求的结果。</p></blockquote><a id="more"></a><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:30%}</style><h2 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h2><table><thead><tr><th align="left">状态码</th><th align="left">含义</th><th align="left">解释</th></tr></thead><tbody><tr><td align="left">1XX</td><td align="left">Informational（信息性状态码）</td><td align="left">接收的请求正在处理</td></tr><tr><td align="left">100</td><td align="left">Continue</td><td align="left">表明到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应。</td></tr><tr><td align="left">101</td><td align="left">Switching Protocols</td><td align="left">切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，如，切换到HTTP的新版本协议。</td></tr><tr><td align="left">102</td><td align="left">Processing</td><td align="left">WebDAV请求可能包含许多涉及文件操作的子请求，需要很长时间才能完成请求。该代码表示​​服务器已经收到并正在处理请求，但无响应可用。这样可以防止客户端超时，并假设请求丢失。</td></tr><tr><td align="left">2XX</td><td align="left">Success（成功状态码）</td><td align="left">请求被成功接收并处理</td></tr><tr><td align="left">200</td><td align="left">OK</td><td align="left">请求已成功，请求所希望的响应头或数据体将随此响应返回。实际的响应将取决于所使用的请求方法。在GET请求中，响应将包含与请求的资源相对应的实体。在POST请求中，响应将包含描述或操作结果的实体。</td></tr><tr><td align="left">201</td><td align="left">Created</td><td align="left">已创建。成功请求并创建了新的资源。</td></tr><tr><td align="left">202</td><td align="left">Accepted</td><td align="left">已接受。已经接受请求，但未处理完成。</td></tr><tr><td align="left">203</td><td align="left">Non-Authoritative Information</td><td align="left">非授权信息。请求成功。但返回的Meta信息不在原始的服务器，而是一个副本。</td></tr><tr><td align="left">204</td><td align="left">No Content</td><td align="left">请求已经成功处理，但未返回内容，即返回的响应报文不包含实体的主体部分。一般在只需要从客户端往服务器发送信息，而不需要返回数据时使用。</td></tr><tr><td align="left">205</td><td align="left">Reset Content</td><td align="left">重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域。</td></tr><tr><td align="left">206</td><td align="left">Partial Content</td><td align="left">部分内容，表示客户端进行了范围请求。服务器成功处理了部分GET请求，响应报文包含由 Content-Range 指定范围的实体内容。</td></tr><tr><td align="left">207</td><td align="left">Multi-Status（WebDAV；RFC 4918）</td><td align="left">代表之后的消息体将是一个XML消息，并且可能依照之前子请求数量的不同，包含一系列独立的响应代码。</td></tr><tr><td align="left">208</td><td align="left">Already Reported （WebDAV；RFC 5842）</td><td align="left">DAV绑定的成员已经在（多状态）响应之前的部分被列举，且未被再次包含。</td></tr><tr><td align="left">226</td><td align="left">IM Used （RFC 3229）</td><td align="left">服务器已经满足了对资源的请求，对实体请求的一个或多个实体操作的结果表示。</td></tr><tr><td align="left">3XX</td><td align="left">Redirection（重定向状态码）</td><td align="left">重定向，需要进一步的操作以完成请求</td></tr><tr><td align="left">300</td><td align="left">Multiple Choices</td><td align="left">多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择。</td></tr><tr><td align="left">301</td><td align="left">Moved Permanently</td><td align="left">永久性重定向。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替。</td></tr><tr><td align="left">302</td><td align="left">Found</td><td align="left">临时性重定向。与301类似。但资源只是临时被移动。客户端应继续使用原有URI。</td></tr><tr><td align="left">303</td><td align="left">See Other</td><td align="left">查看其它地址。和302有着相同的功能，但是303明确要求客户端应该采用GET方法获取资源。</td></tr><tr><td align="left">304</td><td align="left">Not Modified</td><td align="left">未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源。</td></tr><tr><td align="left">305</td><td align="left">Use Proxy</td><td align="left">使用代理。所请求的资源必须通过代理访问。</td></tr><tr><td align="left">306</td><td align="left">Unused</td><td align="left">已经被废弃的HTTP状态码。</td></tr><tr><td align="left">307</td><td align="left">Temporary Redirect</td><td align="left">临时重定向。与302类似。但是307要求浏览器不会把重定向请求的POST方法改成GET方法。</td></tr><tr><td align="left">308</td><td align="left">Permanent Redirect (RFC 7538)</td><td align="left">请求和所有将来的请求应该使用另一个URI重复。 307和308重复302和301的行为，但不允许HTTP方法更改。 例如，将表单提交给永久重定向的资源可能会顺利进行。</td></tr><tr><td align="left">4XX</td><td align="left">Client Error（客户端错误状态码）</td><td align="left">服务器无法处理请求</td></tr><tr><td align="left">400</td><td align="left">Bad Request</td><td align="left">请求报文中存在语法错误，服务器无法理解。</td></tr><tr><td align="left">401</td><td align="left">Unauthorized</td><td align="left">该状态码表示发送的请求需要有认证信息（BASIC 认证、DIGEST 认证）。如果之前已进行过一次请求，则表示用户认证失败。</td></tr><tr><td align="left">402</td><td align="left">Payment Required</td><td align="left">保留，将来使用。</td></tr><tr><td align="left">403</td><td align="left">Forbidden</td><td align="left">服务器理解请求客户端的请求，但是拒绝执行此请求。服务器端没有必要给出拒绝的详细理由。</td></tr><tr><td align="left">404</td><td align="left">Not Found</td><td align="left">服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置”您所请求的资源无法找到”的个性页面。</td></tr><tr><td align="left">405</td><td align="left">Method Not Allowed</td><td align="left">客户端请求中的方法被禁止。</td></tr><tr><td align="left">406</td><td align="left">Not Acceptable</td><td align="left">服务器无法根据客户端请求的内容特性完成请求。</td></tr><tr><td align="left">407</td><td align="left">Proxy Authentication Required</td><td align="left">请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权。</td></tr><tr><td align="left">408</td><td align="left">Request Time-out</td><td align="left">服务器等待客户端发送的请求时间过长，超时。</td></tr><tr><td align="left">409</td><td align="left">Conflict</td><td align="left">服务器完成客户端的PUT请求是可能返回此代码，服务器处理请求时发生了冲突。</td></tr><tr><td align="left">410</td><td align="left">Gone</td><td align="left">客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置。</td></tr><tr><td align="left">411</td><td align="left">Length Required</td><td align="left">服务器无法处理客户端发送的不带Content-Length的请求信息。</td></tr><tr><td align="left">412</td><td align="left">Precondition Failed</td><td align="left">客户端请求信息的先决条件错误。</td></tr><tr><td align="left">413</td><td align="left">Request Entity Too Large</td><td align="left">由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息。</td></tr><tr><td align="left">414</td><td align="left">Request-URI Too Large</td><td align="left">请求的URI过长（URI通常为网址），服务器无法处理。</td></tr><tr><td align="left">415</td><td align="left">Unsupported Media Type</td><td align="left">服务器无法处理请求附带的媒体格式。</td></tr><tr><td align="left">416</td><td align="left">Requested range not satisfiable</td><td align="left">客户端请求的范围无效。</td></tr><tr><td align="left">417</td><td align="left">Expectation Failed</td><td align="left">服务器无法满足Expect的请求头信息。</td></tr><tr><td align="left">421</td><td align="left">Misdirected Request （RFC 7540）</td><td align="left">该请求针对的是无法产生响应的服务器（例如因为连接重用）。</td></tr><tr><td align="left">422</td><td align="left">Unprocessable Entity（WebDAV；RFC 4918 ）</td><td align="left">请求格式正确，但是由于含有语义错误，无法响应。</td></tr><tr><td align="left">423</td><td align="left">Locked（WebDAV；RFC 4918）</td><td align="left">当前资源被锁定。</td></tr><tr><td align="left">424</td><td align="left">Failed Dependency（WebDAV；RFC 4918）</td><td align="left">由于之前的某个请求发生的错误，导致当前请求失败，例如PROPPATCH。</td></tr><tr><td align="left">426</td><td align="left">Upgrade Required（RFC 2817）</td><td align="left">客户端应当切换到TLS/1.0，并在HTTP/1.1 Upgrade header中给出。</td></tr><tr><td align="left">428</td><td align="left">Precondition Required (RFC 6585)</td><td align="left">原服务器要求该请求满足一定条件。这是为了防止‘未更新’问题，即客户端读取（GET）一个资源的状态，更改它，并将它写（PUT）回服务器，但这期间第三方已经在服务器上更改了该资源的状态，因此导致了冲突。</td></tr><tr><td align="left">429</td><td align="left">Too Many Requests （RFC 6585）</td><td align="left">用户在给定的时间内发送了太多的请求。旨在用于网络限速。</td></tr><tr><td align="left">431</td><td align="left">Request Header Fields Too Large （RFC 6585）</td><td align="left">服务器不愿处理请求，因为一个或多个头字段过大。</td></tr><tr><td align="left">444</td><td align="left">No Response</td><td align="left">Nginx上HTTP服务器扩展。服务器不向客户端返回任何信息，并关闭连接（有助于阻止恶意软件）。</td></tr><tr><td align="left">450</td><td align="left">Blocked by Windows Parental Controls</td><td align="left">这是一个由Windows家庭控制（Microsoft）HTTP阻止的450状态代码的示例，用于信息和测试。</td></tr><tr><td align="left">451</td><td align="left">Unavailable For Legal Reasons</td><td align="left">该访问因法律的要求而被拒绝，由IETF在2015核准后新增加。</td></tr><tr><td align="left">494</td><td align="left">Request Header Too Large</td><td align="left">在错误代码431提出之前Nginx上使用的扩展HTTP代码。</td></tr><tr><td align="left">499</td><td align="left">Client has Closed Connection</td><td align="left">客户端已经断开链接。可能是客户端主动断开，也有可能是超时断开。</td></tr><tr><td align="left">5XX</td><td align="left">Server Error（服务器错误状态码）</td><td align="left">服务器处理请求出错</td></tr><tr><td align="left">500</td><td align="left">Internal Server Error</td><td align="left">服务器内部错误，无法完成请求。</td></tr><tr><td align="left">501</td><td align="left">Not Implemented</td><td align="left">服务器不支持请求的功能，无法完成请求。通常出现在nginx没有定义对应的server配置时出现。</td></tr><tr><td align="left">502</td><td align="left">Bad Gateway</td><td align="left">充当网关或代理的服务器，从远端服务器接收到了一个无效的请求。</td></tr><tr><td align="left">503</td><td align="left">Service Unavailable</td><td align="left">服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。延时的长度可包含在服务器的Retry-After头信息中。</td></tr><tr><td align="left">504</td><td align="left">Gateway Time-out</td><td align="left">充当网关或代理的服务器，未及时从远端服务器获取请求。</td></tr><tr><td align="left">505</td><td align="left">HTTP Version not supported</td><td align="left">服务器不支持请求的HTTP协议的版本，无法完成处理。</td></tr><tr><td align="left">506</td><td align="left">Variant Also Negotiates（RFC 2295）</td><td align="left">由《透明内容协商协议》（RFC 2295）扩展，代表服务器存在内部配置错误，被请求的协商变元资源被配置为在透明内容协商中使用自己，因此在一个协商处理中不是一个合适的重点。</td></tr><tr><td align="left">507</td><td align="left">Insufficient Storage（WebDAV；RFC 4918）</td><td align="left">服务器无法存储完成请求所必须的内容。这个状况被认为是临时的。</td></tr><tr><td align="left">508</td><td align="left">Loop Detected （WebDAV；RFC 5842）</td><td align="left">服务器在处理请求时陷入死循环。（可代替 208状态码）</td></tr><tr><td align="left">510</td><td align="left">Not Extended（RFC 2774）</td><td align="left">获取资源所需要的策略并没有被满足。</td></tr><tr><td align="left">511</td><td align="left">Network Authentication Required （RFC 6585）</td><td align="left">客户端需要进行身份验证才能获得网络访问权限，旨在限制用户群访问特定网络。（例如连接WiFi热点时的强制网络门户）</td></tr></tbody></table><ul><li>虽然 HTTP 协议规定 301、302 状态下重定向时不允许把 POST 方法改成 GET 方法，但是大多数浏览器都会在 301、302 和 303 状态下的重定向把 POST 方法改成 GET 方法。</li><li>WebDAV是基于Web的分布式编写和版本控制，是超文本传输协议（HTTP）的扩展。有利于用户间协同编辑和管理存储在万维网服务器文档。许多现代操作系统为WebDAV提供了内置的客户端支持。</li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/HTTP状态码" target="_blank" rel="noopener">WikiPedia·http状态码</a></li><li><a href="http://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">菜鸟教程·http状态码</a></li><li><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/HTTP.md#%E4%B8%89http-%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">Interview-Notebook</a></li></ul>]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
        <tag>协议</tag>
        <tag>状态码</tag>
      </tags>
  </entry>
  <entry>
    <title>通过Zabbix API在告警邮件中插入趋势图</title>
    <url>/%E9%80%9A%E8%BF%87zabbix-api%E5%9C%A8%E5%91%8A%E8%AD%A6%E9%82%AE%E4%BB%B6%E4%B8%AD%E6%8F%92%E5%85%A5%E8%B6%8B%E5%8A%BF%E5%9B%BE/</url>
    <content><![CDATA[<p>告警邮件中嵌入趋势图是非常人性化的设计，只有有温度的告警邮件才会嵌入趋势图。。。</p><a id="more"></a><p>以下内容基于zabbix 3.0.2 测试有效，想必其它版本应该也问题不大。</p><p>话不多说，直接上代码：</p><h2 id="邮件告警脚本"><a href="#邮件告警脚本" class="headerlink" title="邮件告警脚本"></a>邮件告警脚本</h2><ul><li>cat mailAlarm.sh<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Description: 获取某一个监控项在某个时间段的graph</span></span><br><span class="line"><span class="comment"># Date:        </span></span><br><span class="line"><span class="comment"># Author:      </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=========================================</span></span><br><span class="line">ALERT_SENDTO=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">ALERT_SUBJECT=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">ALERT_MESSAGE=<span class="string">"<span class="variable">$(echo -e "$3"|sed -e '$d' -e 's/$/&lt;br\/&gt;/g')</span>"</span></span><br><span class="line">ITEMID=<span class="string">"<span class="variable">$(echo -e "$3"|tail -n1|awk -F":" '&#123;print $2&#125;'|sed s/[[:space:]]//g)</span>"</span></span><br><span class="line">USERNAME=<span class="string">"<span class="variable">$4</span>"</span></span><br><span class="line">PASSWORD=<span class="string">"<span class="variable">$5</span>"</span></span><br><span class="line">STIME=<span class="string">"<span class="variable">$(date -d "1 hour ago" "+%Y%m%d%H%M%S")</span>"</span></span><br><span class="line">PERIOD=3600</span><br><span class="line">WIDTH=800</span><br><span class="line"><span class="comment">#=========================================</span></span><br><span class="line">ROOTPATH=<span class="string">"<span class="variable">$(cd $(dirname $0)</span> &amp;&amp; pwd)"</span></span><br><span class="line">LOGFILE=<span class="string">"<span class="variable">$&#123;ROOTPATH&#125;</span>/logs/<span class="variable">$(basename $0)</span>.log.<span class="variable">$(date "+%Y-%m-%d")</span>"</span></span><br><span class="line"><span class="comment"># 在zabbix-web根目录下创建一个graphs目录用来存放趋势图图片文件</span></span><br><span class="line">GRAPH_DIR=<span class="string">"/usr/local/zabbix-web/graphs"</span></span><br><span class="line">COOKIE=<span class="string">"<span class="variable">$&#123;ROOTPATH&#125;</span>/.zabbixCookie.<span class="variable">$&#123;USERNAME&#125;</span>"</span></span><br><span class="line">CURL=<span class="string">"/usr/bin/curl -s"</span></span><br><span class="line">ZBX_URL=<span class="string">"http://zabbix.server.url"</span></span><br><span class="line">INDEX_URL=<span class="string">"<span class="variable">$ZBX_URL</span>/index.php"</span></span><br><span class="line">CHART_URL=<span class="string">"<span class="variable">$ZBX_URL</span>/chart.php"</span></span><br><span class="line">PNG_PATH=<span class="string">"<span class="variable">$GRAPH_DIR</span>/<span class="variable">$STIME</span>.<span class="variable">$PERIOD</span>.<span class="variable">$&#123;WIDTH&#125;</span>.<span class="variable">$ITEMID</span>.png"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="built_in">help</span>()</span><br><span class="line">&#123;</span><br><span class="line">    cat &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">	sh <span class="variable">$0</span> ALERT_SENDTO ALERT_SUBJECT ALERT_MESSAGE USERNAME PASSWORD</span><br><span class="line">	</span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单记一下日志</span></span><br><span class="line"><span class="keyword">function</span> writeLogs()</span><br><span class="line">&#123;</span><br><span class="line">	[ ! -d <span class="string">"<span class="variable">$(dirname "$&#123;LOGFILE&#125;")</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$(dirname "$&#123;LOGFILE&#125;")</span>"</span></span><br><span class="line">	<span class="built_in">echo</span> -e <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t<span class="variable">$1</span>"</span> &gt;&gt;<span class="string">"<span class="variable">$&#123;LOGFILE&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> check_integer()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">local</span> ret=`<span class="built_in">echo</span> <span class="string">"$*"</span> | sed <span class="string">'s/[0-9]//g'</span>`</span><br><span class="line">    [ -n <span class="string">"<span class="variable">$ret</span>"</span> ] &amp;&amp; <span class="built_in">return</span> 1</span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单校验参数</span></span><br><span class="line"><span class="keyword">function</span> ParametersVerification()</span><br><span class="line">&#123;</span><br><span class="line">	[ -d <span class="string">"<span class="variable">$GRAPH_DIR</span>"</span> ] || mkdir -p <span class="string">"<span class="variable">$GRAPH_DIR</span>"</span></span><br><span class="line">        check_integer <span class="string">"<span class="variable">$ITEMID</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'ITEMID' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$STIME</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'STIME' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$PERIOD</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'PERIOD' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$WIDTH</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'WIDTH' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        [ <span class="variable">$PERIOD</span> -lt 3600 -o <span class="variable">$PERIOD</span> -gt 63072000 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Incorrect value <span class="variable">$PERIOD</span> for PERIOD field: must be between 3600 and 63072000."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">	<span class="comment"># USERNAME、PASSWORD、ITEMID为必需参数</span></span><br><span class="line">	[ -z <span class="string">"<span class="variable">$USERNAME</span>"</span> -o -z <span class="string">"<span class="variable">$PASSWORD</span>"</span> -o -z <span class="string">"<span class="variable">$ITEMID</span>"</span> ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Missing mandatory parameter."</span>; <span class="built_in">help</span>;&#125;</span><br><span class="line">	<span class="comment"># 如果没有传入STIME参数，STIME的值为当前时间减去PERIOD</span></span><br><span class="line">	[ <span class="string">"<span class="variable">$STIME</span>"</span> == <span class="string">""</span> ] &amp;&amp; STIME=`date -d <span class="string">"now -<span class="variable">$&#123;PERIOD&#125;</span> second"</span> +%Y%m%d%H%M%S`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键步骤，获取cookie并写入文件</span></span><br><span class="line"><span class="keyword">function</span> getCookie()</span><br><span class="line">&#123;</span><br><span class="line">	/usr/bin/chattr -i <span class="variable">$&#123;COOKIE&#125;</span></span><br><span class="line">	<span class="variable">$&#123;CURL&#125;</span> -c <span class="variable">$&#123;COOKIE&#125;</span> -d <span class="string">"name=<span class="variable">$&#123;USERNAME&#125;</span>&amp;password=<span class="variable">$&#123;PASSWORD&#125;</span>&amp;autologin=1&amp;enter=Sign+in"</span> <span class="variable">$INDEX_URL</span> | egrep -o <span class="string">"(Login name or passwordis incorrect|Account is blocked.*seconds)"</span></span><br><span class="line">	<span class="comment"># 如果登录失败则退出脚本，并清空cookie文件</span></span><br><span class="line">	[ <span class="variable">$&#123;PIPESTATUS[1]&#125;</span> -eq 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> &gt;<span class="string">"<span class="variable">$COOKIE</span>"</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">	/usr/bin/chattr +i <span class="variable">$&#123;COOKIE&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取趋势图文件</span></span><br><span class="line"><span class="keyword">function</span> getGraph()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment"># zabbix3.0-</span></span><br><span class="line">	<span class="comment">#$&#123;CURL&#125; -b $&#123;COOKIE&#125; -d "itemid=$&#123;ITEMID&#125;&amp;period=$&#123;PERIOD&#125;&amp;stime=$&#123;STIME&#125;&amp;width=$&#123;WIDTH&#125;" $CHART_URL &gt; "$PNG_PATH"</span></span><br><span class="line">	<span class="comment"># zabbix3.0+</span></span><br><span class="line">	<span class="variable">$&#123;CURL&#125;</span> -b <span class="variable">$&#123;COOKIE&#125;</span> -d <span class="string">"itemids%5B0%5D=<span class="variable">$&#123;ITEMID&#125;</span>&amp;period=<span class="variable">$&#123;PERIOD&#125;</span>&amp;stime=<span class="variable">$&#123;STIME&#125;</span>&amp;width=<span class="variable">$&#123;WIDTH&#125;</span>"</span> <span class="variable">$&#123;CHART_URL&#125;</span> &gt; <span class="string">"<span class="variable">$&#123;PNG_PATH&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送告警</span></span><br><span class="line"><span class="keyword">function</span> sendMessage()</span><br><span class="line">&#123;</span><br><span class="line">	/usr/bin/php <span class="variable">$&#123;ROOTPATH&#125;</span>/mailer/sendmail.php <span class="string">"<span class="variable">$&#123;ALERT_SENDTO&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;ALERT_MESSAGE&#125;</span>"</span> <span class="string">"<span class="variable">$(basename $&#123;PNG_PATH&#125;)</span>"</span> <span class="string">"<span class="variable">$&#123;ITEMID&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> [ ! -s <span class="string">"<span class="variable">$&#123;COOKIE&#125;</span>"</span> ];<span class="keyword">then</span></span><br><span class="line">		getCookie</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	getGraph</span><br><span class="line">	<span class="keyword">if</span> [ -s <span class="string">"<span class="variable">$&#123;PNG_PATH&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">		sendMessage</span><br><span class="line">		writeLogs <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t send to <span class="variable">$&#123;ALERT_SENDTO&#125;</span>\t subject:<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>\t transmit status:$?"</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		writeLogs <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t send to <span class="variable">$&#123;ALERT_SENDTO&#125;</span>\t subject:<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>\t transmit status:$? \t <span class="variable">$PNG_PATH</span> doesn't exist."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[[ <span class="string">"<span class="variable">$1</span>"</span> =~ <span class="string">"help"</span> ]] &amp;&amp; &#123; <span class="built_in">help</span> ; <span class="built_in">exit</span> 0; &#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><ul><li>邮件告警脚本，同目录下创建一个mailer目录，mailer目录下存放swiftmailer源码</li></ul></li></ul><h2 id="邮件模板及smtp服务"><a href="#邮件模板及smtp服务" class="headerlink" title="邮件模板及smtp服务"></a>邮件模板及smtp服务</h2><ul><li>cat mailer/sendmail.php<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">''</span>. dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">$sendto = $argv[<span class="number">1</span>];</span><br><span class="line">$subject = $argv[<span class="number">2</span>];</span><br><span class="line">$content = $argv[<span class="number">3</span>];</span><br><span class="line">$graphName = $argv[<span class="number">4</span>];</span><br><span class="line">$itemId = $argv[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the Transport</span></span><br><span class="line">$transport = (<span class="keyword">new</span> Swift_SmtpTransport(<span class="string">'smtp.xxxmail.com'</span>, <span class="number">25</span>))</span><br><span class="line">  -&gt;setUsername(<span class="string">'AuthenticatedUser@xxxmail.com'</span>)</span><br><span class="line">  -&gt;setPassword(<span class="string">'password'</span>)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the Mailer using your created Transport</span></span><br><span class="line">$mailer = <span class="keyword">new</span> Swift_Mailer($transport);</span><br><span class="line"></span><br><span class="line"><span class="comment">// To use the ArrayLogger</span></span><br><span class="line"><span class="comment">#$logger = new Swift_Plugins_Loggers_ArrayLogger();</span></span><br><span class="line"><span class="comment">#$mailer-&gt;registerPlugin(new Swift_Plugins_LoggerPlugin($logger));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or to use the Echo Logger</span></span><br><span class="line"><span class="comment">#$logger = new Swift_Plugins_Loggers_EchoLogger();</span></span><br><span class="line"><span class="comment">#$mailer-&gt;registerPlugin(new Swift_Plugins_LoggerPlugin($logger));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a message</span></span><br><span class="line">$message = (<span class="keyword">new</span> Swift_Message($subject))</span><br><span class="line">  -&gt;setFrom([<span class="string">'Admin@xxxmail.com'</span> =&gt; <span class="string">'Notice'</span>])</span><br><span class="line">  -&gt;setTo([ $sendto =&gt; <span class="string">'Swift Mailer'</span>]);</span><br><span class="line">$message-&gt;setBody(</span><br><span class="line"><span class="string">'</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;!-- So that mobile will display zoomed in --&gt;</span></span><br><span class="line"><span class="string">  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;!-- enable media queries for windows phone 8 --&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name="format-detection" content="telephone=no"&gt; &lt;!-- disable auto telephone linking in iOS --&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;Two Columns to Rows (Simple)&lt;/title&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;style type="text/css"&gt;</span></span><br><span class="line"><span class="string">body &#123;</span></span><br><span class="line"><span class="string">  margin: 0;</span></span><br><span class="line"><span class="string">  padding: 0;</span></span><br><span class="line"><span class="string">  -ms-text-size-adjust: 100%;</span></span><br><span class="line"><span class="string">  -webkit-text-size-adjust: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table &#123;</span></span><br><span class="line"><span class="string">  border-spacing: 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table td &#123;</span></span><br><span class="line"><span class="string">  border-collapse: collapse;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ExternalClass &#123;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ExternalClass,</span></span><br><span class="line"><span class="string">.ExternalClass p,</span></span><br><span class="line"><span class="string">.ExternalClass span,</span></span><br><span class="line"><span class="string">.ExternalClass font,</span></span><br><span class="line"><span class="string">.ExternalClass td,</span></span><br><span class="line"><span class="string">.ExternalClass div &#123;</span></span><br><span class="line"><span class="string">  line-height: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ReadMsgBody &#123;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  background-color: #ebebeb;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table &#123;</span></span><br><span class="line"><span class="string">  mso-table-lspace: 0pt;</span></span><br><span class="line"><span class="string">  mso-table-rspace: 0pt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">img &#123;</span></span><br><span class="line"><span class="string">  -ms-interpolation-mode: bicubic;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.yshortcuts a &#123;</span></span><br><span class="line"><span class="string">  border-bottom: none !important;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">@media screen and (max-width: 599px) &#123;</span></span><br><span class="line"><span class="string">  .force-row,</span></span><br><span class="line"><span class="string">  .container &#123;</span></span><br><span class="line"><span class="string">    width: 100% !important;</span></span><br><span class="line"><span class="string">    max-width: 100% !important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">@media screen and (max-width: 400px) &#123;</span></span><br><span class="line"><span class="string">  .container-padding &#123;</span></span><br><span class="line"><span class="string">    padding-left: 12px !important;</span></span><br><span class="line"><span class="string">    padding-right: 12px !important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ios-footer a &#123;</span></span><br><span class="line"><span class="string">  color: #aaaaaa !important;</span></span><br><span class="line"><span class="string">  text-decoration: underline;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body style="margin:0; padding:0;" bgcolor="#F0F0F0" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0"&gt;</span></span><br><span class="line"><span class="string">&lt;!-- 100% background wrapper (grey background) --&gt;</span></span><br><span class="line"><span class="string">&lt;table border="0" width="100%" height="100%" cellpadding="0" cellspacing="0" bgcolor="#F0F0F0"&gt;</span></span><br><span class="line"><span class="string">  &lt;tr&gt;</span></span><br><span class="line"><span class="string">    &lt;td align="center" valign="top" bgcolor="#F0F0F0" style="background-color: #F0F0F0;"&gt;</span></span><br><span class="line"><span class="string">      &lt;br&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 600px container (white background) --&gt;</span></span><br><span class="line"><span class="string">      &lt;table border="0" width="600" cellpadding="0" cellspacing="0" class="container" style="width:600px;max-width:600px"&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding header" align="left" style="font-family:Helvetica, Arial, sans-serif;font-size:24px;font-weight:bold;padding-bottom:12px;color:#DF4726;padding-left:24px;padding-right:24px"&gt;</span></span><br><span class="line"><span class="string">            告警/恢复信息:</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding content" align="left" style="padding-left:24px;padding-right:24px;padding-top:12px;padding-bottom:12px;background-color:#ffffff"&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="title" style="font-family:Helvetica, Arial, sans-serif;font-size:18px;font-weight:600;color:#374550"&gt;</span></span><br><span class="line"><span class="string">  '</span> . $subject . <span class="string">'</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class="body-text" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333"&gt;</span></span><br><span class="line"><span class="string">  &lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc;clear: both;"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class="subtitle" style="font-family:Helvetica, Arial, sans-serif;font-size:16px;font-weight:600;color:#2469A0"&gt;</span></span><br><span class="line"><span class="string">  详细信息：</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="body-text" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333"&gt;</span></span><br><span class="line"><span class="string">  &lt;ol&gt;</span></span><br><span class="line"><span class="string">    '</span> . $content . <span class="string">'</span></span><br><span class="line"><span class="string">  &lt;/ol&gt;</span></span><br><span class="line"><span class="string">&lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">    &lt;table width="264" border="0" cellpadding="0" cellspacing="0" align="left" class="force-row"&gt;</span></span><br><span class="line"><span class="string">      &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td class="col" valign="top" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333;width:100%"&gt;</span></span><br><span class="line"><span class="string">          &lt;strong&gt;趋势图&lt;/strong&gt;</span></span><br><span class="line"><span class="string">          &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;a href="http://zabbix.server.url/history.php?action=showgraph&amp;itemids[]='</span> . $itemId . <span class="string">'"&gt;</span></span><br><span class="line"><span class="string">	  &lt;img src=http://zabbix.server.url/graphs/'</span> . $graphName . <span class="string">' /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">          &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">        &lt;/td&gt;</span></span><br><span class="line"><span class="string">      &lt;/tr&gt;</span></span><br><span class="line"><span class="string">    &lt;/table&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc;clear: both;"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;</span></span><br><span class="line"><span class="string">  &lt;em&gt;&lt;small&gt;Last updated: 08 April 2018&lt;/small&gt;&lt;/em&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding footer-text" align="left" style="font-family:Helvetica, Arial, sans-serif;font-size:12px;line-height:16px;color:#aaaaaa;padding-left:24px;padding-right:24px"&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            Serviced provider: © 2018 XXX-INC.</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            You are receiving this email because you  used our team\'s monitoring system. Update your &lt;a href="#" style="color:#aaaaaa"&gt;alarm configuration&lt;/a&gt; or &lt;a href="#" style="color:#aaaaaa"&gt;to unsubscribe.&lt;/a&gt;.</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;team@xxxmail.om&lt;/strong&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;span class="ios-footer"&gt;</span></span><br><span class="line"><span class="string">              department signature.&lt;br&gt;</span></span><br><span class="line"><span class="string">              team signature&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://www.Your Company'</span>s Official network.com<span class="string">" style="</span>color:<span class="comment">#aaaaaa"&gt;www.Your Company's Official network.com&lt;/a&gt;&lt;br&gt;</span></span><br><span class="line">            &lt;br&gt;&lt;br&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">&lt;!--/<span class="number">600</span>px container --&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;!--/<span class="number">100</span>% background wrapper--&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="string">','</span>text/html<span class="string">'</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Send the message</span></span><br><span class="line"><span class="string">$result = $mailer-&gt;send($message);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Dump the log contents</span></span><br><span class="line"><span class="string">// NOTE: The EchoLogger dumps in realtime so dump() does nothing for it</span></span><br><span class="line"><span class="string">#echo $logger-&gt;dump();</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="swiftmailer安装"><a href="#swiftmailer安装" class="headerlink" title="swiftmailer安装"></a>swiftmailer安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir mailer</span><br><span class="line"><span class="built_in">cd</span> mailer</span><br><span class="line">composer require <span class="string">"swiftmailer/swiftmailer:^6.0"</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://swiftmailer.symfony.com/docs/introduction.html" target="_blank" rel="noopener">swiftmailer官方文档</a></li></ul><p>至此基本差不多了，剩下的就是在zabbix web页面上配置下了。</p>]]></content>
      <categories>
        <category>zabbix</category>
      </categories>
      <tags>
        <tag>监控</tag>
        <tag>zabbix</tag>
        <tag>告警</tag>
      </tags>
  </entry>
  <entry>
    <title>zabbix实现自定义主机名</title>
    <url>/zabbix%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E6%9C%BA%E5%90%8D/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>主机名作为监控系统的关键信息，一定不能太死板。。。</p></blockquote><a id="more"></a><p>生产环境中通常系统的Hostname定义没有严格规范，一般在做系统时，很少在Hostname定义上花时间。但是Hostname作为关键信息在很多场景下具有非常重要的意义。</p><p>zabbix agent的默认配置文件中Hostname配置为<code># HostnameItem=system.hostname</code>,但是<a href="https://www.zabbix.com/documentation/3.0/manual/config/items/itemtypes/zabbix_agent" target="_blank" rel="noopener">zabbix官方文档</a>中有对<code>system.run[command,&lt;mode&gt;]</code>的描述，从2.2版本开始即支持通过该参数在主机上执行指定命令定义监控项的值。我们可以通过该参数实现对Hostname属性的重写。</p><p>配置样例：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">HostnameItem=system.run[/bin/bash /path/to/hostname.sh]</span><br></pre></td></tr></table></figure><h2 id="zabbix相关资源"><a href="#zabbix相关资源" class="headerlink" title="zabbix相关资源"></a>zabbix相关资源</h2><ul><li><p><a href="https://share.zabbix.com/" target="_blank" rel="noopener">Zabbix社区资源共享</a></p></li><li><p><a href="https://www.zabbix.org/wiki/Main_Page" target="_blank" rel="noopener">Zabbix官方WIKI</a></p></li><li><p><a href="https://www.zabbix.com/manuals" target="_blank" rel="noopener">Zabbix官方文档</a></p></li></ul>]]></content>
      <categories>
        <category>zabbix</category>
      </categories>
      <tags>
        <tag>监控</tag>
        <tag>zabbix</tag>
        <tag>优化</tag>
      </tags>
  </entry>
  <entry>
    <title>zabbix表分区优化</title>
    <url>/zabbix%E8%A1%A8%E5%88%86%E5%8C%BA%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<p>Zabbix是一款非常优秀的开源监控系统。</p><a id="more"></a><h2 id="MySQL存储过程定义"><a href="#MySQL存储过程定义" class="headerlink" title="MySQL存储过程定义"></a>MySQL存储过程定义</h2><ul><li>cat zabbixPartition.sql<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ======partition_create========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_create`</span>(SCHEMANAME <span class="built_in">varchar</span>(<span class="number">64</span>), TABLENAME <span class="built_in">varchar</span>(<span class="number">64</span>), PARTITIONNAME <span class="built_in">varchar</span>(<span class="number">64</span>), CLOCK <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           PARTITIONNAME = The name of the partition to create</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Verify that the partition does not already exist</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_description &gt;= CLOCK;</span><br><span class="line"></span><br><span class="line">        IF RETROWS = 0 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Print a message indicating that a partition was created.</span></span><br><span class="line"><span class="comment">                   2. Create the SQL to create the partition.</span></span><br><span class="line"><span class="comment">                   3. Execute the SQL from #2.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>( <span class="string">"partition_create("</span>, SCHEMANAME, <span class="string">","</span>, TABLENAME, <span class="string">","</span>, PARTITIONNAME, <span class="string">","</span>, CLOCK, <span class="string">")"</span> ) <span class="keyword">AS</span> msg;</span><br><span class="line">                <span class="keyword">SET</span> @<span class="keyword">sql</span> = <span class="keyword">CONCAT</span>( <span class="string">'ALTER TABLE '</span>, SCHEMANAME, <span class="string">'.'</span>, TABLENAME, <span class="string">' ADD PARTITION (PARTITION '</span>, PARTITIONNAME, <span class="string">' VALUES LESS THAN ('</span>, CLOCK, <span class="string">'));'</span> );</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @<span class="keyword">sql</span>;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_drop==========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_drop`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), DELETE_BELOW_PARTITION_DATE <span class="built_in">BIGINT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           DELETE_BELOW_PARTITION_DATE = Delete any partitions with names that are dates older than this one (yyyy-mm-dd)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> done <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> drop_part_name <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Get a list of all the partitions that are older than the date</span></span><br><span class="line"><span class="comment">           in DELETE_BELOW_PARTITION_DATE.  All partitions are prefixed with</span></span><br><span class="line"><span class="comment">           a "p", so use SUBSTRING TO get rid of that character.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> myCursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">                <span class="keyword">SELECT</span> partition_name</span><br><span class="line">                <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">                <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> <span class="keyword">CAST</span>(<span class="keyword">SUBSTRING</span>(partition_name <span class="keyword">FROM</span> <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">UNSIGNED</span>) &lt; DELETE_BELOW_PARTITION_DATE;</span><br><span class="line">        <span class="keyword">DECLARE</span> CONTINUE <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">NOT</span> <span class="keyword">FOUND</span> <span class="keyword">SET</span> done = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Create the basics for when we need to drop the partition.  Also, create</span></span><br><span class="line"><span class="comment">           @drop_partitions to hold a comma-delimited list of all partitions that</span></span><br><span class="line"><span class="comment">           should be deleted.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">SET</span> @alter_header = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE "</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">" DROP PARTITION "</span>);</span><br><span class="line">        <span class="keyword">SET</span> @drop_partitions = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Start looping through all the partitions that are too old.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        OPEN myCursor;</span><br><span class="line">        read_loop: LOOP</span><br><span class="line">                FETCH myCursor INTO drop_part_name;</span><br><span class="line">                IF done THEN</span><br><span class="line">                        LEAVE read_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @drop_partitions = <span class="keyword">IF</span>(@drop_partitions = <span class="string">""</span>, drop_part_name, <span class="keyword">CONCAT</span>(@drop_partitions, <span class="string">","</span>, drop_part_name));</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">        IF @drop_partitions != "" THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Build the SQL to drop all the necessary partitions.</span></span><br><span class="line"><span class="comment">                   2. Run the SQL to drop the partitions.</span></span><br><span class="line"><span class="comment">                   3. Print out the table partitions that were deleted.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SET</span> @full_sql = <span class="keyword">CONCAT</span>(@alter_header, @drop_partitions, <span class="string">";"</span>);</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @full_sql;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, @drop_partitions <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        ELSE</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   No partitions are being deleted, so print out "N/A" (Not applicable) to indicate</span></span><br><span class="line"><span class="comment">                   that no changes were made.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, <span class="string">"N/A"</span> <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_maintenance===================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_maintenance`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), TABLE_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), KEEP_DATA_DAYS <span class="built_in">INT</span>, HOURLY_INTERVAL <span class="built_in">INT</span>, CREATE_NEXT_INTERVALS <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> OLDER_THAN_PARTITION_DATE <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> OLD_PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> LESS_THAN_TIMESTAMP <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> CUR_TIME <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">CALL</span> partition_verify(SCHEMA_NAME, TABLE_NAME, HOURLY_INTERVAL);</span><br><span class="line">        <span class="keyword">SET</span> CUR_TIME = <span class="keyword">UNIX_TIMESTAMP</span>(<span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'%Y-%m-%d 00:00:00'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> @__interval = <span class="number">1</span>;</span><br><span class="line">        create_loop: LOOP</span><br><span class="line">                IF @__interval &gt; CREATE_NEXT_INTERVALS THEN</span><br><span class="line">                        LEAVE create_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SET</span> LESS_THAN_TIMESTAMP = CUR_TIME + (HOURLY_INTERVAL * @__interval * <span class="number">3600</span>);</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = FROM_UNIXTIME(CUR_TIME + HOURLY_INTERVAL * (@__interval - <span class="number">1</span>) * <span class="number">3600</span>, <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line">                IF(PARTITION_NAME != OLD_PARTITION_NAME) THEN</span><br><span class="line">                        <span class="keyword">CALL</span> partition_create(SCHEMA_NAME, TABLE_NAME, PARTITION_NAME, LESS_THAN_TIMESTAMP);</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @__interval=@__interval+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">SET</span> OLD_PARTITION_NAME = PARTITION_NAME;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> OLDER_THAN_PARTITION_DATE=<span class="keyword">DATE_FORMAT</span>(<span class="keyword">DATE_SUB</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> KEEP_DATA_DAYS <span class="keyword">DAY</span>), <span class="string">'%Y%m%d0000'</span>);</span><br><span class="line">        <span class="keyword">CALL</span> partition_drop(SCHEMA_NAME, TABLE_NAME, OLDER_THAN_PARTITION_DATE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_verify========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_verify`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), HOURLYINTERVAL <span class="built_in">INT</span>(<span class="number">11</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>(<span class="number">11</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> FUTURE_TIMESTAMP <span class="built_in">TIMESTAMP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Check if any partitions exist for the given SCHEMANAME.TABLENAME.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_name <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If partitions do not exist, go ahead and partition the table</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        IF RETROWS = 1 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Take the current date at 00:00:00 and add HOURLYINTERVAL to it.  This is the timestamp below which we will store values.</span></span><br><span class="line"><span class="comment">                 * We begin partitioning based on the beginning of a day.  This is because we don't want to generate a random partition</span></span><br><span class="line"><span class="comment">                 * that won't necessarily fall in line with the desired partition naming (ie: if the hour interval is 24 hours, we could</span></span><br><span class="line"><span class="comment">                 * end up creating a partition now named "p201403270600" when all other partitions will be like "p201403280000").</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">SET</span> FUTURE_TIMESTAMP = <span class="keyword">TIMESTAMPADD</span>(<span class="keyword">HOUR</span>, HOURLYINTERVAL, <span class="keyword">CONCAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">" "</span>, <span class="string">'00:00:00'</span>));</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = <span class="keyword">DATE_FORMAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Create the partitioning query</span></span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE "</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">" PARTITION BY RANGE(`clock`)"</span>);</span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(@__PARTITION_SQL, <span class="string">"(PARTITION "</span>, PARTITION_NAME, <span class="string">" VALUES LESS THAN ("</span>, <span class="keyword">UNIX_TIMESTAMP</span>(FUTURE_TIMESTAMP), <span class="string">"));"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Run the partitioning query</span></span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @__PARTITION_SQL;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#======partition_maintenance_all================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_maintenance_all`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_log'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_str'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_text'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_uint'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends'</span>, <span class="number">730</span>, <span class="number">24</span>, <span class="number">365</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends_uint'</span>, <span class="number">730</span>, <span class="number">24</span>, <span class="number">365</span>);</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></li><li>参数说明<ul><li>SCHEMA_NAME = 数据库</li><li>TABLE_NAME = 表</li><li>KEEP_DATA_DAYS = 要保留的分区的最大天数。所有超过此天数的分区将被删除。</li><li>HOURLY_INTERVAL = 分区的时间间隔(小时为单位)</li><li>CREATE_NEXT_INTERVALS = 创建的未来分区数</li></ul></li></ul><h2 id="Housekeeper配置修改"><a href="#Housekeeper配置修改" class="headerlink" title="Housekeeper配置修改"></a>Housekeeper配置修改</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">"Administration"</span> -&gt; <span class="string">"General"</span> -&gt; <span class="string">"Housekeeping"</span></span><br><span class="line">将History&amp;Trends <span class="string">"Enable internal housekeeping"</span>取消，勾选<span class="string">"Override item trend period"</span>,</span><br><span class="line">将<span class="string">"Data storage period (in days)"</span>的值改成和存储过程中变量KEEP_DATA_DAYS的值一致。</span><br></pre></td></tr></table></figure><h2 id="存储过程导入"><a href="#存储过程导入" class="headerlink" title="存储过程导入"></a>存储过程导入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/mysql -uroot -p zabbix &lt; zabbixPartition.sql</span><br></pre></td></tr></table></figure><h2 id="crontab配置"><a href="#crontab配置" class="headerlink" title="crontab配置"></a>crontab配置</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">00 01 01 * *  /usr/bin/mysql  -uroot -pPASSWD zabbix -e<span class="string">"CALL partition_maintenance_all('zabbix')"</span> &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="查看分区结果"><a href="#查看分区结果" class="headerlink" title="查看分区结果"></a>查看分区结果</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; showcreate table <span class="built_in">history</span>;</span><br></pre></td></tr></table></figure><p>以上在zabbix3.0.2版本上执行通过，其它版本根据实际情况判断是否微调。。。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.zabbix.org/wiki/Docs/howto/mysql_partition" target="_blank" rel="noopener">Zabbix wiki</a></li><li><a href="https://cloud.tencent.com/community/article/463810" target="_blank" rel="noopener">Zabbix 分区优化</a></li><li><a href="https://www.kancloud.cn/devops-centos/centos-linux-devops/375488" target="_blank" rel="noopener">Zabbix数据库优化(Zabbix分区表)</a></li></ul>]]></content>
      <categories>
        <category>zabbix</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>zabbix</tag>
        <tag>表分区</tag>
      </tags>
  </entry>
  <entry>
    <title>yum/rpm常用命令总结</title>
    <url>/yum-rpm%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>Yum (Yellow dog Updater, Modified) ,Fedora、RedHat以及CentOS中的Shell前端软件包管理器，基于RPM。</p></blockquote><a id="more"></a><h2 id="yum常用命令"><a href="#yum常用命令" class="headerlink" title="yum常用命令"></a>yum常用命令</h2><ul><li><p>显示可用的yum仓库</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum repolist</span><br></pre></td></tr></table></figure></li><li><p>指定某一个repo内搜索某个rpm包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum --disablerepo=* --enablerepo=xxx search xxxx</span><br></pre></td></tr></table></figure></li><li><p>列出某个yum源中可用的rpm包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo yum --disablerepo=&quot;*&quot; --enablerepo=&quot;xxxx&quot; list available</span><br></pre></td></tr></table></figure></li><li><p>查找某条命令的yum源</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum whatprovides &quot;*/whoami&quot;</span><br></pre></td></tr></table></figure></li><li><p>查找某条命令由什么包提供</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum provides $&#123;cmd&#125;</span><br></pre></td></tr></table></figure></li><li><p>替换安装某个rpm包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum install yum-plugin-replace</span><br><span class="line">yum replace php-common --replace-with=php56-common</span><br></pre></td></tr></table></figure></li><li><p>降级安装</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum downgrade packages</span><br></pre></td></tr></table></figure></li><li><p>安装程序组</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum groupinstall &apos;Development Tools’</span><br></pre></td></tr></table></figure></li><li><p>从yum源中下载rpm包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install yum-utils</span><br><span class="line">yumdownloader xxxx</span><br></pre></td></tr></table></figure></li><li><p>yum下载依赖文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">方法一：</span><br><span class="line">  yumdownloader 下载包名称 --resolve --destdir=/tmp/openresty</span><br><span class="line">  </span><br><span class="line">参考：</span><br><span class="line">  http://www.cnblogs.com/toSeek/p/6093679.html</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">  1.安装yum-plugin-downloadonly</span><br><span class="line">    yum -y install ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/Virtualization:/Appliances/CentOS_CentOS-6/noarch/yum-plugin-downloadonly-1.1.31-2.2.noarch.rpm</span><br><span class="line">  2.下载：</span><br><span class="line">    yum install -y --downloadonly --downloaddir=/tmp/php  php</span><br><span class="line">    </span><br><span class="line">参考：</span><br><span class="line">  http://graybull.is-programmer.com/posts/37702.html</span><br><span class="line">  http://www.jianshu.com/p/5930545b5591</span><br></pre></td></tr></table></figure></li><li><p>yum 查看so库文件所在的rpm包</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum whatprovides  libXpm.so.4</span><br></pre></td></tr></table></figure></li><li><p>Yum 事务完整的历史记录</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum history list all                # 查看历史yum命令</span><br><span class="line">yum history info nginx              # 查看yum涉及指定软件包的事务详情</span><br><span class="line">yum history summary nginx           # 查看yum涉及指定软件包的事务摘要</span><br><span class="line">yum history package-list nginx      # 查看yum涉及指定软件包的历史记录</span><br><span class="line">yum history addon-info              # 提供更多的信息来源</span><br><span class="line">yum history stats                   # 显示当前历史数据库的统计信息</span><br><span class="line">yum history sync                    # 更改为所有已安装软件包存储的rpmdb/yumdb数据</span><br><span class="line">yum history new                     # 创建新的历史文件</span><br></pre></td></tr></table></figure></li></ul><h2 id="rpm常用命令"><a href="#rpm常用命令" class="headerlink" title="rpm常用命令"></a>rpm常用命令</h2><ul><li><p>强制降级</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -Uvh oldpackage.rpm --oldpackage </span><br><span class="line">或</span><br><span class="line">rpm -Uvh oldpackage.rpm --force</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包安装前后执行的脚本</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qp --scripts xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>rpm包安装前后执行脚本被传入参数$1的意义</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0:卸载</span><br><span class="line">1:安装、升级卸载</span><br><span class="line">2:升级</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包提供的命令</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qp --provides xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包注册的冲突信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qp --conflicts xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包注册的依赖信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qpR xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包中注册的配置文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qpc xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包的打包信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -qpi xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看打包spec文件中的tag信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm -q --qf %&#123;tag&#125; rpm_name</span><br><span class="line"></span><br><span class="line">tag list: Name|Version|Release|Summary|Group|License|URL</span><br><span class="line">eg：</span><br><span class="line">rpm -q --qf %&#123;Version&#125; rpm_name</span><br></pre></td></tr></table></figure></li></ul><h2 id="内网yum源维护"><a href="#内网yum源维护" class="headerlink" title="内网yum源维护"></a>内网yum源维护</h2><ul><li><p>创建repodata</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install createrepo</span><br><span class="line">createrepo /path/to/RPMS/epel/7/x86_64/</span><br></pre></td></tr></table></figure></li><li><p>更新repodata</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">createrepo --update /path/to/RPMS/epel/7/x86_64</span><br></pre></td></tr></table></figure></li><li><p>镜像yum源</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reposync -r &quot;repoid&quot;</span><br><span class="line">eg:</span><br><span class="line">reposync -r webtatic-archive -nu</span><br><span class="line"></span><br><span class="line">-r  指定镜像源</span><br><span class="line">-n 只下载最新镜像</span><br><span class="line">-u 只列出，不下载</span><br></pre></td></tr></table></figure></li><li><p>自定义yum源配置</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[epel.xxx]</span><br><span class="line">name=repo.xxx.xxx</span><br><span class="line">baseurl=http://repo.xxx/epel/$releasever/$basearch</span><br><span class="line">skip_if_unavailable=True        # 在CentOS7系统上测试当前yum源如果不可用，会直接跳过，默认False，提示错误.</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[epel-archive.xxx]</span><br><span class="line">name=archive.xxx.xxx</span><br><span class="line">baseurl=http://repo.xxx/archive/$releasever/$basearch</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=0</span><br></pre></td></tr></table></figure></li><li><p>配置文件中$releasever变量是取redhat-release-server(redhat)或centos-release(centos) rpm包的属性 %{version} 的值。验证方法:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$basearch：</span><br><span class="line">rpm -q --qf %&#123;arch&#125; redhat-release-server</span><br><span class="line">$releaseserver：</span><br><span class="line">rpm -q --qf %&#123;version&#125; redhat-release-server</span><br></pre></td></tr></table></figure></li><li><p>rh和centos的$releasever稍有不同，一般rh的$releasever值是${Version}Server,centos的$releasever值直接是${Version}数值，所以在定义配置文件的时候要注意验证。</p></li></ul><h2 id="常见yum报错处理"><a href="#常见yum报错处理" class="headerlink" title="常见yum报错处理"></a>常见yum报错处理</h2><ul><li>yum报错：<code>Rpmdb checksum is invalid: dCDPT(pkg checksums)</code></li><li>解决方案<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm --rebuilddb</span><br><span class="line">yum clean all</span><br></pre></td></tr></table></figure></li></ul><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><ul><li><a href="https://archives.fedoraproject.org/pub/archive/epel/5Server/x86_64/" target="_blank" rel="noopener">CentOS5社区yum源</a></li></ul>]]></content>
      <categories>
        <category>yum</category>
      </categories>
      <tags>
        <tag>rpm</tag>
        <tag>Linux</tag>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>drupal应用部署</title>
    <url>/drupal%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>Drupal是一款诞生于2000年的基于PHP语言编写的经典开源内容管理框架。</p><a id="more"></a><p>坊间传说drupal使用成本比wp高，偶然的机会看到一个基于drupal搭建的网站还不赖。兴趣使然，简单研究了一下drupal的搭建和使用。<br>以下简单给出搭建的关键步骤：</p><h2 id="composer工具准备"><a href="#composer工具准备" class="headerlink" title="composer工具准备"></a>composer工具准备</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php</span><br><span class="line">mv composer.phar /usr/sbin/</span><br><span class="line">composer self-update</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php -r &quot;copy(&apos;https://getcomposer.org/installer&apos;, &apos;composer-setup.php&apos;);&quot;</span><br><span class="line">php -r &quot;if (hash_file(&apos;sha384&apos;, &apos;composer-setup.php&apos;) === &apos;a5c698ffe4b8e849a443b120cd5ba38043260d5c4023dbf93e1558871f1f07f58274fc6f4c93bcfd858c6bd0775cd8d1&apos;) &#123; echo &apos;Installer verified&apos;; &#125; else &#123; echo &apos;Installer corrupt&apos;; unlink(&apos;composer-setup.php&apos;); &#125; echo PHP_EOL;&quot;</span><br><span class="line">php composer-setup.php --install-dir=/bin --filename=composer --version=1.9.0</span><br><span class="line">composer config -g --unset repos.packagist</span><br><span class="line">composer config -g repo.packagist composer https://packagist.phpcomposer.com</span><br></pre></td></tr></table></figure><h2 id="以lightning为例部署"><a href="#以lightning为例部署" class="headerlink" title="以lightning为例部署"></a>以lightning为例部署</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">composer create-project acquia/lightning-project drupal</span><br><span class="line">chown -R nobody:nobody drupal</span><br></pre></td></tr></table></figure><ul><li>drupal/docroot为应用根目录</li><li>drupal默认使用sqlite数据库不需要单独配置</li></ul><h2 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h2><p>以上方式部署完成后，用nginx的默认php应用配置会导致除了首页能访问，其它所有页面全部404，<br>根据drupal的路由特点需要简单配置rewrite规则，nginx应用的基本配置如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       *:80;</span><br><span class="line">    # include vhosts/vhosts.listen.addr;</span><br><span class="line">    # server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line"></span><br><span class="line">    access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   html/drupal/docroot;</span><br><span class="line">        index  index.php index.htm;</span><br><span class="line">        try_files $uri $uri/ @rewrite;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/sites/.*/private/ &#123;</span><br><span class="line">        access_log  off;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location @rewrite &#123;</span><br><span class="line">            rewrite ^/(.*)$ /index.php?q=$1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root           html/drupal/docroot;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny  all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此一来，基本上就可以用了。。。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://getcomposer.org/download/" target="_blank" rel="noopener">composer文档</a></li></ul>]]></content>
      <categories>
        <category>drupal</category>
      </categories>
      <tags>
        <tag>drupal</tag>
        <tag>CMS</tag>
        <tag>搭建部署</tag>
      </tags>
  </entry>
  <entry>
    <title>confluence 自动备份策略不生效</title>
    <url>/confluence-%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5%E4%B8%8D%E7%94%9F%E6%95%88/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>一切问题都有答案。。。</p></blockquote><a id="more"></a><p>##问题现象</p><p>confluence从备份文件中降级恢复后，配置没有任何错误提示，但是发现备份策略不生效，备份目录为空。查看日志后发现，没有取到backupPath，但是实际配置中是有显示配置路径的。</p><h2 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">backupAttachmentsDaily = true</span><br><span class="line">dailyBackupFilePrefix = backup-</span><br><span class="line">backupDaily = true</span><br><span class="line">backupPath = null</span><br><span class="line">2018-03-20 02:00:00,022 WARN [Caesium-1-2] [confluence.importexport.impl.BackupJob] runJob No daily backup directory specified to store the backups. Taking no action!</span><br><span class="line">2018-03-20 02:00:00,038 WARN [Caesium-1-2] [impl.schedule.caesium.JobRunnerWrapper] runJob Scheduled job BackupJob#BackupJob completed unsuccessfully with response JobRunnerResponse[runOutcome=ABORTED,message=&apos;No daily backup directory specified to store the backups. Taking no action!&apos;]</span><br></pre></td></tr></table></figure><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p>参考了一些<a href="https://confluence.atlassian.com/confkb/cannot-create-xml-backup-with-the-warn-message-no-daily-backup-directory-specified-to-store-the-backups-in-the-logs-737772474.html" target="_blank" rel="noopener">官网给出的case</a>,<br>将 ${CONFLUENCE_HOME}目录下的配置文件confluence.cfg.xml中的<code>&lt;property name=&quot;admin.ui.allow.daily.backup.custom.location&quot;&gt;false&lt;/property&gt;</code>属性值变更为<code>true</code>,<br>重启confluence，<br>然后将<code>每日备份管理-&gt;备份设置-&gt;备份路径</code>设置为<code>默认</code>,<br>最后重新手动触发备份任务，<br>成功生成备份文件。</p><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>由于之前有过confluence从备份文件中降级恢复操作，怀疑是由于恢复操作，导致备份路径没有生效，猜测不用修改confluence.cfg.xml，直接重新提交一下备份路径设置也是可以的，因为问题的根本原因是<code>backupPath = null</code>。由于生产环境不便于验证，反复修改验证。有兴趣的读者可以验证一下，以后有机会也会再做验证。</p><p>confluence的备份恢复机制还是很好用的。wiki作为团队的重要资源，做好备份恢复还是非常重要和必要的。</p>]]></content>
      <categories>
        <category>confluence</category>
        <category>填坑指南</category>
      </categories>
      <tags>
        <tag>confluence</tag>
        <tag>wiki</tag>
        <tag>备份</tag>
      </tags>
  </entry>
  <entry>
    <title>bash常用快捷键</title>
    <url>/bash%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
    <content><![CDATA[<p>常用但不全面，会持续总结完善。。。</p><a id="more"></a><style>table th:nth-of-type(1){width:30%}nth-of-type(2){width:70%}</style><h1 id="功能键清单"><a href="#功能键清单" class="headerlink" title="功能键清单"></a>功能键清单</h1><table><thead><tr><th align="left">快捷键</th><th align="left">功能</th></tr></thead><tbody><tr><td align="left">ctrl + k</td><td align="left">删除光标后面所有字符</td></tr><tr><td align="left">ctrl + u</td><td align="left">删除光标前面所有字符</td></tr><tr><td align="left">ctrl + w</td><td align="left">删除光标前一个单词相当于VIM里db</td></tr><tr><td align="left">ctrl + y</td><td align="left">粘贴ctrl+u上次执行时删除的字符</td></tr><tr><td align="left">ctrl + ?</td><td align="left">撤消前一次输入</td></tr><tr><td align="left">ctrl + 方向键</td><td align="left">光标以单词为单位移动</td></tr><tr><td align="left">ctrl + s</td><td align="left">锁住终端</td></tr><tr><td align="left">ctrl + q</td><td align="left">解锁终端</td></tr><tr><td align="left">alt + 数字</td><td align="left">切换到第N个标签页</td></tr><tr><td align="left">alt + r</td><td align="left">透明窗口切换</td></tr><tr><td align="left">Shift + Home</td><td align="left">顶部</td></tr><tr><td align="left">Shift + End</td><td align="left">底部</td></tr><tr><td align="left">Shift + PgUp</td><td align="left">向上翻页</td></tr><tr><td align="left">Shift + PgDn</td><td align="left">向下翻页</td></tr></tbody></table><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://mp.weixin.qq.com/s?__biz=MzI3MTI2NzkxMA==&mid=2247489340&idx=1&sn=c7707e49184df0ba6cbca5505b756e6f&chksm=eac53615ddb2bf03d350efb74fa7cedd81fa8a7886f3bca6918d8f5602ed54e899c318b587a4&scene=0&xtrack=1&key=e4392a9f794f9be2426e33aab082a3b391b98fe6efcab81480f230fc2d84f7053a622e54ccdaa0406e3ba59e266aa9496cebb06026461a5f4e89ff77be93a50d99d8103a861960ae7e86fa7aa194d2df&ascene=14&uin=MjU4NTIwODY2MA%3D%3D&devicetype=Windows+10&version=62070158&lang=zh_CN&pass_ticket=RLo5MX2JTDHvbIbfvEmJrcchovMVEsBeRTjwY6KxzhMgup4hP5dP2VtNUqFttHkd" target="_blank" rel="noopener">掌握这些提升命令行效率的快捷键后，让你的 SHELL 快得飞起来</a></li><li><a href="https://www.runoob.com/w3cnote/bash-shortcut.html" target="_blank" rel="noopener">Bash 快捷键大全</a></li><li><a href="https://linux.cn/article-9430-1.html" target="_blank" rel="noopener">有用的 Bash 快捷键清单</a></li></ul>]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>bash</tag>
        <tag>快捷键</tag>
      </tags>
  </entry>
  <entry>
    <title>influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</title>
    <url>/influxdb-telegraf-grafana%E7%9B%91%E6%8E%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%8Ezabbix%E7%9B%91%E6%8E%A7%E7%9A%84%E5%AF%B9%E6%AF%94/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>术业有专攻，各有所长。。。</p></blockquote><a id="more"></a><style>table th:nth-of-type(1){width:50%}nth-of-type(2){width:50%}</style><h1 id="influxdb-telegraf-Grafana监控解决方案"><a href="#influxdb-telegraf-Grafana监控解决方案" class="headerlink" title="influxdb+telegraf+Grafana监控解决方案"></a>influxdb+telegraf+Grafana监控解决方案</h1><h2 id="角色分工"><a href="#角色分工" class="headerlink" title="角色分工"></a>角色分工</h2><ul><li>telegraf 根据配置采集数据，输出数据；拥有丰富强大的输出输出插件，influxdb官方推出的数据采集方案，对influxdb的支持非常好；</li><li>influxdb 时序数据库，chronograf是官方提供的替代内置方案的web Admin；</li><li>Grafana 出图告警。出图功能灵活强大，告警功能目前还比较简单单一。</li></ul><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ul><li>官方提供的rpm包安装，无依赖，操作简单。</li></ul><h2 id="高可用实现方案"><a href="#高可用实现方案" class="headerlink" title="高可用实现方案"></a>高可用实现方案</h2><ul><li>influxdb社区版不支持集群方案；</li><li>telegraf支持写双份数据，来降低influxdb的单点风险；</li><li>Grafana可以通过MySQL替代SQLite,redis共享session，nginx代理多个应用的方式实现高可用。</li></ul><h2 id="监控项"><a href="#监控项" class="headerlink" title="监控项"></a>监控项</h2><ul><li>对java应用的监控<ul><li>Jolokia</li><li>httpjson<ul><li>jmxtrans</li><li>Actuator</li></ul></li></ul></li><li>对http请求的监控<ul><li>http</li><li>httprespone</li></ul></li><li>对日志的监控<ul><li>logparser</li><li>tail</li></ul></li><li>支持exec脚本</li><li>其它常见应用<ul><li>apache</li><li>ceph</li><li>consul</li><li>docker</li><li>elasticsearch</li><li>fluentd</li><li>graylog</li><li>haproxy</li><li>influxdb</li><li>iptables</li><li>kubernetes</li><li>memcached</li><li>mesos</li><li>mongodb</li><li>mysql</li><li>nginx</li><li>openldap</li><li>phpfpm</li><li>postfix</li><li>postgresql</li><li>prometheus</li><li>rabbitmq</li><li>redis</li><li>solr</li><li>tomcat</li><li>varnish</li><li>zookeeper</li></ul></li></ul><h2 id="telegraf支持的常见写入方式或介质"><a href="#telegraf支持的常见写入方式或介质" class="headerlink" title="telegraf支持的常见写入方式或介质"></a>telegraf支持的常见写入方式或介质</h2><ul><li>influxdb</li><li>rabbitmq</li><li>aws cloudwatch</li><li>elasticsearch</li><li>file</li><li>graphite</li><li>graylog</li><li>kafka</li><li>mqtt</li><li>opentsdb</li><li>prometheus</li><li>socket_writer</li><li>tcp</li><li>udp</li><li>…</li></ul><h2 id="出图"><a href="#出图" class="headerlink" title="出图"></a>出图</h2><ul><li>Grafana社区提供了丰富的<a href="https://grafana.com/dashboards" target="_blank" rel="noopener">Dashboard模板</a></li><li>可以自定义</li><li>导入导出</li><li>Dashboard、Row、查询SQL中均支持Variables，出图非常灵活</li></ul><h2 id="告警"><a href="#告警" class="headerlink" title="告警"></a>告警</h2><ul><li>支持较为简单的告警逻辑处理</li><li>告警关联的SQL中不支持Variables解析</li><li>目前单个panel只支持一个告警规则，因此在配置告警时要进行panel拆分</li></ul><h2 id="部署过程中的要点"><a href="#部署过程中的要点" class="headerlink" title="部署过程中的要点"></a>部署过程中的要点</h2><ul><li>数据库使用域名，或绑hosts，避免迁移修改配置的问题</li><li>http接口鉴权、绑定必要的IP list</li><li>定义influxdb定期清理策略</li><li>influxdb认证</li></ul><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>秒级数据采集</li><li>自动上报</li><li>部署简单</li><li>插件丰富，开箱即用</li><li>支持协议数据</li></ul><h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><ul><li>告警能力（策略相对简单、渠道固定）</li><li>跨网部署</li></ul><h1 id="和zabbix的优劣对比"><a href="#和zabbix的优劣对比" class="headerlink" title="和zabbix的优劣对比"></a>和zabbix的优劣对比</h1><table><thead><tr><th align="left">telegraf+influxdb+Grafana</th><th align="left">Zabbix</th></tr></thead><tbody><tr><td align="left">部署及使用简单</td><td align="left">部署使用相对复杂</td></tr><tr><td align="left">内置监控项丰富</td><td align="left">内置监控项支持相对少一些，但是社区提供了丰富的监控采集方案</td></tr><tr><td align="left">不支持跨机房部署</td><td align="left">支持跨机房部署</td></tr><tr><td align="left">审计功能相对较弱</td><td align="left">审计功能成熟完善</td></tr><tr><td align="left">出图能力灵活强大</td><td align="left">出图功能相对弱一些，图形化定制方面操作复杂</td></tr><tr><td align="left">告警功能简单</td><td align="left">告警强大，支持告警依赖，告警升级</td></tr><tr><td align="left">支持通过webhook方式触发命令</td><td align="left">支持服务器端/客户端的命令自动触发，支持命令推送</td></tr><tr><td align="left">权限管理相对简单</td><td align="left">支持细粒度的权限定制，权限体系成熟完善</td></tr><tr><td align="left">数据采集方式相对单一，仅支持自动上报，但支持较为丰富的数据源</td><td align="left">支持多种数据采集方式/协议，数据源相对单一，v3.4.7版本开始支持ES存储历史数据</td></tr></tbody></table><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul><li>zabbix 更加成熟完善，侧重告警能力。</li><li>telegraf+influxdb+Grafana相对轻量，侧重出图能力。</li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>监控</tag>
        <tag>influxdbdata</tag>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>七层网络协议</title>
    <url>/%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<p>简单概括,不一定准确。。。</p><a id="more"></a><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:10%}nth-of-type(3){width:30%}nth-of-type(4){width:50%}</style><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><table><thead><tr><th align="left">TCP/IP模型</th><th align="left">OSI模型</th><th align="left">分布的应用</th><th align="left">协议说明</th></tr></thead><tbody><tr><td align="left">应用层</td><td align="left">应用层</td><td align="left">nginx、Apache、HAProxy、LVS、keepalived</td><td align="left">DHCP(v6)、DNS、FTP、Gopher、HTTP(SPDY、HTTP/2)、IMAP4、IRC、NNTP、XMPP、POP3、SIP、SMTP、SNMP、SSH、TELNET、RPC、SOAP、NTP、等</td></tr><tr><td align="left">应用层</td><td align="left">表示层</td><td align="left">-</td><td align="left">该层被弃用。应用层的HTTP、FTP、Telnet等协议有类似的功能。传输层的TLS/SSL也有类似功能。</td></tr><tr><td align="left">应用层</td><td align="left">会话层</td><td align="left">-</td><td align="left">该层被弃用。应用层的HTTP、RPC、SDP、RTCP等协议有类似的功能。</td></tr><tr><td align="left">传输层</td><td align="left">传输层</td><td align="left">LVS、keepalived</td><td align="left">TCP、UDP、DCCP、RSVP、PPTP、TLS/SSL等。IP+端口</td></tr><tr><td align="left">网际互连层</td><td align="left">网络层</td><td align="left">keepalived</td><td align="left">IP(v4·v6)、ICMP(v6)、IGMP、IPsec、BGP、RIP、OSPF、RARP等</td></tr><tr><td align="left">网络接口层</td><td align="left">数据链路层</td><td align="left">-</td><td align="left">Wi-Fi(IEEE 802.11)、ARP、ATM、令牌环、以太网、FDDI、帧中继、GPRS、HDLC、PPP、PPPoE、L2TP、ISDN、SPB、STP等</td></tr><tr><td align="left">网络接口层</td><td align="left">物理层</td><td align="left">-</td><td align="left">以太网、调制解调器、电力线通信、同步光网络、光导纤维、同轴电缆、双绞线等</td></tr></tbody></table><h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><ul><li>heartbeat工作在几层？</li></ul>]]></content>
      <categories>
        <category>TCP/IP</category>
      </categories>
      <tags>
        <tag>协议</tag>
        <tag>OSI</tag>
        <tag>TCP/IP</tag>
      </tags>
  </entry>
  <entry>
    <title>redis数据结构</title>
    <url>/redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>只是redis的基本数据类型。</p></blockquote><a id="more"></a><h1 id="5中数据结构"><a href="#5中数据结构" class="headerlink" title="5中数据结构"></a>5中数据结构</h1><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:90%}</style><table><thead><tr><th align="left">数据结构</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">String(字符串)</td><td align="left">Strings 类型，可以完全实现目前Memcached的功能，并且效率更高。还可以享受 Redis 的定时持久化，操作日志及 Replication 等功能，并提供更多的操作命令支持。</td></tr><tr><td align="left">Hash(字典)</td><td align="left">可以像在数据库中Update一个属性一样只修改某一项属性值。</td></tr><tr><td align="left">List(列表)</td><td align="left">链表，可以轻松实现最新消息排行等功能。另一个应用就是消息队列，Redis提供了操作List中某一段元素的 API。</td></tr><tr><td align="left">Set(集合)</td><td align="left">集合的概念就是一堆不重复值的组合。利用 Redis 提供的 Set 数据结构，可以存储一些集合性的数据。</td></tr><tr><td align="left">Sorted Set(有序集合)</td><td align="left">和Sets相比，Sorted Sets是将Set中的元素增加了一个权重参数score，使得集合中的元素能够按 score 进行有序排列,适用于比较复杂的数据结构和带有权重的元素。</td></tr></tbody></table><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li>缓存</li><li>消息队列</li><li>订阅-发布系统</li><li>TimeLine</li><li>加权元素</li><li>事务处理(Transactions)</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="http://www.runoob.com/w3cnote/redis-use-scene.html" target="_blank" rel="noopener">Redis 数据结构使用场景</a></li><li><a href="http://www.redis.net.cn/tutorial/3501.html" target="_blank" rel="noopener">Redis教程</a></li></ul>]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>数据结构</tag>
        <tag>kv</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux挂载Windows共享目录</title>
    <url>/linux%E6%8C%82%E8%BD%BDwindows%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<p>CIFS(Common Internet File System)：通用网络文件系统</p><a id="more"></a><ul><li><p>软件环境</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install cifs-utils.x86_64</span><br></pre></td></tr></table></figure></li><li><p>挂载目录</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p /opt/share</span><br><span class="line">mount -t cifs -o username=&apos;domain-name.com\username&apos; &quot;//10.0.0.1/share&quot; /opt/share</span><br></pre></td></tr></table></figure></li><li><p>永久挂载(直接暴露用户密码，一般不建议，除非免密码公共共享)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\&quot;//10.0.0.1/share\&quot;    /opt/share  cifs  auto,username=&apos;domain-name.com\username&apos;,password=&apos;passwd&apos;  0 0\&quot; &gt;&gt;/etc/fstab</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure></li><li><p>卸载</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">umount //10.0.0.1/share</span><br></pre></td></tr></table></figure></li><li><p>中文乱码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install system-config-language</span><br><span class="line"></span><br><span class="line"># system-config-language  # 选择中文简体</span><br><span class="line"></span><br><span class="line"># 将/etc/sysconfig/i18n中以下两项设置为</span><br><span class="line">LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">SYSFONT=&quot;lat0-sun16&quot;</span><br><span class="line"></span><br><span class="line"># source /etc/sysconfig/i18n  #即使配置不需要改变也需要source一下</span><br><span class="line"></span><br><span class="line"># 如果没有中文语言包，执行此命令安装</span><br><span class="line"># yum groupinstall chinese-support</span><br><span class="line"></span><br><span class="line"># 最后将ssh客户端的编码设置为Unicode(UTF-8)</span><br></pre></td></tr></table></figure></li><li><p>参考</p></li></ul><p><a href="https://www.linuxhub.org/?p=147" target="_blank" rel="noopener">Linux访问Windows共享</a></p>]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Windows</tag>
        <tag>共享</tag>
      </tags>
  </entry>
  <entry>
    <title>HTTP协议中的8种请求方法</title>
    <url>/http%E5%8D%8F%E8%AE%AE%E4%B8%AD%E7%9A%848%E7%A7%8D%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>根据HTTP标准，HTTP请求可以使用多种请求方法。。。</p></blockquote><a id="more"></a><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:90%}</style><h1 id="八种请求方法"><a href="#八种请求方法" class="headerlink" title="八种请求方法"></a>八种请求方法</h1><table><thead><tr><th align="left">请求方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">GET</td><td align="left">请求指定的页面信息，并返回实体主体。</td></tr><tr><td align="left">HEAD</td><td align="left">类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头。</td></tr><tr><td align="left">POST</td><td align="left">向指定资源提交数据进行处理请求，主要用于向数据处理过程提供数据块，如递交表单或上传文件。</td></tr><tr><td align="left">PUT</td><td align="left">从客户端向服务器传送的数据取代指定的文档的内容。由于自身不带验证机制，任何人都可以上传文件，因此存在安全性问题，一般不使用该方法。</td></tr><tr><td align="left">DELETE</td><td align="left">请求服务器删除指定的页面。同样不带验证机制。</td></tr><tr><td align="left">CONNECT</td><td align="left">HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器，使请求连接转换到透明的 TCP/IP 通道。</td></tr><tr><td align="left">OPTIONS</td><td align="left">返回服务器支持的 HTTP 方法，允许客户端查看服务器的性能。</td></tr><tr><td align="left">TRACE</td><td align="left">回显服务器收到的请求，主要用于测试或诊断。通常不会使用 TRACE，并且它容易受到 XST(跨站追踪)攻击。</td></tr></tbody></table><ul><li>其中HTTP1.0定义了三种请求方法： GET、POST、和HEAD，HTTP1.1新增了OPTIONS、PUT、DELETE、TRACE和CONNECT方法。</li></ul><h1 id="GET和POST比较"><a href="#GET和POST比较" class="headerlink" title="GET和POST比较"></a>GET和POST比较</h1><ul><li><p>GET方法<br>GET方法请求有长度限制，保留在浏览器历史记录中，请求可被缓存，可被收藏为书签。请求只应当用于取回数据，不应在处理敏感数据时使用。</p></li><li><p>POST方法<br>POST方法请求对数据长度没有要求，请求不会保留在浏览器历史记录中，请求不能被缓存，不能被收藏为书签。</p></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>*<a href="http://www.runoob.com/http/http-methods.html" target="_blank" rel="noopener">HTTP请求方法</a><br>*<a href="https://github.com/xuelangZF/CS_Offer/blob/master/Network/HTTP.md" target="_blank" rel="noopener">HTTP 协议基础</a><br>*<a href="http://www.w3school.com.cn/tags/html_ref_httpmethods.asp" target="_blank" rel="noopener">HTTP 方法：GET 对比 POST</a></p>]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
        <tag>协议</tag>
      </tags>
  </entry>
  <entry>
    <title>awk使用总结</title>
    <url>/awk%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>AWK是一款优秀的文本处理工具，Linux及类Unix环境中功能最强大的数据处理引擎之一。awk的衍生版本主要有nawk，gawk。linux系统下默认版本为gawk。</p><a id="more"></a><style>table th:nth-of-type(2){width:20%}nth-of-type(3){width:70%}</style><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><table><thead><tr><th align="left">短参数</th><th align="left">长参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">-F fs</td><td align="left">–field-separator=fs</td><td align="left">指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，如-F:</td></tr><tr><td align="left">-v var=val</td><td align="left">–assign=var=val</td><td align="left">赋值一个用户定义变量</td></tr><tr><td align="left">-f 脚本文件</td><td align="left">–file=脚本文件</td><td align="left">从脚本文件中读取awk命令</td></tr><tr><td align="left">-m[fr] val</td><td align="left">–</td><td align="left">对val值设置内在限制，-mf选项限制分配给val的最大块数目；-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用</td></tr><tr><td align="left">-W compat</td><td align="left">–compat</td><td align="left">在兼容模式下运行awk。所以gawk的行为和标准的awk完全一样，所有的awk扩展都被忽略</td></tr><tr><td align="left">-W traditional</td><td align="left">–traditional</td><td align="left">–</td></tr><tr><td align="left">-W posix</td><td align="left">–posix</td><td align="left">打开兼容模式。但有以下限制，不识别：/x、函数关键字、func、换码序列以及当fs是一个空格时，将新行作为一个域分隔符；操作符<strong>和</strong>=不能代替^和^=；fflush无效</td></tr><tr><td align="left">-W re-interval</td><td align="left">–re-interval</td><td align="left">允许间隔正则表达式的使用，参考(grep中的Posix字符类)，如括号表达式[[:alpha:]]</td></tr><tr><td align="left">-W source=program-text</td><td align="left">–source=program-text</td><td align="left">使用program-text作为源代码，可与-f命令混用</td></tr><tr><td align="left">-W lint[=fatal]</td><td align="left">–lint[=fatal]</td><td align="left">打印不能向传统unix平台移植的结构的警告</td></tr><tr><td align="left">-W lint-old</td><td align="left">–lint-old</td><td align="left">打印关于不能向传统unix平台移植的结构的警告</td></tr><tr><td align="left">-W help</td><td align="left">–help</td><td align="left">打印全部awk选项和每个选项的简短说明</td></tr><tr><td align="left">-W usage</td><td align="left">–usage</td><td align="left">–</td></tr><tr><td align="left">-W copyright</td><td align="left">–copyright</td><td align="left">打印简短的版权信息</td></tr><tr><td align="left">-W copyleft</td><td align="left">–copyleft</td><td align="left">–</td></tr><tr><td align="left">-W copyright</td><td align="left">–copyright</td><td align="left">–</td></tr><tr><td align="left">-W version</td><td align="left">–version</td><td align="left">打印bug报告信息的版本</td></tr></tbody></table><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:90%}</style><h1 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h1><h2 id="常见内置变量"><a href="#常见内置变量" class="headerlink" title="常见内置变量"></a>常见内置变量</h2><table><thead><tr><th align="left">变量</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">$n</td><td align="left">当前记录的第n个字段，字段间由FS分隔</td></tr><tr><td align="left">$0</td><td align="left">完整的输入记录</td></tr><tr><td align="left">NF</td><td align="left">一条记录的字段的数目</td></tr><tr><td align="left">FS</td><td align="left">字段分隔符(默认是任何空格)</td></tr><tr><td align="left">OFS</td><td align="left">输出记录分隔符（输出换行符），输出时用指定的符号代替换行符</td></tr><tr><td align="left">RS</td><td align="left">记录分隔符(默认是一个换行符)</td></tr><tr><td align="left">ORS</td><td align="left">输出记录分隔符(默认值是一个换行符)</td></tr><tr><td align="left">NR</td><td align="left">已经读出的记录数，就是行号，从1开始</td></tr><tr><td align="left">FNR</td><td align="left">各文件分别计数的行号</td></tr></tbody></table><h2 id="不常见内置变量"><a href="#不常见内置变量" class="headerlink" title="不常见内置变量"></a>不常见内置变量</h2><table><thead><tr><th align="left">变量</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">FILENAME</td><td align="left">当前文件名</td></tr><tr><td align="left">ARGC</td><td align="left">命令行参数的数目</td></tr><tr><td align="left">ARGV</td><td align="left">包含命令行参数的数组</td></tr><tr><td align="left">ARGIND</td><td align="left">命令行中当前文件的位置(从0开始算)</td></tr><tr><td align="left">FIELDWIDTHS</td><td align="left">字段宽度列表(用空格键分隔)</td></tr><tr><td align="left">IGNORECASE</td><td align="left">如果为真，则进行忽略大小写的匹配</td></tr><tr><td align="left">RLENGTH</td><td align="left">由match函数所匹配的字符串的长度</td></tr><tr><td align="left">RSTART</td><td align="left">由match函数所匹配的字符串的第一个位置</td></tr><tr><td align="left">CONVFMT</td><td align="left">数字转换格式(默认值为%.6g)ENVIRON环境变量关联数组</td></tr><tr><td align="left">OFMT</td><td align="left">数字的输出格式(默认值是%.6g)</td></tr><tr><td align="left">SUBSEP</td><td align="left">数组下标分隔符(默认值是/034)</td></tr><tr><td align="left">ERRNO</td><td align="left">最后一个系统错误的描述</td></tr></tbody></table><style>table th:nth-of-type(2){width:20%}nth-of-type(3){width:70%}</style><h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><table><thead><tr><th align="left">函数</th><th align="left">说明</th><th align="left">使用范例</th></tr></thead><tbody><tr><td align="left">sub(regexp, replacement [, target])</td><td align="left">匹配记录中最大、最靠左边的子字符串的正则表达式，并用替换字符串替换这些字符串。<br>如果没有指定目标字符串就默认使用整个记录。替换只发生在第一次匹配时</td><td align="left">awk ‘BEGIN { str = “water, water, everywhere”;sub(/at/, “ith”, str);print str}’</td></tr><tr><td align="left">gsub(regexp, replacement [, target])</td><td align="left">整个文档中进行匹配</td><td align="left">{ gsub(/Britain/, “United Kingdom”); print }</td></tr><tr><td align="left">index(in, find)</td><td align="left">返回子字符串第一次被匹配的位置，偏移量从位置1开始</td><td align="left">awk ‘BEGIN { print index(“peanut”, “an”) }’</td></tr><tr><td align="left">substr(string, start [, length ])</td><td align="left">返回从位置1开始的子字符串，如果指定长度超过实际长度，就返回整个字符串</td><td align="left">awk ‘BEGIN {string = “abcdef”;string = substr(string, 1, 2) “CDE” substr(string, 6);print string}’</td></tr><tr><td align="left">split(string, array [, fieldsep [, seps ] ])</td><td align="left">可按给定的分隔符把字符串分割为一个数组。<br>如果分隔符没提供，则按当前FS值进行分割</td><td align="left">split(“cul-de-sac”, a, “-“, seps)</td></tr><tr><td align="left">length([string])</td><td align="left">返回记录的字符数</td><td align="left">length(“abcde”)</td></tr><tr><td align="left">match(string, regexp [, array])</td><td align="left">返回在字符串中正则表达式位置的索引，如果找不到指定的正则表达式则返回0</td><td align="left">awk 'BEGIN {{if ($1 == "FIND") regex = $2; else { where = match($0, regex); if (where != 0) print "Match of", regex, "found at", where, "in", $0;}}}'</td></tr><tr><td align="left">toupper和tolower</td><td align="left">可用于字符串大小间的转换，该功能只在gawk中有效</td><td align="left">toupper(“MiXeD cAsE 123”); tolower(“MiXeD cAsE 123”);</td></tr><tr><td align="left">int(x)</td><td align="left">取整,直接舍弃小数点后的数字</td><td align="left">awk ‘BEGIN {print int(9999.99)}’</td></tr><tr><td align="left">rand()</td><td align="left">随机数，产生一个大于等于0而小于1的随机数</td><td align="left">awk ‘BEGIN {print rand()}’</td></tr></tbody></table><style>table th:nth-of-type(1){width:10%}nth-of-type(2){width:90%}</style><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><table><thead><tr><th align="left">运算符</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">&lt;<br>&lt;=<br>&gt;<br>&gt;=<br>!=<br>==</td><td align="left">关系运算符</td></tr><tr><td align="left">=<br>+=<br>-=<br><em>=<br>/=<br>%=<br>^=<br>*</em>=</td><td align="left">赋值</td></tr><tr><td align="left">&amp;&amp;</td><td align="left">逻辑与</td></tr><tr><td align="left">&#124;&#124;</td><td align="left">逻辑或</td></tr><tr><td align="left">+<br>-<br>!</td><td align="left">一元加<br>减<br>逻辑非</td></tr><tr><td align="left"><del>和</del>!</td><td align="left">匹配正则表达式和不匹配正则表达式</td></tr><tr><td align="left">?:</td><td align="left">C条件表达式</td></tr><tr><td align="left">空格</td><td align="left">连接</td></tr><tr><td align="left">$</td><td align="left">字段引用</td></tr><tr><td align="left">in</td><td align="left">数组成员</td></tr><tr><td align="left">+<br>-</td><td align="left">加<br>减</td></tr><tr><td align="left">*<br>/<br>&amp;</td><td align="left">乘<br>除<br>求余</td></tr><tr><td align="left">++<br>–</td><td align="left">增加<br>减少<br>作为前缀或后缀</td></tr></tbody></table><h1 id="awk正则"><a href="#awk正则" class="headerlink" title="awk正则"></a>awk正则</h1><table><thead><tr><th align="left">匹配符</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">\w</td><td align="left">匹配一个字母数字下划线任意组成的字符串</td></tr><tr><td align="left">\W</td><td align="left">匹配一个非字母数字下划线组成的字符串</td></tr><tr><td align="left">\s</td><td align="left">匹配任意空格类字符串，<code>[[:space:]]</code>的缩写</td></tr><tr><td align="left">\S</td><td align="left">匹配任意非空格类字符串，<code>[^[:space:]]</code>的缩写</td></tr><tr><td align="left">\y</td><td align="left">匹配一个单词开头或者末尾的空字符串。<code>eg: &#39;\yballs?\y&#39;</code> matches either ‘ball’ or ‘balls’, as a separate word.</td></tr><tr><td align="left">\B</td><td align="left">匹配单词内的空字符串，<code>eg：/\Brat\B/</code> matches’crate’</td></tr><tr><td align="left">&lt;</td><td align="left">匹配一个单词的开头的空字符串，锚定开始。<code>eg: /\&lt;away/</code> matches ‘away’ but not ‘stowaway’.</td></tr><tr><td align="left">&gt;</td><td align="left">匹配一个单词的末尾的空字符串，锚定末尾。<code>eg: /stow\&gt;/</code> matches ‘stow’ but not ‘stowaway’.</td></tr><tr><td align="left">`</td><td align="left">匹配字符串起始的一个空字符串</td></tr><tr><td align="left">&#39;</td><td align="left">匹配字符串末尾的一个空字符串</td></tr></tbody></table><h1 id="常用的format格式化输出"><a href="#常用的format格式化输出" class="headerlink" title="常用的format格式化输出"></a>常用的format格式化输出</h1><table><thead><tr><th align="left">符号</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">%s</td><td align="left">显示字符串</td></tr><tr><td align="left">%d, %i</td><td align="left">十进制整数</td></tr><tr><td align="left">%u</td><td align="left">无符号整数</td></tr><tr><td align="left">%f</td><td align="left">显示浮点数</td></tr><tr><td align="left">%g, %G</td><td align="left">以科学计数法的格式或浮点数的格式显示数值</td></tr><tr><td align="left">%e, %E</td><td align="left">科学计数法显示数值</td></tr><tr><td align="left">%c</td><td align="left">显示字符的ASCII码</td></tr><tr><td align="left">%%</td><td align="left">显示%自身</td></tr><tr><td align="left">修饰符:<code>N</code></td><td align="left">显示宽度</td></tr><tr><td align="left">修饰符:<code>-</code></td><td align="left">左对齐</td></tr><tr><td align="left">修饰符:<code>+</code></td><td align="left">显示数值符号</td></tr></tbody></table><h1 id="应用范例"><a href="#应用范例" class="headerlink" title="应用范例"></a>应用范例</h1><ul><li><p>格式化输出</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># echo 99 | awk &apos;BEGIN&#123; n=100 &#125;&#123; printf(&quot;%s %s &lt; &quot;n&quot;\n&quot;,$1,($1 &lt; n ? &quot;is&quot; : &quot;is not&quot;)) &#125;&apos;</span><br><span class="line">99 is &lt; 100</span><br><span class="line"># echo 199 | awk &apos;BEGIN&#123; n=100 &#125;&#123; printf(&quot;%s %s &lt; &quot;n&quot;\n&quot;,$1,($1 &lt; n ? &quot;is&quot; : &quot;is not&quot;)) &#125;&apos;</span><br><span class="line">199 is not &lt; 100</span><br></pre></td></tr></table></figure></li><li><p>使用正则，字符串匹配</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># awk &apos;$9 ~ /500/ &#123;print $1,$7&#125;&apos; nginx_access_log</span><br><span class="line"># awk &apos;$9 !~ /200/ &#123;print $1,$7&#125;&apos; nginx_access_log</span><br><span class="line"># awk &apos;!/200/ &#123;print $1,$7&#125;&apos; nginx_access_log</span><br></pre></td></tr></table></figure></li><li><p>if复合条件判断</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% raw %&#125;</span><br><span class="line">cat nginx_access_log |awk &apos;&#123;if($9!=&quot;\&quot;200\&quot;&quot; &amp;&amp; $9 != &quot;\&quot;304\&quot;&quot; &amp;&amp; $9 != &quot;\&quot;302\&quot;&quot; &amp;&amp; $9 != &quot;\&quot;403\&quot;&quot;) &#123;print $9&quot;:&quot;$11&quot;:&quot;$7&#125;&#125;&apos; |sort |uniq -c |sort -rn |head</span><br><span class="line">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用数组进行分类汇总</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% raw %&#125;</span><br><span class="line"># netstat -ant | awk &apos;/^tcp/ &#123;state[$NF]++&#125; END &#123;for(s in state)&#123;if(state[s]&gt;10)print s,state[s]&#125;&#125;&apos;</span><br><span class="line"># tail -n 1000 nginx_access_log| awk &apos;&#123;stat[$9]++&#125; END &#123;for(c in stat)&#123;if(c !~ 200)print c,stat[c]&#125;&#125;&apos;</span><br><span class="line">&#123;% endraw %&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">The GNU Awk User’s Guide</a></li><li><a href="http://awk.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">AWK程序设计语言</a></li><li><a href="https://my.oschina.net/jarly/blog/898144" target="_blank" rel="noopener">详解 awk 工具的使用方法</a></li><li><a href="http://linux.51yip.com/search/awk" target="_blank" rel="noopener">awk</a></li><li><a href="http://www.cnblogs.com/276815076/p/6410179.html" target="_blank" rel="noopener">Linux Awk使用案例总结（nginx日志统计，文件对比合并等）</a></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>awk</tag>
        <tag>文本处理</tag>
      </tags>
  </entry>
  <entry>
    <title>tmux窗口管理</title>
    <url>/tmux%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<p>工欲善其事必先利其器。。。</p><a id="more"></a><blockquote><p>对于tmux简单来说，一个会话里面可以有多个窗口，一个窗口里面可以有多个面板。</p></blockquote><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yum -y install tmux</span><br></pre></td></tr></table></figure><style>table th:nth-of-type(2){width:80%}</style><h1 id="会话（Session）"><a href="#会话（Session）" class="headerlink" title="会话（Session）"></a>会话（Session）</h1><h2 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h2><p>我们拿终端工具如：XShell、SecureCRT 等去连接正在运行的服务器的时候，每新建一个连接，就是一个新的会话。使用 Tmux 新建会话的时候，也是一样，一个新的会话就表示一个新的连接。</p><h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><ul><li>创建一个新的会话test1：tmux new -s sessionName</li><li>断开当前会话：tmux detach(快捷键：Ctrl+b+d)</li><li>进入之前的会话：tmux attach-session -t sessionName，简写：tmux a -t sessionName</li><li>关闭会话：tmux kill-session -t sessionName</li><li>查看所有会话：tmux list-session 简写：tmux ls（快捷键：Ctrl+b+s）</li><li>关闭所有会话：tmux kill-server</li><li>强制重载当前会话：（快捷键：Ctrl+b+r）</li><li>重新开启某一会话: tmux attach -t sessionName</li><li>切换到某一会话：tmux switch -t sessionName</li><li>重命名会话: tmux rename -t oldName newName</li></ul><h2 id="默认会话快捷键"><a href="#默认会话快捷键" class="headerlink" title="默认会话快捷键"></a>默认会话快捷键</h2><ul><li>列出所有快捷键：<code>Ctrl + b,?</code>，按q返回</li><li>脱离当前会话：<code>Ctrl + b,d</code>，输入tmux attach能够重新进入之前会话</li><li>选择并切换会话：<code>Ctrl + b,s</code></li><li>选择要脱离的会话：<code>Ctrl + b,D</code></li><li>挂起当前会话：<code>Ctrl + z</code></li><li>列出提示信息缓存：<code>Ctrl + b,~</code>，含tmux返回的各种提示信息</li><li>进入命令行模式：<code>Ctrl + b,:</code>，可输入tmux命令，如kill-server</li><li>复制模式：<code>Ctrl + b,[</code>，光标移动到复制内容位置，空格键开始，方向键选择复制，回车确认，q/Esc退出</li><li>粘贴模式：<code>Ctrl + b,]</code>，粘贴在复制模式中复制的内容，按q/Esc退出</li><li>显示当前的时间：<code>ctrl + b,t</code></li></ul><h1 id="窗口（Window）"><a href="#窗口（Window）" class="headerlink" title="窗口（Window）"></a>窗口（Window）</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>窗口：窗口的概念，可以类比于 Windows 里面的窗口的概念。<br>之前我们连服务器的时候，终端工具每次连接只有一个界面，当我们需要同时操作多个过程的时候，我们就需要建立新的连接。这样很不方便。<br>Tmux 里面的窗口的概念，就可以让我们在一个会话里有多个界面，就不需要去建立的一个会话。</p><h2 id="常用操作-1"><a href="#常用操作-1" class="headerlink" title="常用操作"></a>常用操作</h2><ul><li>创建一个新的窗口：<code>tmux new-window</code></li><li>列出所有窗口：<code>tmux list-windows</code></li><li>根据序列索引选择窗口 <code>tmux select-window -t :0-9</code></li><li>重命名当前窗口：<code>tmux rename-window</code></li></ul><h2 id="默认窗口快捷键"><a href="#默认窗口快捷键" class="headerlink" title="默认窗口快捷键"></a>默认窗口快捷键</h2><ul><li>创建新窗口：<code>Ctrl + b,c</code></li><li>关闭当前窗口：<code>Ctrl + b,&amp;</code></li><li>切换到指定窗口：<code>Ctrl + b,数字键</code></li><li>重命名当前窗口，便于识别：<code>Ctrl + b,,</code></li><li>修改当前窗口编号，相当于重新排序：<code>Ctrl + b,.</code></li><li>切换至上一窗口：<code>Ctrl + b,p</code></li><li>切换至下一窗口：<code>Ctrl + b,n</code></li><li>前后窗口间互相切换：<code>Ctrl + b,l</code></li><li>通过窗口列表切换窗口：<code>Ctrl + b,w</code></li><li>在所有窗口中查找关键词，便于窗口多了切换：<code>Ctrl + b,f</code></li></ul><h1 id="面板（Panel）"><a href="#面板（Panel）" class="headerlink" title="面板（Panel）"></a>面板（Panel）</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>面板是用于对界面的布局而言的。就是将一个界面划分为多个不同的区域，每个区域我们称之为一个面板</p><h2 id="常用操作-2"><a href="#常用操作-2" class="headerlink" title="常用操作"></a>常用操作</h2><ul><li>垂直切分窗口：<code>tmux split-window</code></li><li>水平切分窗口：<code>tmux split-window -h</code></li><li>在指定方向交换面板：<code>tmux swap-pane -[UDLR]</code></li><li>在指定方向选择下一个面板：<code>tmux select-pane -[UDLR]</code></li></ul><h2 id="默认面板快捷键"><a href="#默认面板快捷键" class="headerlink" title="默认面板快捷键"></a>默认面板快捷键</h2><ul><li>将当前面板上下分屏：<code>Ctrl + b,&quot;</code></li><li>将当前面板左右分屏：<code>Ctrl + b,%</code></li><li>选择当前窗口中下一个面板：<code>Ctrl + b,o</code></li><li>移动光标选择对应面板：<code>Ctrl + b,方向键</code></li><li>向前置换当前面板：<code>Ctrl + b,{</code></li><li>向后置换当前面板：<code>Ctrl + b,}</code></li><li>逆时针旋转当前窗口的面板：<code>Ctrl + b,Alt+o</code></li><li>顺时针旋转当前窗口的面板：<code>Ctrl + b,Ctrl+o</code></li><li>显示面板编号：<code>Ctrl + b,q</code></li><li>关闭当前分屏：<code>Ctrl + b,x</code></li><li>将当前面板置于新窗口,即新建一个窗口,其中仅包含当前面板：<code>Ctrl + b,!</code></li><li>以1个单元格为单位移动边缘以调整当前面板大小：<code>Ctrl + b,Ctrl+方向键</code></li><li>以5个单元格为单位移动边缘以调整当前面板大小：<code>Ctrl + b,Alt+方向键</code></li><li>切换默认面板布局：<code>Ctrl + b,空格键</code></li><li>最大化当前所在面板：<code>Ctrl + b,z</code>，tmux 1.8新特性</li></ul><h1 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h1><ul><li>列出所有tmux命令及其参数：<code>tmux list-commands</code></li><li>列出所有可以的快捷键和其运行的 tmux 命令：<code>tmux list-keys</code></li><li>流出所有的 session、window、pane、运行的进程号：<code>tmux info</code></li><li>变更配置文件后重新加载配置文件：<code>tmux source-file ~/.tmux.conf</code></li><li>重命名会话<code>tmux rename -t 原会话名 新会话名</code></li><li>会话间移动窗口：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">`Ctrl + b,:`  进入命令行模式;</span><br><span class="line">move-window -s 源会话名:窗口号 -t 目标会话名        //move-window可以简写为movew</span><br><span class="line">movew -d 源会话名:窗口号                            //将某个窗口移动到当前会话</span><br></pre></td></tr></table></figure></li><li>复制模式<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">`Ctrl+b	[`进入复制模式，按`q`退出</span><br><span class="line">按下`空格键`开始复制，移动光标选择复制区域</span><br><span class="line">按下`回车键`复制选中文本并退出复制模式</span><br><span class="line">按下`Ctrl+b	]`粘贴复制模式中复制的文本</span><br></pre></td></tr></table></figure><ul><li>复制模式中不接受键盘的字符输入，如果误入复制模式，可以直接按<code>q</code>键退出复制模式。</li><li>另外复制模式中可以上翻查看在普通模式下无法查看的屏幕输出内容。</li></ul></li></ul><ul><li>窗口自动调整大小问题<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> tmux默认会同步同一个会话的操作到所有会话连接的终端窗口中，这种同步机制，限制了窗口的大小为最小的会话连接。</span><br><span class="line"> 为了避免窗口自动调整大小，终端剩余空间填充小圆点可以执行</span><br><span class="line"> tmux a -d</span><br><span class="line">或在会话命令行模式下执行</span><br><span class="line">: a -d</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>调整窗口排序顺序</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">命令行模式下</span><br><span class="line">swap-window -s 1 -t 2  交换1、2窗口</span><br><span class="line">swap-window -t 1       当前窗口和1号窗口交换</span><br><span class="line">move-window -t 1       将当前窗口移动到1号窗口位置</span><br></pre></td></tr></table></figure></li><li><p>终端类型与配色方案</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ncurses库包名</span><br><span class="line">    CentOS 5:</span><br><span class="line">    ncurses-5.5-24.20060715</span><br><span class="line">    CentOS 6/7:</span><br><span class="line">    ncurses-base-5.9-13.20130511.el7.noarch</span><br><span class="line">文件路径</span><br><span class="line">    /usr/share/terminfo/</span><br><span class="line">    eg:</span><br><span class="line">    /usr/share/terminfo/s/screen-256color</span><br><span class="line">    /usr/share/terminfo/x/xterm-256color</span><br><span class="line">终端配置</span><br><span class="line">    echo $TERM</span><br><span class="line">    echo $TERMINFO</span><br><span class="line">    export TERM=screen-256color</span><br><span class="line">    export TERM=xterm</span><br><span class="line">    export TERMINFO=/user/share/terminfo</span><br><span class="line">tmux 临时设置默认终端类型</span><br><span class="line">    set -g default-terminal &quot;xterm&quot;</span><br><span class="line">当终端不支持screen-256color，vim编辑文件报错时，将TERM修改为xterm</span><br><span class="line">    # echo $TERM</span><br><span class="line">    screen-256color</span><br><span class="line">    export TERM=xterm</span><br><span class="line">备注：</span><br><span class="line">    vim ~/.tmux.conf</span><br><span class="line">    必须设置成</span><br><span class="line">    set -g default-terminal &quot;screen-256color&quot;</span><br><span class="line">    不能设置成</span><br><span class="line">    set -g default-terminal &quot;xterm-256color&quot;</span><br><span class="line">    否则tmux新开的窗口中默认的$TERM就是xterm-256color，</span><br><span class="line">    开启omnitty 会有阴影，显示会有问题。也可以手动修改窗口中的$TERM环境变量消除阴影。</span><br></pre></td></tr></table></figure></li><li><p>screen-256color和xterm-256color的区别？</p></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://linuxwiki.github.io/ProductivityTools/tmux.html" target="_blank" rel="noopener">tmux wiki</a></li><li><a href="http://louiszhai.github.io/2017/09/30/tmux/#Tmux%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4" target="_blank" rel="noopener">Tmux使用手册</a></li><li><a href="https://linux.cn/blog-17704-5941.html" target="_blank" rel="noopener">linux term</a></li><li><a href="http://www.kbase101.com/question/26581.html" target="_blank" rel="noopener">zsh：在tmux中设置TERM = screen-256color，但在没有tmux的情况下设置xterm-256color</a></li><li><a href="https://better-coding.com/solved-xterm-256color-unknown-terminal-type/" target="_blank" rel="noopener">xterm-256color’: unknown terminal type.</a></li><li><a href="https://wiki.archlinux.org/index.php/GNU_Screen_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E4%BD%BF%E7%94%A8_256_%E8%89%B2" target="_blank" rel="noopener">GNU Screen</a></li></ul>]]></content>
      <categories>
        <category>tmux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>tmux</tag>
      </tags>
  </entry>
  <entry>
    <title>MediaWiki常见问题汇总</title>
    <url>/mediawiki%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<p>MediaWiki是一个非常成熟完善的文档框架，也许是因为太过成熟，官方给出的文档太过全面，一些问题就连google都很难搜出有效信息。</p><a id="more"></a><h1 id="登录问题"><a href="#登录问题" class="headerlink" title="登录问题"></a>登录问题</h1><ul><li><p>问题现象：</p><ul><li><p>现象描述：</p><ul><li><p>登录时报错：似乎您的登录会话有问题；为了防止会话劫持，这个操作已经被取消。请返回先前的页面，重新载入这个页面，然后重试。</p><ul><li>从服务器端看session文件写入为空，但是session配置、权限等都没有问题。报错如下图：</li></ul><p><img src="http://www.lengyuewusheng.com/assets/images/00025-01.png" alt="登录报错"></p></li></ul></li><li><p>解决方案：该问题一般是由于php 序列化导致，多数情况是由于服务器端环境缺少apcu扩展。</p></li></ul></li></ul><h1 id="访问问题"><a href="#访问问题" class="headerlink" title="访问问题"></a>访问问题</h1><ul><li><p>问题现象：</p><ul><li><p>访问直接报错：Exception encountered, of type “InvalidArgumentException”</p></li><li><p>无任何其它的nginx或php层面的报错日志输出</p></li></ul></li><li><p>解决方案：MediaWiki要求服务器端php环境默认关闭session.auto_start属性，因此php.ini配置文件中session.auto_start = 0 即可。</p></li></ul>]]></content>
      <categories>
        <category>MediaWiki</category>
        <category>填坑指南</category>
      </categories>
      <tags>
        <tag>MediaWiki</tag>
      </tags>
  </entry>
  <entry>
    <title>腾讯云虚机自动挂载数据盘脚本</title>
    <url>/%E8%85%BE%E8%AE%AF%E4%BA%91%E8%99%9A%E6%9C%BA%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>把之前在腾讯云上部署环境过程中遇到的可以抽象摘取出来的固定逻辑，稍加整理供大家参考。</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> Usage()</span><br><span class="line">&#123;</span><br><span class="line">cat &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    sh <span class="variable">$0</span></span><br><span class="line">    sh <span class="variable">$0</span> -d MOUNTDIRECTORY</span><br><span class="line">    sh <span class="variable">$0</span> -h|--<span class="built_in">help</span></span><br><span class="line">    </span><br><span class="line">Options:</span><br><span class="line">    -d|--MountDirectory &#123;eg:/data&#125;:     Mount directory.</span><br><span class="line">    -h|--<span class="built_in">help</span>:  Show <span class="built_in">help</span>.</span><br><span class="line">    </span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">OPTS=$(getopt -o d:h -a --long <span class="built_in">help</span>,MountDirectory: -n <span class="string">'warning'</span> -- <span class="string">"<span class="variable">$@</span>"</span>)</span><br><span class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">"<span class="variable">$OPTS</span>"</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">        -d|--MountDirectory) MountDirectory=<span class="variable">$2</span>; <span class="built_in">shift</span> 2 ;;</span><br><span class="line">        -h|--<span class="built_in">help</span>) Usage; <span class="built_in">shift</span>; <span class="built_in">exit</span> 0 ;;</span><br><span class="line">        --) <span class="built_in">shift</span>; <span class="built_in">break</span> ;;</span><br><span class="line">        *) <span class="built_in">echo</span> -e <span class="string">"\nParameter error.\n"</span>; Usage; <span class="built_in">exit</span> 1 ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> disk_mount()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> [ -b /dev/vdb ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">"\033[32m<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span> \tfdisk /dev/vdb \033[0m"</span></span><br><span class="line">		fdisk /dev/vdb 1&gt;/dev/null &lt;&lt; EOF</span><br><span class="line">n</span><br><span class="line">p</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wq</span><br><span class="line">EOF</span><br><span class="line">		<span class="built_in">wait</span></span><br><span class="line">		<span class="keyword">if</span> [ -b /dev/vdb1 ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> -e <span class="string">"\033[32m<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t mkfs.ext4 /dev/vdb1 \033[0m"</span></span><br><span class="line">			mkfs.ext4 /dev/vdb1 1&gt;/dev/null</span><br><span class="line">			sleep 3</span><br><span class="line">			<span class="built_in">echo</span> -e <span class="string">"\033[32m<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t mounting -a \033[0m"</span></span><br><span class="line">			mkdir -p <span class="variable">$&#123;MountDirectory&#125;</span></span><br><span class="line">			<span class="keyword">if</span> ! grep <span class="string">"<span class="variable">$&#123;MountDirectory&#125;</span>"</span> /etc/fstab &gt;/dev/null 2&gt;&amp;1 ; <span class="keyword">then</span></span><br><span class="line">				<span class="built_in">echo</span> -e <span class="string">"/dev/disk/by-uuid/<span class="variable">$(ls -l /dev/disk/by-uuid/ |grep vdb1 |awk '&#123;print $9&#125;')</span>     <span class="variable">$&#123;MountDirectory&#125;</span>	ext4	defaults,nofail 0 2"</span> &gt;&gt;/etc/fstab &amp;&amp; mount -a</span><br><span class="line">			    <span class="built_in">echo</span> -e <span class="string">"\033[32m<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t Finished. \033[0m"</span></span><br><span class="line">                df -h |grep <span class="string">"<span class="variable">$&#123;MountDirectory&#125;</span>"</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">echo</span> -e <span class="string">"\033[31m /etc/fstab record has already existed. \033[0m"</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> -e <span class="string">"\033[31m fdisk failed. \033[0m"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\033[31m/dev/vdb does not exist. \033[0m"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    MountDirectory=<span class="string">"<span class="variable">$(echo "$&#123;MountDirectory&#125;" |grep -Po '^/(\w+/)</span>*\w+')"</span></span><br><span class="line">    [ -z <span class="string">"<span class="variable">$&#123;MountDirectory&#125;</span>"</span> ] &amp;&amp; MountDirectory=/tencentCloud/data;</span><br><span class="line">    disk_mount</span><br><span class="line">&#125;</span><br><span class="line">main</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>脚本</tag>
        <tag>腾讯云</tag>
      </tags>
  </entry>
  <entry>
    <title>MediaWiki导航菜单设置</title>
    <url>/mediawiki%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95%E8%AE%BE%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="侧边栏导航-MediaWiki-Sidebar"><a href="#侧边栏导航-MediaWiki-Sidebar" class="headerlink" title="侧边栏导航(MediaWiki:Sidebar)"></a>侧边栏导航(MediaWiki:Sidebar)</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* CATEGORY-SIDEBAR</span><br><span class="line">* navigation</span><br><span class="line">** mainpage|mainpage-description</span><br><span class="line">** recentchanges-url|recentchanges</span><br><span class="line">** randompage-url|randompage</span><br><span class="line">** helppage|help</span><br><span class="line"></span><br><span class="line">*  自定义一级导航1</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航1</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航2</span><br><span class="line">*  自定义一级导航2</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航1</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航2</span><br><span class="line">*  自定义一级导航3</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航1</span><br><span class="line">** http://www.lengyuewusheng.com/ |自定义二级级导航2</span><br><span class="line"></span><br><span class="line">* SEARCH</span><br><span class="line">* TOOLBOX</span><br><span class="line">* LANGUAGES</span><br></pre></td></tr></table></figure><h1 id="右侧悬浮目录"><a href="#右侧悬浮目录" class="headerlink" title="右侧悬浮目录"></a>右侧悬浮目录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Common.css</span><br><span class="line">/* 放置于这里的CSS将应用于所有皮肤 */</span><br><span class="line">#toc&#123;</span><br><span class="line"> display: block;</span><br><span class="line"> position: fixed;</span><br><span class="line"> top: 100px;</span><br><span class="line"> right: 0px;</span><br><span class="line"> min-width: 200px;</span><br><span class="line"> max-width: 350px;</span><br><span class="line"> max-height: 10px;</span><br><span class="line"> overflow-y: scroll;</span><br><span class="line"> border: 1px solid #aaa;</span><br><span class="line"> border-radius: 0 0 1px 1px;</span><br><span class="line"> -moz-border-radius: 0 0 1px 1px;</span><br><span class="line"> background: rgba(249,249,249,0.75);</span><br><span class="line"> padding: 12px;</span><br><span class="line"> box-shadow: 0 1px 8px #000;</span><br><span class="line"> -webkit-box-shadow: 0 1px 8px #000;</span><br><span class="line"> -moz-box-shadow: 0 1px 8px #000;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">#toc:hover&#123;</span><br><span class="line"> display: block;</span><br><span class="line"> position: fixed;</span><br><span class="line"> top: 100px;</span><br><span class="line"> right: 0px;</span><br><span class="line"> min-width: 200px;</span><br><span class="line"> max-width: 350px;</span><br><span class="line"> max-height: 100px;</span><br><span class="line"> max-height: 600px;</span><br><span class="line"> overflow-y: scroll;</span><br><span class="line"> border: 1px solid #aaa;</span><br><span class="line"> border-radius: 0 0 1px 1px;</span><br><span class="line"> -moz-border-radius: 0 0 1px 1px;</span><br><span class="line"> background: rgba(249,249,249,0.75);</span><br><span class="line"> padding: 12px;</span><br><span class="line"> box-shadow: 0 1px 8px #000;</span><br><span class="line"> -webkit-box-shadow: 0 1px 8px #000;</span><br><span class="line"> -moz-box-shadow: 0 1px 8px #000;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">body &#123; overflow-x: hidden;&#125;</span><br><span class="line"></span><br><span class="line">/*Extension:TreeAndMenu*/</span><br><span class="line">.fancytree ul &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 12px;</span><br><span class="line">&#125;</span><br><span class="line">ul.fancytree-container &#123;</span><br><span class="line">    outline: 0;</span><br><span class="line">    border: none;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.fancytree p &#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line">span.fancytree-title &#123;</span><br><span class="line">    cursor: default;</span><br><span class="line">&#125;</span><br><span class="line">span.fancytree-title a &#123;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://codex.wordpress.org.cn/Mediawiki%E4%BF%AE%E6%94%B9%E5%B7%A6%E4%BE%A7%E5%AF%BC%E8%88%AA%E6%9D%A1" target="_blank" rel="noopener">Mediawiki修改左侧导航条</a></li><li><a href="https://wiki.ling2.cn/index.php/MediaWiki-%E7%9B%AE%E5%BD%95%E6%82%AC%E6%B5%AE%2B%E9%9A%90%E8%97%8F" target="_blank" rel="noopener">MediaWiki-目录悬浮+隐藏</a></li></ul>]]></content>
      <categories>
        <category>MediaWiki</category>
      </categories>
      <tags>
        <tag>MediaWiki</tag>
        <tag>开源工具</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux系统中的IO模式</title>
    <url>/linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84io%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h1 id="一次IO的两个阶段："><a href="#一次IO的两个阶段：" class="headerlink" title="一次IO的两个阶段："></a>一次IO的两个阶段：</h1><ul><li>Waiting for the data to be ready(等待数据到达内核缓冲区)；</li><li>Copying the data from the kernel to the process(从内核缓冲区拷贝数据到程序缓冲区)）</li></ul><style>table th:nth-of-type(2){width:80%}</style><h1 id="IO模式"><a href="#IO模式" class="headerlink" title="IO模式"></a>IO模式</h1><table><thead><tr><th align="left">模式</th><th align="left">特点</th></tr></thead><tbody><tr><td align="left">阻塞 I/O（blocking IO）</td><td align="left">在IO执行的两个阶段都处于blocked（阻塞）状态</td></tr><tr><td align="left">非阻塞 I/O（nonblocking IO）</td><td align="left">用户进程需要不断的主动询问kernel数据，相当于copy data from kernel to user)依然处于一个阻塞状态</td></tr><tr><td align="left">I/O 多路复用（ IO multiplexing）</td><td align="left">两个阶段的都是阻塞状态，但是可以同时监听多个文件描述符。</td></tr><tr><td align="left">信号驱动 I/O（ signal driven IO）</td><td align="left">在实机生产环境中并不常用</td></tr><tr><td align="left">异步 I/O（asynchronous IO）</td><td align="left">相比信号驱动IO，异步IO两个阶段都是非阻塞的</td></tr></tbody></table><ul><li>阻塞式IO(默认)，非阻塞式IO(nonblock)，IO复用(select/poll/epoll)，signal driven IO(信号驱动IO)都是属于同步型IO。</li></ul><h1 id="IO多路复用的机制"><a href="#IO多路复用的机制" class="headerlink" title="IO多路复用的机制"></a>IO多路复用的机制</h1><table><thead><tr><th align="left">机制</th><th align="left">特点</th></tr></thead><tbody><tr><td align="left">select</td><td align="left">良好跨平台支持,单个进程能够监视的文件描述符的数量存在最大限制，在Linux上一般为1024</td></tr><tr><td align="left">poll</td><td align="left">pollfd并没有最大数量限制（但是数量过大后性能也是会下降）。 和select函数一样，poll返回后，需要轮询pollfd来获取就绪的描述符。</td></tr><tr><td align="left">epoll</td><td align="left">Linux系统专有，在2.6内核中新增。更加灵活，没有描述符限制。epoll使用一个文件描述符管理多个描述符，将用户关系的文件描述符的事件存放到内核的一个事件表中，这样在用户空间和内核空间的copy只需一次。</td></tr></tbody></table><ul><li>select和poll都需要在返回后，通过遍历文件描述符来获取已经就绪的socket。事实上，同时连接的大量客户端在一时刻可能只有很少的处于就绪状态，因此随着监视的描述符数量的增长，其效率也会线性下降。</li><li>select，poll，epoll本质上都是同步I/O，因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的，而异步I/O则无需自己负责进行读写，异步I/O的实现会负责把数据从内核拷贝到用户空间。</li></ul><h1 id="epoll的两种模式"><a href="#epoll的两种模式" class="headerlink" title="epoll的两种模式"></a>epoll的两种模式</h1><ul><li>边缘触发(ET:edge-triggered):是高速工作模式，只支持no-block socket，当状态有变化或发生了某种事件就发出通知；</li><li>水平触发(LT:level triggered):是默认的工作方式，同时支持block和no-block socket，当处于某种状态或具备某种条件就发出通知；</li><li>ET和LT的区别：LT事件不会丢弃，只要读buffer里面有数据可以让用户读，则会不断通知你。而ET则只在事件发生之时通知。</li></ul><h1 id="epoll优点"><a href="#epoll优点" class="headerlink" title="epoll优点"></a>epoll优点</h1><ul><li>当检查大量的文件描述符时，epoll的性能延展性比select和poll高很多；</li><li>epoll API既支持水平触发也支持边缘触发，select和poll只支持水平触发，信号驱动只支持边缘触发；</li><li>性能方面，epoll可以避免复杂的信号处理流程；</li><li>灵活性高，可以指定我们希望检查的事件类型。</li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.ywnds.com/?p=10504" target="_blank" rel="noopener">Linux五种IO模型浅谈</a><br><a href="https://segmentfault.com/a/1190000003063859" target="_blank" rel="noopener">Linux IO模式及 select、poll、epoll详解</a></p>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>C10K问题</title>
    <url>/c10k%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h1 id="维基百科描述"><a href="#维基百科描述" class="headerlink" title="维基百科描述"></a>维基百科描述</h1><blockquote><p>The C10k problem is the problem of optimising network sockets to handle a large number of clients at the same time. The name C10k is a numeronym for concurrently handling ten thousand connections. Note that concurrent connections are not the same as requests per second, though they are similar: handling many requests per second requires high throughput (processing them quickly), while high number of concurrent connections requires efficient scheduling of connections. In other words, handling many requests per second is concerned with the speed of handling requests, whereas a system capable of handling a high number of concurrent connections does not necessarily have to be a fast system, only one where each request will deterministically return a response within a (not necessarily fixed) finite amount of time.</p><p>The problem of socket server optimisation has been studied because a number of factors must be considered to allow a web server to support many clients. This can involve a combination of operating system constraints and web server software limitations. According to the scope of services to be made available and the capabilities of the operating system as well as hardware considerations such as multi-processing capabilities, a multi-threading model or a single threading model can be preferred. Concurrently with this aspect, which involves considerations regarding memory management (usually operating system related), strategies implied relate to the very diverse aspects of the I/O management.</p></blockquote><h1 id="简单概括"><a href="#简单概括" class="headerlink" title="简单概括"></a>简单概括</h1><p>Web2.0时代，由于互联网用户的快速增长，以及应用程序的日趋复杂。最初的服务器都是基于进程/线程模型的，新到来一个TCP连接，就需要分配1个进程或线程。一台机器的资源有限，无法创建很多进程。C10K就要创建1万个进程，操作系统会出现效率低下或崩溃的情况。</p><h1 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h1><blockquote><p>FreeBSD推出了kqueue</p><p>Linux推出了epoll</p><p>Windows推出了IOCP</p></blockquote><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="http://rango.swoole.com/archives/381" target="_blank" rel="noopener">http://rango.swoole.com/archives/381</a></li><li><a href="http://www.52im.net/thread-566-1-1.html" target="_blank" rel="noopener">http://www.52im.net/thread-566-1-1.html</a></li><li><a href="http://www.52im.net/thread-578-1-1.html" target="_blank" rel="noopener">http://www.52im.net/thread-578-1-1.html</a></li><li><a href="https://segmentfault.com/a/1190000007240744" target="_blank" rel="noopener">https://segmentfault.com/a/1190000007240744</a></li></ul>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>性能</tag>
      </tags>
  </entry>
  <entry>
    <title>基于生产环境的仿真流量测试</title>
    <url>/%E5%9F%BA%E4%BA%8E%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%9A%84%E4%BB%BF%E7%9C%9F%E6%B5%81%E9%87%8F%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>虽然业界的Web应用测试工具众多，但多数是基于压力的离线测试，很多时候很难发现所有问题，往往测试上线后依然存在各种问题。基于实际生产环境的仿真流量测试，无疑能够覆盖更多的问题，达到更好的测试效果。<br>以下介绍三种实现仿真流量测试环境的实现工具。</p><a id="more"></a><h1 id="goreplay"><a href="#goreplay" class="headerlink" title="goreplay"></a>goreplay</h1><ul><li><p>源码下载</p><p><a href="https://github.com/buger/goreplay.git" target="_blank" rel="noopener">下载</a></p></li><li><p>文档</p><p><a href="https://github.com/buger/goreplay/wiki" target="_blank" rel="noopener">GitHubWiki</a></p></li><li><p>特点</p><ul><li>Go语言编写</li><li>功能强大，简单易用</li><li>资源消耗少</li></ul></li></ul><ul><li>简单用例<ul><li>将本地8080端口流量复制到 10.0.0.2 的80端口<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./goreplay --http-original-host --input-raw :8080 --input-raw-realip-header &quot;X-Real-IP&quot; --output-http &quot;http://10.0.0.2:80&quot; --exit-after 259200s</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="Tcpcopy"><a href="#Tcpcopy" class="headerlink" title="Tcpcopy"></a>Tcpcopy</h1><ul><li><p>源码下载</p><p><a href="https://github.com/session-replay-tools/tcpcopy.git" target="_blank" rel="noopener">Tcpcopy</a></p><p><a href="https://github.com/session-replay-tools/intercept.git" target="_blank" rel="noopener">intercept</a></p></li><li><p>文档</p><p><a href="https://github.com/session-replay-tools/tcpcopy" target="_blank" rel="noopener">GitHub·READEME</a></p></li><li><p>特点</p><ul><li>C语言编写</li><li>使用复杂</li><li>依赖root权限或CAP_NET_RAW capability(e.g. setcap CAP_NET_RAW=ep tcpcopy)</li><li>依赖于 assistant server的intercept截获应答</li></ul></li></ul><ul><li>简单用例<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10.0.0.1 生产环境</span><br><span class="line">10.0.0.2 测试环境</span><br><span class="line">10.0.0.3 assistant server</span><br></pre></td></tr></table></figure><ul><li>生产环境<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./tcpcopy -x 8080-10.0.0.2:80 -s 10.0.0.3 -d -n2</span><br><span class="line"># 将生产环境本地8080端口流量放大2倍复制到10.0.0.2的80端口，并指定10.0.0.3为assistant server</span><br></pre></td></tr></table></figure></li><li>测试服务器（10.0.0.2）上添加路由<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">route add -net 10.0.0.0 netmask 255.255.255.0 gw 10.0.0.3</span><br><span class="line">或：</span><br><span class="line">route add -host 10.0.0.1 gw 10.0.0.3</span><br></pre></td></tr></table></figure></li><li>assistant server<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./intercept -i eth0 -F ‘tcp and src port 80’ -d</span><br><span class="line"># assistant server的intercept捕获eth0网卡的80端口的响应包</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="ngx-http-mirror-module"><a href="#ngx-http-mirror-module" class="headerlink" title="ngx_http_mirror_module"></a>ngx_http_mirror_module</h1><p>mirror模块默认开启，编译时加–without-http_mirror_module参数可禁用此功能。</p><ul><li><p>版本</p><p>Nginx 1.13.4 +</p></li><li><p>作用域</p><p>http, server, location</p><p>mirror 模块配置分为两部分：源地址和镜像地址配置。</p></li><li><p>简单用例配置</p></li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># original配置</span><br><span class="line">location / &#123;</span><br><span class="line">    mirror /mirror;</span><br><span class="line">    mirror /mirror2;</span><br><span class="line">    mirror_request_body off; //是否镜像请求Body部分</span><br><span class="line">    proxy_pass http://prod.env:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># mirror配置  //mirror不会输出http返回内容</span><br><span class="line">location /mirror &#123;</span><br><span class="line">    internal;       //指定此location只能被内部的请求调用，外部的调用请求会返回404</span><br><span class="line">    proxy_pass http://test.env:8000$request_uri;   //指定上游Server的地址</span><br><span class="line">    proxy_set_header X-Original-URI $request_uri;  //镜像流量的头部</span><br><span class="line">&#125;</span><br><span class="line">location /mirror2 &#123;</span><br><span class="line">    internal;</span><br><span class="line">    proxy_pass http://test2.env:8000$request_uri;</span><br><span class="line">    proxy_set_header X-Original-URI $request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>测试</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>仿真测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux系统中的tmpfs、/dev/shm、tmp以及共享内存机制</title>
    <url>/linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84tmpfs%E3%80%81-dev-shm%E3%80%81tmp%E4%BB%A5%E5%8F%8A%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<p>共享内存允许两个或更多进程访问同一块内存。</p><a id="more"></a><h1 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h1><p>tmpfs一种基于内存的临时文件系统，tmpfs可以使用RAM，但它也可以使用swap分区来存储。传统的ramdisk是个块设备，要用mkfs来格式化它，才能真正地使用它；tmpfs是一个文件系统，并不是块设备，安装即可以使用。tmpfs是最好的基于RAM的文件系统。</p><ul><li>特征：<ul><li>动态文件系统大小</li><li>存取速度快</li></ul></li></ul><h1 id="dev-shm"><a href="#dev-shm" class="headerlink" title="/dev/shm"></a>/dev/shm</h1><p>是利用内存虚拟出来的磁盘空间。通常是内存空间大小的一半，该目录下创建的文件存取速度优于普通硬盘挂载的目录下的文件，该目录下的文件在机器重启时会丢失。</p><h1 id="tmp目录"><a href="#tmp目录" class="headerlink" title="/tmp目录"></a>/tmp目录</h1><p>存放临时文件的目录。由于通常/dev/shm挂载在/tmp目录下，该目录会被不同用户读写，因此<strong>该目录的权限建议设置成777</strong>。<br>之前就在生产环境中遇到过/tmp目录权限被旁路流程误修改为755，导致普通用户启动的C++的应用无法写入共享内存，导致线上服务异常的惨痛教训。希望大家吸取教训。<br>这种目录权限导致的问题，恢复较为容易，但是定位问题原因较为复杂，由于之前的代码中没有调试逻辑，出现问题时，开发临时新上了一版代码增加了详细的错误输出，最后才定位到共享内存写入失败导致，此过程花费相对较长的时间。</p><ul><li>文件系统挂载关系<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat /etc/fstab |egrep &quot;tmp|shm&quot;</span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        0 0</span><br><span class="line">/dev/shm                /tmp                    none    rw,bind         0 0</span><br></pre></td></tr></table></figure></li></ul><h1 id="Linux的两种共享内存机制"><a href="#Linux的两种共享内存机制" class="headerlink" title="Linux的两种共享内存机制:"></a>Linux的两种共享内存机制:</h1><ul><li>POSIX共享内存(结合内存映射mmap使用)<ul><li>mmap映射的内存是非持久化的，随着进程关闭，映射会随即失效。</li><li>mmap内存映射机制标准的系统调用，分为：<ul><li>匿名映射</li><li>文件映射，又分为：<ul><li>MAP_PRIVATE</li><li>MAP_SHARED</li></ul></li></ul></li></ul></li><li>System V共享内存(经典方案)<ul><li>sysv shm是持久化的，除非被进程明确的删除，否则在系统关机前始终存在于内存中。</li></ul></li></ul><p>虽然System V与POSIX共享内存都是通过tmpfs实现，但由于内核在mount tmpfs时，指定了MS_NOUSER，所以该tmpfs没有大小限制。因此/proc/sys/kernel/shmmax只会限制System V共享内存，/dev/shm只限制Posix共享内存,默认是物理内存的一半。</p><ul><li><p>System V共享内存的最大值</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat /proc/sys/kernel/shmmax</span><br><span class="line">68719476736</span><br></pre></td></tr></table></figure></li><li><p>/dev/shm空间大小设定</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount -t tmpfs -o size=2G tmpfs -o remount /dev/shm</span><br></pre></td></tr></table></figure></li></ul><h1 id="修改tmpfs大小"><a href="#修改tmpfs大小" class="headerlink" title="修改tmpfs大小"></a>修改tmpfs大小</h1><ul><li><p>/etc/fstab 字段介绍</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/etc/fstab</span><br><span class="line"># &lt;file system&gt;            &lt;dir&gt;                        &lt;type&gt;    &lt;options&gt;             &lt;dump&gt; &lt;pass&gt;</span><br></pre></td></tr></table></figure><ul><li>file system: 要挂载的分区或存储设备</li><li>dir: file systems的挂载位置</li><li>type: 要挂载设备或是分区的文件系统类型<ul><li>ext2, ext3, ext4, reiserfs, xfs, jfs, smbfs, iso9660, vfat, ntfs, swap 及 auto</li></ul></li><li>options: 挂载时使用的参数<ul><li>defaults</li></ul></li><li>dump: dump工具通过它决定何时作备份<ul><li>0和1,0表示忽略，1则进行备份。大部分的用户是没有安装 dump 的，对他们而言<dump>应设为 0。</dump></li></ul></li><li>pass fsck 读取 pass的数值来决定需要检查的文件系统的检查顺序。允许的数字是0,1,和2。<ul><li>根目录应当获得最高的优先权 1,</li><li>其它所有需要被检查的设备设置为 2.</li><li>0表示设备不会被 fsck 所检查。</li></ul></li></ul></li><li><p>centos5修改tmpfs大小</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /etc/fstab</span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        0 0            //修改这行不起作用</span><br><span class="line">/dev/shm                /tmp                    none    rw,bind,size=55g         0 0</span><br></pre></td></tr></table></figure></li><li><p>centos6/7修改tmpfs大小</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /etc/fstab</span><br><span class="line">tmpfs       /dev/shm      tmpfs   defaults,size=30g        0 0</span><br><span class="line">/dev/shm    /tmp          none     rw,bind                 0 0    // 修改这行不起作用</span><br></pre></td></tr></table></figure></li><li><p>挂载命令</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mount -a        //加载文件&quot;/etc/fstab&quot;中描述的所有文件系统。</span><br><span class="line">mount -o remount /dev/shm   //重新加载设备</span><br></pre></td></tr></table></figure><ul><li>要直接执行 mount -a 命令，因为可能造成无法访问当前目录中的文件（比如你应该保证 lockfiles 的正常存在）。</li><li>然而，如果它们都是空的，那么就可以直接执行 mount -a 而不必重启电脑。</li><li>应用更改后，可以通过 findmnt 检查是否生效：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">findmnt --target /tmp</span><br></pre></td></tr></table></figure></li><li>tmpfs 可以设置成比物理内存大，但是只能存储小于物理内存空间的数据，之后会出现登录掉线等异常.</li></ul></li></ul>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>共享内存</tag>
      </tags>
  </entry>
  <entry>
    <title>存储空间计算</title>
    <url>/%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<p>最基础的知识往往是最容易被忽略的点，放低姿态，夯实基础，才能行稳致远。</p><a id="more"></a><h1 id="存储空间单位换算"><a href="#存储空间单位换算" class="headerlink" title="存储空间单位换算"></a>存储空间单位换算</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 B = 8 bit</span><br><span class="line">1 KB = 1024 B = 8192 bit</span><br><span class="line">1 MB = 1024 KB = 1048576 B = 8388608 bit</span><br><span class="line">1 GB = 1024 MB = 1048576 KB = 1073741824 B = 8589934592 bit</span><br><span class="line">1 TB = 1024 GB = 1048576 MB = 1073741824 KB = 1099511627776 B = 8796093022208 bit</span><br><span class="line">1 PB = 1024 TB = 1048576 GB = 1073741824 MB = 1099511627776 KB = 1125899906842624 B = 9007199254740992 bit</span><br><span class="line">1 EB = 1024 PB = 1048576 TB = 1073741824 GB = 1099511627776 MB = 1125899906842624 KB = 1.152921504606847e+18 B = 9.223372036854776e+18 bit</span><br></pre></td></tr></table></figure><h1 id="ASCII编码"><a href="#ASCII编码" class="headerlink" title="ASCII编码"></a>ASCII编码</h1><ul><li>一个ASCII码占一个字节</li><li>一个英文字母占一个字节</li><li>一个中文汉字占两个字节</li></ul><h1 id="UTF-8编码"><a href="#UTF-8编码" class="headerlink" title="UTF-8编码"></a>UTF-8编码</h1><ul><li>一个英文字符等于一个字节</li><li>一个中文（含繁体）占三个字节</li></ul><h1 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h1><ul><li>一个英文字占两个字节</li><li>一个中文（含繁体）占两个字节</li></ul><h1 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h1><ul><li>英文标点占一个字节</li><li>中文标点占两个字节</li></ul>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>磁盘存储</tag>
      </tags>
  </entry>
  <entry>
    <title>常用shell命令总结</title>
    <url>/%E5%B8%B8%E7%94%A8shell%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>Linux常用低端入门命令。</p><a id="more"></a><style>table th:nth-of-type(2){width:80%}</style><h1 id="系统监控、审计"><a href="#系统监控、审计" class="headerlink" title="系统监控、审计"></a>系统监控、审计</h1><ul><li><p>ssh 远程执行命令，屏蔽连接警告、提示</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh  -o StrictHostKeyChecking=no -q 127.0.0.1 &quot;whoami&quot;</span><br></pre></td></tr></table></figure></li><li><p>history命令记录加时间戳</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;</span><br><span class="line"># 或</span><br><span class="line">echo &apos;export HISTTIMEFORMAT=&quot;%F %T `whoami` &quot;&apos; &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></li><li><p>操作审计</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">script -qaf /tmp/audit.log</span><br></pre></td></tr></table></figure></li><li><p>查看命令执行输出变化</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">watch -n1 -d -t &quot;date +%s&quot;</span><br></pre></td></tr></table></figure></li><li><p>输出命令执行消耗的时间</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># /usr/bin/time -f &quot;time: %E&quot; sleep 10 &amp;&amp; echo &quot;OK&quot;</span><br><span class="line">time: 0:10.00</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">%E	real时间，显示格式为[小时:]分钟:秒;</span><br><span class="line">%U	user时间;</span><br><span class="line">%S	sys时间。</span><br></pre></td></tr></table></figure></li><li><p>编程方式重置用户密码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo 密码|passwd --stdin 用户名</span><br></pre></td></tr></table></figure></li></ul><h1 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h1><ul><li><p>读取键盘输入</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">read</span><br><span class="line">默认将读取到的数据保存到变量REPLY中</span><br><span class="line">-p &quot;tips:&quot;输出提示</span><br><span class="line">-s 密码方式输入，不回显</span><br><span class="line">-r 允许读取反斜杠</span><br><span class="line">-t timeout 设置等待超时时间</span><br><span class="line">-n number 设置读取变量的最大长度，不需回车结束</span><br><span class="line">-d &quot;@&quot; 定义结束符，默认回车</span><br><span class="line">-a arrayName 将单词存入数组</span><br></pre></td></tr></table></figure></li><li><p>终端输出</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stty -echo  禁止将输出发送到终端</span><br><span class="line">stty echo   允许将输出发送到终端</span><br></pre></td></tr></table></figure></li><li><p>彩色输出</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo -e &quot;\033[30m 黑色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[31m 红色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[32m 绿色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[33m 黄色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[34m 蓝色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[35m 紫色字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[36m 天蓝字 \033[0m&quot;</span><br><span class="line">echo -e &quot;\033[37m 白色字 \033[0m&quot;</span><br></pre></td></tr></table></figure></li><li><p>json格式化输出</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -s http://ip.taobao.com/service/getIpInfo.php?ip=8.8.8.8|python -m json.tool</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: 0,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;area&quot;: &quot;&quot;,</span><br><span class="line">        &quot;area_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;city&quot;: &quot;&quot;,</span><br><span class="line">        &quot;city_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;country&quot;: &quot;\u7f8e\u56fd&quot;,</span><br><span class="line">        &quot;country_id&quot;: &quot;US&quot;,</span><br><span class="line">        &quot;county&quot;: &quot;&quot;,</span><br><span class="line">        &quot;county_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ip&quot;: &quot;8.8.8.8&quot;,</span><br><span class="line">        &quot;isp&quot;: &quot;&quot;,</span><br><span class="line">        &quot;isp_id&quot;: &quot;&quot;,</span><br><span class="line">        &quot;region&quot;: &quot;&quot;,</span><br><span class="line">        &quot;region_id&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>将Windows格式转换成unix格式,去掉^M</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dos2unix windows.txt</span><br></pre></td></tr></table></figure></li><li><p>用sed消除空格</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed s/[[:space:]]//g</span><br></pre></td></tr></table></figure></li></ul><h1 id="文件属性"><a href="#文件属性" class="headerlink" title="文件属性"></a>文件属性</h1><ul><li><p>文件只读属性</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 增加只读属性</span><br><span class="line">chattr +i filename</span><br><span class="line"># 删除只读属性</span><br><span class="line">chattr  -i filename</span><br><span class="line"># 增加追加属性</span><br><span class="line">chattr +a filename</span><br><span class="line"># 删除追加属性</span><br><span class="line">chattr -a filename</span><br><span class="line"># 查看文件属性</span><br><span class="line">lsattr filename</span><br></pre></td></tr></table></figure></li><li><p>输出文件属性</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 数字格式输出文件或目录的权限值</span><br><span class="line">stat -c&quot;%a&quot; /tmp</span><br><span class="line"># 显示某一文件或目录的创建时间</span><br><span class="line">stat -c&quot;%Z&quot; /tmp</span><br></pre></td></tr></table></figure></li><li><p>获取软链实际指向的路径</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readlink /usr/local/test/link</span><br></pre></td></tr></table></figure></li><li><p>显示文件或目录的绝对路径</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls -1d /data/files/*</span><br></pre></td></tr></table></figure></li></ul><h1 id="文本、文件操作"><a href="#文本、文件操作" class="headerlink" title="文本、文件操作"></a>文本、文件操作</h1><ul><li><p>生成随机字符串显示成三列</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tr -dc &apos;A-Za-z0-9!@#$%^&amp;*&apos; &lt; /dev/urandom | fold -w 30 | head -n 30|paste - - -</span><br></pre></td></tr></table></figure></li><li><p>生成随机密码</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 方式一</span><br><span class="line">echo `tr -dc &apos;a-zA-Z0-9&apos; &lt; /dev/urandom | head -c20`</span><br><span class="line">cat /dev/urandom | tr -dc &apos;a-zA-Z0-9&apos; | head -c 10</span><br><span class="line"># 方式二</span><br><span class="line">tr -dc &apos;A-Za-z0-9!@#$%^&amp;*&apos; &lt; /dev/urandom | fold -w 20 | head -n 1</span><br></pre></td></tr></table></figure></li><li><p>cut命令方式截取</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cut -c N-M</span><br><span class="line">eg: </span><br><span class="line">获取系统版本</span><br><span class="line">lsb_release -r |awk &apos;&#123;print $2&#125;&apos;|cut -c 1-3</span><br></pre></td></tr></table></figure></li><li><p>根据已有字符串生成随机临时文件名后缀</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">FileName=$(echo $SERV | md5sum | cut -d&quot; &quot; -f1)</span><br></pre></td></tr></table></figure></li><li><p>日志文件切割</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 按行数切割</span><br><span class="line">split -l 行数 -d -a 3 文件 文件前缀</span><br><span class="line">  #-d：数字后缀</span><br><span class="line">  #-a length 指定后缀的长度</span><br><span class="line">    eg: split -l 100000 -d -a 4 nginx_access_log /var/log/nginx_access_log_</span><br><span class="line"># 按文件大小切割</span><br><span class="line">split -b 大小 文件 文件前缀</span><br><span class="line">  # -b：指定文件大小，单位为byte</span><br><span class="line">  # 默认分隔为字母后缀的文件</span><br></pre></td></tr></table></figure></li><li><p>多行文本转换成一行(将目录中的子文件或目录一行输出)</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># awk方式</span><br><span class="line">ls -1 /var/log/ |awk &apos;BEGIN&#123;printf(&quot;%s&quot;,&quot;&#123;&quot;)&#125;&#123;printf(&quot;%s,&quot;,$0);&#125;END&#123;print &quot;&#125;&quot;&#125;&apos;</span><br><span class="line"># sed方式</span><br><span class="line">ls -1 /var/log/ |sed &apos;:a;N;s/\n/\t/;t a;&apos;</span><br><span class="line"># paste方式</span><br><span class="line">ls -1 /var/log/ |paste -d&quot; &quot; -s</span><br><span class="line"># tr方式</span><br><span class="line">ls -1 /var/log/ |tr -s &quot;\n&quot; &quot;\t&quot;</span><br><span class="line"># xargs方式</span><br><span class="line">ls -1 /var/log/ |xargs echo</span><br></pre></td></tr></table></figure></li><li><p>输出重定向副本到文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">whoami |tee -a /tmp/script.log</span><br></pre></td></tr></table></figure></li><li><p>diff命令常用参数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-b或--ignore-space-change：不检查空格字符的不同； </span><br><span class="line">-B或--ignore-blank-lines：不检查空白行；</span><br><span class="line">-H或--speed-large-files：比较大文件时，可加快速度；  </span><br><span class="line">-i或--ignore-case：不检查大小写的不同； </span><br><span class="line">-q或--brief：仅显示有无差异，不显示详细的信息； </span><br><span class="line">-s或--report-identical-files：若没有发现任何差异，仍然显示信息； </span><br><span class="line">-T或--initial-tab：在每行前面加上tab字符以便对齐；  </span><br><span class="line">-w或--ignore-all-space：忽略全部的空格字符；</span><br><span class="line">-y或--side-by-side：以并列的方式显示文件的异同之处；</span><br><span class="line">--left-column：在使用-y参数时，若两个文件某一行内容相同，则仅在左侧的栏位显示该行内容；</span><br><span class="line">--suppress-common-lines：在使用-y参数时，仅显示不同之处。</span><br></pre></td></tr></table></figure></li><li><p>文件备份</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mv -bf -S &quot;_$(date &quot;+%Y-%m-%d_%H%M%S&quot;)&quot; /tmp/test /tmp/ &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">-b：需要覆盖时，备份源文件；</span><br><span class="line">-f：若目标文件或目录存在，则强制覆盖；</span><br><span class="line">-S&lt;后缀&gt;：为备份文件指定后缀，默认后缀为~，当备份文件或目录已存在时，mv操作报错中止；</span><br></pre></td></tr></table></figure></li></ul><h1 id="网络、端口、进程"><a href="#网络、端口、进程" class="headerlink" title="网络、端口、进程"></a>网络、端口、进程</h1><ul><li><p>释放已删除文件占用的磁盘空间</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsof |grep delete |awk &apos;&#123;print $2&#125;&apos;|xargs kill -9</span><br></pre></td></tr></table></figure></li><li><p>ping 命令输出结果前加时间戳前缀</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping 127.0.0.1| awk &apos;&#123; now=strftime(&quot;%Y-%m-%d %H:%M:%S&quot;,systime()); printf(&quot;%s:%s\n&quot;,now,$0);&#125;&apos;</span><br></pre></td></tr></table></figure></li><li><p>解析与反解析</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dig +short www.lengyuewusheng.com</span><br><span class="line"># 主要在内网环境中应用</span><br><span class="line">dig +short -x 10.0.0.1</span><br></pre></td></tr></table></figure></li><li><p>输出本地启动的服务及端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -anltp|awk &apos;&#123;if($NF==&quot;*&quot;) &#123;print $4&quot;:&quot; $(NF-1)&#125; else &#123;print $4&quot;:&quot; $NF&#125;&#125;&apos;|sed &apos;s/\//:/g&apos;|egrep -v &quot;:::|::&quot; |awk -F&apos;:&apos; &apos;&#123;if ($2~/^[0-9]*$/) print $2&quot; &quot;$NF&#125;&apos;|sort -u</span><br></pre></td></tr></table></figure></li><li><p>统计TCP不同连接状态的连接数</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -n|awk &apos;/^tcp/ &#123;++a[$NF]&#125; END &#123;for (b in a) print b,&quot;\t&quot;,a[b]&#125;&apos;</span><br></pre></td></tr></table></figure></li><li><p>探测端口是否开放</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -w1 -s &quot;$&#123;SourceIP&#125;&quot; -z &quot;$&#123;TargetIP&#125;&quot; &quot;$&#123;TargetPort&#125;&quot; &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"># 指定本地IP本地端口</span><br><span class="line">nc -v -s 10.0.0.1 -p 50000 -w3 -z 10.0.0.2 80</span><br><span class="line"># 简单模式</span><br><span class="line">nc -w3 -z 10.0.0.2 80</span><br></pre></td></tr></table></figure></li><li><p>探测机器活性</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping -c 1 -w 2 $&#123;TargetIP&#125; &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li><li><p>关闭80端口的占用程序</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fuser -k -n tcp 80</span><br></pre></td></tr></table></figure></li><li><p>查看80端口的占用程序</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsof -i :80</span><br></pre></td></tr></table></figure></li><li><p>获取网卡的IP地址</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip addr show dev eth0 | awk &apos;/inet/ &#123;sub(/\//, &quot; &quot;); print $2&#125;&apos;|head -1</span><br></pre></td></tr></table></figure></li><li><p>端口流量查询</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iftop -i eth1 -n -P</span><br><span class="line"># 命令安装</span><br><span class="line">yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64//iftop-1.0-0.14.pre4.el6.x86_64.rpm</span><br></pre></td></tr></table></figure></li><li><p>请求网关信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 命令行查询(详细):</span><br><span class="line">    UNIX/Linux: </span><br><span class="line">        #curl cip.cc</span><br><span class="line">    Windows: </span><br><span class="line">        &gt; telnet cip.cc</span><br><span class="line">        &gt; ftp cip.cc</span><br><span class="line"># 命令行查询纯ip返回:</span><br><span class="line">    UNIX/Linux: #curl ip.cip.cc</span><br></pre></td></tr></table></figure></li><li><p>防火墙放开http、ssh</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lokkit -s http -s ssh</span><br></pre></td></tr></table></figure></li></ul><h1 id="date-系列"><a href="#date-系列" class="headerlink" title="date 系列"></a>date 系列</h1><ul><li>时间日期操作<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># date -d &quot;@1500000000&quot; &quot;+%d/%b/%Y:%H:%M:%S&quot;</span><br><span class="line">14/Jul/2017:10:40:00</span><br><span class="line"></span><br><span class="line"># date -d &quot;@1500000000&quot; &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br><span class="line">2017-07-14 10:40:00</span><br><span class="line"></span><br><span class="line"># date -d &quot;2017-07-14 10:40:00&quot; &quot;+%s&quot;</span><br><span class="line">1500000000</span><br><span class="line"></span><br><span class="line"># date -d &quot;1 hours ago&quot; &quot;+%Y-%m-%d %H:%M:%S&quot;</span><br><span class="line">2017-08-15 08:59:59</span><br><span class="line"></span><br><span class="line"># date &quot;+%Y-%m-%d %H:%M:%S %N&quot;</span><br><span class="line">2017-10-04 15:43:15 911203100</span><br><span class="line"></span><br><span class="line">for i in &#123;001..100&#125;  ##for i in $(seq -w 0 100)</span><br><span class="line">do</span><br><span class="line">	echo -e &quot;$i\t $(date &quot;+%Y-%m-%d %H:%M:%S.%N&quot;)&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li></ul><h1 id="find-系列"><a href="#find-系列" class="headerlink" title="find 系列"></a>find 系列</h1><ul><li>find 相关操作<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 针对find查询到的结果进行多步操作</span><br><span class="line">find . -name &quot;*.cfg&quot; -exec echo -e &quot;=============\n&#123;&#125;&quot; \; -exec ls -1 &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"># find 排除多个目录</span><br><span class="line">find /data/ \( -path /data/test1 -o -path /data/test2 -o -path /data/test3 \) -prune -o -type f -name &quot;fileName&quot; -exec echo -e &quot;=============\n&#123;&#125;&quot; \;  -exec dirname &#123;&#125; \;</span><br><span class="line">固定格式： \(   -path /path1 -o -path /path2 \) -prune -o</span><br><span class="line"></span><br><span class="line"># 对find查询结果执行多步操作</span><br><span class="line">find /data/ \( -path /data/test1 -o -path /data/test2 -o -path /data/test3 \) -prune -o -type f -name &quot;fileName&quot; -print |xargs  -P3 -n1 -I &#123;&#125; sh -c &apos;[ -L &#123;&#125; ] &amp;&amp; echo -e &#123;&#125;&quot;is a Soft link.&quot; || echo -e &quot;&#123;&#125; is a File.&quot;&apos;</span><br><span class="line">xargs后通过sh -c &apos;&apos;执行多次命令</span><br><span class="line">-P num 开启num个进程加速处理</span><br><span class="line"></span><br><span class="line"># find统计/var/log目录下每一个文件的记录行数</span><br><span class="line">find /var/log/ -type f -name &quot;*.log&quot; -print0 | xargs -0 wc -l</span><br><span class="line"> # -print0：假设find指令的回传值为Ture，就将文件或目录名称列出到标准输出。格式为全部的名称皆在同一行</span><br><span class="line"> # xargs -0将\0作为定界符</span><br><span class="line"></span><br><span class="line"># 最近7天日志文件的总大小</span><br><span class="line">find /var/log/ -mtime -7 -type f | xargs du -ch | tail -n1</span><br><span class="line"></span><br><span class="line"># 对文件批量重命名</span><br><span class="line">find /data/ -type f -name &quot;*keywords*&quot; |xargs -t -i mv &#123;&#125; &#123;&#125;.bak$(date &quot;+%Y%m%d&quot;)</span><br></pre></td></tr></table></figure></li></ul><h1 id="shell语法"><a href="#shell语法" class="headerlink" title="shell语法"></a>shell语法</h1><ul><li><p>变量赋值</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;VAR:-string&#125;  如果VAR变量为空则返回string</span><br><span class="line">$&#123;VAR:+string&#125;  如果VAR变量不为空则返回string</span><br><span class="line">$&#123;VAR:=string&#125;  如果VAR变量为空则重新赋值VAR变量值为string</span><br><span class="line">$&#123;VAR:?string&#125;  如果VAR变量为空则将&quot;string&quot;作为报错信息输出到stderr</span><br></pre></td></tr></table></figure></li><li><p>字符串截取及替换</p></li></ul><table><thead><tr><th align="left">符号</th><th align="left">意义</th></tr></thead><tbody><tr><td align="left">${var#*”分隔符”}</td><td align="left">#*”分隔符” 表示删除从左往右第一个分隔符以及其左边的所有字符</td></tr><tr><td align="left">${var##*”分隔符”}</td><td align="left">##*”分隔符” 表示删除从左往右最后一个分隔符以及其左边的所有字符</td></tr><tr><td align="left">${var%”分隔符”*}</td><td align="left">%”分隔符”* 表示删除从右往左第一个分隔符以及其右边的所有字符</td></tr><tr><td align="left">${var%%”分隔符”*}</td><td align="left">%%”分隔符”* 表示删除从右往左最后一个分隔符以及其右边的所有字符</td></tr><tr><td align="left">${var:n:m}</td><td align="left">从左边第n个字符开始，往右截取m个字符</td></tr><tr><td align="left">${var:n}</td><td align="left">从左边第n个字符开始，往右截取到最后</td></tr><tr><td align="left">${var:0-n:m}</td><td align="left">从右边第n个字符开始，往右截取m个字符</td></tr><tr><td align="left">${var:0-n}</td><td align="left">从右边第n个字符开始，往右截取到最后</td></tr><tr><td align="left">${var/ABC/abc}</td><td align="left">将${var}中第一个ABC用abc替换ABC</td></tr><tr><td align="left">${var//ABC/abc}</td><td align="left">将${var}中所有的ABC用abc替换ABC</td></tr><tr><td align="left">${var/#ABC/abc}</td><td align="left">如果字符串${var}以ABC开头则用abc替换ABC</td></tr><tr><td align="left">${var/%ABC/abc}</td><td align="left">如果字符串${var}以ABC结尾则用abc替换ABC</td></tr><tr><td align="left">${var#start}</td><td align="left">如果字符串${var}以start开头，则删掉</td></tr><tr><td align="left">${var%end}</td><td align="left">如果字符串${var}以end结束，则删掉</td></tr><tr><td align="left">${var#s}</td><td align="left">如果字符串${var}开头第一个字母是s则删掉</td></tr><tr><td align="left">${var%e}</td><td align="left">如果字符串${var}最后一个字母是e则删掉</td></tr><tr><td align="left">$-</td><td align="left">当前设置的shell选项</td></tr><tr><td align="left">${-#*i}</td><td align="left">删除shell选项中i以及其左边的所有字符，常用于判断是否是交互式shell</td></tr></tbody></table><ul><li>$- shell选项参数说明<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$- prints The current set of options in your current shell.</span><br><span class="line"></span><br><span class="line">himBH means following options are enabled:</span><br><span class="line"></span><br><span class="line">H - histexpand</span><br><span class="line">m - monitor</span><br><span class="line">h - hashall</span><br><span class="line">B - braceexpand</span><br><span class="line">i - interactive</span><br></pre></td></tr></table></figure></li></ul><p>eg:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var=http://test.com/index.html_http://test.com/default.html</span><br><span class="line"></span><br><span class="line">$&#123;var#*//&#125;:	test.com/index.html_http://test.com/default.html</span><br><span class="line">$&#123;var##*/&#125;:	default.html</span><br><span class="line">$&#123;var%/*&#125;:	http://test.com/index.html_http://test.com</span><br><span class="line">$&#123;var%%/*&#125;:	http:</span><br><span class="line">$&#123;var:0:3&#125;:	htt</span><br><span class="line">$&#123;var:5&#125;:	//test.com/index.html_http://test.com/default.html</span><br><span class="line">$&#123;var:0-10:3&#125;:	fau</span><br><span class="line">$&#123;var:0-10&#125;:	fault.html</span><br><span class="line">$&#123;var/http/https&#125;:  https://test.com/index.html_http://test.com/default.html</span><br><span class="line">$&#123;var//http/https&#125;:  https://test.com/index.html_https://test.com/default.html</span><br><span class="line">$&#123;var/#http/https&#125;:  https://test.com/index.html_http://test.com/default.html</span><br><span class="line">$&#123;var/%html/php&#125;:  http://test.com/index.html_http://test.com/default.php</span><br><span class="line"></span><br><span class="line">var=&quot;starrend&quot;</span><br><span class="line">$&#123;var#start&#125;: end</span><br><span class="line">$&#123;var%end&#125;: start</span><br></pre></td></tr></table></figure><ul><li><p>变量的间接引用</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var1=&quot;It&apos;s a magical way&quot;</span><br><span class="line">var2=&quot;var1&quot;</span><br><span class="line">echo &quot;$&#123;!var2&#125;&quot;</span><br></pre></td></tr></table></figure></li><li><p>shell中的括号</p></li></ul><table><thead><tr><th align="left">符号</th><th align="left">意义</th></tr></thead><tbody><tr><td align="left">()</td><td align="left">1.定义数组变量；2.命令组，括号中的变量不能被括号外引用</td></tr><tr><td align="left">$()</td><td align="left">和反引号(``)相同，都是用来做命令替换</td></tr><tr><td align="left">$(())</td><td align="left">和$[]相同，都是进行数学计算，bash中只能进行整数运算，浮点数作为字符串处理</td></tr><tr><td align="left">[]</td><td align="left">1.test的另一种形式;2.字符范围</td></tr><tr><td align="left">$[]</td><td align="left">和$(())相同，都是进行数学计算</td></tr><tr><td align="left">[[]]</td><td align="left">bash中的关键字，不是命令，用于if判断结构</td></tr><tr><td align="left">{}</td><td align="left">代码块，又称内部组。与小括号不同，大括号内的命令不会新开一个子shell运行，括号内变量可以被括号外引用。分号隔开命令，最后一条命令也必须跟分号。</td></tr><tr><td align="left">${}</td><td align="left">变量引用</td></tr></tbody></table><ul><li><p>判断字符串包含</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">long_str=abcded</span><br><span class="line">short_str=def</span><br><span class="line">if [[ &quot;$&#123;long_str&#125;&quot; =~ &quot;$&#123;short_str&#125;&quot; ]]; then</span><br><span class="line">    echo &quot;包含&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;不包含&quot;</span><br><span class="line">fi</span><br><span class="line">=~ 判断前者是否包含后者</span><br></pre></td></tr></table></figure></li><li><p>数组操作</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">数组定义：arrayName=(&quot;elements_1&quot; &quot;elements_2&quot; &quot;elements_3&quot;)</span><br><span class="line">数组单个元素赋值：arrayName[$i]=&quot;value&quot;</span><br><span class="line">数组长度：$&#123;#arrayName[@]&#125;</span><br><span class="line">取数组所有元素：$&#123;arrayName[@]&#125;</span><br><span class="line">数组中的单个元素：$&#123;arrayName[$i]&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h1><ul><li><p>时间同步</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 硬件时间与系统时间同步</span><br><span class="line">/sbin/clock -w</span><br><span class="line"># 本地时间与时间服务器同步</span><br><span class="line">/usr/sbin/ntpdate ntp.server</span><br></pre></td></tr></table></figure></li><li><p>查看单个进程的top信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">top -p $(pidof $&#123;ProcessName&#125;|sed &apos;s/ /,/g&apos;)</span><br></pre></td></tr></table></figure></li><li><p>ab压测</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ab -c 100 -n 10000 &quot;http://127.0.0.1/&quot;</span><br></pre></td></tr></table></figure></li><li><p>系统盘iNode使用率过高，一般的清理策略</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find /var/spool/postfix/maildrop/ -type f -delete</span><br></pre></td></tr></table></figure></li><li><p>top后台记录系统启动的进程信息</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">top -bc -n 3 -d 5</span><br><span class="line">-b: 批处理模式</span><br><span class="line">-c: 显示完整命令</span><br><span class="line">-d: 设置延迟间隔</span><br><span class="line">-n: 设置输出次数</span><br></pre></td></tr></table></figure></li><li><p>编码转换</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iconv -f GBK -t UTF-8 gbk.txt -o utf8.txt</span><br></pre></td></tr></table></figure></li></ul><h1 id="硬件相关"><a href="#硬件相关" class="headerlink" title="硬件相关"></a>硬件相关</h1><ul><li>虚机硬盘坏盘修复<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">确定文件系统类型：</span><br><span class="line">df -T</span><br><span class="line"></span><br><span class="line">修复：</span><br><span class="line">umount /dev/vdb</span><br><span class="line">xfs_repair /dev/vdb</span><br></pre></td></tr></table></figure><ul><li>xfs_repair: xfsprogs.x86_64</li></ul></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>http不同版本及特性概括</title>
    <url>/http%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E5%8F%8A%E7%89%B9%E6%80%A7%E6%A6%82%E6%8B%AC/</url>
    <content><![CDATA[<p>HTTP（HyperText Transfer Protocol）是互联网应用中最常见的一种协议。</p><a id="more"></a><h1 id="HTTP-0-9"><a href="#HTTP-0-9" class="headerlink" title="HTTP 0.9"></a>HTTP 0.9</h1><p>1991年，Tim Berners-Lee概述。</p><ul><li><p>特性：</p><ul><li>客户端/服务器，请求/响应；</li><li>ASCII协议，运行于TCP/IP链接之上；</li><li>传输超文本文档（HTML）；</li><li>服务器和客户端之间的连接在每次请求之后都会关闭；</li></ul></li><li><p>http逃逸原理<br>由于http0.9协议没有响应头。大多数防火墙产品只是简单地让它无法分析的数据包直接通过，对HTTP/0.9的响应包没有做进一步检测。导致http/0.9协议传输的响应包可以绕过防火墙。</p></li></ul><h1 id="HTTP-1-0"><a href="#HTTP-1-0" class="headerlink" title="HTTP 1.0"></a>HTTP 1.0</h1><p>1996年，HTTP工作组发布 RFC 1945。</p><ul><li>特性：<ul><li>HTTP1.0并不是一个正式的规范或标准</li><li>请求可以由多行首部字段构成；</li><li>响应对象前面包含响应状态行；</li><li>响应对象包含由换行符分割的首部字段；</li><li>响应对象不局限于超文本；</li><li>服务器和客户端之间的连接在每次请求之后都会关闭；</li></ul></li></ul><h1 id="HTTP1-1"><a href="#HTTP1-1" class="headerlink" title="HTTP1.1"></a>HTTP1.1</h1><p>1997年1月，定义正式http1.1标准的RFC2068发布；1999年6月，RFC2616发布，在标准中集合了很多改进和更新。</p><ul><li>特性：<ul><li>默认持久连接</li><li>分块编码传输</li><li>字节范围请求</li><li>增强的缓存机制</li><li>传输编码及请求管道</li><li>内容编码字符集以及语言的协商机制</li></ul></li></ul><h1 id="HTTP-2-0"><a href="#HTTP-2-0" class="headerlink" title="HTTP 2.0"></a>HTTP 2.0</h1><p>2012年1月，HTTP 2.0纲领发布。</p><ul><li>特性：<ul><li>主要目标是改进传输性能，实现低延迟和高吞吐量</li><li>二进制分帧</li><li>异步连接</li><li>多路复用</li><li>头部压缩</li><li>流量控制</li><li>请求响应管线化（管道Pipelining传输）</li><li>请求优先级</li><li>服务器推送</li></ul></li></ul><ul><li>参考<ul><li>Ilya, Grigorik. Web性能权威指南[M]. 人民邮电出版社, 2014.</li></ul></li></ul>]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx配置location匹配规则</title>
    <url>/nginx%E9%85%8D%E7%BD%AElocation%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99/</url>
    <content><![CDATA[<blockquote><p>请求路由定位是Nginx的核心功能，位于ngx_http_core_module模块中。</p></blockquote><a id="more"></a><ul><li>location匹配模式</li></ul><style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">判断条件</th><th align="left">符号意义</th></tr></thead><tbody><tr><td align="left">~</td><td align="left">区分大小写地匹配正则</td></tr><tr><td align="left">~*</td><td align="left">不区分大小写地匹配正则</td></tr><tr><td align="left">^~</td><td align="left">普通字符（相对于正则）匹配，一般用来匹配目录</td></tr><tr><td align="left">=</td><td align="left">进行普通字符精确匹配</td></tr><tr><td align="left">@</td><td align="left">“@”定义一个命名的 location,用于内部重定向，不能被嵌套，不能包含嵌套的location。例如 error_page, try_files</td></tr></tbody></table><ul><li>location 匹配的优先级<ul><li>= 精确匹配会第一个被处理。如果发现精确匹配，nginx停止搜索其他匹配；</li><li>Nginx首先检查最长前缀字符串匹配，其次检查正则表达式的匹配程度；</li><li>最长前缀匹配如果使用”^~”，则不检查正则表达式；</li><li>当没有正则表达式或者没有正则表达式被匹配的情况下，那么匹配程度最高的前缀匹配规则会被应用。</li></ul></li></ul><ul><li>参考文档<ul><li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">nginx官方文档location部分</a></li></ul></li></ul>]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>location</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx配置中的if指令</title>
    <url>/nginx%E9%85%8D%E7%BD%AE%E4%B8%AD%E7%9A%84if%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<blockquote><p>通常Nginx的if判断不支持else逻辑。</p></blockquote><a id="more"></a><ul><li>判断条件</li></ul><style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">判断条件</th><th align="left">符号意义</th></tr></thead><tbody><tr><td align="left">= ,!=</td><td align="left">比较字符串相等</td></tr><tr><td align="left">~</td><td align="left">匹配正则表达式</td></tr><tr><td align="left">~*</td><td align="left">不区分大小写的匹配</td></tr><tr><td align="left">!~</td><td align="left">区分大小写的不匹配</td></tr><tr><td align="left">-f ，!-f</td><td align="left">判断文件是否存在</td></tr><tr><td align="left">-d, !-d</td><td align="left">判断目录是否存在</td></tr><tr><td align="left">-e ，!-e</td><td align="left">判断文件、目录或链接是否存在</td></tr><tr><td align="left">-x ， !-x</td><td align="left">判断文件是否可被执行</td></tr></tbody></table><ul><li>说明<ul><li>作用域：server,location</li><li>if指令中如果一个变量是空字符串或者以0开始的字符串，则为false；</li><li>nginx的if条件判断不支持else语法；</li></ul></li></ul><ul><li>参考文档<ul><li><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener">nginx官方文档Module ngx_http_rewrite_module部分</a></li></ul></li></ul>]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>rewrite</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx-rewrite指令中的flag参数</title>
    <url>/nginx-rewrite%E6%8C%87%E4%BB%A4%E4%B8%AD%E7%9A%84flag%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<blockquote><p>Nginx的ngx_http_rewrite_module模块使用PCRE（pcre.x86_64）正则表达式重定向URL。</p></blockquote><a id="more"></a><style>table th:nth-of-type(2){width:80%}</style><ul><li>flag 参数</li></ul><table><thead><tr><th align="left">flag参数</th><th align="left">意义</th></tr></thead><tbody><tr><td align="left">last</td><td align="left">终止rewrite指令匹配，然后对当前重写的新URI在rewrite指令集上重新查找</td></tr><tr><td align="left">break</td><td align="left">停止处理后续rewrite指令集，并不在重新查找,但是当前location内剩余非rewrite语句和location外的的非rewrite语句可以执行</td></tr><tr><td align="left">permant</td><td align="left">返回301永久重定向，地址栏显示跳转后的地址</td></tr><tr><td align="left">redirect</td><td align="left">返回302临时重定向，地址栏显示跳转后的地址</td></tr></tbody></table><ul><li>说明<ul><li>nginx可以通过增加<code>rewrite_log on; error_log logs/error.log notice;</code>调试 rewrite；</li><li>last：将rewrite后的地址重新在server标签执行；</li><li>break：将rewrite后地址重新在当前的location标签执行；</li><li>last和break正常返回200状态码；</li><li>last一般写在server和if中，而break一般使用在location中；</li><li>last不终止重写后的url匹配，而break终止重写后的匹配；</li><li>一般使用302重定向是在一个网站或网页在24到48小时之内临时移到其它位置，建议尽量采用301重定向；</li><li>rewrite指令执行过程中如果循环超过10次，则返回500 Internal Server Error错误；</li><li>rewrite正则表达regex式中包含 “}” 或 “;”时整个表达式需要用双引号或单引号引起来；</li></ul></li></ul><ul><li>参考文档<ul><li><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener">nginx官方文档Module ngx_http_rewrite_module部分</a></li></ul></li></ul>]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
        <tag>rewrite</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows小工具</title>
    <url>/windows%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">工具名</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://chocolatey.org/install#installing-chocolatey" target="_blank" rel="noopener">Chocolatey</a></td><td align="left">Windows 包管理器</td></tr><tr><td align="left"><a href="https://msdn.microsoft.com/en-us/commandline/wsl/install-win10" target="_blank" rel="noopener">Windows Subsystem for Linux</a></td><td align="left">Windows环境下的Linux模式</td></tr><tr><td align="left"><a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/sysinternals-suite" target="_blank" rel="noopener">SysInternals</a></td><td align="left">微软官方提供的免费工具集。<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/" target="_blank" rel="noopener">文档</a></td></tr><tr><td align="left">Cygwin</td><td align="left">在 Windows 中为你提供 Unix 环境</td></tr><tr><td align="left"><a href="http://winmtr.net/download-winmtr/" target="_blank" rel="noopener">WinMTR</a></td><td align="left">Windows环境下mtr工具</td></tr><tr><td align="left">Listary</td><td align="left">文件管理器</td></tr><tr><td align="left">everything</td><td align="left">本地文件搜索神器</td></tr><tr><td align="left">KeePass</td><td align="left">本地密码存储客户端</td></tr><tr><td align="left">Fiddler</td><td align="left">HTTP 调试代理</td></tr><tr><td align="left">Wireshark</td><td align="left">网络封包分析软件</td></tr><tr><td align="left">Snoop</td><td align="left">Visual调试工具</td></tr><tr><td align="left">AnyDesk</td><td align="left">远程连接软件（感觉比较危险）</td></tr><tr><td align="left">Navicat Premium</td><td align="left">数据库客户端</td></tr><tr><td align="left">Robomongo</td><td align="left">Mongo客户端</td></tr><tr><td align="left">LdapAdmin</td><td align="left">免费Ldap客户端</td></tr><tr><td align="left">Redis Desktop Manager</td><td align="left">redis客户端，支持Windows、Linux、Mac OS X。</td></tr><tr><td align="left">飞鸽传书</td><td align="left">局域网聊天软件</td></tr><tr><td align="left">Atom</td><td align="left">开源编辑器</td></tr><tr><td align="left">Visual Studio Code</td><td align="left">开源编辑器</td></tr><tr><td align="left">sublime_text</td><td align="left">代码编辑器</td></tr><tr><td align="left">Typora</td><td align="left">微信公众号排版工具</td></tr><tr><td align="left">LICEcap</td><td align="left">GIF录屏软件</td></tr><tr><td align="left"><a href="https://www.screentogif.com/" target="_blank" rel="noopener">screentogif</a></td><td align="left">截屏/录屏神器</td></tr><tr><td align="left">ShareX</td><td align="left">功能强大的截屏录屏软件，支持上传云端</td></tr><tr><td align="left">亿图图示</td><td align="left">功能强大的图形设计软件</td></tr><tr><td align="left">Beyond Compare</td><td align="left">文件比较工具</td></tr><tr><td align="left"><a href="http://www.zisync.com/" target="_blank" rel="noopener">自同步</a></td><td align="left">P2P同步工具，支持Windows、MAC、Android。</td></tr><tr><td align="left">Dukto R6</td><td align="left">开源跨平台文件共享工具，支持Windows、Linux、Mac OS X和移动端</td></tr><tr><td align="left">FileZilla Server(Client)</td><td align="left">免费开源的FTP软件</td></tr><tr><td align="left">FreeFileSync</td><td align="left">开源的文件夹比较和同步软件。支持Windows、Linux、Mac OS X。</td></tr><tr><td align="left">NitroShare</td><td align="left">跨平台、开源的文件共享神器，支持Windows、Linux、Mac OS X。</td></tr><tr><td align="left"><a href="https://github.com/syncthing/syncthing" target="_blank" rel="noopener">syncthing</a></td><td align="left">文件共享同步工具</td></tr><tr><td align="left"><a href="https://astuteinternet.dl.sourceforge.net/project/ext2read/Ext2read%20Version%202.2%20%28Latest%29/ext2explore-2.2.71.zip" target="_blank" rel="noopener">ext2explore</a></td><td align="left">读取Ext文件系统，其最新版本支持ext4。支持Windows10。</td></tr><tr><td align="left"><a href="https://versaweb.dl.sourceforge.net/project/ext2fsd/Ext2fsd/0.69/Ext2Fsd-0.69.exe" target="_blank" rel="noopener">Ext2Fsd</a></td><td align="left">供了Windows驱动级的ext支持，该软件可以写Ext3和不带extent的Ext4的分区。支持Windows10。</td></tr><tr><td align="left"><a href="https://motrix.app/zh-CN" target="_blank" rel="noopener">motrix</a></td><td align="left">免费、开源跨平台下载工具</td></tr><tr><td align="left"><a href="https://www.freedownloadmanager.org/download.htm" target="_blank" rel="noopener">freedownloadmanager</a></td><td align="left">免费、跨平台下载工具</td></tr><tr><td align="left"><a href="https://github.com/kenvix/USBCopyer" target="_blank" rel="noopener">USBCopyer</a></td><td align="left">USB设备自动复制工具</td></tr><tr><td align="left"><a href="http://www.xuetr.com/download/PCHunter_free.zip" target="_blank" rel="noopener">PCHunter</a></td><td align="left">PC Hunter是一个Windows系统信息查看软件，同时也是一个手工杀毒辅助软件。</td></tr><tr><td align="left"><a href="https://www.islide.cc/download" target="_blank" rel="noopener">iSlide</a></td><td align="left">PowerPoint设计插件</td></tr><tr><td align="left"><a href="https://ditto-cp.sourceforge.io/" target="_blank" rel="noopener">ditto</a></td><td align="left">剪贴板管理工具</td></tr><tr><td align="left"><a href="https://tropy.org" target="_blank" rel="noopener">tropy</a></td><td align="left">图片管理工具</td></tr><tr><td align="left"><a href="https://www.sparkleshare.org/" target="_blank" rel="noopener">sparkleshare</a></td><td align="left">内网备份协助软件</td></tr><tr><td align="left"><a href="https://www.snipaste.com/index.html" target="_blank" rel="noopener">snipaste</a></td><td align="left">截图工具</td></tr><tr><td align="left"><a href="https://fastcopy.jp/" target="_blank" rel="noopener">Fastcopy</a></td><td align="left">文件复制工具</td></tr><tr><td align="left"><a href="http://www.codesector.com/teracopy" target="_blank" rel="noopener">TeraCopy</a></td><td align="left">文件复制工具，支持Windows·Mac,分为免费和收费版本</td></tr><tr><td align="left"><a href="https://www.ghisler.com/download.htm" target="_blank" rel="noopener">Total Commander</a></td><td align="left">文件管理软件</td></tr><tr><td align="left"><a href="http://www.uderzo.it/main_products/space_sniffer/" target="_blank" rel="noopener">SpaceSniffer</a></td><td align="left">磁盘使用情况分析工具</td></tr><tr><td align="left"><a href="http://www.dropitproject.com/" target="_blank" rel="noopener">DropIt</a></td><td align="left">文件管理工具</td></tr><tr><td align="left"><a href="https://github.com/TranslucentTB/TranslucentTB" target="_blank" rel="noopener">TranslucentTB</a></td><td align="left">透明化系统任务栏</td></tr><tr><td align="left"><a href="https://github.com/rainmeter/rainmeter" target="_blank" rel="noopener">rainmeter</a></td><td align="left">Windows桌面个性化工具，常用主题下载<a href="https://www.deviantart.com/qubes/art/Blue-Planet-for-Rainmeter-254377385" target="_blank" rel="noopener">地址</a></td></tr></tbody></table>]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>chrome经典插件</title>
    <url>/chrome%E7%BB%8F%E5%85%B8%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">插件名</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">Copytables</td><td align="left">快速选择表格中的行、列、单元格等信息复制</td></tr><tr><td align="left">JSON Formatter/JSONiew</td><td align="left">json格式化输出</td></tr><tr><td align="left">XML Tree</td><td align="left">xml格式化输出</td></tr><tr><td align="left">LastPass: Free Password Manager</td><td align="left">密码存储</td></tr><tr><td align="left">Print Friendly &amp; PDF</td><td align="left">网页打印工具</td></tr><tr><td align="left">Host Switch Plus</td><td align="left">host快速切换工具</td></tr><tr><td align="left">Website IP</td><td align="left">显示访问站点的IP，一般结合Host Switch Plus一起使用</td></tr><tr><td align="left">Proxy SwitchySharp</td><td align="left">代理切换</td></tr><tr><td align="left">OneTab</td><td align="left">快速记录并存储当前正在打开的标签页</td></tr><tr><td align="left">The Great Suspender</td><td align="left">自动暂停使用标签来释放系统资源</td></tr><tr><td align="left">Octotree</td><td align="left">GitHub侧边栏插件，便于浏览代码目录</td></tr><tr><td align="left">Adblock Plus</td><td align="left">屏蔽广告</td></tr><tr><td align="left">New Tab Redirect</td><td align="left">首页设置</td></tr><tr><td align="left">Stylish</td><td align="left">客户端自定义站点样式</td></tr><tr><td align="left">Postman</td><td align="left">Web调试工具</td></tr></tbody></table>]]></content>
      <categories>
        <category>chrome</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>chrome插件</tag>
      </tags>
  </entry>
  <entry>
    <title>shell printf格式化输出</title>
    <url>/shell-printf%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA/</url>
    <content><![CDATA[<p>shell也可以优雅的输出。</p><a id="more"></a><h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">printf: usage: printf [-v var] format [arguments]</span><br></pre></td></tr></table></figure><h1 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h1><h2 id="常用格式控制符"><a href="#常用格式控制符" class="headerlink" title="常用格式控制符"></a>常用格式控制符</h2><style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">格式符</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">%s</td><td align="left">字符串</td></tr><tr><td align="left">%d,%i</td><td align="left">十进制整数</td></tr><tr><td align="left">%u</td><td align="left">不带正负号的十进制值</td></tr><tr><td align="left">%o</td><td align="left">不带正负号的八进制值</td></tr><tr><td align="left">%x</td><td align="left">不带正负号的十六进制值，使用a至f表示10至15</td></tr><tr><td align="left">%X</td><td align="left">不带正负号的十六进制值，使用A至F表示10至15</td></tr><tr><td align="left">%e,%E,%f</td><td align="left">浮点格式</td></tr><tr><td align="left">%g</td><td align="left">%e或%f转换，看哪一个较短，则删除结尾的零</td></tr><tr><td align="left">%G</td><td align="left">%E或%f转换，看哪一个较短，则删除结尾的零</td></tr><tr><td align="left">%b</td><td align="left">相对应的参数被视为含有要被处理的转义序列之字符串</td></tr><tr><td align="left">%c</td><td align="left">ASCII字符。显示相对应参数的第一个字符</td></tr><tr><td align="left">%%</td><td align="left">字面意义的%</td></tr></tbody></table><h2 id="常用转义序列"><a href="#常用转义序列" class="headerlink" title="常用转义序列"></a>常用转义序列</h2><table><thead><tr><th align="left">格式符</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">\f</td><td align="left">换页（formfeed）</td></tr><tr><td align="left">\n</td><td align="left">换行</td></tr><tr><td align="left">\r</td><td align="left">回车（Carriage return）</td></tr><tr><td align="left">\t</td><td align="left">水平制表符</td></tr><tr><td align="left">\v</td><td align="left">垂直制表符</td></tr><tr><td align="left">\</td><td align="left">一个字面上的反斜杠字符</td></tr><tr><td align="left">\ddd</td><td align="left">表示1到3位数八进制值的字符，仅在格式字符串中有效</td></tr><tr><td align="left">\0ddd</td><td align="left">表示1到3位的八进制值字符</td></tr></tbody></table><h1 id="使用场景举例"><a href="#使用场景举例" class="headerlink" title="使用场景举例"></a>使用场景举例</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat printf.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">printf &quot;%-20s\t%-30s\n&quot; &quot;格式符&quot; &quot;说明&quot;</span><br><span class="line">printf &quot;%-20s\t\033[33m%-30s\033[0m\n&quot; &apos;%s&apos; &apos;字符串&apos;</span><br><span class="line">printf &apos;%-20s\t%-30s\n&apos; &apos;%d&apos; &apos;十进制整数&apos;</span><br><span class="line">printf &quot;%-20s\t%-30s\n&quot; &quot;%u&quot; &apos;不带正负号的十进制值&apos;</span><br><span class="line">printf &quot;%-20s\t%-30s\n&quot; &quot;%o&quot; &quot;不带正负号的八进制值&quot;</span><br><span class="line">printf &quot;\033[32m%-20s\033[0m\t%-1.15f\n&quot; %f 3.14159265358</span><br><span class="line"></span><br><span class="line"># sh printf.sh</span><br><span class="line">格式符           	说明</span><br><span class="line">%s                  	字符串</span><br><span class="line">%d                  	十进制整数</span><br><span class="line">%u                  	不带正负号的十进制值</span><br><span class="line">%o                  	不带正负号的八进制值</span><br><span class="line">%f                  	3.141592653580000</span><br></pre></td></tr></table></figure><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><ul><li>默认printf没有换行，需要手动添加\n；</li><li>%-20s指一个宽度为20的左对齐字符。如果不满20个字符则以空格填充，如超出20个字符也会显示所有内容；</li><li>-表示左对齐，+或者空则表示右对齐；</li><li>%-1.15f 格式化小数，其中.15指保留15位小数，不足位数补零；</li><li>在格式控制符和输出字符串中单引号与双引号效果相同，但是不能将所有的输出字符串用一个引起来，必须每个字段一对引号；</li><li>格式控制中也可以引入字体颜色。</li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>printf</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible copy模块和synchronize模块说明及比较</title>
    <url>/ansible-copy%E6%A8%A1%E5%9D%97%E5%92%8Csynchronize%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E%E5%8F%8A%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<p>对文件的批量变更是运维自动化领域中很常见的需求之一.Ansible官方针对文件操作部分提供了很多<a href="http://docs.ansible.com/ansible/latest/list_of_files_modules.html" target="_blank" rel="noopener">模块</a>,这里仅对最常用的copy和synchronize模块进行一个简单的比较。</p><a id="more"></a><h1 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h1><h2 id="常用参数列表"><a href="#常用参数列表" class="headerlink" title="常用参数列表"></a>常用参数列表</h2><style>table th:nth-of-type(5){width:70%}</style><table><thead><tr><th align="left">参数</th><th align="left">是否必选字段</th><th align="left">默认值</th><th align="left">可选值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">backup</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">是否备份被修改的文件</td></tr><tr><td align="left">src</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">本地路径；可以是绝对路径也可以是相对路径。如果是目录，则递归地复制。此种情况下，类似于rsync，如果路径以“/”结尾，则只有该目录下的文件或子目录被复制。如果不以“/”结尾，则同时复制该目录。</td></tr><tr><td align="left">content</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">可使用content代替”SRC”，将文件的内容直接设置为指定的简单的值。对于任何复杂的或格式化的内容使用template模块。</td></tr><tr><td align="left">dest</td><td align="left">yes</td><td align="left"></td><td align="left"></td><td align="left">文件被复制到的远端服务器上的绝对路径。说明：如果src给定的是目录，dest也必须是目录</td></tr><tr><td align="left">follow</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">保留软链属性(added in 1.8)</td></tr><tr><td align="left">force</td><td align="left">no</td><td align="left">yes</td><td align="left">yes/no</td><td align="left">如果文件已存在，默认强制覆盖，如果设置为no,则只有当文件不存在时才会被传输 aliases: thirsty</td></tr><tr><td align="left">group</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">文件或目录的所属用户组</td></tr><tr><td align="left">mode</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">文件或目录权限，用八进制数字表示，如0644，如果没有前置0可能出现异常</td></tr><tr><td align="left">owner</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">文件或目录的所属用户</td></tr><tr><td align="left">remote_src</td><td align="left">no</td><td align="left">False</td><td align="left">True/False</td><td align="left">如果是true，将从远端往远端服务，相当于在远端服务器上执行copy操作。如果为false，则从本地复制到远程，默认是false。remote_src不支持递归复制。(added in 2.0)</td></tr></tbody></table><h2 id="使用场景举例"><a href="#使用场景举例" class="headerlink" title="使用场景举例"></a>使用场景举例</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m copy -a &quot;src=/tmp/test.txt dest=/tmp/ backup=yes&quot; -i hosts</span><br><span class="line">192.168.0.1 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;backup_file&quot;: &quot;/tmp/test.txt.7587.2017-08-04@16:58:43~&quot;,</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;checksum&quot;: &quot;d961c3de6d6c99429806ae3d6d03f316a1168ac6&quot;,</span><br><span class="line">    &quot;dest&quot;: &quot;/tmp/test.txt&quot;,</span><br><span class="line">    &quot;gid&quot;: 0,</span><br><span class="line">    &quot;group&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;md5sum&quot;: &quot;7494ab07987ba112bd5c4f9857ccfb3f&quot;,</span><br><span class="line">    &quot;mode&quot;: &quot;0644&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;root&quot;,</span><br><span class="line">    &quot;size&quot;: 5,</span><br><span class="line">    &quot;src&quot;: &quot;/root/.ansible/tmp/ansible-tmp-1501837122.86-21046238098569/source&quot;,</span><br><span class="line">    &quot;state&quot;: &quot;file&quot;,</span><br><span class="line">    &quot;uid&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="synchronize模块"><a href="#synchronize模块" class="headerlink" title="synchronize模块"></a>synchronize模块</h1><h2 id="常用参数列表-1"><a href="#常用参数列表-1" class="headerlink" title="常用参数列表"></a>常用参数列表</h2><table><thead><tr><th align="left">参数</th><th align="left">是否必选字段</th><th align="left">默认值</th><th align="left">可选值</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">archive</td><td align="left">no</td><td align="left">yes</td><td align="left">yes/no</td><td align="left">递归保留源目录中的软链、权限、时间戳、所属用户等属性</td></tr><tr><td align="left">recursive</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">目录递归</td></tr><tr><td align="left">group</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">指定所属用户组</td></tr><tr><td align="left">owner</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">指定所属用户</td></tr><tr><td align="left">links</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">保留软链接</td></tr><tr><td align="left">perms</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">保留权限设置</td></tr><tr><td align="left">times</td><td align="left">no</td><td align="left">选项archive的值</td><td align="left">yes/no</td><td align="left">保留时间戳</td></tr><tr><td align="left">compress</td><td align="left">no</td><td align="left">yes</td><td align="left">yes/no</td><td align="left">压缩传输，除非会导致异常，多数情况下建议开启(added in 1.7)</td></tr><tr><td align="left">copy_links</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">复制软链指向的内容而不是软链本身</td></tr><tr><td align="left">delete</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">传输完成后，删除目标路径下，源目录中不存在的文件This option requires recursive=yes.</td></tr><tr><td align="left">src</td><td align="left">yes</td><td align="left"></td><td align="left"></td><td align="left">源主机上的路径，可以是绝对路径也可以是相对路径</td></tr><tr><td align="left">dest</td><td align="left">yes</td><td align="left"></td><td align="left"></td><td align="left">目标主机上的存储路径。可以是绝对路径，也可以是相对路径。</td></tr><tr><td align="left">dirs</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">不递归传输</td></tr><tr><td align="left">existing_only</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">跳过目标端不存在的目录或文件(added in 1.5)</td></tr><tr><td align="left">mode</td><td align="left">no</td><td align="left">push</td><td align="left">push/pull</td><td align="left">指定推送方式，拉取或者推送，默认是push模式，push模式下src是源，pull模式下dest是源</td></tr><tr><td align="left">rsync_opts</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">通过数组指定额外的rsync选项(added in 1.6)</td></tr><tr><td align="left">rsync_path</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">指定远程主机上的rsync命令</td></tr><tr><td align="left">rsync_timeout</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">指定rsync的超时时间</td></tr><tr><td align="left">set_remote_user</td><td align="left">no</td><td align="left">True</td><td align="left"></td><td align="left">当远端服务器上自定义ssh配置文件中定义的remote user和inventory user不匹配的情况下，这个参数值设置为”no”</td></tr><tr><td align="left">use_ssh_args</td><td align="left">no</td><td align="left">no</td><td align="left">yes/no</td><td align="left">使用ansible.cfg中指定的ssh_args参数(added in 2.0)</td></tr><tr><td align="left">verify_host</td><td align="left">no</td><td align="left"></td><td align="left"></td><td align="left">验证目标主机的秘钥(added in 2.0)</td></tr></tbody></table><h2 id="使用场景举例-1"><a href="#使用场景举例-1" class="headerlink" title="使用场景举例"></a>使用场景举例</h2><ul><li>报错：”msg”: “Invalid shell type specified (bash), or the plugin for that shell type is missing.”<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m synchronize -a &quot;src=/tmp/test.txt dest=/tmp/&quot; -i hosts</span><br><span class="line">192.168.0.1 | FAILED! =&gt; &#123;</span><br><span class="line">    &quot;failed&quot;: true,</span><br><span class="line">    &quot;msg&quot;: &quot;Invalid shell type specified (bash), or the plugin for that shell type is missing.&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>解决方案：<ul><li>将<code>ansible.cfg</code>中的<code>executable = /bin/bash</code>注释掉<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m synchronize -a &quot;src=/tmp/test.txt dest=/tmp/&quot; -i hosts</span><br><span class="line">192.168.0.1 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;changed&quot;: true,</span><br><span class="line">    &quot;cmd&quot;: &quot;/usr/bin/rsync --delay-updates -F --compress --archive --rsh &apos;ssh  -S none -o StrictHostKeyChecking=no&apos; --out-format=&apos;&lt;&lt;CHANGED&gt;&gt;%i %n%L&apos; \&quot;/tmp/test.txt\&quot; \&quot;rsync.test.monitor.zw.ted:/tmp/\&quot;&quot;,</span><br><span class="line">    &quot;msg&quot;: &quot;&lt;f.st...... test.txt\n&quot;,</span><br><span class="line">    &quot;rc&quot;: 0,</span><br><span class="line">    &quot;stdout_lines&quot;: [</span><br><span class="line">        &quot;&lt;f.st...... test.txt&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li>push模式拉取文件<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m synchronize -a &quot;src=/tmp/test.txt dest=/tmp/ rsync_opts=&apos;-abvzP, --suffix=.bak-$(date &quot;+%Y-%m-%d_%H&quot;)&apos;&quot; -ihosts</span><br><span class="line">192.168.0.1 | SUCCESS =&gt; &#123;</span><br><span class="line">   &quot;changed&quot;: true,</span><br><span class="line">   &quot;cmd&quot;: &quot;/usr/bin/rsync --delay-updates -F --compress --archive --rsh &apos;ssh  -S none -o StrictHostKeyChecking=no&apos; -abvzP  --suffix=.bak-2017-08-04_18 --out-format=&apos;&lt;&lt;CHANGED&gt;&gt;%i %n%L&apos; \&quot;/tmp/test.txt\&quot; \&quot;rsync.test.monitor.zw.ted:/tmp/\&quot;&quot;,</span><br><span class="line">   &quot;msg&quot;: &quot;building file list ... \n 0 files...\r1 file to consider\n&lt;f..t...... test.txt\n           6 100%    0.00kB/s    0:00:00\r6 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)\n\nsent 79 bytes  received 37 bytes  77.33 bytes/sec\ntotal size is 6  speedup is 0.05\n&quot;,</span><br><span class="line">   &quot;rc&quot;: 0,</span><br><span class="line">   &quot;stdout_lines&quot;: [</span><br><span class="line">       &quot;building file list ... &quot;,</span><br><span class="line">       &quot; 0 files...\r1 file to consider&quot;,</span><br><span class="line">       &quot;&lt;f..t...... test.txt&quot;,</span><br><span class="line">       &quot;           6 100%    0.00kB/s    0:00:00\r           6 100%    0.00kB/s    0:00:00 (xfer#1, to-check=0/1)&quot;,</span><br><span class="line">       &quot;sent 79 bytes  received 37 bytes  77.33 bytes/sec&quot;,</span><br><span class="line">       &quot;total size is 6  speedup is 0.05&quot;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>pull模式拉取文件<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m synchronize -a &quot;mode=pull src=/tmp/tmp1 dest=/tmp/ rsync_opts=&apos;-abvzP, --suffix=.bak-$(date &quot;+%Y-%m-%d_%H&quot;)&apos;&quot; -i hosts</span><br><span class="line">192.168.0.1 | SUCCESS =&gt; &#123;</span><br><span class="line">   &quot;changed&quot;: true,</span><br><span class="line">   &quot;cmd&quot;: &quot;/usr/bin/rsync --delay-updates -F --compress --archive --rsh &apos;ssh  -S none -o StrictHostKeyChecking=no&apos; -abvzP  --suffix=.bak-2017-08-05_13 --out-format=&apos;&lt;&lt;CHANGED&gt;&gt;%i %n%L&apos; \&quot;rsync.test.monitor.zw.ted:/tmp/tmp1\&quot; \&quot;/tmp/\&quot;&quot;,</span><br><span class="line">   &quot;msg&quot;: &quot;receiving file list ... \n4 files to consider\ncd+++++++++ tmp1/\ncd+++++++++ tmp1/tmp2/\ncd+++++++++ tmp1/tmp2/tmp3/\n&gt;f+++++++++ tmp1/tmp2/tmp3/test.log\n           0   0%    0.00kB/s    0:00:00\r          13 100%   12.70kB/s    0:00:00 (xfer#1, to-check=0/4)\n\nsent 73 bytes  received 145 bytes  436.00 bytes/sec\ntotal size is 13  speedup is 0.06\n&quot;,</span><br><span class="line">   &quot;rc&quot;: 0,</span><br><span class="line">   &quot;stdout_lines&quot;: [</span><br><span class="line">       &quot;receiving file list ... &quot;,</span><br><span class="line">       &quot;4 files to consider&quot;,</span><br><span class="line">       &quot;cd+++++++++ tmp1/&quot;,</span><br><span class="line">       &quot;cd+++++++++ tmp1/tmp2/&quot;,</span><br><span class="line">       &quot;cd+++++++++ tmp1/tmp2/tmp3/&quot;,</span><br><span class="line">       &quot;&gt;f+++++++++ tmp1/tmp2/tmp3/test.log&quot;,</span><br><span class="line">       &quot;           0   0%    0.00kB/s    0:00:00\r          13 100%   12.70kB/s    0:00:00 (xfer#1, to-check=0/4)&quot;,</span><br><span class="line">       &quot;sent 73 bytes  received 145 bytes  436.00 bytes/sec&quot;,</span><br><span class="line">       &quot;total size is 13  speedup is 0.06&quot;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="copy模块和synchronize模块的简单比较"><a href="#copy模块和synchronize模块的简单比较" class="headerlink" title="copy模块和synchronize模块的简单比较"></a>copy模块和synchronize模块的简单比较</h1><ul><li>copy模块不支持从远端到本地的拉去操作，fetch模块支持，但是src参数不支持目录递归，只能回传具体文件；</li><li>copy模块的remote_src参数是指定从远端服务器上往远端服务器上复制，相当于在shell模块中执行copy命令；</li><li>synchronize则支持文件下发和回传，分别对应的push和pull模式。synchronize模块的功能依赖于rsync.x86_64，但是功能不依赖于rsync配置文件中定义的模块；</li><li>copy模块适用于小规模文件操作，synchronize支持大规模文件操作。</li></ul><h1 id="synchronize模块存在的缺陷"><a href="#synchronize模块存在的缺陷" class="headerlink" title="synchronize模块存在的缺陷"></a>synchronize模块存在的缺陷</h1><ul><li>hosts文件(inventory)中中如果使用<code>ansible_ssh_pass</code>通过用户名密码认证，则在使用synchronize模块时由于模块使用的是独立的ssh通道因此会再次提示输入密码，在大规模文件下发场景中使用体验较差，可以考虑通过其它途径实现。</li></ul>]]></content>
      <categories>
        <category>ansible</category>
      </categories>
      <tags>
        <tag>ansible</tag>
        <tag>运维自动化</tag>
      </tags>
  </entry>
  <entry>
    <title>shell的分批并发操作的简单实现</title>
    <url>/shell%E7%9A%84%E5%88%86%E6%89%B9%E5%B9%B6%E5%8F%91%E6%93%8D%E4%BD%9C%E7%9A%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<blockquote><p>很多情况下，计算资源是有限的。我们需要在任务时长和资源消耗之前取得一种平衡。因此需要进行并发和控制。</p></blockquote><a id="more"></a><ul><li><p>示例一</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat packetConcurrency.sh</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 并发数</span><br><span class="line">threads=3</span><br><span class="line"># 任务数</span><br><span class="line">tasks=9</span><br><span class="line">function task()</span><br><span class="line">&#123;</span><br><span class="line">	r=$(( $RANDOM % 30 + 1 ))</span><br><span class="line">	echo &quot;Start $1.&quot;</span><br><span class="line">	sleep $r</span><br><span class="line">	echo &quot;Finished $1,took $&#123;r&#125;s.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">counter=1</span><br><span class="line">for sn in $(seq 1 $&#123;tasks&#125;)</span><br><span class="line">do</span><br><span class="line">    task $&#123;sn&#125; &amp;</span><br><span class="line">    if [ &quot;$(($&#123;counter&#125; % $&#123;threads&#125;))&quot; -eq &quot;0&quot; ]; then</span><br><span class="line">	time wait</span><br><span class="line">	echo &quot;===================&quot;</span><br><span class="line">    fi</span><br><span class="line">    counter=$(($&#123;counter&#125; + 1))</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#######################################################</span><br><span class="line">执行结果：</span><br><span class="line"># sh packetConcurrency.sh</span><br><span class="line">Start 2.</span><br><span class="line">Start 3.</span><br><span class="line">Start 1.</span><br><span class="line">Finished 2,took 3s.</span><br><span class="line">Finished 1,took 14s.</span><br><span class="line">Finished 3,took 15s.</span><br><span class="line"></span><br><span class="line">real	0m15.014s       #每一批任务的耗时和该批任务中耗时最长的任务消耗的时间一致。</span><br><span class="line">user	0m0.021s</span><br><span class="line">sys	0m0.059s</span><br><span class="line">===================</span><br><span class="line">Start 5.</span><br><span class="line">Start 6.</span><br><span class="line">Start 4.</span><br><span class="line">Finished 5,took 1s.</span><br><span class="line">Finished 6,took 22s.</span><br><span class="line">Finished 4,took 26s.</span><br><span class="line"></span><br><span class="line">real	0m26.065s       #每一批任务的耗时和该批任务中耗时最长的任务消耗的时间一致。</span><br><span class="line">user	0m0.021s</span><br><span class="line">sys	0m0.050s</span><br><span class="line">===================</span><br><span class="line">Start 8.</span><br><span class="line">Start 9.</span><br><span class="line">Start 7.</span><br><span class="line">Finished 8,took 6s.</span><br><span class="line">Finished 7,took 9s.</span><br><span class="line">Finished 9,took 22s.</span><br><span class="line"></span><br><span class="line">real	0m22.101s       #每一批任务的耗时和该批任务中耗时最长的任务消耗的时间一致。</span><br><span class="line">user	0m0.088s</span><br><span class="line">sys	0m0.099s</span><br><span class="line">===================</span><br></pre></td></tr></table></figure></li><li><p>示例二</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat groupExec.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">groups=5</span><br><span class="line">tasks=20</span><br><span class="line">function groupExec()</span><br><span class="line">&#123;</span><br><span class="line">for group in $(seq 0 $(($&#123;groups&#125; - 1 )))</span><br><span class="line">do</span><br><span class="line">	echo &quot;======第$(($&#123;group&#125; + 1))组开始：======&quot;</span><br><span class="line">        for task in $(seq 0 $(($&#123;tasks&#125; - 1 )))</span><br><span class="line">        do</span><br><span class="line">                if [ &quot;$(($&#123;task&#125; / $(($&#123;tasks&#125; / $&#123;groups&#125;))))&quot; -eq &quot;$&#123;group&#125;&quot; ]; then</span><br><span class="line">                        &#123; echo &quot;task:$(( $&#123;task&#125; + 1 ))&quot;;sleep $(($RANDOM % 10)); &#125; &amp;</span><br><span class="line">                else</span><br><span class="line">                        continue</span><br><span class="line">                fi</span><br><span class="line">        done</span><br><span class="line">        wait</span><br><span class="line">	echo &quot;======第$(($&#123;group&#125; + 1))组完成。======&quot;</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line">groupExec</span><br><span class="line"></span><br><span class="line"># sh groupExec.sh</span><br><span class="line">======第1组开始：======</span><br><span class="line">task:1</span><br><span class="line">task:4</span><br><span class="line">task:3</span><br><span class="line">task:2</span><br><span class="line">======第1组完成。======</span><br><span class="line">======第2组开始：======</span><br><span class="line">task:5</span><br><span class="line">task:7</span><br><span class="line">task:8</span><br><span class="line">task:6</span><br><span class="line">======第2组完成。======</span><br><span class="line">======第3组开始：======</span><br><span class="line">task:9</span><br><span class="line">task:11</span><br><span class="line">task:12</span><br><span class="line">task:10</span><br><span class="line">======第3组完成。======</span><br><span class="line">======第4组开始：======</span><br><span class="line">task:15</span><br><span class="line">task:16</span><br><span class="line">task:13</span><br><span class="line">task:14</span><br><span class="line">======第4组完成。======</span><br><span class="line">======第5组开始：======</span><br><span class="line">task:19</span><br><span class="line">task:17</span><br><span class="line">task:18</span><br><span class="line">task:20</span><br><span class="line">======第5组完成。======</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>并发</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL常见的两种数据库引擎比较</title>
    <url>/mysql%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<p>MySQL有多种存储引擎：MyISAM、InnoDB、MERGE、MEMORY(HEAP)、BDB(BerkeleyDB)、EXAMPLE、FEDERATED、ARCHIVE、CSV、BLACKHOLE 等。</p><a id="more"></a><h1 id="MyISAM-amp-InnoDB比较"><a href="#MyISAM-amp-InnoDB比较" class="headerlink" title="MyISAM&amp;InnoDB比较"></a>MyISAM&amp;InnoDB比较</h1><style>table th:nth-of-type(2){width:80%}</style><table><thead><tr><th align="left">引擎</th><th align="left">特点</th></tr></thead><tbody><tr><td align="left">MyISAM</td><td align="left">MySQL的默认引擎；<br>磁盘上存储成三个文件（ .frm:表定义,.MYD:数据文件，.MYI (MYIndex):索引文件）；<br>不支持事务处理；<br>不支持外键；<br>支持全文检索（FULLTEXT）；<br>自增长字段可以和其它字段一起建立联合索引；<br>清空表操作是直接重建该表，效率高；<br>表级锁，并发量较小，不适合大量update；<br>缓存索引，查询数据相对较快，适合大量的select；<br>索引和数据分开，索引有压缩，内存使用率高；<br>表格可以被压缩；</td></tr><tr><td align="left">InnoDB</td><td align="left">磁盘存两个文件InnoDB表空间数据文件、日志文件；<br>支持事务处理；<br>支持外键；<br>不支持FULLTEXT类型的索引；<br>对于自增长的字段，InnoDB中必须包含只有该字段的索引；<br>清空整个表时，InnoDB是一行一行的删除，效率非常慢；<br>支持行锁；<br>并发量较大，适合大量update；<br>不保存表的行数；<br>如设置成默认引擎需在配置文件my.ini中指定default-storage-engine=INNODB</td></tr></tbody></table><ul><li><p>索引：是对数据库表中一列或多列的值进行排序的一种结构，使用索引可快速访问数据库表中的特定信息。索引有助于更快地获取信息。索引的一个主要目的就是加快检索表中数据的方法，也就是能协助信息搜索者尽快的找到符合限制条件的记录ID的辅助数据结构。</p><ul><li>存储结构划分<ul><li>聚簇索引：是按照数据存放的物理位置为顺序的，能提高多行检索的速度。</li><li>非聚簇索引：对于单行的检索很快。</li></ul></li><li>功能划分<ul><li>唯一索引：不允许其中任何两行具有相同索引值的索引。</li><li>主键索引：数据库表中一列或多列组合，其值唯一标识表中的的一行。在数据库关系图中为表定义主键将自动创建主键索引，主键索引是唯一索引的特定类型。该索引要求主键中的每个值都唯一。当在查询中使用主键索引时，它还允许对数据的快速访问。</li><li>聚集索引：在聚集索引中，表中行的物理顺序与键值的逻辑（索引）顺序相同。一个表只能包含一个聚集索引。如果某索引不是聚集索引，则表中行的物理顺序与键值的逻辑顺序不匹配。与非聚集索引相比，聚集索引通常提供更快的数据访问速度。</li></ul></li></ul></li><li><p>事务处理：事务是数据库运行中的逻辑工作单位。是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。一个逻辑工作单元要成为事务，必须满足所谓的ACID（原子性、一致性、隔离性和持久性）属性。</p><ul><li>原子性：一组事务，要么成功；要么撤回。</li><li>稳定性 ：有非法数据（外键约束之类），事务撤回。</li><li>隔离性：事务独立运行。一个事务处理后的结果，影响了其他事务，那么其他事务会撤回。事务的100%隔离，需要牺牲速度。</li><li>可靠性：软、硬件崩溃后，InnoDB数据表驱动会利用日志文件重构修改。可靠性和高速度不可兼得，innodb_flush_log_at_trx_commit 选项 决定什么时候吧事务保存到日志里。在 MySQL 命令行的默认设置下，事务都是自动提交的，即执行 SQL 语句后就会马上执行 COMMIT 操作。因此要显式地开启一个事务务须使用命令 BEGIN 或 START TRANSACTION，或者执行命令 SET AUTOCOMMIT=0，用来禁止使用当前会话的自动提交。</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><p><a href="https://my.oschina.net/junn/blog/183341" target="_blank" rel="noopener">MySQL存储引擎InnoDB与Myisam的六大区别</a></p></li><li><p><a href="http://www.runoob.com/mysql/mysql-transaction.html" target="_blank" rel="noopener">MySQL 事务</a></p></li><li><p><a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/9744607?fr=aladdin" target="_blank" rel="noopener">数据库事务</a></p></li></ul>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
        <tag>数据库</tag>
      </tags>
  </entry>
  <entry>
    <title>shell脚本传参</title>
    <url>/shell%E8%84%9A%E6%9C%AC%E4%BC%A0%E5%8F%82/</url>
    <content><![CDATA[<ul><li>shell脚本通常有三种传参方式：<ul><li>手工处理</li><li>getopts</li><li>getopt</li></ul></li></ul><h1 id="手工处理方式"><a href="#手工处理方式" class="headerlink" title="手工处理方式"></a>手工处理方式</h1><ul><li>内置变量<ul><li>$0 脚本文件名</li><li>$1—$9 穿入的第1—9个参数。第10个参数用${10}表示</li><li>$# 参数个数</li><li>$@ 参数列表</li><li>$*</li><li>$$ 脚本进程<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat test.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line">n=0</span><br><span class="line">for parameter in $@</span><br><span class="line">do</span><br><span class="line">    echo &quot;第$((++n))个参数值为:$&#123;parameter&#125;&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"># sh test.sh a b c d e</span><br><span class="line">第1个参数值为:a</span><br><span class="line">第2个参数值为:b</span><br><span class="line">第3个参数值为:c</span><br><span class="line">第4个参数值为:d</span><br><span class="line">第5个参数值为:e</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="getopts"><a href="#getopts" class="headerlink" title="getopts"></a>getopts</h1><blockquote><p>getopts是由bash内置,不支持长参数选项，使用简单,不会重排所有参数的顺序。</p></blockquote><ul><li>参数说明：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">所有选项参数必须写在其它参数的前面</span><br><span class="line">不支持长选项</span><br><span class="line">usage: </span><br><span class="line">    getopts optstring name [arg]</span><br><span class="line">&quot;:&quot;         选项后面跟单个冒号表示该选项跟参数</span><br><span class="line">&quot;$OPTARG&quot;   内置变量，用于存放参数值</span><br><span class="line">&quot;$OPTIND&quot;   代表当前选项在参数列表中的位移。参数从1开始编号，getopts在处理参数的时候，处理一个开关型选项，OPTIND加1，处理一个带值的选项参数，OPTIND则会加2。</span><br></pre></td></tr></table></figure></li><li>范例<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat getopts.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">while getopts &quot;a:b:cd&quot; args</span><br><span class="line">do</span><br><span class="line">    echo -e &quot;\$args:$args \t\$OPTARG:$OPTARG\t\$OPTIND:$OPTIND&quot;</span><br><span class="line">    case $args in</span><br><span class="line">    a)</span><br><span class="line">        echo &quot;$args&apos;s arg:$OPTARG,\$OPTIND:$OPTIND&quot;</span><br><span class="line">    ;;</span><br><span class="line">    b)</span><br><span class="line">        echo &quot;$args&apos;s arg:$OPTARG,\$OPTIND:$OPTIND&quot;</span><br><span class="line">    ;;</span><br><span class="line">    c)</span><br><span class="line">        echo &quot;$args&apos;s arg:$OPTARG,\$OPTIND:$OPTIND&quot;</span><br><span class="line">    ;;</span><br><span class="line">    d)</span><br><span class="line">        echo &quot;$args&apos;s arg:$OPTARG,\$OPTIND:$OPTIND&quot;</span><br><span class="line">    ;;</span><br><span class="line">    #当遇到未定义的选项时args值为?</span><br><span class="line">    #*)</span><br><span class="line">    #    echo &quot;$args&apos;s arg:$OPTARG,\$OPTIND:$OPTIND&quot;</span><br><span class="line">    #	exit 1</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 参数不被重新排序，当遇到不能被识别的参数&quot;3&quot;时，循环退出。</span><br><span class="line"># sh getopts.sh -a 1 -b 2 -c 3 -d 4</span><br><span class="line">$args:a 	$OPTARG:1	$OPTIND:3</span><br><span class="line">a&apos;s arg:1,$OPTIND:3</span><br><span class="line">$args:b 	$OPTARG:2	$OPTIND:5</span><br><span class="line">b&apos;s arg:2,$OPTIND:5</span><br><span class="line">$args:c 	$OPTARG:	$OPTIND:6</span><br><span class="line">c&apos;s arg:,$OPTIND:6</span><br><span class="line"></span><br><span class="line">#参数合并</span><br><span class="line"># sh getopts.sh -a1 -b2 -cd</span><br><span class="line">$args:a 	$OPTARG:1	$OPTIND:2</span><br><span class="line">a&apos;s arg:1,$OPTIND:2</span><br><span class="line">$args:b 	$OPTARG:2	$OPTIND:3</span><br><span class="line">b&apos;s arg:2,$OPTIND:3</span><br><span class="line">$args:c 	$OPTARG:	$OPTIND:3</span><br><span class="line">c&apos;s arg:,$OPTIND:3</span><br><span class="line">$args:d 	$OPTARG:	$OPTIND:4</span><br><span class="line">d&apos;s arg:,$OPTIND:4</span><br></pre></td></tr></table></figure></li></ul><h1 id="getopt"><a href="#getopt" class="headerlink" title="getopt"></a>getopt</h1><blockquote><p>getopt是独立的可执行文件</p></blockquote><ul><li>常用参数说明<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">−a, −−alternative           使getopt长参数支持&quot;-&quot;符号打头，必须与-l同时使用</span><br><span class="line">−l, −−longoptions           表示长选项，后面接getopt支持长参数列表，逗号分隔</span><br><span class="line">−n, −−name progname         如果getopt处理参数出错，返回错误提示</span><br><span class="line">−o, −−options shortopts     表示短选项，后面接短参数列表，这种用法与getopts类似。两个冒号表示该选项有一个可选参数，可选参数必须紧贴选项。</span><br><span class="line">−q, −−quiet                 关闭错误输出</span><br><span class="line">−Q, −−quiet−output          关闭正常输出</span><br><span class="line">−s, −−shell shell           指定shell类型，&quot;sh&quot;,&quot;bash&quot;,&quot;csh&quot;,&quot;tcsh&quot;.</span><br><span class="line">−u, −−unquoted              不给参数列表加引号，默认是加引号的（不使用-u选项）</span><br><span class="line">−T, −−test                  测试getopt是增强版或旧版，不生成输出。</span><br><span class="line">−V, −−version</span><br><span class="line">−h, −−help</span><br><span class="line">$@                          参数本身的列表，也不包括命令本身</span><br><span class="line">&quot;:&quot;         选项后面跟单个冒号表示该选项必须跟参数</span><br><span class="line">&quot;::&quot;        选项后面跟两个冒号表示该选项可以跟参数</span><br></pre></td></tr></table></figure></li><li>范例<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat getopt.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">OPTS=$(getopt -s bash -o x:y::z -a --long aaaa:,bbbb::,cccc -n &apos;warning&apos; -- &quot;$@&quot;)</span><br><span class="line"></span><br><span class="line">eval set -- &quot;$OPTS&quot;</span><br><span class="line"></span><br><span class="line">while true;</span><br><span class="line">do</span><br><span class="line">    case &quot;$1&quot; in</span><br><span class="line">    -x|--aaaa)</span><br><span class="line">	echo -e &quot;Hit $1,arg=$2&quot;</span><br><span class="line">	shift 2</span><br><span class="line">    ;;</span><br><span class="line">    -y|--bbbb)</span><br><span class="line">        echo -e &quot;Hit $1,arg=$2&quot;</span><br><span class="line">	shift 2</span><br><span class="line">    ;;</span><br><span class="line">    -z|--cccc)</span><br><span class="line">        echo -e &quot;Hit $1,arg=$2&quot;</span><br><span class="line">	shift</span><br><span class="line">    ;;</span><br><span class="line">    --)</span><br><span class="line">        echo -e &quot;Hit $1,arg=$2&quot;</span><br><span class="line">	shift;</span><br><span class="line">	break</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">        echo -e &quot;\nNo parameters were hit.\n&quot;</span><br><span class="line">	break</span><br><span class="line">    ;;</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">## -cccc后没有冒号，实际执行中后面即使跟了参数也不会被接收</span><br><span class="line"># sh getopt.sh -aaaa 1 -bbbb=2 -cccc 3</span><br><span class="line">Hit --aaaa,arg=1</span><br><span class="line">Hit --bbbb,arg=2</span><br><span class="line">Hit --cccc,arg=--</span><br><span class="line">Hit --,arg=3</span><br><span class="line"></span><br><span class="line">## 长参数类型中，可选参数必须由等号连接选项和参数，空格隔开无法接收</span><br><span class="line"># sh getopt.sh -aaaa 1 -bbbb 2 -cccc 3</span><br><span class="line">Hit --aaaa,arg=1</span><br><span class="line">Hit --bbbb,arg=</span><br><span class="line">Hit --cccc,arg=--</span><br><span class="line">Hit --,arg=2</span><br><span class="line"></span><br><span class="line"># sh getopt.sh -x 1 -y 2 -z</span><br><span class="line">Hit -x,arg=1</span><br><span class="line">Hit -y,arg=</span><br><span class="line">Hit -z,arg=--</span><br><span class="line">Hit --,arg=2</span><br><span class="line"></span><br><span class="line">## 在短选项参数中，可选参数可紧跟选项传参，长选项中不支持</span><br><span class="line"># sh getopt.sh -aaaa 1 -bbbb2 -cccc 3</span><br><span class="line">warning：无法识别的选项“-bbbb2”</span><br><span class="line">Hit --aaaa,arg=1</span><br><span class="line">Hit --cccc,arg=--</span><br><span class="line">Hit --,arg=3</span><br><span class="line"></span><br><span class="line">## sh getopt.sh -aaaa 1 -bbbb2 -cccc 3</span><br><span class="line">warning：无法识别的选项“-bbbb2”</span><br><span class="line">Hit --aaaa,arg=1</span><br><span class="line">Hit --cccc,arg=--</span><br><span class="line">Hit --,arg=3</span><br><span class="line"></span><br><span class="line">##如果没有参数的选项后跟了参数，且不是在参数列表的最后位置，会导致参数错乱</span><br><span class="line"># sh getopt.sh -cccc 1 -bbbb=2 -aaaa 3</span><br><span class="line">Hit --cccc,arg=--bbbb</span><br><span class="line">Hit --bbbb,arg=2</span><br><span class="line">Hit --aaaa,arg=3</span><br><span class="line">Hit --,arg=1</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>传参</tag>
      </tags>
  </entry>
  <entry>
    <title>curl命令使用范例</title>
    <url>/curl%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8%E8%8C%83%E4%BE%8B/</url>
    <content><![CDATA[<h1 id="curl常用参数："><a href="#curl常用参数：" class="headerlink" title="curl常用参数："></a>curl常用参数：</h1><style>table th:nth-of-type(1){width:15%}nth-of-type(2){width:85%}</style><table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">-A/–user-agent</td><td align="left">定义用户代理字符串</td></tr><tr><td align="left">-H/–header</td><td align="left">自定义header头信息</td></tr><tr><td align="left">-i/–include</td><td align="left">输出时包括protocol头信息</td></tr><tr><td align="left">-I/–head</td><td align="left">只显示请求的头信息</td></tr><tr><td align="left">-o/–output</td><td align="left">把输出写到该文件中</td></tr><tr><td align="left">-s/–silent</td><td align="left">静默模式</td></tr><tr><td align="left">-w/–write-out [format]</td><td align="left">在一次完整且成功的操作后输出指定格式的内容到标准输出</td></tr><tr><td align="left">-X/–request</td><td align="left">指定请求方式</td></tr><tr><td align="left">-u/–user</td><td align="left">设置服务器的用户和密码</td></tr><tr><td align="left">-T/–upload-file</td><td align="left">上传文件</td></tr><tr><td align="left">-l/–list-only</td><td align="left">列出ftp目录下的文件名称</td></tr><tr><td align="left">–limit-rate</td><td align="left">设置传输速度</td></tr><tr><td align="left">-m/–max-time</td><td align="left">设置最大传输时间</td></tr></tbody></table><h1 id="常用范例-纯shell命令-："><a href="#常用范例-纯shell命令-：" class="headerlink" title="常用范例(纯shell命令)："></a>常用范例(纯shell命令)：</h1><ul><li><p>伪造UA绑host请求:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl --user-agent &quot;curl-test-agent&quot; -H &quot;Host:www.lengyuewusheng.com&quot; -I &quot;http://10.0.0.1/index.php&quot;</span><br></pre></td></tr></table></figure></li><li><p>伪造X-Real-IP：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -H &quot;X-Real-IP:1.1.1.1&quot; -H &quot;Host:www.lengyuwusheng.com&quot; &quot;http://10.0.0.1/index.php&quot;</span><br></pre></td></tr></table></figure></li><li><p>获取请求的状态码字符串</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -o /dev/null -s -w &quot;%&#123;http_code&#125;\n&quot; -H &quot;Host:www.lengyuewusheng.com&quot; &quot;http://10.0.0.1/index.php&quot;</span><br></pre></td></tr></table></figure></li><li><p>向服务器端POST数据</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -X POST -d &quot;a=1&amp;b=2&amp;c=3&quot; &quot;http://www.lengyuewusheng.com&quot;</span><br></pre></td></tr></table></figure></li><li><p>指定请求的超时时间</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl --connect-timeout 5 -m 90 -o /dev/null -s -w &quot;%&#123;http_code&#125;&quot; &quot;http://www.lengyuewusheng.com&quot;</span><br></pre></td></tr></table></figure></li><li><p>通过curl向ftp服务器上传文件</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl -u &quot;$&#123;USER&#125;:$&#123;PASSWD&#125;&quot; -T &quot;$&#123;DATADIR&#125;/$&#123;FILE&#125;&quot; &quot;ftp://$&#123;FTPSERVER&#125;&quot;</span><br><span class="line"># eg: curl -u &quot;admin:123456&quot; -T &quot;/tmp/logs/test.log&quot; &quot;ftp://10.0.0.1&quot;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      <categories>
        <category>shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
        <tag>curl</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx部分常用内置变量</title>
    <url>/nginx%E9%83%A8%E5%88%86%E5%B8%B8%E7%94%A8%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<style>table th:nth-of-type(1){width:15%}nth-of-type(2){width:45%}nth-of-type(3){width:40%}</style><table><thead><tr><th align="left">变量名</th><th align="left">说明</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">$host</td><td align="left">请求中的主机头(Host)字段</td><td align="left">如果请求中的主机头不可用或为空，则为处理请求的server名称(处理请求的server的server_name指令的值)。值为小写，不包含端口。</td></tr><tr><td align="left">$server_name</td><td align="left">服务器名称</td><td align="left">nginx conf文件Server模块中定义的值</td></tr><tr><td align="left">$server_port</td><td align="left">服务器端的端口号</td><td align="left">eg: 80、8080、443</td></tr><tr><td align="left">$remote_port</td><td align="left">客户端的端口</td><td align="left"></td></tr><tr><td align="left">$remote_addr</td><td align="left">客户端的IP地址</td><td align="left"></td></tr><tr><td align="left">$$binary_remote_addr</td><td align="left">二进制码形式的客户端地址</td><td align="left"></td></tr><tr><td align="left">$document_root</td><td align="left">当前请求在root指令中指定的值</td><td align="left"></td></tr><tr><td align="left">$scheme</td><td align="left">协议</td><td align="left">eg: http、https</td></tr><tr><td align="left">$cookie_COOKIE</td><td align="left">cookie中COOKIE的值</td><td align="left">eg: $cookie_iploc</td></tr><tr><td align="left">$http_HEADER</td><td align="left">匹配任意请求头字段</td><td align="left">“HEADER”可以替换成任意请求头字段，如在配置文件中需要获取http请求头：“Accept-Language”，那么将“－”替换为下划线，大写字母替换为小写，形如：$http_accept_language即可。</td></tr><tr><td align="left">$sent_http_HEADER</td><td align="left">HTTP响应头中的内容，HEADER为HTTP响应中的内容转为小写，-变为_(破折号变为下划线)</td><td align="left">eg: $sent_http_cache_control、$sent_http_content_type</td></tr><tr><td align="left">$request_uri</td><td align="left">请求参数的原始URI</td><td align="left">无法修改，请查看$uri更改或重写URI</td></tr><tr><td align="left">$uri</td><td align="left">请求中的当前URI(不带请求参数，参数位于$args)</td><td align="left">不同于浏览器传递的$request_uri的值，它可以通过内部重定向，或者使用index指令进行修改。不包括协议和主机名，例如/foo/bar.html</td></tr><tr><td align="left">$document_uri</td><td align="left">与$uri相同</td><td align="left"></td></tr><tr><td align="left">$args</td><td align="left">GET请求中的参数</td><td align="left">eg: foo=123&amp;bar=abc;</td></tr><tr><td align="left">$arg_name</td><td align="left">请求中参数name的值</td><td align="left"></td></tr><tr><td align="left">$query_string</td><td align="left">与$args相同</td><td align="left"></td></tr><tr><td align="left">$arg_PARAMETER</td><td align="left">GET请求中变量名PARAMETER参数的值</td><td align="left"></td></tr><tr><td align="left">$http_referer</td><td align="left">引导用户代理到当前页的前一页的地址信息</td><td align="left"></td></tr><tr><td align="left">$http_x_forwarded-for</td><td align="left">表示 HTTP 请求端真实 IP</td><td align="left">X-Forwarded-For格式：<code>X-Forwarded-For: client, proxy1, proxy2</code>XFF的内容由「英文逗号+空格」隔开的多个部分组成，第一个IP是离服务端最远的设备IP，然后是每一级代理的IP</td></tr></tbody></table><ul><li>通常情况下：$request_uri=$document_uri($uri)+$query_string($args)</li></ul><blockquote><ul><li>eg: <a href="http://localhost:8080/test1/test2/index.php?a=1&amp;b=2&amp;c=3" target="_blank" rel="noopener">http://localhost:8080/test1/test2/index.php?a=1&amp;b=2&amp;c=3</a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;$server_port：8080</span><br><span class="line">&gt;$request_uri：/test1/test2/index.php?a=1&amp;b=2&amp;c=3</span><br><span class="line">&gt;$document_uri：/test1/test2/index.php</span><br><span class="line">&gt;$query_string: a=1&amp;b=2&amp;c=3</span><br><span class="line">&gt;$uri: /test1/test2/index.php</span><br><span class="line">&gt;$args: a=1&amp;b=2&amp;c=3</span><br><span class="line">&gt;$document_root：/usr/local/nginx/html</span><br><span class="line">&gt;$request_filename：/usr/local/nginx/html/test1/test2/index.php</span><br></pre></td></tr></table></figure></li></ul></blockquote>]]></content>
      <categories>
        <category>nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>DOS常用命令总结</title>
    <url>/dos%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<ul><li><p>查看历史命令（快捷键：F7）</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">doskey /history</span><br></pre></td></tr></table></figure></li><li><p>查看端口</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -ano|findstr &quot;80&quot;</span><br></pre></td></tr></table></figure></li><li><p>查看进程PID</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tasklist</span><br><span class="line"># /s computer 制定远程计算机名称或IP</span><br><span class="line"># /u domain\user 指定用户</span><br><span class="line"># /p password 指定用户密码</span><br></pre></td></tr></table></figure></li><li><p>查看进程PID</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">taskkill</span><br><span class="line"># /s computer 制定远程计算机名称或IP</span><br><span class="line"># /u domain\user 指定用户</span><br><span class="line"># /p password 指定用户密码</span><br><span class="line"># /pid ProcessID 被终止进程的ID</span><br><span class="line"># /f 强制终止。远程进程可忽略此参数，所有远程进程都会被强制终止</span><br><span class="line"># /t 终止与父进程的所有子进程</span><br></pre></td></tr></table></figure></li><li><p>自动关机</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shutdown</span><br><span class="line"># /m \\ComputerName 关闭远程机器</span><br><span class="line"># /l 注销当前用户</span><br><span class="line"># /s 关机</span><br><span class="line"># /r 重启</span><br><span class="line"># /f 强制关闭应用程序</span><br><span class="line"># /c &quot;comment&quot; 操作说明</span><br></pre></td></tr></table></figure></li><li><p>文件系统转换</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">convert D: /fs:ntfs /x</span><br><span class="line"># /x 强制卸除卷标</span><br></pre></td></tr></table></figure></li><li><p>磁盘检查</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chkdsk C: /X /R /F</span><br><span class="line"># /X    如果必要，则先强制卸除卷。</span><br><span class="line"># /R    查找坏扇区并恢复可读信息</span><br><span class="line"># /F    修复磁盘上的错误。</span><br></pre></td></tr></table></figure></li><li><p>修改文件属性</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">attrib [+R|-R] [+A|-A] [+S|-S] [+H|-H] [+I|-I] [drive:][path][filename] [/S [/D] [/L]]</span><br><span class="line">#  +   设置属性。</span><br><span class="line">#  -   清除属性。</span><br><span class="line">#  R   只读文件属性。</span><br><span class="line">#  A   存档文件属性。</span><br><span class="line">#  S   系统文件属性。</span><br><span class="line">#  H   隐藏文件属性。</span><br><span class="line">#  I   无内容索引文件属性。</span><br><span class="line">#  X   无清理文件属性。</span><br><span class="line">#  V   完整性属性。</span><br><span class="line">#  [drive:][path][filename]指定 attrib 要处理的文件</span><br><span class="line">#  /S  处理当前文件夹及其所有子文件夹中的匹配文件</span><br><span class="line">#  /D  也处理文件夹。</span><br><span class="line">#  /L  处理符号链接和符号链接目标的属性</span><br></pre></td></tr></table></figure></li><li><p>内网主机名IP互查</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">根据IP查主机名</span><br><span class="line">nbtstat -A IP</span><br><span class="line">ping -a IP</span><br><span class="line">根据主机名查IP</span><br><span class="line">nbtstat -a 主机名</span><br><span class="line">ping 主机名</span><br></pre></td></tr></table></figure></li><li><p>组策略</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">打开组策略</span><br><span class="line">gpedit.msc</span><br><span class="line">强制刷新组策略</span><br><span class="line">gpupdate /force</span><br><span class="line">仅刷新用户策略</span><br><span class="line">gpupdate /target:user</span><br></pre></td></tr></table></figure><ul><li>一般如果所有配置都正确的情况下，Mac远程桌面Windows依然连不上，就强制刷新一下组策略有可能会出现奇迹。。。</li></ul></li><li><p>help</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">help [command]</span><br><span class="line"># 提供 Windows 命令的帮助信息。</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      <categories>
        <category>DOS</category>
      </categories>
      <tags>
        <tag>DOS</tag>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo(Next)+GitHub Pages搭建开源博客</title>
    <url>/hexo-next-github-pages%E6%90%AD%E5%BB%BA%E5%BC%80%E6%BA%90%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h1 id="node环境"><a href="#node环境" class="headerlink" title="node环境"></a>node环境</h1><p>略</p><h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br><span class="line">hexo init MyBlog</span><br><span class="line">cd MyBlog</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><h1 id="安装主题"><a href="#安装主题" class="headerlink" title="安装主题"></a>安装主题</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/iissnan/hexo-theme-next.git themes/next</span><br></pre></td></tr></table></figure><h1 id="创建页面"><a href="#创建页面" class="headerlink" title="创建页面"></a>创建页面</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo new page &quot;tags&quot;</span><br><span class="line">hexo new page categories</span><br><span class="line">hexo new page &quot;about&quot;</span><br></pre></td></tr></table></figure><h1 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-server</span><br><span class="line">npm install --save hexo-wordcount</span><br><span class="line">npm install --save hexo-asset-image</span><br><span class="line">npm install --save hexo-generator-tag</span><br><span class="line">npm install --save hexo-generator-feed</span><br><span class="line">npm install --save hexo-generator-index</span><br><span class="line">npm install --save hexo-generator-archive</span><br><span class="line">npm install --save hexo-generator-category</span><br><span class="line">npm install --save hexo-generator-search</span><br><span class="line">npm install --save hexo-generator-searchdb</span><br><span class="line">npm install --save hexo-generator-sitemap</span><br><span class="line">npm install --save hexo-generator-baidu-sitemap</span><br><span class="line">npm install --save hexo-generator-seo-friendly-sitemap</span><br><span class="line"># npm install --save hexo-filter-indicate-the-source</span><br><span class="line"># 压缩</span><br><span class="line">npm install --save hexo-uglify</span><br><span class="line">npm install --save hexo-imagemin    # 安装报错 19</span><br><span class="line">npm install --save hexo-clean-css</span><br><span class="line">npm install --save hexo-html-minifier # 安装报错 2</span><br><span class="line"># 发布</span><br><span class="line">npm install --save hexo-deployer-git</span><br><span class="line">npm install --save hexo-deployer-rsync</span><br><span class="line">npm install --save gulp-minify-css gulp-uglify gulp-htmlmin gulp-htmlclean gulp </span><br><span class="line"></span><br><span class="line"># 其它插件</span><br><span class="line">npm install --save hexo-recommended-posts</span><br></pre></td></tr></table></figure><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 清空缓存</span><br><span class="line">hexo clean</span><br><span class="line"></span><br><span class="line"># 创建草稿</span><br><span class="line">hexo new draft &quot;My first Blog&quot;</span><br><span class="line"></span><br><span class="line"># 将草稿发布成文章</span><br><span class="line">hexo publish &quot;My first Blog&quot;</span><br><span class="line"></span><br><span class="line"># 直接创建文章</span><br><span class="line">hexo new &quot;My second Blog&quot;</span><br><span class="line"></span><br><span class="line"># 生成静态文件并部署网站</span><br><span class="line">hexo generate(g) --deploy( -d)</span><br><span class="line"></span><br><span class="line"># 启动本地服务</span><br><span class="line">hexo server -i 10.0.0.1 -p 80 -l</span><br><span class="line"></span><br><span class="line"># 获取推荐文章列表，前提是已安装hexo-recommended-posts插件</span><br><span class="line">hexo recommend</span><br></pre></td></tr></table></figure><h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><h2 id="首页博客间距调整"><a href="#首页博客间距调整" class="headerlink" title="首页博客间距调整"></a>首页博客间距调整</h2><blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo-theme-next\source\css\_schemes\Mist\_posts-expanded.styl</span><br><span class="line">.post &#123; margin-top: 60px; &#125;</span><br></pre></td></tr></table></figure></blockquote><h2 id="自定义内容区域的宽度"><a href="#自定义内容区域的宽度" class="headerlink" title="自定义内容区域的宽度"></a>自定义内容区域的宽度</h2><blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo-theme-next\source\css\_variables\custom.styl</span><br><span class="line">$content-desktop = 700px</span><br><span class="line">$content-desktop-large = 900px</span><br><span class="line"># 此方法不适用于 Pisces Scheme</span><br><span class="line"># 移动设备下，宽度自适应</span><br></pre></td></tr></table></figure></blockquote><h2 id="替换文章标签图标"><a href="#替换文章标签图标" class="headerlink" title="替换文章标签图标"></a>替换文章标签图标</h2><ul><li>themes/hexo-theme-next-6.7.0/layout/_macro/post.swig</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将</span><br><span class="line">rel=&quot;tag&quot;&gt;#</span><br><span class="line">替换为</span><br><span class="line">rel=&quot;tag&quot;&gt;&lt;i class=&quot;fa fa-tag&quot;&gt;&lt;/i&gt;</span><br></pre></td></tr></table></figure><h2 id="自定义样式优化"><a href="#自定义样式优化" class="headerlink" title="自定义样式优化"></a>自定义样式优化</h2><ul><li>themes\hexo-theme-next-6.7.0\source\css_custom\custom.styl 追加</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// 主页文章添加阴影效果</span><br><span class="line">.post &#123;</span><br><span class="line">  margin-top: 2%;</span><br><span class="line">  margin-bottom: 5%;</span><br><span class="line">  padding: 1%;</span><br><span class="line">  -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5);</span><br><span class="line">  -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.main-inner &#123;</span><br><span class="line">  margin-top: 2%;</span><br><span class="line">  padding: 2% 2% 2% 2%;</span><br><span class="line">  background: #fff;</span><br><span class="line">  min-height: 95%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.footer &#123;</span><br><span class="line">    margin-top: 1%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 自动更新背景图片</span><br><span class="line">body &#123;</span><br><span class="line">  background: url(https://source.unsplash.com/random/1600x900);</span><br><span class="line">  background-repeat: no-repeat;</span><br><span class="line">  background-attachment:fixed;</span><br><span class="line">  background-size: cover;</span><br><span class="line">  background-position:50% 50%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 修改博客页面宽度</span><br><span class="line">.container .main-inner &#123;</span><br><span class="line">  width: 85%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 优化修改博客标题位置</span><br><span class="line">.posts-expand .post &#123;</span><br><span class="line">  margin-top: 3%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 优化标题字体大写</span><br><span class="line">.menu .menu-item a, .menu .menu-item span.exturl &#123;</span><br><span class="line">  font-size: 16px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="公益404页面优化404效果"><a href="#公益404页面优化404效果" class="headerlink" title="公益404页面优化404效果"></a>公益404页面优化404效果</h2><ul><li>在source目录下创建404.html<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8;&quot;/&gt;</span><br><span class="line">  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;</span><br><span class="line">  &lt;meta name=&quot;robots&quot; content=&quot;all&quot; /&gt;</span><br><span class="line">  &lt;meta name=&quot;robots&quot; content=&quot;index,follow&quot;/&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://qzone.qq.com/gy/404/style/404style.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js&quot; charset=&quot;utf-8&quot; homePageUrl=&quot;https://www.lengyuewusheng.com&quot; homePageName=&quot;回到 www.lengyuewusheng.com&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li>测试只有在发布到github pages上才生效，本地测试无法直接跳转。</li></ul></li></ul><h2 id="文章结尾增加版权声明"><a href="#文章结尾增加版权声明" class="headerlink" title="文章结尾增加版权声明"></a>文章结尾增加版权声明</h2><ul><li>themes/hexo-theme-next-6.7.0/layout/_macro/ 目录下创建 my-copyright.swig</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% if page.copyright %&#125;</span><br><span class="line">&lt;div class=&quot;my_post_copyright&quot;&gt;</span><br><span class="line">  &lt;script src=&quot;//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- JS库 sweetalert 可修改路径 --&gt;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot; src=&quot;http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script src=&quot;http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css&quot;&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;本文标题:&lt;/span&gt;&lt;a href=&quot;&#123;&#123; url_for(page.path) &#125;&#125;&quot;&gt;&#123;&#123; page.title &#125;&#125;&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;文章作者:&lt;/span&gt;&lt;a href=&quot;/&quot; title=&quot;访问 &#123;&#123; theme.author &#125;&#125; 的个人博客&quot;&gt;&#123;&#123; theme.author &#125;&#125;&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;发布时间:&lt;/span&gt;&#123;&#123; page.date.format(&quot;YYYY年MM月DD日 - HH:MM&quot;) &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;最后更新:&lt;/span&gt;&#123;&#123; page.updated.format(&quot;YYYY年MM月DD日 - HH:MM&quot;) &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;原始链接:&lt;/span&gt;&lt;a href=&quot;&#123;&#123; url_for(page.path) &#125;&#125;&quot; title=&quot;&#123;&#123; page.title &#125;&#125;&quot;&gt;&#123;&#123; page.permalink &#125;&#125;&lt;/a&gt;</span><br><span class="line">    &lt;span class=&quot;copy-path&quot;  title=&quot;点击复制文章链接&quot;&gt;&lt;i class=&quot;fa fa-clipboard&quot; data-clipboard-text=&quot;&#123;&#123; page.permalink &#125;&#125;&quot;  aria-label=&quot;复制成功！&quot;&gt;&lt;/i&gt;&lt;/span&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  &lt;!-- p&gt;&lt;span&gt;许可协议:&lt;/span&gt;&lt;i class=&quot;fa fa-creative-commons&quot;&gt;&lt;/i&gt; &lt;a rel=&quot;license&quot; href=&quot;https://creativecommons.org/licenses/by-nc-nd/4.0/&quot; target=&quot;_blank&quot; title=&quot;Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)&quot;&gt;署名-非商业性使用-禁止演绎 4.0 国际&lt;/a&gt; 转载请保留原文链接及作者。&lt;/p --&gt;</span><br><span class="line">  &lt;p&gt;&lt;span&gt;许可协议:&lt;/span&gt;本博客所有文章除特别声明外，均采用&lt;i class=&quot;fa fa-creative-commons&quot;&gt;&lt;/i&gt;&lt;a href=&quot;https://creativecommons.org/licenses/by-nc-sa/3.0/&quot; rel=&quot;external nofollow&quot; target=&quot;_blank&quot;&gt; BY-NC-SA 3.0&lt;/a&gt;许可协议。转载请注明出处！&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var clipboard = new Clipboard(&apos;.fa-clipboard&apos;);</span><br><span class="line">    clipboard.on(&apos;success&apos;, $(function()&#123;</span><br><span class="line">      $(&quot;.fa-clipboard&quot;).click(function()&#123;</span><br><span class="line">        swal(&#123;</span><br><span class="line">          title: &quot;&quot;,</span><br><span class="line">          text: &apos;复制成功&apos;,</span><br><span class="line">          html: false,</span><br><span class="line">          timer: 500,</span><br><span class="line">          showConfirmButton: false</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;));</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><ul><li>themes/hexo-theme-next-6.7.0/source/css/_common/components/post/ 目录下创建 my-post-copyright.styl</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.my_post_copyright &#123;</span><br><span class="line">  width: 85%;</span><br><span class="line">  max-width: 45em;</span><br><span class="line">  margin: 2.8em auto 0;</span><br><span class="line">  padding: 0.5em 1.0em;</span><br><span class="line">  border: 1px solid #d3d3d3;</span><br><span class="line">  font-size: 0.93rem;</span><br><span class="line">  line-height: 1.6em;</span><br><span class="line">  word-break: break-all;</span><br><span class="line">  background: rgba(255,255,255,0.4);</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright p&#123;margin:0;&#125;</span><br><span class="line">.my_post_copyright span &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  width: 5.2em;</span><br><span class="line">  color: #b5b5b5;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright .raw &#123;</span><br><span class="line">  margin-left: 1em;</span><br><span class="line">  width: 5em;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright a &#123;</span><br><span class="line">  color: #808080;</span><br><span class="line">  border-bottom:0;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright a:hover &#123;</span><br><span class="line">  color: #a3d2a3;</span><br><span class="line">  text-decoration: underline;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright:hover .fa-clipboard &#123;</span><br><span class="line">  color: #000;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright .post-url:hover &#123;</span><br><span class="line">  font-weight: normal;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright .copy-path &#123;</span><br><span class="line">  margin-left: 1em;</span><br><span class="line">  width: 1em;</span><br><span class="line">  +mobile()&#123;display:none;&#125;</span><br><span class="line">&#125;</span><br><span class="line">.my_post_copyright .copy-path:hover &#123;</span><br><span class="line">  color: #808080;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>修改 themes/hexo-theme-next-6.7.0/layout/_macro/post.swig</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> &#123;% if theme.wechat_subscriber.enabled and not is_index %&#125;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;% include &apos;../_partials/post/wechat-subscriber.swig&apos; %&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">#========在include ../_partials/post/wechat-subscriber.swig逻辑下追加以下内容=============</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">  &#123;% if not is_index %&#125;</span><br><span class="line">  &#123;% include &apos;passage-end-tag.swig&apos; %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">        &#123;% if not is_index %&#125;</span><br><span class="line">          &#123;% include &apos;my-copyright.swig&apos; %&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure><ul><li>themes/hexo-theme-next-6.7.0/source/css/_common/components/post/post.styl追加一行</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@import &quot;my-post-copyright&quot;</span><br></pre></td></tr></table></figure><ul><li>themes/hexo-theme-next-6.7.0/layout/_macro/ 目录下新建 passage-end-tag.swig</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &#123;% if not is_index %&#125;</span><br><span class="line">        &lt;div style=&quot;text-align:center;color: #ccc;font-size:14px;&quot;&gt;-------------End of article. &lt;i class=&quot;fa fa-paw&quot;&gt;&lt;/i&gt; I appreciate whoever read and leave commends on articles.-------------&lt;/div&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><ul><li>themes/hexo-theme-next-6.7.0/_config.yml中追加</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">passage_end_tag:</span><br><span class="line">  enabled: true</span><br></pre></td></tr></table></figure><ul><li>博客文章头中声明copyright</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">copyright: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure><ul><li><p>定制草稿模板</p><p>修改lengyuewusheng.com/scaffolds/draft.md</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">tags:</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">categories:</span><br><span class="line">-</span><br><span class="line">copyright: true</span><br><span class="line">keywords: Blog,lengyuewusheng</span><br><span class="line">description: Describe briefly.</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">&#123;% cq %&#125;</span><br><span class="line">摘要内容</span><br><span class="line">&#123;% endcq %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line">正文</span><br></pre></td></tr></table></figure></li></ul><h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="生成发布时报错，几乎没有有效信息。。。"><a href="#生成发布时报错，几乎没有有效信息。。。" class="headerlink" title="生成发布时报错，几乎没有有效信息。。。"></a>生成发布时报错，几乎没有有效信息。。。</h2><ul><li>报错内容：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">H:\hexo-Blog&gt;hexo g -d</span><br><span class="line">INFO  Start processing</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br></pre></td></tr></table></figure><ul><li>处理方案：</li></ul><blockquote><p>此种情况大概率是由于你的博客的Markdown文件中存在非表格格式的竖线或其它Markdown难以解析的符号导致，如果存在竖线，将竖线用<code>&amp;#124</code>替换，如果存在其它特殊符号将符号删除即可。</p></blockquote><h2 id="hexo-generate-执行报错"><a href="#hexo-generate-执行报错" class="headerlink" title="hexo generate 执行报错"></a>hexo generate 执行报错</h2><ul><li>报错内容:</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">H:\hexo-Blog&gt;hexo g</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded in 1.97 s</span><br><span class="line">INFO  Generated: baidusitemap.xml</span><br><span class="line">ERROR Asset render failed: lib/canvas-ribbon/canvas-ribbon.js</span><br><span class="line">SyntaxError: Unexpected token: operator (&gt;)</span><br><span class="line">    at JS_Parse_Error.get (eval at &lt;anonymous&gt; (H:\hexo-Blog\node_modules\hexo-uglify\node_modules\uglify-js\tools\node.js:27:1), &lt;anonymous&gt;:86:23)</span><br><span class="line">    at getFullErrorStack (H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:1129:18)</span><br><span class="line">    at Object.Logger.stdSerializers.err (H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:1147:16)</span><br><span class="line">    at H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:873:50</span><br><span class="line">    at Array.forEach (&lt;anonymous&gt;)</span><br><span class="line">    at Logger._applySerializers (H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:865:35)</span><br><span class="line">    at mkRecord (H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:978:17)</span><br><span class="line">    at Logger.&lt;anonymous&gt; (H:\hexo-Blog\node_modules\hexo-bunyan\lib\bunyan.js:1044:19)</span><br><span class="line">    at self.render.render.catch.err (H:\hexo-Blog\node_modules\hexo\lib\plugins\generator\asset.js:33:20)</span><br><span class="line">    at tryCatcher (H:\hexo-Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at Promise._settlePromiseFromHandler (H:\hexo-Blog\node_modules\bluebird\js\release\promise.js:512:31)</span><br><span class="line">    at Promise._settlePromise (H:\hexo-Blog\node_modules\bluebird\js\release\promise.js:569:18)</span><br><span class="line">    at Promise._settlePromise0 (H:\hexo-Blog\node_modules\bluebird\js\release\promise.js:614:10)</span><br><span class="line">    at Promise._settlePromises (H:\hexo-Blog\node_modules\bluebird\js\release\promise.js:689:18)</span><br><span class="line">    at Async._drainQueue (H:\hexo-Blog\node_modules\bluebird\js\release\async.js:133:16)</span><br><span class="line">    at Async._drainQueues (H:\hexo-Blog\node_modules\bluebird\js\release\async.js:143:10)</span><br><span class="line">    at Immediate.Async.drainQueues (H:\hexo-Blog\node_modules\bluebird\js\release\async.js:17:14)</span><br><span class="line">    at runCallback (timers.js:789:20)</span><br><span class="line">    at tryOnImmediate (timers.js:751:5)</span><br><span class="line">    at processImmediate [as _immediateCallback] (timers.js:722:5)</span><br><span class="line">INFO  Generated: atom.xml</span><br><span class="line">INFO  Generated: search.xml</span><br></pre></td></tr></table></figure><ul><li>处理方案:</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-uglify uglify uglify-js</span><br></pre></td></tr></table></figure><ul><li>报错内容：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ERROR path.substring is not a function</span><br><span class="line">TypeError: path.substring is not a function</span><br><span class="line">    at Object.urlForHelper (H:\hexo-Blog\node_modules\hexo\lib\plugins\helper\url_for.js:9:31)</span><br><span class="line">    at wrapper (H:\hexo-Blog\node_modules\lodash\lodash.js:4941:19)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:125:119)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:263:126)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Theme._View.View._compiled (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:127:30)</span><br><span class="line">    at Theme._View.View.View.render (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:29:15)</span><br><span class="line">    at H:\hexo-Blog\node_modules\hexo\lib\hexo\index.js:390:29</span><br><span class="line">    at tryCatcher (H:\hexo-Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at H:\hexo-Blog\node_modules\bluebird\js\release\method.js:15:34</span><br><span class="line">    at RouteStream._read (H:\hexo-Blog\node_modules\hexo\lib\hexo\router.js:134:3)</span><br><span class="line">    at RouteStream.Readable.read (_stream_readable.js:442:10)</span><br><span class="line">    at resume_ (_stream_readable.js:822:12)</span><br><span class="line">    at _combinedTickCallback (internal/process/next_tick.js:138:11)</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:180:9)</span><br><span class="line">ERROR path.substring is not a function</span><br><span class="line">TypeError: path.substring is not a function</span><br><span class="line">    at Object.urlForHelper (H:\hexo-Blog\node_modules\hexo\lib\plugins\helper\url_for.js:9:31)</span><br><span class="line">    at wrapper (H:\hexo-Blog\node_modules\lodash\lodash.js:4941:19)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:125:119)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:263:126)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Theme._View.View._compiled (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:127:30)</span><br><span class="line">    at Theme._View.View.View.render (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:29:15)</span><br><span class="line">    at H:\hexo-Blog\node_modules\hexo\lib\hexo\index.js:390:29</span><br><span class="line">    at tryCatcher (H:\hexo-Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at H:\hexo-Blog\node_modules\bluebird\js\release\method.js:15:34</span><br><span class="line">    at RouteStream._read (H:\hexo-Blog\node_modules\hexo\lib\hexo\router.js:134:3)</span><br><span class="line">    at RouteStream.Readable.read (_stream_readable.js:442:10)</span><br><span class="line">    at resume_ (_stream_readable.js:822:12)</span><br><span class="line">    at _combinedTickCallback (internal/process/next_tick.js:138:11)</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:180:9)</span><br><span class="line">ERROR path.substring is not a function</span><br><span class="line">TypeError: path.substring is not a function</span><br><span class="line">    at Object.urlForHelper (H:\hexo-Blog\node_modules\hexo\lib\plugins\helper\url_for.js:9:31)</span><br><span class="line">    at wrapper (H:\hexo-Blog\node_modules\lodash\lodash.js:4941:19)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:125:119)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Object.eval [as tpl] (eval at precompile (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:497:13), &lt;anonymous&gt;:263:126)</span><br><span class="line">    at compiled (H:\hexo-Blog\node_modules\swig-templates\lib\swig.js:618:18)</span><br><span class="line">    at Theme._View.View._compiled (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:127:30)</span><br><span class="line">    at Theme._View.View.View.render (H:\hexo-Blog\node_modules\hexo\lib\theme\view.js:29:15)</span><br><span class="line">    at H:\hexo-Blog\node_modules\hexo\lib\hexo\index.js:390:29</span><br><span class="line">    at tryCatcher (H:\hexo-Blog\node_modules\bluebird\js\release\util.js:16:23)</span><br><span class="line">    at H:\hexo-Blog\node_modules\bluebird\js\release\method.js:15:34</span><br><span class="line">    at RouteStream._read (H:\hexo-Blog\node_modules\hexo\lib\hexo\router.js:134:3)</span><br><span class="line">    at RouteStream.Readable.read (_stream_readable.js:442:10)</span><br><span class="line">    at resume_ (_stream_readable.js:822:12)</span><br><span class="line">    at _combinedTickCallback (internal/process/next_tick.js:138:11)</span><br><span class="line">    at process._tickCallback (internal/process/next_tick.js:180:9)</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure><ul><li>处理方案：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">该问题是在升级Next v5.1.4时出现，首先将Next回滚，然后将本地的node_modules文件夹删除，同时删除package-lock.json，重新执行`npm install`生成node_modules目录后恢复。</span><br></pre></td></tr></table></figure><h2 id="hexo-deploy-执行报错"><a href="#hexo-deploy-执行报错" class="headerlink" title="hexo deploy 执行报错"></a>hexo deploy 执行报错</h2><ul><li>报错内容：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">fatal: HttpRequestException encountered.</span><br><span class="line">   ��������ʱ�����</span><br><span class="line">bash: /dev/tty: No such device or address</span><br><span class="line">error: failed to execute prompt script (exit code 1)</span><br><span class="line">fatal: could not read Username for &apos;https://github.com&apos;: No error</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: fatal: HttpRequestException encountered.</span><br><span class="line">   ��������ʱ����</span><br><span class="line">bash: /dev/tty: No such device or address</span><br><span class="line">error: failed to execute prompt script (exit code 1)</span><br><span class="line">fatal: could not read Username for &apos;https://github.com&apos;: No error</span><br><span class="line"></span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (H:\hexo-Blog\node_modules\hexo-util\lib\spawn.js:37:17)</span><br><span class="line">    at emitTwo (events.js:126:13)</span><br><span class="line">    at ChildProcess.emit (events.js:214:7)</span><br><span class="line">    at ChildProcess.cp.emit (H:\hexo-Blog\node_modules\cross-spawn\lib\enoent.js:40:29)</span><br><span class="line">    at maybeClose (internal/child_process.js:925:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:209:5)</span><br><span class="line"></span><br><span class="line">H:\hexo-Blog&gt;</span><br></pre></td></tr></table></figure><ul><li>处理方案：</li></ul><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">这种问题可能是因为本地git环境被破坏导致，重装或升级一下本地git即可解决问题。</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">官方文档</a></li><li><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">NEXT官方文档</a></li><li><a href="https://github.com/iissnan/hexo-theme-next/wiki" target="_blank" rel="noopener">NEXT Wiki</a></li><li><a href="http://huangjihua.com.cn/2015/10/15/hexo%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/" target="_blank" rel="noopener">hexo搭建静态博客</a></li><li><a href="http://www.tuicool.com/kans/1331697897" target="_blank" rel="noopener">推酷·hexo</a></li><li><a href="http://shadow000902.space/2016/03/18/利用Hexo在Github%20Page上部署个人博客/" target="_blank" rel="noopener">利用Hexo在Github Page上部署个人博客</a></li><li><a href="https://valine.js.org/" target="_blank" rel="noopener">valine·基于LeanCloud的无后端评论系统</a></li></ul>]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
        <tag>next</tag>
      </tags>
  </entry>
  <entry>
    <title>开张之作</title>
    <url>/%E5%BC%80%E5%BC%A0%E4%B9%8B%E4%BD%9C/</url>
    <content><![CDATA[<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=32507038&auto=1&height=66"></iframe><p>不得不说，想做成一件事情真的很难。</p><p>酝酿三年，筹备半年，将近一个月的紧密实施，博客终于赶在今天悄然上线了。</p><p>不得不说，做任何事情只要肯走心，一定能够做成，如果没成，那就再花点心思。</p><p>在这个自媒体泛滥的时代，碎片化的知识无处不在，</p><p>然而我并不励志做一个媒体人，我只是希望把日常的进步积累下来，</p><p>蹉跎岁月中最后能留下点自己亲手创造的价值。</p><p>还记得QQ空间刚火起来的那些年，每隔几个月都会挤时间跑到网吧里就为了写一篇博客，</p><p>后来变成了每到寒暑假写一篇总结，再到后来每到年末回首过去展望未来写一篇，</p><p>再后来我就变得不会写字了，如今算起来已经三四年没有认真写过东西了。</p><p>从今天起，做一个爱学习爱总结的人，借助博客督促自己多读书，多学习，多努力。</p><p>如果在自己进步的同时，无意中也帮到了你，这也算是一件让人开心的事儿了。</p><p>已经很晚了，再不睡觉天都要亮了，今天就写到这儿吧，来日方长，积水成渊吧！</p>]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>生活</tag>
      </tags>
  </entry>
  <entry>
    <title>MediaWiki管理控制台命令操作</title>
    <url>/mediawiki%E7%AE%A1%E7%90%86%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<p>经典wiki</p><a id="more"></a><h1 id="站内通告"><a href="#站内通告" class="headerlink" title="站内通告"></a>站内通告</h1><p>MediaWiki:Sitenotice</p><p>#MediaWiki的大部分界面信息<br>Special:Allmessages<br>包括界面的文字、链接、气泡提示、热键等。</p><h1 id="设定-取消用户组权限（”Bureaucrat”（行政管理员）权限的帐号才有权限设定）"><a href="#设定-取消用户组权限（”Bureaucrat”（行政管理员）权限的帐号才有权限设定）" class="headerlink" title="设定/取消用户组权限（”Bureaucrat”（行政管理员）权限的帐号才有权限设定）"></a>设定/取消用户组权限（”Bureaucrat”（行政管理员）权限的帐号才有权限设定）</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Special:Userrights</span><br></pre></td></tr></table></figure><h1 id="设置首页"><a href="#设置首页" class="headerlink" title="设置首页"></a>设置首页</h1><p>MediaWiki:Mainpage</p><h1 id="设置网页标题"><a href="#设置网页标题" class="headerlink" title="设置网页标题"></a>设置网页标题</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:pagetitle</span><br><span class="line">(浏览器上方)网页标题，可改为“$1 – 站名”，其中$1代表文章名称</span><br></pre></td></tr></table></figure><h1 id="设置-页脚-隐私政策"><a href="#设置-页脚-隐私政策" class="headerlink" title="设置(页脚)隐私政策"></a>设置(页脚)隐私政策</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Privacy</span><br><span class="line">可改为相应文章标题（如“隐私政策”）或“-”禁止显示本项</span><br></pre></td></tr></table></figure><h1 id="设置-页脚-关于本站"><a href="#设置-页脚-关于本站" class="headerlink" title="设置(页脚)关于本站"></a>设置(页脚)关于本站</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Aboutpage</span><br></pre></td></tr></table></figure><h1 id="设置-页脚-免责申明"><a href="#设置-页脚-免责申明" class="headerlink" title="设置(页脚)免责申明"></a>设置(页脚)免责申明</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Disclaimers</span><br><span class="line">可改为相应文章标题（如“本站免责声明”）或“-”禁止显示本项</span><br></pre></td></tr></table></figure><h1 id="测栏）导航栏"><a href="#测栏）导航栏" class="headerlink" title="(测栏）导航栏"></a>(测栏）导航栏</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Sidebar       格式：URL|标题</span><br></pre></td></tr></table></figure><h1 id="最受欢迎的页面"><a href="#最受欢迎的页面" class="headerlink" title="最受欢迎的页面"></a>最受欢迎的页面</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Special:PopularPages</span><br></pre></td></tr></table></figure><h1 id="查看所有名字空间"><a href="#查看所有名字空间" class="headerlink" title="查看所有名字空间"></a>查看所有名字空间</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">special:allmessages</span><br><span class="line">&quot;mainpage&quot;代表文字信息参数页面&quot;[[mediawiki:mainpage]]&quot;</span><br></pre></td></tr></table></figure><h1 id="查看MediaWiki版本"><a href="#查看MediaWiki版本" class="headerlink" title="查看MediaWiki版本"></a>查看MediaWiki版本</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Special:Version</span><br></pre></td></tr></table></figure><h1 id="修改默认主页"><a href="#修改默认主页" class="headerlink" title="修改默认主页"></a>修改默认主页</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Mainpage</span><br></pre></td></tr></table></figure><h1 id="lastmod-最后修订"><a href="#lastmod-最后修订" class="headerlink" title="lastmod:最后修订"></a>lastmod:最后修订</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># MediaWiki:Lastmodifiedat</span><br></pre></td></tr></table></figure><h1 id="viewcount-页面浏览次数"><a href="#viewcount-页面浏览次数" class="headerlink" title="viewcount:页面浏览次数"></a>viewcount:页面浏览次数</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Viewcount</span><br></pre></td></tr></table></figure><h1 id="numberofwatchingusers-关注用户"><a href="#numberofwatchingusers-关注用户" class="headerlink" title="numberofwatchingusers:关注用户"></a>numberofwatchingusers:关注用户</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Number</span><br></pre></td></tr></table></figure><h1 id="privacy-隐私政策"><a href="#privacy-隐私政策" class="headerlink" title="privacy:隐私政策"></a>privacy:隐私政策</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Copyright</span><br></pre></td></tr></table></figure><h1 id="copyright-版权"><a href="#copyright-版权" class="headerlink" title="copyright:版权"></a>copyright:版权</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Privacy</span><br></pre></td></tr></table></figure><h1 id="about-关于"><a href="#about-关于" class="headerlink" title="about:关于"></a>about:关于</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Aboutsite</span><br></pre></td></tr></table></figure><h1 id="disclaimer-免责声明"><a href="#disclaimer-免责声明" class="headerlink" title="disclaimer:免责声明"></a>disclaimer:免责声明</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MediaWiki:Disclaimers</span><br></pre></td></tr></table></figure><h1 id="清除页面缓存"><a href="#清除页面缓存" class="headerlink" title="清除页面缓存"></a>清除页面缓存</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">url 加入 &amp;action=purge</span><br></pre></td></tr></table></figure><h1 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h1><p>php changePassword.php –user=someuser –password=somepass</p><h1 id="去掉链接的图标"><a href="#去掉链接的图标" class="headerlink" title="去掉链接的图标"></a>去掉链接的图标</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim mediawiki/skins/vector/components/externalLinks.less</span><br><span class="line">注释：</span><br><span class="line">/*</span><br><span class="line">.background-image-svg(&apos;images/external-link-ltr-icon.svg&apos;, &apos;images/external-link-ltr-icon.png&apos;);</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h1 id="变更默认logo"><a href="#变更默认logo" class="headerlink" title="变更默认logo"></a>变更默认logo</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">替换/skins/common/images/wiki.png</span><br><span class="line">或者通过设定$wgLogo值来确定logo文件位置</span><br></pre></td></tr></table></figure><h1 id="强制目录"><a href="#强制目录" class="headerlink" title="强制目录"></a>强制目录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">在页面顶部添加</span><br><span class="line">&lt;div style=””&gt;__TOC__&lt;/div&gt;</span><br><span class="line">mediawiki默认3个以上标题时自动显示目录</span><br><span class="line">“__NOTOC__”标记，隐藏目录；</span><br><span class="line">“__TOC__”标记，显示目录；</span><br></pre></td></tr></table></figure><h1 id="mediawiki-LocalSettings-php-配置"><a href="#mediawiki-LocalSettings-php-配置" class="headerlink" title="mediawiki/LocalSettings.php 配置"></a>mediawiki/LocalSettings.php 配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$wgExternalLinkTarget = ‘_blank&apos;;       #新窗口打开外链</span><br><span class="line">禁止用户自助注册，</span><br><span class="line">$wgWhitelistAccount = array ( &quot;user&quot; =&gt; 0, &quot;sysop&quot; =&gt; 1, &quot;developer&quot; =&gt; 1 );</span><br></pre></td></tr></table></figure><h1 id="分列"><a href="#分列" class="headerlink" title="分列"></a>分列</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;div style=&quot;column-count:4;-moz-column-count:4;-webkit-column-count:4&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="去掉超链接图标"><a href="#去掉超链接图标" class="headerlink" title="去掉超链接图标"></a>去掉超链接图标</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim skins/Vector/components/externalLinks.less</span><br><span class="line">注释：</span><br><span class="line">/*.background-image-svg(&apos;images/external-link-ltr-icon.svg&apos;, &apos;images/external-link-ltr-icon.png&apos;);*/</span><br></pre></td></tr></table></figure><h1 id="配置邮件"><a href="#配置邮件" class="headerlink" title="配置邮件"></a>配置邮件</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">composer require --update-no-dev pear/mail pear/net_smtp或sudo pear install Mail Net_SMTP</span><br><span class="line">vim LocalSettings.php</span><br><span class="line">$wgSMTP = array(</span><br><span class="line">    &apos;host&apos;     =&gt; &quot;mail.example.com&quot;, // SMTP 服务器的地址 (或IP).如果使用了SSL,记得加上 ssl://</span><br><span class="line">    &apos;IDHost&apos;   =&gt; &quot;example.com&quot;,      // 汝的域名,可选.如果不设置的话会设置成 $wgServer 的值.</span><br><span class="line">    &apos;port&apos;     =&gt; 25,                 // 端口(一般是25,SSL是465,StartTLS是587)</span><br><span class="line">    &apos;auth&apos;     =&gt; true,               // 是否需要 SMTP 认证 (多半都需要呗~)</span><br><span class="line">    &apos;username&apos; =&gt; &quot;my_user_name&quot;,     // SMTP 认证的用户名.</span><br><span class="line">    &apos;password&apos; =&gt; &quot;my_password&quot;       // SMTP 认证的密码.</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="禁止匿名用户创建账户和编辑"><a href="#禁止匿名用户创建账户和编辑" class="headerlink" title="禁止匿名用户创建账户和编辑"></a>禁止匿名用户创建账户和编辑</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;createaccount&apos;]  = false;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;read&apos;]           = true;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;edit&apos;]           = false;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos; ][&apos;createpage&apos;]    = false;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos; ][&apos;createtalk&apos;]    = true;</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://www.mediawiki.org/wiki/Manual:FAQ/zh" target="_blank" rel="noopener">MediaWiki FAQ</a></li><li><a href="https://www.mediawiki.org/wiki/Manual:LocalSettings.php/zh" target="_blank" rel="noopener">LocalSettings.php手册</a></li><li><a href="https://www.mediawiki.org/wiki/Manual:Configuration_settings/zh" target="_blank" rel="noopener">Manual:Configuration settings/zh</a></li><li><a href="https://www.mediawiki.org/wiki/Category:MediaWiki_configuration/zh" target="_blank" rel="noopener">分类:MediaWiki配置</a></li><li><a href="https://www.mediawiki.org/wiki/Manual:Page_customizations/zh" target="_blank" rel="noopener">手册:页面自定义</a></li><li><a href="https://www.mediawiki.org/wiki/Manual:Maintenance_scripts/zh" target="_blank" rel="noopener">维护脚本手册</a></li><li><a href="https://www.mediawiki.org/w/index.php?title=Manual:Maintenance_scripts/zh&variant=zh-cn" target="_blank" rel="noopener">维护脚本手册</a></li><li><a href="https://doc.wikimedia.org/mediawiki-core/master/php/dir_8c6e8fc95ba4b3726993b760dbac16bc.html" target="_blank" rel="noopener">MediaWiki文档</a></li><li><a href="https://www.mediawiki.org/wiki/Sysadmin_hub/zh" target="_blank" rel="noopener">系统管理员中心</a></li><li><a href="https://www.wkwkk.com/article/c4c993d07d02bfbb1774e907d67d2002.html" target="_blank" rel="noopener">设置MediaWiki页脚</a></li></ul>]]></content>
      <categories>
        <category>开源技术栈</category>
      </categories>
      <tags>
        <tag>MediaWiki</tag>
        <tag>开源技术栈</tag>
      </tags>
  </entry>
  <entry>
    <title>CPU相关知识总结</title>
    <url>/cpu%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>整理中。。。</p><a id="more"></a><h1 id="CPU的亲和性"><a href="#CPU的亲和性" class="headerlink" title="CPU的亲和性"></a>CPU的亲和性</h1><p>CPU的亲和性(affinity)是指在Linux系统中能够将一个或多个进程绑定到一个或多个处理器上运行。这意味着进程通常不会在处理器之间频繁迁移。一个进程的CPU亲合力掩码决定了该进程将在哪个或哪几个CPU上运行。在一个多处理器系统中，设置CPU亲合力的掩码可能会获得更好的性能。</p><p>CPU的亲和性利用了这样一个事实，就是进程上一次运行后的残余信息会保留在处理器的状态中（也就是指处理器的缓存）。如果下一次仍然将该进程调度到同一个处理器上，就能避免一些不好的情况（比如缓存未命中），使得进程的运行更加高效。</p><ul><li><p>软亲和性<br>意味着进程并不会在处理器之间频繁迁移。</p></li><li><p>硬亲和性<br>意味着进程需要在您指定的处理器上运行。</p><ul><li>内核 API<ul><li>sched_set_affinity() (用来修改位掩码)</li><li>sched_get_affinity() (用来查看当前的位掩码)</li></ul></li></ul></li></ul><p>处理器亲和性能够有效地解决一些高速缓存的问题，但却不能缓解负载均衡的问题。而且，在异构系统中，处理器亲和性问题会变得更加复杂。</p><h1 id="taskset查看、设定-CPU-核使用情况"><a href="#taskset查看、设定-CPU-核使用情况" class="headerlink" title="taskset查看、设定 CPU 核使用情况"></a>taskset查看、设定 CPU 核使用情况</h1><p>``</p><h1 id="taskset-h"><a href="#taskset-h" class="headerlink" title="taskset -h"></a>taskset -h</h1><p>-p, –pid operate on existing given pid<br>-c, –cpu-list display and specify cpus in list format<br>-h, –help display this help<br>-V, –version output version information</p><h1 id="taskset-cp-2-3-nginx"><a href="#taskset-cp-2-3-nginx" class="headerlink" title="taskset -cp 2-3 nginx"></a>taskset -cp 2-3 nginx</h1><p>``</p><h1 id="nice-renice设定进程调度优先级"><a href="#nice-renice设定进程调度优先级" class="headerlink" title="nice/renice设定进程调度优先级"></a>nice/renice设定进程调度优先级</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># renice --help</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"> renice [-n] priority [-p|--pid] pid  [... pid]</span><br><span class="line"> renice [-n] priority  -g|--pgrp pgrp [... pgrp]</span><br><span class="line"> renice [-n] priority  -u|--user user [... user]</span><br><span class="line"> renice -h | --help</span><br><span class="line"> renice -v | --version</span><br></pre></td></tr></table></figure><h1 id="查看cpu状态"><a href="#查看cpu状态" class="headerlink" title="查看cpu状态"></a>查看cpu状态</h1><blockquote><p>mpstat -P ALL 3 5</p><p>mpstat -P cpu编号 间隔时间(秒) 输出次数</p></blockquote><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mpstat -P ALL 3 5</span><br><span class="line">Linux 2.6.32-431.el6.x86_64 (test-204) 	08/22/2017 	_x86_64_	(2 CPU)</span><br><span class="line"></span><br><span class="line">08:34:03 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">08:34:06 PM  all    1.01    0.00    2.86    0.00    0.00    0.00    0.00    0.00   96.13</span><br><span class="line">08:34:06 PM    0    0.67    0.00    3.37    0.00    0.00    0.00    0.00    0.00   95.96</span><br><span class="line">08:34:06 PM    1    1.34    0.00    2.68    0.00    0.00    0.00    0.00    0.00   95.97</span><br><span class="line"></span><br><span class="line">08:34:06 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">08:34:09 PM  all    1.34    0.00    2.85    0.17    0.00    0.00    0.00    0.00   95.64</span><br><span class="line">08:34:09 PM    0    1.00    0.00    2.68    0.00    0.00    0.00    0.00    0.00   96.32</span><br><span class="line">08:34:09 PM    1    2.01    0.00    2.68    0.33    0.00    0.00    0.00    0.00   94.98</span><br><span class="line"></span><br><span class="line">08:34:09 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">08:34:12 PM  all    0.67    0.00    1.51    0.00    0.00    0.17    0.00    0.00   97.65</span><br><span class="line">08:34:12 PM    0    0.34    0.00    1.68    0.00    0.00    0.00    0.00    0.00   97.98</span><br><span class="line">08:34:12 PM    1    1.00    0.00    1.34    0.00    0.00    0.00    0.00    0.00   97.66</span><br><span class="line"></span><br><span class="line">08:34:12 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">08:34:15 PM  all    0.34    0.00    1.01    0.00    0.00    0.00    0.00    0.00   98.66</span><br><span class="line">08:34:15 PM    0    0.00    0.00    1.34    0.33    0.00    0.00    0.00    0.00   98.33</span><br><span class="line">08:34:15 PM    1    0.34    0.00    0.67    0.00    0.00    0.00    0.00    0.00   98.99</span><br><span class="line"></span><br><span class="line">08:34:15 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">08:34:18 PM  all    0.50    0.00    1.34    0.00    0.00    0.00    0.00    0.00   98.16</span><br><span class="line">08:34:18 PM    0    0.33    0.00    1.67    0.00    0.00    0.00    0.00    0.00   98.00</span><br><span class="line">08:34:18 PM    1    0.67    0.00    1.01    0.00    0.00    0.00    0.00    0.00   98.32</span><br><span class="line"></span><br><span class="line">Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</span><br><span class="line">Average:     all    0.77    0.00    1.91    0.03    0.00    0.03    0.00    0.00   97.25</span><br><span class="line">Average:       0    0.47    0.00    2.14    0.07    0.00    0.00    0.00    0.00   97.32</span><br><span class="line">Average:       1    1.07    0.00    1.68    0.07    0.00    0.00    0.00    0.00   97.18</span><br></pre></td></tr></table></figure><h1 id="上下文交换"><a href="#上下文交换" class="headerlink" title="上下文交换"></a>上下文交换</h1><ul><li>中断(Interrupt)<br>是指处理器接收到来自硬件或软件的信号，提示发生了某个事件，应该被注意，这种情况就称为中断。</li></ul><h1 id="cpu核数计算"><a href="#cpu核数计算" class="headerlink" title="cpu核数计算"></a>cpu核数计算</h1><ul><li>查询物理CPU个数：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;physical id&quot;| sort| uniq| wc -l</span><br></pre></td></tr></table></figure></li><li>查询单个物理cpu的核数：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;cpu cores&quot;| uniq</span><br></pre></td></tr></table></figure></li><li>查询逻辑CPU总数：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /proc/cpuinfo| grep &quot;processor&quot;| wc -l</span><br></pre></td></tr></table></figure><ul><li>逻辑CPU总数=物理CPU个数<em>单个CPU核数(</em>2 超线程)</li></ul></li></ul><h1 id="超频检测"><a href="#超频检测" class="headerlink" title="超频检测"></a>超频检测</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">turbostat -i 1</span><br></pre></td></tr></table></figure><h1 id="CPU架构类型"><a href="#CPU架构类型" class="headerlink" title="CPU架构类型"></a>CPU架构类型</h1><blockquote><p>x86这一术语并不是指的某一个（具体CPU使用的）具体的指令集，而是在8086（的指令集）基础上发展而来 的所有指令集的泛称。</p></blockquote><ul><li><p>i386</p><blockquote><p>Intel 80386，通常用来作为对Intel(英特尔)32位微处理器的统称。</p></blockquote></li><li><p>arm64</p><blockquote><p>又称“x86-64”或“x64”，是一种64位元的电脑处理器架构。由AMD公司开发.</p></blockquote></li><li><p>amd64</p><blockquote><p>ARM架构，过去称作高级精简指令集机器，是一个32位精简指令集（RISC）处理器架构，其广泛地使用在许多嵌入式系统设计。但在其他领域上也有很多作为，由于节能的特点，ARM处理器非常适用于移动通信领域，匹配其主要设计目标为低成本、高性能、低耗电的特性。另一方面，超级计算机消耗大量电能，ARM同样被视作更高效的选择。</p></blockquote></li></ul><blockquote><p>Darwin是由苹果电脑于2000年所释出的一个开放原始码操作系统。Darwin 是MacOSX 操作环境的操作系统成份。</p></blockquote><ul><li>FreeBSD<blockquote><p>是一种类UNIX操作系统，是由经过BSD、386BSD和4.4BSD发展而来的Unix的一个重要分支。FreeBSD 为不同架构的计算机系统提供了不同程度的支持。<br>FreeBSD支持amd64(x86_64)、X86（i386）、ARM、IA-64、PowerPC、PC-98、SPARC等架构（不同版本支持有所不同）（详细情况见官方文档）。</p></blockquote></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://yukikazebox.wordpress.com/2010/05/20/%E7%94%A8turbostat%E7%9B%91%E8%A7%86linux%E4%B8%8Bturbo-boost%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8A%B6%E6%80%81/" target="_blank" rel="noopener">用turbostat监视linux下turbo boost的工作状态</a></p></li><li><p><a href="http://www.cnblogs.com/edwardlost/archive/2010/10/23/1858991.html" target="_blank" rel="noopener">http://www.cnblogs.com/edwardlost/archive/2010/10/23/1858991.html</a></p></li><li><p><a href="https://www.tmy.me/linux/832.html" target="_blank" rel="noopener">https://www.tmy.me/linux/832.html</a></p></li><li><p><a href="http://lisux.me/lishuai/?p=184" target="_blank" rel="noopener">http://lisux.me/lishuai/?p=184</a></p></li><li><p><a href="http://blog.csdn.net/ttyttytty12/article/details/11726569" target="_blank" rel="noopener">http://blog.csdn.net/ttyttytty12/article/details/11726569</a></p></li></ul>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>cpu</tag>
      </tags>
  </entry>
</search>
