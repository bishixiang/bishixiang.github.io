<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冷月无声</title>
  
  <subtitle>相信积累的力量！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.lengyuewusheng.com/"/>
  <updated>2019-12-15T08:33:10.559Z</updated>
  <id>https://www.lengyuewusheng.com/</id>
  
  <author>
    <name>冷月无声</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nginx常用功能配置范例</title>
    <link href="https://www.lengyuewusheng.com/nginx%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E9%85%8D%E7%BD%AE%E8%8C%83%E4%BE%8B.html"/>
    <id>https://www.lengyuewusheng.com/nginx常用功能配置范例.html</id>
    <published>2019-08-31T08:47:23.000Z</published>
    <updated>2019-12-15T08:33:10.559Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev.</p></blockquote><a id="more"></a><h1 id="隐藏版本号"><a href="#隐藏版本号" class="headerlink" title="隐藏版本号"></a>隐藏版本号</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">  server_tokens off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="nginx-Basic-认证"><a href="#nginx-Basic-认证" class="headerlink" title="nginx Basic 认证"></a>nginx Basic 认证</h1><ul><li><p>生成用户密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /usr/local/nginx/conf/nginx.passwd.db admin</span><br></pre></td></tr></table></figure></li><li><p>更新密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd /usr/local/nginx/conf/nginx.passwd.db admin</span><br></pre></td></tr></table></figure></li><li><p>配置内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    auth_basic &quot;View is cheap,show me the password!&quot;;</span><br><span class="line">    auth_basic_user_file nginx.passwd.db;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="限制-http-x-forwarded-for"><a href="#限制-http-x-forwarded-for" class="headerlink" title="限制$http_x_forwarded_for"></a>限制$http_x_forwarded_for</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">set $allow false;</span><br><span class="line">if ($http_x_forwarded_for = &quot;185.199.111.153&quot;) &#123;</span><br><span class="line">  set $allow true;</span><br><span class="line">&#125;</span><br><span class="line">if ($http_x_forwarded_for ~ &quot;10.0.0.*&quot;) &#123;</span><br><span class="line">  set $allow true;</span><br><span class="line">&#125;</span><br><span class="line">if ($allow = false) &#123;</span><br><span class="line">  return 404;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="限制请求方法"><a href="#限制请求方法" class="headerlink" title="限制请求方法"></a>限制请求方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($request_method !~ ^(GET|POST)$ ) &#123;</span><br><span class="line">    return 405;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="过滤特殊UA"><a href="#过滤特殊UA" class="headerlink" title="过滤特殊UA"></a>过滤特殊UA</h1><p>if ($http_user_agent ~* sqlmap|wget|curl) {<br>return 403;<br>}</p><h1 id="图片防盗链"><a href="#图片防盗链" class="headerlink" title="图片防盗链"></a>图片防盗链</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /images/ &#123;</span><br><span class="line">    valid_referers none blocked lengyuewusheng.com www.lengyuewusheng.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        return  403;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">或</span><br><span class="line">location /images/ &#123;</span><br><span class="line">    valid_referers blocked lengyuewusheng.com www.lengyuewusheng.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">        rewrite ^/images/.*\.(gif|jpg|jpeg|png)$ /error.html last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>“Referer”请求头为指定值时，内嵌变量$invalid_referer被设置为空字符串， 否则这个变量会被置成”1”。查找匹配时不区分大小写。</li><li>valid_referers：验证referer<ul><li>none: 允许referer为空，</li><li>blocked: 允许不带协议的请求.</li></ul></li></ul><h1 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  upstream realservers &#123;</span><br><span class="line">    server 10.0.0.1:8080 weight=3;</span><br><span class="line">    server 10.0.0.2:8080 weight=7;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  server &#123;</span><br><span class="line">    location /admin/ &#123; </span><br><span class="line">      proxy_pass http://realserver;</span><br><span class="line">      proxy_set_header Host $host;</span><br><span class="line">      proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">      proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="nginx开启keepalive"><a href="#nginx开启keepalive" class="headerlink" title="nginx开启keepalive"></a>nginx开启keepalive</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">upstream realserver &#123;</span><br><span class="line">    server 10.0.0.1:8080;</span><br><span class="line">    keepalive 10;</span><br><span class="line">    keepalive_timeout 60s;    # This directive appeared in version 1.15.3.</span><br><span class="line">    keepalive_requests 100;   # This directive appeared in version 1.15.3.</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">  keepalive_timeout 75s;</span><br><span class="line">  server &#123;</span><br><span class="line">      location / &#123;</span><br><span class="line">          proxy_http_version 1.1;</span><br><span class="line">          proxy_set_header Connection &quot;&quot;;</span><br><span class="line">          proxy_pass http://realserver;</span><br><span class="line">          ...</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>keepalive： 指定每个nginx worker可以保持的最大连接数量为1024，默认不设置，即nginx作为client时keepalive未生效。</p></li><li><p>proxy_http_version 1.1: 开启keepalive要求HTTP协议版本为HTTP 1.1。</p></li><li><p>proxy_set_header Connection “”: 为了兼容老的协议以及防止http头中有Connection close导致的keepalive失效，这里需要及时清掉HTTP头部的Connection。</p></li><li><p>keepalive_requests: 设置可通过一个保持连接提供服务的最大请求数。在发出最大请求数后，连接将关闭。</p></li><li><p>keepalive_timeout:</p><ul><li>upstream中的keepalive_timeoute是ngx_http_upstream_module模块中的功能，是1.15.3后的新特性，设置空闲保持连接的超时时间。</li><li>upstream外的keepalived是ngx_http_core_module模块中的功能,第一个参数是保持活动的客户机连接将在服务器端保持打开状态的超时时间。0表示禁用保持活动的客户端连接。可选的第二个参数在”Keep-Alive: timeout=time”响应头字段中设置一个值。两个参数可以不同。</li></ul></li></ul><h1 id="nginx开启目录查看"><a href="#nginx开启目录查看" class="headerlink" title="nginx开启目录查看"></a>nginx开启目录查看</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location /download/ &#123;</span><br><span class="line">        autoindex on;</span><br><span class="line">        autoindex_exact_size off;</span><br><span class="line">        autoindex_localtime on;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>autoindex_exact_size： 为on(默认)时显示文件的确切大小，单位是byte；改为off显示文件大概大小，单位KB或MB或GB</p></li><li><p>autoindex_localtime： 为off(默认)时显示的文件时间为GMT时间；改为on后，显示的文件时间为服务器时间</p></li></ul><h1 id="浏览器不显示文件内容直接下载文件"><a href="#浏览器不显示文件内容直接下载文件" class="headerlink" title="浏览器不显示文件内容直接下载文件"></a>浏览器不显示文件内容直接下载文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($request_filename ~* ^.*?\.(txt|pdf)$) &#123;</span><br><span class="line">    add_header Content-Disposition &apos;attachment&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="nginx获取用户真实IP"><a href="#nginx获取用户真实IP" class="headerlink" title="nginx获取用户真实IP"></a>nginx获取用户真实IP</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set_real_ip_from  10.0.0.0/8;               #真实服务器上一级代理的IP地址或者IP段,可以写多行。</span><br><span class="line">set_real_ip_from  192.168.0.0/16;</span><br><span class="line">real_ip_header    X-Forwarded-For;          #从哪个header头检索出要的IP地址。</span><br><span class="line">real_ip_recursive on;                       #递归的排除所配置中的可信IP。</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></pre></td></tr></table></figure><ul><li>X-Forwarded-For 变量，是squid开发的，用于识别请求通过了哪些HTTP代理或负载平衡器，记录相应IP地址列表的非rfc标准，如果设置了X-Forwarded-For，那么每次经过proxy转发请求后都会有记录。</li></ul><h1 id="nginx-强制跳转https"><a href="#nginx-强制跳转https" class="headerlink" title="nginx 强制跳转https"></a>nginx 强制跳转https</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if ( $scheme = http )&#123;</span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br><span class="line">或</span><br><span class="line">if ( $scheme = http )&#123;</span><br><span class="line">    rewrite ^(.*)$  https://$host$1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="防恶意抓取"><a href="#防恶意抓取" class="headerlink" title="防恶意抓取"></a>防恶意抓取</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    geo $limited</span><br><span class="line">    &#123;</span><br><span class="line">        default 1;</span><br><span class="line">        10.0.0.0/8 0;</span><br><span class="line">        123.207.144.220/32 0;</span><br><span class="line">        36.110.170.248/30 0;</span><br><span class="line">        118.184.170.248/30 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map $limited $limit &#123;</span><br><span class="line">        1 $binary_remote_addr;</span><br><span class="line">        0 &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    limit_req_zone $limit zone=reqids:100m rate=10r/s;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        limit_req zone=reqids burst=2 nodelay;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>geo设置白名单</li></ul><h1 id="nginx健康检查机制"><a href="#nginx健康检查机制" class="headerlink" title="nginx健康检查机制"></a>nginx健康检查机制</h1><p>check_http_expect_alive [ http_2xx | http_3xx | http_4xx | http_5xx ]<br>返回指定HTTP code，符合预期就算检测成功</p><h1 id="通过nginx查看txt文本文件乱码"><a href="#通过nginx查看txt文本文件乱码" class="headerlink" title="通过nginx查看txt文本文件乱码"></a>通过nginx查看txt文本文件乱码</h1><ul><li>文件后缀必须是.txt而不是.html,否则换行显示会有问题<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">    default_type &apos;text/html&apos;;</span><br><span class="line">    charset utf-8,gbk;</span><br></pre></td></tr></table></figure></li></ul><h1 id="nginx代理文件下载以及时间显示问题"><a href="#nginx代理文件下载以及时间显示问题" class="headerlink" title="nginx代理文件下载以及时间显示问题"></a>nginx代理文件下载以及时间显示问题</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    autoindex on;</span><br><span class="line">    autoindex_localtime on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="nginx-try-files"><a href="#nginx-try-files" class="headerlink" title="nginx try_files"></a>nginx try_files</h1><h1 id="nginx-location"><a href="#nginx-location" class="headerlink" title="nginx location @"></a>nginx location @</h1><h1 id="nginx缓存配置"><a href="#nginx缓存配置" class="headerlink" title="nginx缓存配置"></a>nginx缓存配置</h1><h1 id="nginx-根据uuid灰度"><a href="#nginx-根据uuid灰度" class="headerlink" title="nginx 根据uuid灰度"></a>nginx 根据uuid灰度</h1><h1 id="nginx限制并发连接数"><a href="#nginx限制并发连接数" class="headerlink" title="nginx限制并发连接数"></a>nginx限制并发连接数</h1><h1 id="nginx限制请求频率"><a href="#nginx限制请求频率" class="headerlink" title="nginx限制请求频率"></a>nginx限制请求频率</h1><h1 id="nginx存活检测"><a href="#nginx存活检测" class="headerlink" title="nginx存活检测"></a>nginx存活检测</h1><h1 id="nginx-upstream-backup机制"><a href="#nginx-upstream-backup机制" class="headerlink" title="nginx upstream backup机制"></a>nginx upstream backup机制</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rewrite_log on;</span><br><span class="line">proxy_ignore_client_abort on;</span><br><span class="line"></span><br><span class="line">expires epoch;</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://ialloc.org/blog/using-nginx/" target="_blank" rel="noopener">使用 Nginx - 基础配置</a></p></li><li><p><a href="https://my.oschina.net/moooofly/blog/295853" target="_blank" rel="noopener">获取用户真实 ip 地址的 nginx 相关配置</a></p></li><li><p><a href="https://www.hi-linux.com/posts/53006.html" target="_blank" rel="noopener">使用 Nginx 自带 Realip 模块获取用户真实 IP 地址</a></p></li><li><p><a href="http://blog.51cto.com/nolinux/1594029" target="_blank" rel="noopener">Nginx实战系列之功能篇—-后端节点健康检查</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1027287" target="_blank" rel="noopener">Nginx负载均衡中后端节点服务器健康检查的操作梳理</a></p></li><li><p><a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="noopener">官方·Building nginx from Sources</a></p></li><li><p><a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" target="_blank" rel="noopener">官方·TCP and UDP Load Balancing</a></p></li><li><p><a href="http://nginx.org/en/docs/stream/ngx_stream_core_module.html" target="_blank" rel="noopener">官方·Module ngx_stream_core_module</a></p></li><li><p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html" target="_blank" rel="noopener">官方·http ngx_http_core_module</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev.&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://www.lengyuewusheng.com/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://www.lengyuewusheng.com/tags/nginx/"/>
    
      <category term="配置范例" scheme="https://www.lengyuewusheng.com/tags/%E9%85%8D%E7%BD%AE%E8%8C%83%E4%BE%8B/"/>
    
  </entry>
  
  <entry>
    <title>wekan开源kanban系统部署</title>
    <link href="https://www.lengyuewusheng.com/wekan%E5%BC%80%E6%BA%90kanban%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2.html"/>
    <id>https://www.lengyuewusheng.com/wekan开源kanban系统部署.html</id>
    <published>2019-08-23T23:07:10.000Z</published>
    <updated>2019-12-01T13:26:19.705Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Open-Source kanban.</p></blockquote><a id="more"></a><h1 id="关键安装步骤"><a href="#关键安装步骤" class="headerlink" title="关键安装步骤"></a>关键安装步骤</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum --showduplicates list snapd |expand</span><br><span class="line"></span><br><span class="line">yum -y install snapd-2.30-0.el7.centos.1.x86_64 snapd-selinux-2.30-0.el7.centos.1.noarch snap-confine-2.30-0.el7.centos.1.x86_64</span><br><span class="line"></span><br><span class="line">snap install wekan</span><br><span class="line"></span><br><span class="line"> snap list</span><br><span class="line"></span><br><span class="line">查看wekan配置</span><br><span class="line">snap get wekan</span><br><span class="line"></span><br><span class="line">snap info wekan</span><br><span class="line">snap services</span><br><span class="line"></span><br><span class="line">snap 安装指定修订版本应用</span><br><span class="line">snap refresh wekan --revision=581 --stable</span><br></pre></td></tr></table></figure><h1 id="安装后配置"><a href="#安装后配置" class="headerlink" title="安装后配置"></a>安装后配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">snap set wekan caddy-bind-port=&apos;80&apos;</span><br><span class="line">snap set wekan caddy-enabled=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;cn\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan mail-from=&apos;username &lt;username@xxxx.com&gt;&apos;</span><br><span class="line">snap set wekan mail-url=&apos;smtp://username:passwd@mail.xxxx.com:25&apos;</span><br><span class="line">snap set wekan mongodb-bind-ip=&apos;127.0.0.1&apos;</span><br><span class="line">snap set wekan port=&apos;3001&apos;</span><br><span class="line">snap set wekan root-url=&apos;http://domainname&apos;</span><br><span class="line">#-----------------------------</span><br><span class="line">snap set wekan ldap-enable=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-port=&apos;389&apos;</span><br><span class="line">snap set wekan ldap-host=&apos;ldap.xxxx.com&apos;</span><br><span class="line">snap set wekan ldap-basedn=&apos;OU=user,OU=xxxx,DC=xxxx,DC=com&apos;</span><br><span class="line">snap set wekan ldap-login-fallback=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reconnect=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-idle-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-vonnect-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-authentication=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-authentication-userdn=&apos;cn=xxxx,ou=Special_Account,ou=user,ou=xxxx,dc=xxxx,dc=com&apos;</span><br><span class="line">snap set wekan ldap-authentication-password=&apos;passwd&apos;</span><br><span class="line">snap set wekan ldap-internal-log-level=&apos;debug&apos;</span><br><span class="line">snap set wekan ldap-background-sync=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-background-sync-interval=&apos;100&apos;</span><br><span class="line">snap set wekan ldap-encryption=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reject-unauthorized=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-group-filter-enable=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-search-page-size=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-search-size-limit=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-user-search-filter=&apos;&apos;</span><br><span class="line">snap set wekan ldap-user-search-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-user-search-scope=&apos;&apos;</span><br><span class="line">snap set wekan ldap-unique-identifier-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-username-field=&apos;displayName&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data=&apos;false&apos;</span><br><span class="line"># snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;cn\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;displayName\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-merge-existing-users=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-utf8-names-slugify=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-fullname-field=displayName</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap set wekan default-authentication-method=&apos;ldap&apos;</span><br></pre></td></tr></table></figure><h1 id="备份与恢复数据"><a href="#备份与恢复数据" class="headerlink" title="备份与恢复数据"></a>备份与恢复数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">备份：</span><br><span class="line">/var/lib/snapd/snap/bin/wekan.database-backup &gt;/dev/null 2&gt;&amp;1 &amp;&amp; mv /var/snap/wekan/common/db-backups/* /data/wekan/db-backups/</span><br><span class="line"></span><br><span class="line">恢复</span><br><span class="line">wekan.database-restore /var/snap/wekan/common/db-backups/wekan-20190806T103004.backup</span><br></pre></td></tr></table></figure><h1 id="操作历史"><a href="#操作历史" class="headerlink" title="操作历史"></a>操作历史</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">diff /etc/yum.repos.d/ngompa-snapcore-el7-epel-7.repo /etc/yum.repos.d/_copr_ngompa-snapcore-el7.repo</span><br><span class="line"> rm -rf /etc/yum.repos.d/ngompa-snapcore-el7-epel-7.repo</span><br><span class="line">sudo yum install snapd</span><br><span class="line">snap install wekan</span><br><span class="line">systemctl enable --now snapd.socket</span><br><span class="line">snap install wekan</span><br><span class="line">snap set wekan root-url=&quot;http://0.0.0.0:3000/&quot;</span><br><span class="line">lsof -i :3000</span><br><span class="line">snap set wekan root-url=&quot;http://10.153.43.151:3000/wekan&quot;</span><br><span class="line">snap set wekan port=&apos;3001&apos;</span><br><span class="line">systemctl restart snap.wekan.wekan</span><br><span class="line">systemctl status snap.wekan.wekan</span><br><span class="line">snap set wekan.help</span><br><span class="line">wekan.help</span><br><span class="line">ll /snapcat /etc/systemd/system/snap.wekan.wekan.service</span><br><span class="line">cat /etc/systemd/system/snap.wekan.wekan.service</span><br><span class="line">sudo snap set wekan mail-url=&apos;smtp://username:passwd@mail.xxx-inc.com:25&apos;</span><br><span class="line">sudo snap set wekan mail-from=&apos;xxx &lt;xxx@xxx-inc.com&gt;&apos;</span><br><span class="line">systemctl restart snap.wekan.caddy.service</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.mongodb.service</span><br><span class="line">journalctl -af -u snap.wekan.caddy.service</span><br><span class="line">vim /etc/systemd/system/snap.wekan.caddy.service</span><br><span class="line"> /usr/bin/snap run wekan.caddy</span><br><span class="line">snap set wekan caddy-bind-port=80</span><br><span class="line">snap set wekan caddy-enabled=true</span><br><span class="line">systemctl status snap.wekan.caddy.service</span><br><span class="line">vim /var/snap/wekan/common/Caddyfile</span><br><span class="line">vim /var/snap/wekan/common/Caddyfile</span><br><span class="line">snap set wekan caddy-bind-port=80</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap get wekan</span><br><span class="line">snap set wekan root-url=http://10.153.43.151:3001/dashboard</span><br><span class="line">systemctl status snap.wekan.caddy.service -l</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.mongodb.service</span><br><span class="line">snap set wekan caddy-enabled=false</span><br><span class="line">snap set wekan port=80</span><br><span class="line">snap set wekan root-url=http://domainname/dashboard</span><br><span class="line">snap set wekan port=3001</span><br><span class="line">snap set wekan root-url=http://domainname</span><br><span class="line">snap set wekan mongodb-bind-ip=127.0.0.1</span><br><span class="line">systemctl restart snap.wekan.wekan.service</span><br><span class="line">systemctl status snap.wekan.wekan.service</span><br></pre></td></tr></table></figure><h1 id="LDAP配置"><a href="#LDAP配置" class="headerlink" title="LDAP配置"></a>LDAP配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">snap set wekan ldap-port=&apos;389&apos;</span><br><span class="line">snap set wekan ldap-host=&apos;ldap.xxx-inc.com&apos;</span><br><span class="line">snap set wekan ldap-basedn=&apos;OU=user,OU=xxx,DC=xxx-inc,DC=com&apos;</span><br><span class="line">snap set wekan ldap-login-fallback=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reconnect=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-idle-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-vonnect-timeout=&apos;10000&apos;</span><br><span class="line">snap set wekan ldap-authentication=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-authentication-userdn=&apos;cn=xxxxxx,ou=xxxxxx,ou=user,ou=xxx,dc=xxx-inc,dc=com&apos;</span><br><span class="line">snap set wekan ldap-authentication-password=&apos;passwd&apos;</span><br><span class="line">snap set wekan ldap-internal-log-level=&apos;debug&apos;</span><br><span class="line">snap set wekan ldap-background-sync=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-background-sync-interval=&apos;100&apos;</span><br><span class="line">snap set wekan ldap-encryption=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-reject-unauthorized=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-group-filter-enable=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-search-page-size=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-search-size-limit=&apos;0&apos;</span><br><span class="line">snap set wekan ldap-user-search-filter=&apos;&apos;</span><br><span class="line">snap set wekan ldap-user-search-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-user-search-scope=&apos;&apos;</span><br><span class="line">snap set wekan ldap-unique-identifier-field=&apos;sAMAccountName&apos;</span><br><span class="line">snap set wekan ldap-username-field=&apos;displayName&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data=&apos;false&apos;</span><br><span class="line">snap set wekan ldap-sync-user-data-fieldmap=&apos;&#123;\&quot;displayName\&quot;:\&quot;name\&quot;, \&quot;mail\&quot;:\&quot;email\&quot;&#125;&apos;</span><br><span class="line">snap set wekan ldap-merge-existing-users=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-utf8-names-slugify=&apos;true&apos;</span><br><span class="line">snap set wekan ldap-fullname-field=displayName</span><br><span class="line">snap set wekan ldap-login-fallback=true</span><br><span class="line">snap set wekan default-authentication-method=&apos;ldap&apos;</span><br><span class="line">EOF |bash</span><br></pre></td></tr></table></figure><h1 id="nginx代理"><a href="#nginx代理" class="headerlink" title="nginx代理"></a>nginx代理</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; wekan.conf &lt;&lt; EOF</span><br><span class="line">upstream task &#123;</span><br><span class="line">server 10.0.0.1:3001;</span><br><span class="line">&#125;</span><br><span class="line"># this section is needed to proxy web-socket connections</span><br><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &apos;&apos;      close;</span><br><span class="line">&#125;</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">include vhosts/vhosts.listen.addr;</span><br><span class="line"></span><br><span class="line">server_name wekan.webserver;</span><br><span class="line">access_log logs/$&#123;server_name&#125;_access_log main;</span><br><span class="line">access_log logs/status_log mini;</span><br><span class="line">charset  utf-8;</span><br><span class="line"></span><br><span class="line">error_page  404           /404.html;</span><br><span class="line">error_page   500 502 503 504  /50x.html;</span><br><span class="line"></span><br><span class="line">location = /50x.html</span><br><span class="line">&#123;</span><br><span class="line">root   html;</span><br><span class="line">&#125;</span><br><span class="line">location /server-status</span><br><span class="line">&#123;</span><br><span class="line">stub_status on;</span><br><span class="line">allow 10.0.0.0/8;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line">location /</span><br><span class="line">&#123;</span><br><span class="line">      proxy_set_header   Host              $host;</span><br><span class="line">      proxy_set_header   X-Real-IP         $remote_addr;</span><br><span class="line">      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;</span><br><span class="line">      proxy_set_header   X-Forwarded-Proto $scheme;</span><br><span class="line">      proxy_max_temp_file_size 0;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade; # allow websockets</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">      proxy_pass         http://task;</span><br><span class="line"></span><br><span class="line">      #this is the maximum upload size</span><br><span class="line">      client_max_body_size       10m;</span><br><span class="line">      client_body_buffer_size    128k;</span><br><span class="line"></span><br><span class="line">      proxy_connect_timeout      90;</span><br><span class="line">      proxy_send_timeout         90;</span><br><span class="line">      proxy_read_timeout         90;</span><br><span class="line">      proxy_buffering            off;</span><br><span class="line">      proxy_request_buffering    off; # Required for HTTP CLI commands in Jenkins &gt; 2.54</span><br><span class="line">      proxy_set_header Connection &quot;&quot;; # Clear for keepalive</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 10 * * * /var/lib/snapd/snap/bin/wekan.database-backup &gt;/dev/null 2&gt;&amp;1 &amp;&amp; mv /var/snap/wekan/common/db-backups/* /data/wekan/db-backups/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">我们可以看到图中的loo0-loop11占用100%,我们只要清理掉一下就可以了.</span><br><span class="line">命令:</span><br><span class="line">sudo apt autoremove --purge snapd</span><br><span class="line">　命令:</span><br><span class="line">　　sudo apt autoremove --purge snapd</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://github.com/wekan/wekan-snap/wiki/Install" target="_blank" rel="noopener">官方安装文档</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Open-Source kanban.&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="开源技术栈" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
      <category term="wekan" scheme="https://www.lengyuewusheng.com/tags/wekan/"/>
    
      <category term="kanban" scheme="https://www.lengyuewusheng.com/tags/kanban/"/>
    
  </entry>
  
  <entry>
    <title>tomcat调优实践</title>
    <link href="https://www.lengyuewusheng.com/tomcat%E8%B0%83%E4%BC%98%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://www.lengyuewusheng.com/tomcat调优实践.html</id>
    <published>2019-08-18T08:53:36.000Z</published>
    <updated>2019-12-01T13:26:08.019Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>持续整理中</p></blockquote><a id="more"></a><h1 id="调优思路"><a href="#调优思路" class="headerlink" title="调优思路"></a>调优思路</h1><ul><li><p>清空webapps</p></li><li><p>隐藏tomcat版本号</p></li><li><p>开启apr</p></li><li><p>修改随机数生成器</p></li><li><p>修改8005重启命令</p></li><li><p>禁用8009</p></li><li><p>Connector和exec优化</p></li><li><p>开机启动</p></li><li><p>systemd支持</p></li><li><p>cron自动重启自动清理日志</p></li><li><p>关闭autoDeploy</p></li><li><p>使用LD_LIBRARY_PATH替换java.library.path</p></li></ul><h1 id="关闭autoDeploy"><a href="#关闭autoDeploy" class="headerlink" title="关闭autoDeploy"></a>关闭autoDeploy</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;</span><br><span class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;false&quot;&gt;</span><br></pre></td></tr></table></figure><h1 id="使用LD-LIBRARY-PATH替换java-library-path"><a href="#使用LD-LIBRARY-PATH替换java-library-path" class="headerlink" title="使用LD_LIBRARY_PATH替换java.library.path"></a>使用LD_LIBRARY_PATH替换java.library.path</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=$CATALINA_HOME/extra/lib</span><br><span class="line">会覆盖系统环境变量：</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH/path/to//so-lib</span><br></pre></td></tr></table></figure><ul><li>添加多个值 <code>-Djava.library.path=/opt/hdf-java/build/bin:/opt/opencv-2.4.10/build/lib</code></li></ul><h1 id="隐藏版本"><a href="#隐藏版本" class="headerlink" title="隐藏版本"></a>隐藏版本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd apache-tomcat/lib/</span><br><span class="line">unzip catalina.jar</span><br><span class="line">修改 org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">增量更新jar包: jar -uvf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br></pre></td></tr></table></figure><h1 id="自定义header-Server"><a href="#自定义header-Server" class="headerlink" title="自定义header Server"></a>自定义header Server</h1><p>conf/server.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;  </span><br><span class="line">                    connectionTimeout=&quot;20000&quot; </span><br><span class="line">                    redirectPort=&quot;8443&quot;  </span><br><span class="line">                    URIEncoding=&quot;UTF-8&quot; </span><br><span class="line">                    useBodyEncodingForURI=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">修改后如下：</span><br><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;  </span><br><span class="line">                     connectionTimeout=&quot;20000&quot; </span><br><span class="line">                     redirectPort=&quot;8443&quot;  </span><br><span class="line">                     URIEncoding=&quot;UTF-8&quot; </span><br><span class="line">                     useBodyEncodingForURI=&quot;true&quot; </span><br><span class="line">                     server=&quot;Microsoft-IIS/6.5&quot;/&gt;</span><br></pre></td></tr></table></figure><h1 id="开启apr"><a href="#开启apr" class="headerlink" title="开启apr"></a>开启apr</h1><p>LD_LIBRARY_PATH是Linux环境变量名，该环境变量主要用于指定查找共享库（动态链接库）时除了默认路径之外的其他路径。<br>LD_RUN_PATH环境变量, 它也是把路径编译进可执行文件内，不同的是它只设置RPATH<br>这么多搜索路径，他们有个先后顺序如下<br>1、RUMPATH 优先级最高<br>2、RPATH 其次<br>3、LD_LIBRARY_PATH<br>4、/etc/ld.so.cache<br>5、/usr/lib/ /lib/</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install apr-devel</span><br><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/apr/lib</span><br><span class="line">或者：</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=/usr/local/apr/lib&quot;</span><br></pre></td></tr></table></figure><h1 id="bin-catalina-sh-stop-不生效问题"><a href="#bin-catalina-sh-stop-不生效问题" class="headerlink" title="bin/catalina.sh stop 不生效问题"></a>bin/catalina.sh stop 不生效问题</h1><p>在读取时，/dev/random设备会返回小于熵池噪声总数的随机字节。<br>/dev/random可生成高随机性的公钥或一次性密码本。若熵池空了，对/dev/random的读操作将会被阻塞，直到收集到了足够的环境噪声为止。\这样的设计使得/dev/random是真正的随机数发生器，提供了最大可能的随机数据熵，建议在需要生成高强度的密钥时使用。</p><p>/dev/random的一个副本是/dev/urandom（“unblocked”，非阻塞的随机数发生器），它会重复使用熵池中的数据以产生伪随机数据。<br>这表示对/dev/urandom的读取操作不会产生阻塞，但其输出的熵可能小于/dev/random的。它可以作为生成较低强度密码的伪随机数生成器，不建议用于生成高强度长期密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;s/securerandom.source=file:\/dev\/random/securerandom.source=file:\/dev\/urandom/g&apos; /usr/java/jdk1.8.0_192/jre/lib/security/java.security</span><br><span class="line">或</span><br><span class="line">-Djava.security.egd=file:/dev/./urandom</span><br></pre></td></tr></table></figure><h1 id="使bin-catalina-sh-stop-force生效"><a href="#使bin-catalina-sh-stop-force生效" class="headerlink" title="使bin/catalina.sh stop -force生效"></a>使bin/catalina.sh stop -force生效</h1><p>cat &gt;&gt; /search/odin/webserver/tomcat/bin/setenv.sh &lt;&lt; EOF<br>#!/bin/bash<br>CATALINA_PID=$CATALINA_HOME/bin/catalina.map.pid<br>EOF</p><h1 id="Connector优化"><a href="#Connector优化" class="headerlink" title="Connector优化"></a>Connector优化</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;</span><br><span class="line">           maxThreads=&quot;5000&quot; </span><br><span class="line">           minSpareThreads=&quot;2500&quot; </span><br><span class="line">           maxSpareThreads=&quot;3750&quot;</span><br><span class="line">           enableLookups=&quot;false&quot;  //禁用dns解析</span><br><span class="line">           edirectPort=&quot;8443&quot; </span><br><span class="line">           acceptCount=&quot;1024&quot;</span><br><span class="line">           debug=&quot;0&quot; </span><br><span class="line">           connectionTimeout=&quot;10000&quot;</span><br><span class="line">           disableUploadTimeout=&quot;true&quot; /&gt;</span><br></pre></td></tr></table></figure><h1 id="prometheus监控jmx"><a href="#prometheus监控jmx" class="headerlink" title="prometheus监控jmx"></a>prometheus监控jmx</h1><ul><li><p><a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/collector/0.12.0/collector-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/collector/0.12.0/collector-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.12.0/jmx_prometheus_javaagent-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.12.0/jmx_prometheus_javaagent-0.12.0.jar</a></p></li><li><p><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_httpserver/0.12.0/jmx_prometheus_httpserver-0.12.0.jar</a></p></li><li><p><a href="https://github.com/prometheus/jmx_exporter/tree/master/example_configs" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter/tree/master/example_configs</a></p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- cat jmx.sh</span><br><span class="line">#!/usr/bin/env bash</span><br><span class="line"># Script to run a java application for testing jmx4prometheus.</span><br><span class="line"># Note: You can use localhost:5556 instead of 5556 for configuring socket hostname.</span><br><span class="line">java -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.port=5555 -jar ./jmx_prometheus_httpserver-0.12.0-jar-with-dependencies.jar 5556 ./tomcat.yml</span><br></pre></td></tr></table></figure><ul><li><p>cat setenv.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">CATALINA_PID=$CATALINA_HOME/bin/catalina.map.pid</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=$CATALINA_HOME/extra/apr/lib</span><br><span class="line">-Djava.security.egd=file:/dev/./urandom</span><br><span class="line">-Djava.awt.headless=true&quot;</span><br><span class="line">[ -f $CATALINA_HOME/extra/catalina_opts.sh ] &amp;&amp; source $CATALINA_HOME/extra/catalina_opts.sh</span><br><span class="line">[ -f $CATALINA_HOME/extra/jmx_exporter_opts.sh ] &amp;&amp; source $CATALINA_HOME/extra/jmx_exporter_opts.sh</span><br></pre></td></tr></table></figure></li><li><p>cat jmx_exporter_opts.sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -javaagent:/search/odin/webserver/tomcat/extra/jmx_exporter/jmx_prometheus_javaagent-0.12.0.jar=7788:/search/odin/webserver/tomcat/extra/jmx_exporter/tomcat.yml&quot;</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.ibm.com/support/knowledgecenter/zh/SSHS8R_8.0.0/com.ibm.worklight.installconfig.doc/install_config/t_optional_config_app_server_tomcat.html" target="_blank" rel="noopener">tomcat开启jmx</a></p></li></ul><h1 id="解决验证码不显示的问题"><a href="#解决验证码不显示的问题" class="headerlink" title="解决验证码不显示的问题"></a>解决验证码不显示的问题</h1><ul><li>Headless模式是一种系统配置模式。在该模式下，系统缺少了显示设备、键盘或鼠标，一般Linux服务端使用headless mode。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.awt.headless=true&quot;</span><br><span class="line">或</span><br><span class="line">System.setProperty(&quot;java.awt.headless&quot;, &quot;true&quot;);</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://cloud.tencent.com/developer/article/1404206" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1404206</a></p></li><li><p><a href="http://lovesoo.org/tomcat-process-fails-to-stop-problem-solving.html?zyvufk=zcpgj2&amp;emjyvm=yr0rj2" target="_blank" rel="noopener">http://lovesoo.org/tomcat-process-fails-to-stop-problem-solving.html?zyvufk=zcpgj2&amp;emjyvm=yr0rj2</a></p></li><li><p><a href="https://rorschachchan.github.io/2019/09/30/Tomcat8%E9%85%8D%E7%BD%AEapr/" target="_blank" rel="noopener">https://rorschachchan.github.io/2019/09/30/Tomcat8%E9%85%8D%E7%BD%AEapr/</a></p></li><li><p><a href="http://www.laruence.com/2010/01/27/1265.html" target="_blank" rel="noopener">http://www.laruence.com/2010/01/27/1265.html</a></p></li><li><p><a href="https://www.sohu.com/a/204046542_355142" target="_blank" rel="noopener">https://www.sohu.com/a/204046542_355142</a></p></li><li><p><a href="https://www.bbsmax.com/A/o75NLyZXzW/" target="_blank" rel="noopener">关于 Tomcat 的线程池的理解</a></p></li><li><p><a href="https://www.w3cschool.cn/tomcat/5tqv1k9w.html" target="_blank" rel="noopener">https://www.w3cschool.cn/tomcat/5tqv1k9w.html</a></p></li><li><p><a href="https://www.alibabacloud.com/help/zh/faq-detail/37421.htm" target="_blank" rel="noopener">Tomcat服务安全加固</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1173187" target="_blank" rel="noopener">tomcat安全加固</a></p></li><li><p><a href="https://www.yuque.com/idevops/slhwwz/mfvpl0" target="_blank" rel="noopener">prometheus 监控 tomcat</a></p></li><li><p><a href="http://xieyufei.com/2017/01/08/SERVER-OPEN-GZIP.html" target="_blank" rel="noopener">服务器开启GZIP</a></p></li><li><p><a href="https://tomcat.apache.org/tomcat-9.0-doc/config/http.html" target="_blank" rel="noopener">Apache Tomcat·The HTTP Connector</a></p></li><li><p><a href="https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Access_Logging" target="_blank" rel="noopener">Access Logging</a></p></li><li><p><a href="https://cloud.tencent.com/developer/article/1103077" target="_blank" rel="noopener">详解 Tomcat 的连接数与线程池</a></p></li><li><p><a href="https://blog.51cto.com/meiling/1826588" target="_blank" rel="noopener">Tomcat优化配置</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzAwNTM5Njk3Mw==&mid=2247483768&idx=1&sn=23fb8e372719b626a5f5c5a6c98cfb72&chksm=9b1c01faac6b88ec2c3b975b03d50b4a7cdef5d0c84ec4d686abd93464d60f779a1373fa7f64&mpshare=1&scene=24&srcid=1115o7YJ3T32liFwWOetxYqe&sharer_sharetime=1573785651091&sharer_shareid=49ca04d76869dc1e522c1a1b20a84c86&key=a942e04100fd18a078c9258af003e3080d124c9a352555786f1ba968e08e029e37ef17fc36615f987a85542332b8032d41a00435f94369e8b31014f8c10abe7501042c6063477d314b8037e76c530ced&ascene=14&uin=MjU4NTIwODY2MA%3D%3D&devicetype=Windows+10&version=62070158&lang=zh_CN&pass_ticket=z2BrPOXYDDwdKGKf8dnPrjuybJjyK869CeFHtJoQXp9eq0XjxSciWNxP9e%2BEjhod" target="_blank" rel="noopener">Tomcat性能调优及JVM内存工作原理</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU0NTk2MjQyOA==&mid=2247484611&idx=1&sn=39c36f2bbabd87d47b1c8d4eb2cf9776&chksm=fb65a410cc122d0613c4f55e76a527acd5a45a66fdd071d243ac21c315ce1e2d6e840651f260&mpshare=1&scene=24&srcid=11141emsLAqdabcKtAQE6L0u&sharer_sharetime=1573745704644&sharer_shareid=49ca04d76869dc1e522c1a1b20a84c86&key=3486ba94f9a3c84a9daa93a3b19f3e84d39750a0c02d5b1307f993bb98f946ecc3c6fbb5fc3e37203e2e5d6f01fc5195c3ce4bc3e62f2de0ba2ba25cc207c7723bcde53e2dc13a3562957998878bd27c&ascene=14&uin=MjU4NTIwODY2MA%3D%3D&devicetype=Windows+10&version=62070158&lang=zh_CN&pass_ticket=z2BrPOXYDDwdKGKf8dnPrjuybJjyK869CeFHtJoQXp9eq0XjxSciWNxP9e%2BEjhod" target="_blank" rel="noopener">tomcat 调优-生产环境必备</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU5NTAzNjM0Mw==&mid=2247485907&idx=2&sn=53818bc549bf40ded1a03841d5a7be7c&chksm=fe79580bc90ed11d5c0311f556addf497bdb3fe618d82057c97541dc6bc77cd4cfc59eef1981&scene=1&subscene=10000&clicktime=1574088752&enterid=1574088752&ascene=0&devicetype=android-28&version=27000834&nettype=cmnet&abtest_cookie=AAACAA%3D%3D&lang=zh_CN&pass_ticket=3bM%2FBKwG9HXfHMZLcUxTc7IYYXA6GqQhW%2FoLrNbJazmkYAdXv%2B0Uzi%2B3NB5K3nQM&wx_header=1" target="_blank" rel="noopener">小计Tomcat的调优思路 | 必学必知</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;持续整理中&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="tomcat" scheme="https://www.lengyuewusheng.com/categories/tomcat/"/>
    
    
      <category term="tomcat" scheme="https://www.lengyuewusheng.com/tags/tomcat/"/>
    
      <category term="jvm" scheme="https://www.lengyuewusheng.com/tags/jvm/"/>
    
  </entry>
  
  <entry>
    <title>pandoc+revealjs使用Markdown编写在线PPT</title>
    <link href="https://www.lengyuewusheng.com/pandoc-revealjs%E4%BD%BF%E7%94%A8markdown%E7%BC%96%E5%86%99%E5%9C%A8%E7%BA%BFppt.html"/>
    <id>https://www.lengyuewusheng.com/pandoc-revealjs使用markdown编写在线ppt.html</id>
    <published>2019-07-28T10:25:26.000Z</published>
    <updated>2019-12-08T05:13:15.387Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>学什么PPT，学reveal.js就够了！</p></blockquote><a id="more"></a><h2 id="revealjs"><a href="#revealjs" class="headerlink" title="revealjs"></a>revealjs</h2><iframe src="https://revealjs.com/#/" height="400px" width="95%"></iframe><h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2><ul><li><p>文档头部元数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">% 标题</span><br><span class="line">% 作者</span><br><span class="line">% 日期</span><br></pre></td></tr></table></figure></li><li><p>分页</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--- 横向强制分页</span><br><span class="line">-- 纵向分页，通常一列可以作为一个章节。</span><br></pre></td></tr></table></figure></li></ul><h2 id="pandoc"><a href="#pandoc" class="headerlink" title="pandoc"></a>pandoc</h2><blockquote><p>pandoc是一个神奇而强大的工具，非常强大。具体使用方法，参见<a href="https://pandoc.org/MANUAL.html" target="_blank" rel="noopener">官方文档</a>。使用范例，后面再陆续总结。。。</p></blockquote><h2 id="转换命令"><a href="#转换命令" class="headerlink" title="转换命令"></a>转换命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pandoc slides.md -o slides.html -t revealjs -s -V theme=beige</span><br><span class="line"></span><br><span class="line">pandoc 2019Mid-yearSummary.md -o 2019.html -t revealjs -s -V theme=sky</span><br></pre></td></tr></table></figure><h2 id="常用主题"><a href="#常用主题" class="headerlink" title="常用主题"></a>常用主题</h2><ul><li>default：（默认）深灰色背景，白色文字</li><li>beige：米色背景，深色文字</li><li>sky：天蓝色背景，白色细文字</li><li>night：黑色背景，白色粗文字</li><li>serif：浅色背景，灰色衬线文字</li><li>simple：白色背景，黑色文字</li><li>solarized：奶油色背景，深青色文字</li></ul><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ul><li><code>p</code>：上一页</li><li><code>n</code>：下一页</li><li><code>s</code>：演示模式</li><li><code>f</code>: 全屏模式</li><li><code>b(/.)</code>: 黑屏暂停</li><li><code>o</code>: 概览模式</li><li><code>Esc</code>：退出全屏/概览模式</li><li><code>?</code>: 快捷键帮助</li><li><code>Alt + 鼠标单击</code>：放大显示</li></ul><h2 id="演示备注"><a href="#演示备注" class="headerlink" title="演示备注"></a>演示备注</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;aside class=&quot;notes&quot;&gt;</span><br><span class="line">   备注内容</span><br><span class="line">&lt;/aside&gt;</span><br></pre></td></tr></table></figure><h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><ul><li><a href="https://www.lfhacks.com/s/revealjs.html" target="_blank" rel="noopener">https://www.lfhacks.com/s/revealjs.html</a></li><li><a href="https://palmer.arkstack.cn/2017/05/RevealJs-slides%E6%BC%94%E7%A4%BA%E5%B7%A5%E5%85%B7-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/" target="_blank" rel="noopener">https://palmer.arkstack.cn/2017/05/RevealJs-slides%E6%BC%94%E7%A4%BA%E5%B7%A5%E5%85%B7-%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/</a></li><li><a href="https://vxhly.github.io/archives/8bdf06de.html" target="_blank" rel="noopener">https://vxhly.github.io/archives/8bdf06de.html</a></li><li><a href="https://amito.me/2018/Using-Pandoc-to-Make-HTML-and-Beamer-Slides/" target="_blank" rel="noopener">https://amito.me/2018/Using-Pandoc-to-Make-HTML-and-Beamer-Slides/</a></li><li><a href="https://github.com/luckylooke/revealjsBallTheme" target="_blank" rel="noopener">https://github.com/luckylooke/revealjsBallTheme</a></li><li><a href="https://crazy-max.github.io/php7-presentation/#/" target="_blank" rel="noopener">https://crazy-max.github.io/php7-presentation/#/</a></li><li><a href="https://github.com/denehyg/reveal.js-menu" target="_blank" rel="noopener">https://github.com/denehyg/reveal.js-menu</a></li><li><a href="https://github.com/denehyg/reveal.js-toolbar" target="_blank" rel="noopener">https://github.com/denehyg/reveal.js-toolbar</a></li><li><a href="https://github.com/byteclubfr/uncloak" target="_blank" rel="noopener">https://github.com/byteclubfr/uncloak</a></li><li><a href="https://linux.cn/article-10228-1.html" target="_blank" rel="noopener">https://linux.cn/article-10228-1.html</a></li><li><a href="https://pandoc.org/MANUAL.html" target="_blank" rel="noopener">https://pandoc.org/MANUAL.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;学什么PPT，学reveal.js就够了！&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="开源技术栈" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
      <category term="pandoc" scheme="https://www.lengyuewusheng.com/tags/pandoc/"/>
    
      <category term="revealjs" scheme="https://www.lengyuewusheng.com/tags/revealjs/"/>
    
      <category term="ppt" scheme="https://www.lengyuewusheng.com/tags/ppt/"/>
    
  </entry>
  
  <entry>
    <title>prometheus监控实践</title>
    <link href="https://www.lengyuewusheng.com/prometheus%E7%9B%91%E6%8E%A7%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://www.lengyuewusheng.com/prometheus监控实践.html</id>
    <published>2019-07-20T06:03:24.000Z</published>
    <updated>2019-12-08T05:10:59.213Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Power your metrics and alerting with a leading open-source monitoring solution.</p></blockquote><a id="more"></a><h1 id="prometheus-server端配置范例"><a href="#prometheus-server端配置范例" class="headerlink" title="prometheus server端配置范例"></a>prometheus server端配置范例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"># my global config</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     60s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">  evaluation_interval: 60s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">  # scrape_timeout is set to the global default (10s).</span><br><span class="line"></span><br><span class="line"># Alertmanager configuration</span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      # - alertmanager:9093</span><br><span class="line"></span><br><span class="line"># Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.</span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first_rules.yml&quot;</span><br><span class="line">  # - &quot;second_rules.yml&quot;</span><br><span class="line">  # - compute_metrics.rules</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line"># ================================================================</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line"></span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    # static_configs:</span><br><span class="line"></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/node.d/*.yml&apos;]</span><br><span class="line"></span><br><span class="line">  - job_name: &apos;metricslogfile&apos;</span><br><span class="line">    metrics_path: &apos;/metrics/logfile&apos;</span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    # static_configs:</span><br><span class="line"></span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/node.d/*.yml&apos;]</span><br><span class="line"></span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;blackbox&apos;</span><br><span class="line">    metrics_path: /probe</span><br><span class="line">    params:</span><br><span class="line">      module: [http_2xx]  # Look for a HTTP 200 response.</span><br><span class="line">    # static_configs:</span><br><span class="line">    #   - targets:</span><br><span class="line">    #     - https://123.xxxx.com    # Target to probe with http.</span><br><span class="line">    #     - http://map.xxxx.com</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/blackbox.d/*.yml&apos;]</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: slavedb.dt.zw.ted:19115  # The blackbox exporter&apos;s real hostname:port.</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;mobile.xxxx.com&apos;</span><br><span class="line">    metrics_path: /probe</span><br><span class="line">    params:</span><br><span class="line">      module: [http_2xx_mobile_zhushou_sogou_com]  # Look for a HTTP 200 response.</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/importantServices.d/xxxx.yml&apos;]</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels: [__address__]</span><br><span class="line">        target_label: __param_target</span><br><span class="line">      - source_labels: [__param_target]</span><br><span class="line">        target_label: instance</span><br><span class="line">      - target_label: __address__</span><br><span class="line">        replacement: slavedb.dt.zw.ted:19115  # The blackbox exporter&apos;s real hostname:port.</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;nginxstatus&apos;</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/nginx.d/*.yml&apos;]</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;jenkins&apos;</span><br><span class="line">    metrics_path: /prometheus</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - &apos;10.142.112.144:8080&apos;</span><br><span class="line">      labels:</span><br><span class="line">        cluster: &apos;业务&apos;</span><br><span class="line">        group: &apos;产品&apos;</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;prometheustatus&apos;</span><br><span class="line">    metrics_path: /metrics</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - &apos;127.0.0.1:19090&apos;</span><br><span class="line">      labels:</span><br><span class="line">        cluster: &apos;Prometheus&apos;</span><br><span class="line">        group: &apos;生产环境&apos;</span><br><span class="line"># ================================================================</span><br><span class="line">  - job_name: &apos;etcd&apos;</span><br><span class="line">    metrics_path: /metrics</span><br><span class="line">    file_sd_configs:</span><br><span class="line">      - files: [&apos;/opt/prometheus/conf/etcd.d/*.yml&apos;]</span><br></pre></td></tr></table></figure><h2 id="子配置范例"><a href="#子配置范例" class="headerlink" title="子配置范例"></a>子配置范例</h2><ul><li><p>node</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">        &apos;10.0.0.1:9100&apos;,</span><br><span class="line">        &apos;10.0.0.2:9100&apos;,</span><br><span class="line">        &apos;10.0.0.3:9100&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li><li><p>blackbox</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">&apos;http://www.xxxx.com/&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li><li><p>etcd监控</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- targets: [</span><br><span class="line">    &apos;etcd01.localhost:2379&apos;,</span><br><span class="line">    &apos;etcd02.localhost:2379&apos;,</span><br><span class="line">    &apos;etcd03.localhost:2379&apos;,</span><br><span class="line">]</span><br><span class="line">  labels:</span><br><span class="line">    cluster: &apos;etcd.业务&apos;</span><br><span class="line">    group: &apos;产品&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><h2 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a>prometheus</h2><ul><li><a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="noopener">exporters</a></li><li><h2 id="grafana模板"><a href="#grafana模板" class="headerlink" title="grafana模板"></a>grafana模板</h2><h3 id="prometheus-1"><a href="#prometheus-1" class="headerlink" title="prometheus"></a>prometheus</h3><ul><li><a href="https://grafana.com/grafana/dashboards/8919" target="_blank" rel="noopener">Node Exporter 0.16 + for Prometheus 监控展示看板</a></li><li><a href="https://grafana.com/grafana/dashboards/1860" target="_blank" rel="noopener">Node Exporter Full</a></li><li><a href="https://github.com/rfrail3/grafana-dashboards" target="_blank" rel="noopener">CentOS5版本监控</a></li><li><a href="https://grafana.com/grafana/dashboards/405" target="_blank" rel="noopener">Node Exporter Server Metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/306" target="_blank" rel="noopener">jenkins状态监控</a></li></ul></li></ul><h3 id="blackbox"><a href="#blackbox" class="headerlink" title="blackbox"></a>blackbox</h3><ul><li><a href="https://grafana.com/grafana/dashboards/5345" target="_blank" rel="noopener">Blackbox Exporter Overview</a></li><li><a href="https://grafana.com/grafana/dashboards/7587" target="_blank" rel="noopener"></a></li><li><a href="https://grafana.com/grafana/dashboards/9965" target="_blank" rel="noopener">Blackbox Exporter 0.14 for Prometheus 监控展示看板</a></li></ul><h3 id="telegraf-influxdb"><a href="#telegraf-influxdb" class="headerlink" title="telegraf + influxdb"></a>telegraf + influxdb</h3><ul><li><a href="https://grafana.com/grafana/dashboards/61" target="_blank" rel="noopener">Telegraf metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/5955" target="_blank" rel="noopener">Telegraf - system metrics</a></li><li><a href="https://grafana.com/grafana/dashboards/914" target="_blank" rel="noopener">Telegraf system overview</a></li><li><a href="https://grafana.com/grafana/dashboards/317" target="_blank" rel="noopener">influxdb状态监控</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Power your metrics and alerting with a leading open-source monitoring solution.&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="prometheus" scheme="https://www.lengyuewusheng.com/categories/prometheus/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="监控" scheme="https://www.lengyuewusheng.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
      <category term="prometheus" scheme="https://www.lengyuewusheng.com/tags/prometheus/"/>
    
  </entry>
  
  <entry>
    <title>ngxtop应用实践</title>
    <link href="https://www.lengyuewusheng.com/ngxtop%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://www.lengyuewusheng.com/ngxtop应用实践.html</id>
    <published>2019-07-16T03:57:33.000Z</published>
    <updated>2019-12-01T13:25:02.924Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>挺实用。。。</p></blockquote><a id="more"></a><ul><li>操作范例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/python/bin/ngxtop top remote_addr -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/python/bin/ngxtop -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><ul><li><p>查看前30条</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/python/bin/ngxtop -n 30 -c /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>安装报错<br>ImportError: No module named ‘config_parser’</p></li><li><p>解决方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/lebinh/ngxtop.git</span><br><span class="line">cd ngxtop</span><br><span class="line">pip install .</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=403732461&amp;idx=1&amp;sn=355c5b2c4eea5fc667d910a976bc23d9&amp;scene=7&amp;key=b00bc6577437f0f5637ec152e1a9885b06338b95d65135e74cbc78d69c09655b0695f143dcfbb99626af16ddd5291d68c8441d2f8d77b962377edc86a1dc1478a07d1c4eeba5bd828e99a530ed574c7b&amp;ascene=0&amp;uin=MjU4NTIwODY2MA%3D%3D&amp;devicetype=Windows+10&amp;version=62060844&amp;lang=zh_CN&amp;pass_ticket=VJ5qyiMQOdr7Vx9dh33jjUe53zQKR3FhJuWiKB%2ButNzqA0ZJO83cJfRurzxTLSbl" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzA4Nzc4MjI4MQ==&amp;mid=403732461&amp;idx=1&amp;sn=355c5b2c4eea5fc667d910a976bc23d9&amp;scene=7&amp;key=b00bc6577437f0f5637ec152e1a9885b06338b95d65135e74cbc78d69c09655b0695f143dcfbb99626af16ddd5291d68c8441d2f8d77b962377edc86a1dc1478a07d1c4eeba5bd828e99a530ed574c7b&amp;ascene=0&amp;uin=MjU4NTIwODY2MA%3D%3D&amp;devicetype=Windows+10&amp;version=62060844&amp;lang=zh_CN&amp;pass_ticket=VJ5qyiMQOdr7Vx9dh33jjUe53zQKR3FhJuWiKB%2ButNzqA0ZJO83cJfRurzxTLSbl</a></p></li><li><p><a href="https://www.vpser.net/manage/ngxtop.html" target="_blank" rel="noopener">https://www.vpser.net/manage/ngxtop.html</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;挺实用。。。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="工具控" scheme="https://www.lengyuewusheng.com/categories/%E5%B7%A5%E5%85%B7%E6%8E%A7/"/>
    
    
      <category term="nginx" scheme="https://www.lengyuewusheng.com/tags/nginx/"/>
    
      <category term="ngxtop" scheme="https://www.lengyuewusheng.com/tags/ngxtop/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB基础实践</title>
    <link href="https://www.lengyuewusheng.com/mongodb%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://www.lengyuewusheng.com/mongodb基础实践.html</id>
    <published>2019-06-30T10:04:25.000Z</published>
    <updated>2019-12-01T13:24:32.550Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>边用边总结</p></blockquote><a id="more"></a><h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="mongo连接"><a href="#mongo连接" class="headerlink" title="mongo连接"></a>mongo连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongo --host 127.0.0.1 --port 27017</span><br><span class="line">或</span><br><span class="line">mongo &quot;mongodb://127.0.0.1:27017&quot;</span><br></pre></td></tr></table></figure><h2 id="升级操作"><a href="#升级操作" class="headerlink" title="升级操作"></a>升级操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.adminCommand( &#123; setFeatureCompatibilityVersion: &quot;4.0&quot; &#125; )</span><br></pre></td></tr></table></figure><h2 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h2><p>启用用户认证必须修改配置文件/etc/mongod.conf为：并重启服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security.authorization : enabled</span><br></pre></td></tr></table></figure><ul><li><p>创建管理员用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123; user: &quot;admin&quot;, pwd: &quot;passwd&quot;, roles: [&#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;] &#125;)</span><br><span class="line">db.auth(&quot;admin&quot;, &quot;adminPassword?&quot;)</span><br><span class="line">db.getUsers()</span><br></pre></td></tr></table></figure></li><li><p>创建备份用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use testdb</span><br><span class="line">db.createUser(&#123; user: &quot;backup&quot;, pwd: &quot;passwd&quot;, roles: [&#123; role: &quot;backup&quot;, db: &quot;admin&quot; &#125;, &#123; role: &quot;restore&quot;, db: &quot;admin&quot; &#125;] &#125;)  # role中的db必须为admin</span><br></pre></td></tr></table></figure></li><li><p>查看用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.system.users.find().pretty()</span><br><span class="line">use testdb</span><br><span class="line">show users</span><br></pre></td></tr></table></figure></li></ul><h2 id="开启-关闭监控"><a href="#开启-关闭监控" class="headerlink" title="开启/关闭监控"></a>开启/关闭监控</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.enableFreeMonitoring()</span><br><span class="line">db.disableFreeMonitoring()</span><br></pre></td></tr></table></figure><h2 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show dbs;</span><br><span class="line">db.getCollectionNames();   #show collections;</span><br><span class="line">help</span><br><span class="line"></span><br><span class="line">删除数据库</span><br><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure><h2 id="查询范例"><a href="#查询范例" class="headerlink" title="查询范例"></a>查询范例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&apos;gd_event&apos;).aggregate([&#123;$group:&#123;_id:&quot;$eid&quot;,count:&#123;$sum:1&#125;&#125;&#125;,&#123; $match:&#123;count:&#123;$gt:1&#125;&#125;&#125;])</span><br><span class="line">类似sql：</span><br><span class="line">select eid as _id,count(eid) as count from gd_event group by eid having count&gt;1</span><br><span class="line"></span><br><span class="line">两个条件或运算：</span><br><span class="line">db.getCollection(&apos;gd_event_log&apos;).find(&#123;$or:[&#123;&quot;detail&quot;:&#123;$regex:&quot;冷月无声&quot;&#125;&#125;,&#123;&quot;info&quot;:&#123;$regex:&quot;冷月无声&quot;&#125;&#125;]&#125;)</span><br></pre></td></tr></table></figure><h2 id="mongo查询包含"><a href="#mongo查询包含" class="headerlink" title="mongo查询包含"></a>mongo查询包含</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&apos;cards&apos;).find(&#123;title:/scribe/&#125;)</span><br><span class="line">db.getCollection(&apos;cards&apos;).find(&#123;title:/导航/&#125;)</span><br></pre></td></tr></table></figure><h2 id="mongo启用全文索引"><a href="#mongo启用全文索引" class="headerlink" title="mongo启用全文索引"></a>mongo启用全文索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.adminCommand( &#123; setParameter : 1, textSearchEnabled : true &#125; )</span><br><span class="line">&#123; &quot;was&quot; : false, &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><ul><li>默认是关闭的。否则会报错”err” : “text search not enabled”</li></ul><h2 id="索引语言支持"><a href="#索引语言支持" class="headerlink" title="索引语言支持"></a>索引语言支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.de.ensureIndex( &#123;txt: &quot;text&quot;&#125;, &#123;default_language: &quot;german&quot;&#125; )</span><br></pre></td></tr></table></figure><ul><li>如果希望使用其他语言，需要在创建索引时指定要使用的语言。默认是支持英文的。</li></ul><h1 id="mongdb客户端工具"><a href="#mongdb客户端工具" class="headerlink" title="mongdb客户端工具"></a>mongdb客户端工具</h1><ul><li><a href="http://robomongo.org/" target="_blank" rel="noopener">http://robomongo.org/</a></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://www.jianshu.com/p/f5afc6488f9e" target="_blank" rel="noopener">https://www.jianshu.com/p/f5afc6488f9e</a></li><li><a href="https://docs.mongodb.com/manual/reference/built-in-roles/#backup-and-restoration-roles" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/built-in-roles/#backup-and-restoration-roles</a></li><li><a href="https://docs.mongodb.com/manual/reference/configuration-options/#security.authorization" target="_blank" rel="noopener">https://docs.mongodb.com/manual/reference/configuration-options/#security.authorization</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;边用边总结&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MongoDB" scheme="https://www.lengyuewusheng.com/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="https://www.lengyuewusheng.com/tags/MongoDB/"/>
    
      <category term="nosql" scheme="https://www.lengyuewusheng.com/tags/nosql/"/>
    
  </entry>
  
  <entry>
    <title>Linux内核崩溃分析</title>
    <link href="https://www.lengyuewusheng.com/linux%E5%86%85%E6%A0%B8%E5%B4%A9%E6%BA%83%E5%88%86%E6%9E%90.html"/>
    <id>https://www.lengyuewusheng.com/linux内核崩溃分析.html</id>
    <published>2019-06-08T11:43:01.000Z</published>
    <updated>2019-12-01T13:23:24.830Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>持续整理中。。。</p></blockquote><a id="more"></a><h1 id="崩溃现场"><a href="#崩溃现场" class="headerlink" title="崩溃现场"></a>崩溃现场</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">[@bjsjs_42_92 ~]# crash /usr/lib/debug/lib/modules/3.10.0-327.el7.x86_64/vmlinux /opt/var/crash/127.0.0.1-2019-08-06-10\:16\:35/vmcore</span><br><span class="line"></span><br><span class="line">crash 7.1.2-3.el7_2.1</span><br><span class="line">Copyright (C) 2002-2014  Red Hat, Inc.</span><br><span class="line">Copyright (C) 2004, 2005, 2006, 2010  IBM Corporation</span><br><span class="line">Copyright (C) 1999-2006  Hewlett-Packard Co</span><br><span class="line">Copyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited</span><br><span class="line">Copyright (C) 2006, 2007  VA Linux Systems Japan K.K.</span><br><span class="line">Copyright (C) 2005, 2011  NEC Corporation</span><br><span class="line">Copyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.</span><br><span class="line">Copyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.</span><br><span class="line">This program is free software, covered by the GNU General Public License,</span><br><span class="line">and you are welcome to change it and/or distribute copies of it under</span><br><span class="line">certain conditions.  Enter &quot;help copying&quot; to see the conditions.</span><br><span class="line">This program has absolutely no warranty.  Enter &quot;help warranty&quot; for details.</span><br><span class="line"></span><br><span class="line">GNU gdb (GDB) 7.6</span><br><span class="line">Copyright (C) 2013 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type &quot;show copying&quot;</span><br><span class="line">and &quot;show warranty&quot; for details.</span><br><span class="line">This GDB was configured as &quot;x86_64-unknown-linux-gnu&quot;...</span><br><span class="line"></span><br><span class="line">      KERNEL: /usr/lib/debug/lib/modules/3.10.0-327.el7.x86_64/vmlinux</span><br><span class="line">    DUMPFILE: /opt/var/crash/127.0.0.1-2019-08-06-10:16:35/vmcore  [PARTIAL DUMP]</span><br><span class="line">        CPUS: 40</span><br><span class="line">        DATE: Tue Aug  6 10:16:27 2019</span><br><span class="line">      UPTIME: 390 days, 14:40:34</span><br><span class="line">LOAD AVERAGE: 81.55, 29.79, 16.87</span><br><span class="line">       TASKS: 2448</span><br><span class="line">    NODENAME: bjsjs_42_92</span><br><span class="line">     RELEASE: 3.10.0-327.el7.x86_64</span><br><span class="line">     VERSION: #1 SMP Thu Nov 19 22:10:57 UTC 2015</span><br><span class="line">     MACHINE: x86_64  (2199 Mhz)</span><br><span class="line">      MEMORY: 127.9 GB</span><br><span class="line">       PANIC: &quot;kernel BUG at fs/buffer.c:1280!&quot;</span><br><span class="line">         PID: 57502</span><br><span class="line">     COMMAND: &quot;java&quot;</span><br><span class="line">        TASK: ffff88201a2eb980  [THREAD_INFO: ffff880f7566c000]</span><br><span class="line">         CPU: 26</span><br><span class="line">       STATE:  (PANIC)</span><br><span class="line"></span><br><span class="line">crash&gt; bt</span><br><span class="line">PID: 57502  TASK: ffff88201a2eb980  CPU: 26  COMMAND: &quot;java&quot;</span><br><span class="line"> #0 [ffff880f7566f5a8] machine_kexec at ffffffff81051beb</span><br><span class="line"> #1 [ffff880f7566f608] crash_kexec at ffffffff810f2542</span><br><span class="line"> #2 [ffff880f7566f6d8] oops_end at ffffffff8163e1a8</span><br><span class="line"> #3 [ffff880f7566f700] die at ffffffff8101859b</span><br><span class="line"> #4 [ffff880f7566f730] do_trap at ffffffff8163d860</span><br><span class="line"> #5 [ffff880f7566f780] do_invalid_op at ffffffff81015204</span><br><span class="line"> #6 [ffff880f7566f830] invalid_op at ffffffff8164701e</span><br><span class="line">    [exception RIP: check_irqs_on+4]</span><br><span class="line">    RIP: ffffffff816326d1  RSP: ffff880f7566f8e8  RFLAGS: 00010046</span><br><span class="line">    RAX: 0000000000000096  RBX: ffff8810092d9110  RCX: ffff880ee7d05800</span><br><span class="line">    RDX: 0000000000001000  RSI: 000000000090014a  RDI: ffff880f8cf4b740</span><br><span class="line">    RBP: ffff880f7566f8e8   R8: 0000000000000004   R9: 0000000000000004</span><br><span class="line">    R10: ffff880ee7d05800  R11: ffff880f7566f9e8  R12: ffff880f8cf4b740</span><br><span class="line">    R13: 0000000000001000  R14: ffff8801df370800  R15: 0000000000000010</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018</span><br><span class="line"> #7 [ffff880f7566f8f0] __find_get_block at ffffffff81212c85</span><br><span class="line"> #8 [ffff880f7566f910] __getblk at ffffffff81212cb5</span><br><span class="line"> #9 [ffff880f7566f970] __ext4_get_inode_loc at ffffffffa0373030 [ext4]</span><br><span class="line">#10 [ffff880f7566f9d8] ext4_get_inode_loc at ffffffffa0374dbd [ext4]</span><br><span class="line">#11 [ffff880f7566f9e8] ext4_reserve_inode_write at ffffffffa0376906 [ext4]</span><br><span class="line">#12 [ffff880f7566fa18] ext4_mark_inode_dirty at ffffffffa03769d3 [ext4]</span><br><span class="line">#13 [ffff880f7566fa70] ext4_writepages at ffffffffa0377567 [ext4]</span><br><span class="line">#14 [ffff880f7566fba8] do_writepages at ffffffff811758fe</span><br><span class="line">#15 [ffff880f7566fbb8] __filemap_fdatawrite_range at ffffffff8116a685</span><br><span class="line">#16 [ffff880f7566fc08] filemap_flush at ffffffff8116a74c</span><br><span class="line">#17 [ffff880f7566fc18] ext4_alloc_da_blocks at ffffffffa0374a8c [ext4]</span><br><span class="line">#18 [ffff880f7566fc38] ext4_release_file at ffffffffa036df89 [ext4]</span><br><span class="line">#19 [ffff880f7566fc60] __fput at ffffffff811e0329</span><br><span class="line">#20 [ffff880f7566fca8] ____fput at ffffffff811e05ee</span><br><span class="line">#21 [ffff880f7566fcb8] task_work_run at ffffffff810a22f4</span><br><span class="line">#22 [ffff880f7566fce8] do_exit at ffffffff810815eb</span><br><span class="line">#23 [ffff880f7566fd78] do_group_exit at ffffffff81081dff</span><br><span class="line">#24 [ffff880f7566fda8] get_signal_to_deliver at ffffffff81092c10</span><br><span class="line">#25 [ffff880f7566fe40] do_signal at ffffffff81014417</span><br><span class="line">#26 [ffff880f7566ff30] do_notify_resume at ffffffff81014adf</span><br><span class="line">#27 [ffff880f7566ff50] retint_signal at ffffffff8163d1fc</span><br><span class="line">    RIP: 00007f3db495ee17  RSP: 00007f3cbc8a20f0  RFLAGS: 00010246</span><br><span class="line">    RAX: 0000000000000006  RBX: 00007f3cbc8a2430  RCX: 0000000000000001</span><br><span class="line">    RDX: 00007f3cbc99f700  RSI: 0000000000000008  RDI: 0000000000000000</span><br><span class="line">    RBP: 00007f3cbc8a2220   R8: 00007f3cbc8a25f0   R9: 00007f3cbc8a24c0</span><br><span class="line">    R10: 00000000fffffe00  R11: 0000000000000000  R12: 000000000000000b</span><br><span class="line">    R13: 00007f3cbc8a24c0  R14: 00007f3cbc8a2430  R15: 00007f3db48ee2c5</span><br><span class="line">    ORIG_RAX: ffffffffffffffff  CS: 0033  SS: 002b</span><br><span class="line">crash&gt;</span><br></pre></td></tr></table></figure><h1 id="字段解释"><a href="#字段解释" class="headerlink" title="字段解释"></a>字段解释</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">KERNEL: 系统崩溃时运行的 kernel 文件</span><br><span class="line"></span><br><span class="line">DUMPFILE: 内核转储文件</span><br><span class="line"></span><br><span class="line">CPUS: 所在机器的 CPU 数量</span><br><span class="line"></span><br><span class="line">DATE: 系统崩溃的时间</span><br><span class="line"></span><br><span class="line">TASKS: 系统崩溃时内存中的任务数</span><br><span class="line"></span><br><span class="line">NODENAME: 崩溃的系统主机名</span><br><span class="line"></span><br><span class="line">RELEASE: 和 VERSION: 内核版本号</span><br><span class="line"></span><br><span class="line">MACHINE: CPU 架构</span><br><span class="line"></span><br><span class="line">MEMORY: 崩溃主机的物理内存</span><br><span class="line"></span><br><span class="line">PANIC: 崩溃类型，常见的崩溃类型包括：</span><br><span class="line"></span><br><span class="line">SysRq (System Request)：通过魔法组合键导致的系统崩溃，通常是测试使用。通过 echo c &gt; /proc/sysrq-trigger，就可以触发系统崩溃。</span><br><span class="line"></span><br><span class="line">oops：可以看成是内核级的 Segmentation Fault。应用程序如果进行了非法内存访问或执行了非法指令，会得到 Segfault 信号，一般行为是 coredump，应用程序也可以自己截获 Segfault 信号，自行处理。如果内核自己犯了这样的错误，则会弹出 oops 信息。</span><br></pre></td></tr></table></figure><h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/yum.repos.d/CentOS-Debug.repo  &lt;&lt;EOF</span><br><span class="line">[CentOS-Debug]</span><br><span class="line">name=CentOS-$releasever - DebugInfo</span><br><span class="line">baseurl=http://debuginfo.centos.org/\$releasever/\$basearch/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">protect=1</span><br><span class="line">priority=1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum --enablerepo=CentOS-Debug install -y kernel-debuginfo-$(uname -r)</span><br><span class="line"></span><br><span class="line">debuginfo-install glibc</span><br><span class="line"></span><br><span class="line">vmcore crash</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564573323&amp;ver=1762&amp;signature=eYQiG0V4e3pgc5iydmtd*UEuhY7rohGi9zaL*RC0WEfAiCVkC4t1brOW0hsLGkaT3Fb54tubjVVihDE24JBc3TDelUB8VS3dXWmA5oQSE8HyC*j7Cu8KTjfSmoYkL3wN&amp;new=1" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564573323&amp;ver=1762&amp;signature=eYQiG0V4e3pgc5iydmtd*UEuhY7rohGi9zaL*RC0WEfAiCVkC4t1brOW0hsLGkaT3Fb54tubjVVihDE24JBc3TDelUB8VS3dXWmA5oQSE8HyC*j7Cu8KTjfSmoYkL3wN&amp;new=1</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564546192&amp;ver=1761&amp;signature=4arrExz*PZo7Q3bQh5JnHWGSHOFGVdyWcc-WLOHUnHdNZoX6C0Abn*ENOjxlyt50u03ahhItFz7sj7wdGswCnLgOJ-HJBX1lEp8K2IlHxBggA8ZbcfAWj76YroR6wifv&amp;new=1" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?src=11&amp;timestamp=1564546192&amp;ver=1761&amp;signature=4arrExz*PZo7Q3bQh5JnHWGSHOFGVdyWcc-WLOHUnHdNZoX6C0Abn*ENOjxlyt50u03ahhItFz7sj7wdGswCnLgOJ-HJBX1lEp8K2IlHxBggA8ZbcfAWj76YroR6wifv&amp;new=1</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump1/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump1/index.html</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump3/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump3/index.html</a></p></li><li><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-kdump4/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/linux/l-cn-kdump4/index.html</a></p></li><li><p><a href="https://www.jianshu.com/p/5b4ef8112b97" target="_blank" rel="noopener">https://www.jianshu.com/p/5b4ef8112b97</a></p></li><li><p><a href="https://linux.cn/article-8737-1.html" target="_blank" rel="noopener">https://linux.cn/article-8737-1.html</a></p></li><li><p><a href="https://blog.csdn.net/yuanfang_way/article/details/77987399" target="_blank" rel="noopener">https://blog.csdn.net/yuanfang_way/article/details/77987399</a></p></li><li><p><a href="https://yq.aliyun.com/articles/483967" target="_blank" rel="noopener">https://yq.aliyun.com/articles/483967</a></p></li><li><p><a href="https://xiaoyeshiyu.github.io/linux/fae/2017/05/11/%E5%AE%9E%E4%BE%8B%E4%BD%BF%E7%94%A8crash%E5%88%86%E6%9E%90Kdump%E8%BD%AC%E5%82%A8kernel%E5%B4%A9%E6%BA%83%E5%86%85%E6%A0%B8/" target="_blank" rel="noopener">https://xiaoyeshiyu.github.io/linux/fae/2017/05/11/%E5%AE%9E%E4%BE%8B%E4%BD%BF%E7%94%A8crash%E5%88%86%E6%9E%90Kdump%E8%BD%AC%E5%82%A8kernel%E5%B4%A9%E6%BA%83%E5%86%85%E6%A0%B8/</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;持续整理中。。。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="crash" scheme="https://www.lengyuewusheng.com/tags/crash/"/>
    
  </entry>
  
  <entry>
    <title>常用Notebook使用笔记</title>
    <link href="https://www.lengyuewusheng.com/%E5%B8%B8%E7%94%A8notebook%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0.html"/>
    <id>https://www.lengyuewusheng.com/常用notebook使用笔记.html</id>
    <published>2019-06-02T04:25:42.000Z</published>
    <updated>2019-12-01T13:22:47.466Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>基础备忘</p></blockquote><a id="more"></a><h1 id="jupyter"><a href="#jupyter" class="headerlink" title="jupyter"></a>jupyter</h1><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><ul><li><p>列出主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jt -l</span><br></pre></td></tr></table></figure></li><li><p>选择主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">jt -t grade3     #白</span><br><span class="line">jt -t solarizedl #浅土黄</span><br><span class="line">jt -t gruvboxl   #深土黄</span><br><span class="line">jt -t chesterish #深蓝</span><br><span class="line">jt -t solarizedd #深绿</span><br><span class="line">jt -t oceans16   #深灰</span><br><span class="line">jt -t monokai    #黑白</span><br><span class="line">jt -t gruvboxd   #黑黄</span><br><span class="line">jt -t onedork    #黑灰</span><br></pre></td></tr></table></figure></li><li><p>代码转PPT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter nbconvert *.ipynb --to slides --post serve</span><br></pre></td></tr></table></figure></li><li><p>绑定IP端口启动服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --ip=10.0.0.1 --port=10001</span><br></pre></td></tr></table></figure></li><li><p>指定目录<br>jupyter notebook –ip=10.0.0.1 –port=10001 nibilaoyedenotebook</p></li><li><p>创建密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jupyter notebook --generate-config</span><br><span class="line">jupyter notebook password --ip=10.0.0.1 --port=10001</span><br></pre></td></tr></table></figure></li></ul><h1 id="zeppelin"><a href="#zeppelin" class="headerlink" title="zeppelin"></a>zeppelin</h1><h2 id="ldap-认证"><a href="#ldap-认证" class="headerlink" title="ldap 认证"></a>ldap 认证</h2><ul><li>userDnTemplate中的{0}表示登录时输入的用户名,</li><li>conf/zeppelin-site.xml修改zeppelin.anonymous.allowed属性为false</li><li>ldapRealm.contextFactory.authenticationMechanism后面的赋值选项<ul><li>none</li><li>simple</li><li>SASL</li><li>DIGEST-MD5<ul><li><a href="https://github.com/apache/zeppelin/pull/2331" target="_blank" rel="noopener">https://github.com/apache/zeppelin/pull/2331</a></li></ul></li></ul></li></ul><h2 id="nginx代理关键配置"><a href="#nginx代理关键配置" class="headerlink" title="nginx代理关键配置"></a>nginx代理关键配置</h2><ul><li><p>zeppelin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat conf/zeppelin-site.xml</span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;zeppelin.server.context.path&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;/zeppelin/&lt;/value&gt;</span><br><span class="line">  &lt;description&gt;Context Path of the Web Application&lt;/description&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure></li><li><p>nginx</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream zeppelin &#123;</span><br><span class="line">        server 10.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location /zeppelin</span><br><span class="line">&#123;</span><br><span class="line">    proxy_pass http://zeppelin;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Forwarded-Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br><span class="line">location /zeppelin/ws &#123;  # For websocket support</span><br><span class="line">    proxy_pass http://zeppelin;</span><br><span class="line">    proxy_http_version 1.1;</span><br><span class="line">    proxy_set_header Upgrade websocket;</span><br><span class="line">    proxy_set_header Connection upgrade;</span><br><span class="line">    proxy_read_timeout 86400;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><p>-<a href="https://nbviewer.jupyter.org/" target="_blank" rel="noopener">upyter Notebooks 共享社区</a></p><ul><li><p><a href="https://jupyter-notebook.readthedocs.io/en/stable/security.html#alternatives-to-token-authentication" target="_blank" rel="noopener">https://jupyter-notebook.readthedocs.io/en/stable/security.html#alternatives-to-token-authentication</a></p></li><li><p><a href="https://zeppelin.apache.org/docs/0.8.0/setup/security/shiro_authentication.html" target="_blank" rel="noopener">https://zeppelin.apache.org/docs/0.8.0/setup/security/shiro_authentication.html</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;基础备忘&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="开源技术栈" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
      <category term="jupyter" scheme="https://www.lengyuewusheng.com/tags/jupyter/"/>
    
      <category term="zeppelin" scheme="https://www.lengyuewusheng.com/tags/zeppelin/"/>
    
  </entry>
  
  <entry>
    <title>自签SSL证书</title>
    <link href="https://www.lengyuewusheng.com/%E8%87%AA%E7%AD%BEssl%E8%AF%81%E4%B9%A6.html"/>
    <id>https://www.lengyuewusheng.com/自签ssl证书.html</id>
    <published>2019-05-26T06:38:29.000Z</published>
    <updated>2019-12-01T14:01:40.870Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>devops 必备技能</p></blockquote><a id="more"></a><ul><li><p>查看当前系统使用的 OpenSSL 版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version</span><br></pre></td></tr></table></figure></li><li><p>获取完整的版本信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl version -a</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>X.509 是密码学里公钥证书的格式标准。一般包含三类文件，key，csr，crt。</p></blockquote><ul><li>key是私用密钥，openssl格式，通常是rsa算法。</li><li>csr是证书请求文件，用于申请证书。在制作csr文件的时候，必须使用自己的私钥来签署申请，还可以设定一个密钥。</li><li>crt是CA认证后的证书文件（windows下面的csr，其实是crt），签署人用自己的key给你签署的凭证。</li></ul><h1 id="证书创建过程"><a href="#证书创建过程" class="headerlink" title="证书创建过程"></a>证书创建过程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/nginx/conf/cert</span><br><span class="line">cd /usr/local/nginx/conf/cert</span><br><span class="line"></span><br><span class="line">#创建RSA私有密钥</span><br><span class="line">openssl genrsa  -out domainName.key 2048</span><br><span class="line"># 创建CSR(为申请数字服务器证书而发送至证书颁发机构 (CA) 的文件)</span><br><span class="line">openssl req -out domainName.csr -key domainName.key -new -sha256</span><br><span class="line">mv domainName.key domainName.origin.key</span><br><span class="line"># 删除RSA私钥密码</span><br><span class="line">openssl rsa -in domainName.origin.key -out domainName.key</span><br><span class="line"># 请使用 openssl x509 对证书进行签名(使用私钥和签名请求创建的公有证书)</span><br><span class="line">openssl x509 -req -sha256 -days 3650 -in domainName.csr -signkey domainName.key -out domainName.crt</span><br></pre></td></tr></table></figure><h1 id="nginx相关配置"><a href="#nginx相关配置" class="headerlink" title="nginx相关配置"></a>nginx相关配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">   listen 443 ssl;</span><br><span class="line">   ssl_certificate     /usr/local/nginx/conf/cert/domainName.crt;</span><br><span class="line">   ssl_certificate_key  /usr/local/nginx/conf/cert/domainName.key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><a href="https://certbot.eff.org/lets-encrypt/centosrhel7-nginx" target="_blank" rel="noopener">certbot生成CentOS7证书</a></li><li><a href="https://certbot.eff.org/docs/using.html#nginx" target="_blank" rel="noopener">certbot官方文档</a></li><li><a href="https://www.openssl.org/docs/man1.1.1/man1/" target="_blank" rel="noopener">OpenSSL commands·官方文档</a></li><li><a href="https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/configuring-https-ssl.html" target="_blank" rel="noopener">创建和签名 X509 证书</a></li><li><a href="https://www.jianshu.com/p/f5d9d778d9dc" target="_blank" rel="noopener">openssl 生成nginx 证书</a></li></ul>]]></content>
    
    <summary type="html">
    
      Describe briefly.
    
    </summary>
    
    
      <category term="openssl" scheme="https://www.lengyuewusheng.com/tags/openssl/"/>
    
      <category term="https" scheme="https://www.lengyuewusheng.com/tags/https/"/>
    
  </entry>
  
  <entry>
    <title>开源论坛技术栈</title>
    <link href="https://www.lengyuewusheng.com/%E5%BC%80%E6%BA%90%E8%AE%BA%E5%9D%9B%E6%8A%80%E6%9C%AF%E6%A0%88.html"/>
    <id>https://www.lengyuewusheng.com/开源论坛技术栈.html</id>
    <published>2019-05-19T12:18:06.000Z</published>
    <updated>2019-12-01T13:22:21.747Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>摘要内容</p></blockquote><a id="more"></a><h1 id="nodebb"><a href="#nodebb" class="headerlink" title="nodebb"></a>nodebb</h1><h2 id="命令行安装-启-停插件"><a href="#命令行安装-启-停插件" class="headerlink" title="命令行安装/启/停插件"></a>命令行安装/启/停插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 列出插件列表</span><br><span class="line">./nodebb plugins</span><br><span class="line">npm install nodebb-plugin-office-ldap</span><br><span class="line">./nodebb reset --plugin nodebb-plugin-office-ldap</span><br><span class="line">./nodebb restart</span><br><span class="line">./nodebb activate nodebb-plugin-office-ldap</span><br><span class="line">./nodebb restart</span><br></pre></td></tr></table></figure><h2 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">crontab:</span><br><span class="line">*/2 * * * * /data/nodebb/nodebb.mongo.backup.sh &gt;&gt; /data/nodebb/backupLogs/backup.log.$(date &quot;+\%Y\%m\%d\%H\%M\%S&quot;) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">cat nodebb.mongo.backup.sh</span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">backupDir=/data/nodebb/db-backups/mongo.backup.v$(date &quot;+%Y%m%d_%H%M%S&quot;)</span><br><span class="line">mkdir -v $&#123;backupDir&#125;</span><br><span class="line">/usr/bin/mongodump -h 127.0.0.1:27017 -d nodebb -o $&#123;backupDir&#125;</span><br><span class="line">cd $(dirname $&#123;backupDir&#125;)</span><br><span class="line">tar -czf  $(basename $&#123;backupDir&#125;).tar.gz $(basename $&#123;backupDir&#125;)</span><br><span class="line">rm -rvf $(basename $&#123;backupDir&#125;)</span><br></pre></td></tr></table></figure><h2 id="中文搜索支持"><a href="#中文搜索支持" class="headerlink" title="中文搜索支持"></a>中文搜索支持</h2><p>nodebb-plugin-solr</p><h2 id="solr部署"><a href="#solr部署" class="headerlink" title="solr部署"></a>solr部署</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget http://apache.mirrors.lucidnetworks.net/lucene/solr/8.2.0/solr-8.2.0.tgz -O - |tar -zx</span><br><span class="line">ulimit -u 65000</span><br><span class="line">cd /path/to/solr/server/solr</span><br><span class="line">/path/to/solr/bin/solr create_core -c nodebb            #创建核心</span><br><span class="line">/path/to/solr/bin/solr create_collection -c nodebb      #cloud模式下</span><br><span class="line">/path/to/solr/bin/solr delete -c nodebb                 # 删除核心创建核心</span><br><span class="line">/path/to/solr/bin/solr status                           # 查看solr节点信息</span><br><span class="line">./bin/solr start</span><br><span class="line">/path/to/solr/bin/solr start -e cloud                   #以cloud实例模式运行</span><br><span class="line">/path/to/solr/bin/solr create_collection -c nodebb -s 3 -rf 3</span><br><span class="line">/path/to/solr/bin/solr auth enable -type basicAuth -credentials admin:nodebbAdmin</span><br><span class="line">/path/to/solr/bin/solr auth disable</span><br></pre></td></tr></table></figure><ul><li><a href="https://www.w3cschool.cn/solr_doc/solr_doc-emn62fs5.html" target="_blank" rel="noopener">以示例配置运行</a></li></ul><h1 id="discourse"><a href="#discourse" class="headerlink" title="discourse"></a>discourse</h1><p>官方仅提供docker部署方式</p><h1 id="Flarum"><a href="#Flarum" class="headerlink" title="Flarum"></a>Flarum</h1><p>Beta版本，功能和易用性相对较差</p><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://docs.archive.nodebb.org/zh_CN/latest/configuring/databases/mongo.html" target="_blank" rel="noopener">nodebb官方文档</a></p></li><li><p><a href="https://docs.nodebb.org/installing/os/centos/" target="_blank" rel="noopener">https://docs.nodebb.org/installing/os/centos/</a></p></li><li><p><a href="https://hearrain.com/2015/12/847" target="_blank" rel="noopener">https://hearrain.com/2015/12/847</a></p></li><li><p><a href="https://www.rosehosting.com/blog/how-to-install-nodebb-on-a-centos-7-vps/" target="_blank" rel="noopener">https://www.rosehosting.com/blog/how-to-install-nodebb-on-a-centos-7-vps/</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;摘要内容&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="开源技术栈" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
    
    
      <category term="开源工具" scheme="https://www.lengyuewusheng.com/tags/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/"/>
    
      <category term="nodebb" scheme="https://www.lengyuewusheng.com/tags/nodebb/"/>
    
  </entry>
  
  <entry>
    <title>基于scrcpy远程操控android设备</title>
    <link href="https://www.lengyuewusheng.com/%E5%9F%BA%E4%BA%8Escrcpy%E8%BF%9C%E7%A8%8B%E6%93%8D%E6%8E%A7android%E8%AE%BE%E5%A4%87.html"/>
    <id>https://www.lengyuewusheng.com/基于scrcpy远程操控android设备.html</id>
    <published>2019-05-11T05:17:27.000Z</published>
    <updated>2019-12-01T13:22:05.308Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>非常酷炫的操作。。。</p></blockquote><a id="more"></a><h1 id="USB模式"><a href="#USB模式" class="headerlink" title="USB模式"></a>USB模式</h1><blockquote><p>需要通过USB线直连Android设备。</p></blockquote><h2 id="打开开发者选项"><a href="#打开开发者选项" class="headerlink" title="打开开发者选项"></a>打开开发者选项</h2><blockquote><p>当手机开发者选项隐藏关闭时，需要打开开发者选项，设置&gt;系统&gt;关于手机&gt;版本号，<a href="https://developer.android.com/studio/debug/dev-options?hl=zh-CN" target="_blank" rel="noopener">点击版本号信息7次</a>,返回上一屏幕，在底部附近可以找到开发者选项</p></blockquote><h2 id="打开USB调试"><a href="#打开USB调试" class="headerlink" title="打开USB调试"></a>打开USB调试</h2><blockquote><p>设置&gt;系统&gt;开发者选项&gt;USB调试，打开USB调试</p></blockquote><h2 id="打开”仅充电”模式下允许ADB调试"><a href="#打开”仅充电”模式下允许ADB调试" class="headerlink" title="打开”仅充电”模式下允许ADB调试"></a>打开”仅充电”模式下允许ADB调试</h2><blockquote><p>设置&gt;系统&gt;开发者选项&gt;”仅充电”模式下允许ADB调试，打开”仅充电”模式下允许ADB调试</p></blockquote><h2 id="执行-scrcpy-exe-即可"><a href="#执行-scrcpy-exe-即可" class="headerlink" title="执行 scrcpy.exe, 即可"></a>执行 <code>scrcpy.exe</code>, 即可</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\scrcpy-win64-v1.10&gt; .\scrcpy.exe</span><br><span class="line">INFO: scrcpy 1.10 &lt;https://github.com/Genymobile/scrcpy&gt;</span><br><span class="line">E:\PortableSoftwares\scrcpy-win64-v1.10\scrcpy-server.jar: 1 file pushed. 0.0 MB/s (22546 bytes in 0.435s)</span><br><span class="line">INFO: Initial texture: 1080x1920</span><br></pre></td></tr></table></figure><h1 id="wifi模式"><a href="#wifi模式" class="headerlink" title="wifi模式"></a>wifi模式</h1><blockquote><p>前三步和USB模式相同，同时要求，adb调试设备和被调试设备在同一WLAN网络</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS C:\WINDOWS\system32&gt; adb tcpip 5555</span><br><span class="line">PS C:\WINDOWS\system32&gt; adb connect 10.10.10.2:5555</span><br><span class="line">connected to 10.10.10.2:5555</span><br><span class="line"># 至此可拔掉USB连接线</span><br><span class="line">PS C:\WINDOWS\system32&gt; cd C:\scrcpy-win64-v1.10</span><br><span class="line">PS C:\scrcpy-win64-v1.10&gt; .\scrcpy.exe</span><br><span class="line">INFO: scrcpy 1.10 &lt;https://github.com/Genymobile/scrcpy&gt;</span><br><span class="line">E:\PortableSoftwares\scrcpy-win64-v1.10\scrcpy-server.jar: 1 file pushed. 0.0 MB/s (22546 bytes in 0.431s)</span><br><span class="line">INFO: Initial texture: 1080x1920</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://github.com/Genymobile/scrcpy" target="_blank" rel="noopener">scrcpy</a></p></li><li><p><a href="https://github.com/Tomotoes/scrcpy-gui" target="_blank" rel="noopener">scrcpy-gui</a></p></li><li><p><a href="https://developer.android.com/studio/command-line/adb.html#Enabling" target="_blank" rel="noopener">android开发者文档·在设备上启用 adb 调试</a></p></li><li><p><a href="https://developer.android.com/studio/releases/platform-tools.html" target="_blank" rel="noopener">Android SDK Platform-Tools下载·adb命令</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;非常酷炫的操作。。。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="工具控" scheme="https://www.lengyuewusheng.com/categories/%E5%B7%A5%E5%85%B7%E6%8E%A7/"/>
    
    
      <category term="scrcpy" scheme="https://www.lengyuewusheng.com/tags/scrcpy/"/>
    
      <category term="Android" scheme="https://www.lengyuewusheng.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Linux开机启动的多种实现方式</title>
    <link href="https://www.lengyuewusheng.com/linux%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E7%9A%84%E5%A4%9A%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F.html"/>
    <id>https://www.lengyuewusheng.com/linux开机启动的多种实现方式.html</id>
    <published>2019-04-23T04:14:58.000Z</published>
    <updated>2019-06-05T05:00:20.414Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>开机启动是运维自动化的重要组成部分。</p></blockquote><a id="more"></a><h1 id="etc-rc-local"><a href="#etc-rc-local" class="headerlink" title="/etc/rc.local"></a>/etc/rc.local</h1><blockquote><p>可将开机启动命令追加到/etc/rc.local中</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># readlink /etc/rc.local</span><br><span class="line">rc.d/rc.local         // /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure><h1 id="chkconfig"><a href="#chkconfig" class="headerlink" title="chkconfig"></a>chkconfig</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># readlink /etc/init.d</span><br><span class="line">rc.d/init.d           // /etc/rc.d/init.d/</span><br><span class="line"></span><br><span class="line">chkconfig --add servicename             # 使服务会被在/etc/rc.d/rcN.d中赋予K/S入口</span><br><span class="line">chkconfig --level 35 servicename on 或 sudo update-rc.d servicename defaults 95</span><br><span class="line">chkconfig --list</span><br></pre></td></tr></table></figure><ul><li><p>服务脚本必须存放在/etc/ini.d/目录下</p></li><li><p>/etc/ini.d/下的脚本最开始必须包含以下三行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/sh</span><br><span class="line"># chkconfig: - 58 74    # 分别代表运行级别，启动优先权，关闭优先权，此行代码必须</span><br><span class="line"># description:</span><br></pre></td></tr></table></figure></li></ul><h1 id="etc-profile-d"><a href="#etc-profile-d" class="headerlink" title="/etc/profile.d/"></a>/etc/profile.d/</h1><ul><li><p>登陆自动执行(/etc/profile.d/)，不仅仅是开机自动执行。</p></li><li><p>必须是.sh后缀的脚本文件</p></li></ul><h1 id="systemd"><a href="#systemd" class="headerlink" title="systemd"></a>systemd</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files --type=service | grep enabled         # 查看允许开机启动的服务进程</span><br><span class="line">systemctl list -units --type=service                            # 查看所有已启动的服务</span><br><span class="line">systemctl mask daemon.service                                   # 在任何情况下系统启动时都不启动该进程</span><br><span class="line">systemctl enable daemon.service                                 # 设置开机启动</span><br><span class="line">systemctl disable daemon.service                                # 禁止开机启动</span><br><span class="line">systemctl is-enabled daemon.service                             # 确认服务是否开机启动</span><br><span class="line">ll  /etc/systemd/system/multi-user.target.wants/                # 查看所有开启启动的服务</span><br></pre></td></tr></table></figure><h1 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@reboot root ( sleep 30; sh /path/to/script.sh )    # 经验证，cron配置中支持小括号</span><br></pre></td></tr></table></figure><ul><li>cron支持的关键字<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@reboot at startup</span><br><span class="line">@yearly once a year</span><br><span class="line">@annually ( == @yearly)</span><br><span class="line">@monthly once a month</span><br><span class="line">@weekly once a week</span><br><span class="line">@daily once a day</span><br><span class="line">@midnight ( == @daily)</span><br><span class="line">@hourly once an hour</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;开机启动是运维自动化的重要组成部分。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="chkconfig" scheme="https://www.lengyuewusheng.com/tags/chkconfig/"/>
    
      <category term="systemd" scheme="https://www.lengyuewusheng.com/tags/systemd/"/>
    
  </entry>
  
  <entry>
    <title>Linux环境中精确控制普通用户的sudo权限</title>
    <link href="https://www.lengyuewusheng.com/linux%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%B2%BE%E7%A1%AE%E6%8E%A7%E5%88%B6%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E7%9A%84sudo%E6%9D%83%E9%99%90.html"/>
    <id>https://www.lengyuewusheng.com/linux环境中精确控制普通用户的sudo权限.html</id>
    <published>2019-02-07T12:56:23.000Z</published>
    <updated>2019-06-05T05:01:37.092Z</updated>
    
    <content type="html"><![CDATA[<p>精准施控才能游刃有余。</p><a id="more"></a><h1 id="需求背景"><a href="#需求背景" class="headerlink" title="需求背景"></a>需求背景</h1><blockquote><p>在持续集成的实践中,为了保障生产环境安全可靠避免意外事故的发生。需要限制用户的操作权限，又要满足构建需要，因此需要对持续集成过程中的操作命令权限进行精准控制。实现最小权限开放，最大灵活性保障。</p></blockquote><h1 id="sudo配置"><a href="#sudo配置" class="headerlink" title="sudo配置"></a>sudo配置</h1><ul><li><p>配置文件名不能包含.后缀(文件名中不能包含.)，否则配置不生效。</p></li><li><p>生成配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sudoers.d/jenkins_deploy &lt;&lt; EOF</span><br><span class="line">Host_Alias     JENKINS_SERVERS = $(echo -n $(ip addr show dev eth0 | awk &apos;/inet/ &#123;sub(/\//, &quot; &quot;); print $2&#125;&apos;|head -1)), 127.0.0.1</span><br><span class="line">Cmnd_Alias      JENKINS_CMD = $(which rsync), $(which ln), $(which unlink), $(which readlink), $(which test), $(which mv), $(which mkdir)</span><br><span class="line">Defaults:jenkins        !requiretty</span><br><span class="line">Defaults!JENKINS_CMD  !syslog</span><br><span class="line">jenkins         JENKINS_SERVERS=(root)      NOPASSWD: JENKINS_CMD</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li><li><p>配置范例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host_Alias     JENKINS_SERVERS = 10.0.0.1, 127.0.0.1</span><br><span class="line">Cmnd_Alias      JENKINS_CMD = /usr/bin/rsync, /bin/ln, /bin/unlink, /usr/bin/readlink, /usr/bin/test, /bin/mv, /bin/mkdir</span><br><span class="line">Defaults:jenkins    !requiretty</span><br><span class="line">Defaults!JENKINS_CMD!syslog</span><br><span class="line">jenkinsJENKINS_SERVERS=(root)      NOPASSWD: JENKINS_CMD</span><br></pre></td></tr></table></figure></li></ul><blockquote><ul><li>主机别名定义 sudo 用户有权在哪个服务器（或特定范围内的服务器）上发出命令。在主机别名中，可以使用 DNS 名称或 IP 地址，或者指定整个网络范围（例如 172.17.12.0/24）。要限制访问范围，应该仅指定群集节点的主机名。别名必须全部而且只能使用大写英文字母的组合</li><li>centos 5 的默认版本sudo-1.7.2p1-14.el5_8.4 不支持JENKINS_SERVERS中使用网段掩码</li></ul></blockquote><h1 id="ALL-ALL-ALL-ALL-配置字段解释"><a href="#ALL-ALL-ALL-ALL-配置字段解释" class="headerlink" title="ALL ALL=(ALL) ALL 配置字段解释"></a>ALL ALL=(ALL) ALL 配置字段解释</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALL ALL=(ALL) ALL</span><br><span class="line">The first ALL is the users allowed</span><br><span class="line">The second one is the hosts</span><br><span class="line">The third one is the user as you are running the command</span><br><span class="line">The last one is the commands allowed</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="https://unix.stackexchange.com/questions/201858/what-does-all-all-all-all-mean-in-sudoers" target="_blank" rel="noopener">What does “ALL ALL=(ALL) ALL” mean in sudoers?</a></p></li><li><p><a href="https://wiki.archlinux.org/index.php/Sudo" target="_blank" rel="noopener">archlinux·sudo</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;精准施控才能游刃有余。&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/categories/Linux/"/>
    
    
      <category term="linux" scheme="https://www.lengyuewusheng.com/tags/linux/"/>
    
      <category term="权限管理" scheme="https://www.lengyuewusheng.com/tags/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    
      <category term="sudoers" scheme="https://www.lengyuewusheng.com/tags/sudoers/"/>
    
  </entry>
  
  <entry>
    <title>Apache No space left on device</title>
    <link href="https://www.lengyuewusheng.com/apache-no-space-left-on-device.html"/>
    <id>https://www.lengyuewusheng.com/apache-no-space-left-on-device.html</id>
    <published>2019-01-31T13:04:10.000Z</published>
    <updated>2019-04-09T06:13:04.382Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Inter-Process Communication，进程间通信</p></blockquote><a id="more"></a><h1 id="报错信息"><a href="#报错信息" class="headerlink" title="报错信息"></a>报错信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat /var/logs/httpd/error_log |grep -i device</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] create_server_temp_conf begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] create_server_temp_conf end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] Digest: generating secret for digest authentication ...</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] Digest: done</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config begin</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_create: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_mc_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_qdb_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] qdb_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_socket_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] socket_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] set_schat_host_sc end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: begin 23014</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: for loop i=0, server_no:1</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: for loop i=0, server_no:1,0,900,1000</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] schat_cp_initialize: ok</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [notice] sohudb_post_config end</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [warn] pid file /etc/httpd/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?</span><br><span class="line">[Wed Nov 21 20:15:01 2018] [emerg] (28)No space left on device: Couldn&apos;t create accept lock (/etc/httpd/logs/accept.lock.23014) (5)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># ipcs -s</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 65273857   apache    600        1</span><br><span class="line">0x00000000 65372162   apache    600        1</span><br><span class="line">0x00000000 65470467   apache    600        1</span><br><span class="line">0x00000000 65568772   apache    600        1</span><br><span class="line">0x00000000 65667077   apache    600        1</span><br><span class="line">0x00000000 65765382   apache    600        1</span><br><span class="line">0x00000000 65863687   apache    600        1</span><br><span class="line">0x00000000 65961992   apache    600        1</span><br><span class="line">0x00000000 66060297   apache    600        1</span><br><span class="line">0x00000000 66158602   apache    600        1</span><br><span class="line">0x00000000 66256907   apache    600        1</span><br><span class="line">0x00000000 66355212   apache    600        1</span><br><span class="line">0x00000000 66453517   apache    600        1</span><br><span class="line">0x00000000 66551822   apache    600        1</span><br><span class="line">0x00000000 66650127   apache    600        1</span><br><span class="line">0x00000000 66748432   apache    600        1</span><br><span class="line">0x00000000 66846737   apache    600        1</span><br><span class="line">0x00000000 66945042   apache    600        1</span><br><span class="line">0x00000000 67043347   apache    600        1</span><br><span class="line">0x00000000 67141652   apache    600        1</span><br><span class="line">0x00000000 67239957   apache    600        1</span><br><span class="line">0x00000000 67338262   apache    600        1</span><br><span class="line">0x00000000 67436567   apache    600        1</span><br><span class="line">0x00000000 67534872   apache    600        1</span><br><span class="line">0x00000000 67633177   apache    600        1</span><br><span class="line">0x00000000 67731482   apache    600        1</span><br><span class="line">0x00000000 67829787   apache    600        1</span><br><span class="line">0x00000000 67928092   apache    600        1</span><br><span class="line">0x00000000 68026397   apache    600        1</span><br><span class="line">0x00000000 68124702   apache    600        1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># ipcs -l</span><br><span class="line"></span><br><span class="line">------ Shared Memory Limits --------</span><br><span class="line">max number of segments = 4096</span><br><span class="line">max seg size (kbytes) = 67108864</span><br><span class="line">max total shared memory (kbytes) = 17179869184</span><br><span class="line">min seg size (bytes) = 1</span><br><span class="line"></span><br><span class="line">------ Semaphore Limits --------</span><br><span class="line">max number of arrays = 512</span><br><span class="line">max semaphores per array = 25032000</span><br><span class="line">max semaphores system wide = 32</span><br><span class="line">max ops per semop call = 512</span><br><span class="line">semaphore max value = 32767</span><br><span class="line"></span><br><span class="line">------ Messages: Limits --------</span><br><span class="line">max queues system wide = 16</span><br><span class="line">max size of message (bytes) = 65536</span><br><span class="line">default max size of queue (bytes) = 65536</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># ipcs -a</span><br><span class="line"></span><br><span class="line">------ Shared Memory Segments --------</span><br><span class="line">key        shmid      owner      perms      bytes      nattch     status</span><br><span class="line">0x74008327 3440640    root      600        4          0</span><br><span class="line">0x740082fd 4128769    root      600        4          0</span><br><span class="line">0x00000000 4489218    root      644        80         2</span><br><span class="line">0x740082fc 4096003    root      600        4          0</span><br><span class="line">0x00000000 4521988    root      644        16384      2</span><br><span class="line">0x00000000 4554757    root      644        280        2</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 170524673  apache    600        1</span><br><span class="line">0x00000000 170557442  apache    600        1</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br></pre></td></tr></table></figure><h1 id="处理方案"><a href="#处理方案" class="headerlink" title="处理方案"></a>处理方案</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># for i in $(/usr/bin/ipcs -s | awk &apos;/apache/ &#123;print $2&#125;&apos;); do /usr/bin/ipcrm -s $i; done</span><br><span class="line"># ipcs -s</span><br><span class="line"></span><br><span class="line">------ Semaphore Arrays --------</span><br><span class="line">key        semid      owner      perms      nsems</span><br><span class="line">0x000000a7 0          root      600        1</span><br><span class="line">0x00000000 170524673  apache    600        1</span><br><span class="line">0x00000000 170557442  apache    600        1</span><br></pre></td></tr></table></figure><h1 id="linux-unix下的进程间两类通信方式"><a href="#linux-unix下的进程间两类通信方式" class="headerlink" title="linux/unix下的进程间两类通信方式"></a>linux/unix下的进程间两类通信方式</h1><h2 id="基于文件的IPC"><a href="#基于文件的IPC" class="headerlink" title="基于文件的IPC"></a>基于文件的IPC</h2><ul><li>基于普通文件的IPC</li><li>基于管道文件的IPC<ul><li>普通管道</li><li>匿名管道<ul><li>匿名管道只能使用在父子进程之间</li></ul></li></ul></li><li>基于socket文件的IPC<ul><li>对等模型<ul><li>对等模型主要用于udp编程</li></ul></li><li>C/S模型<ul><li>C/S模型主要用于TCP编程</li></ul></li></ul></li></ul><h2 id="基于内存的IPC"><a href="#基于内存的IPC" class="headerlink" title="基于内存的IPC"></a>基于内存的IPC</h2><ul><li>基于共享内存的IPC，</li><li>基于共享队列的IPC，</li><li>基于信号量的IPC。</li><li>内核内存的工具（ipcs）<blockquote><p>ipcs命令往标准输出写入一些关于活动进程间通信设施的信息.</p><ul><li>ipcs可以指定查看的具体信息，<ul><li>如ipcs -m 查看共享内存，</li><li>-q：查看共享队列，</li><li>ipcs -s查看共享信号量，</li><li>以上3中都不指定时则是查看共享内存、共享队列和共享信号量</li></ul></li></ul></blockquote></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><p><a href="https://major.io/2007/08/24/apache-no-space-left-on-device-couldnt-create-accept-lock/" target="_blank" rel="noopener">Apache: No space left on device: Couldn’t create accept lock</a></p></li><li><p><a href="http://www.voidcn.com/article/p-xilljgvz-ms.html" target="_blank" rel="noopener">ipcs命令详解</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Inter-Process Communication，进程间通信&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="IPC" scheme="https://www.lengyuewusheng.com/categories/IPC/"/>
    
    
      <category term="Apache" scheme="https://www.lengyuewusheng.com/tags/Apache/"/>
    
      <category term="httpd" scheme="https://www.lengyuewusheng.com/tags/httpd/"/>
    
      <category term="IPC" scheme="https://www.lengyuewusheng.com/tags/IPC/"/>
    
  </entry>
  
  <entry>
    <title>应用开发的12要素</title>
    <link href="https://www.lengyuewusheng.com/%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E7%9A%8412%E8%A6%81%E7%B4%A0.html"/>
    <id>https://www.lengyuewusheng.com/应用开发的12要素.html</id>
    <published>2019-01-25T14:47:57.000Z</published>
    <updated>2019-04-09T06:16:26.262Z</updated>
    
    <content type="html"><![CDATA[<p>12-Factor 为构建 SaaS 应用提供方法论。</p><a id="more"></a><ul><li><p>基准代码</p><blockquote><p>一份基准代码，多份部署</p></blockquote></li><li><p>依赖</p><blockquote><p>显式声明依赖关系</p></blockquote></li><li><p>配置</p><blockquote><p>在环境中存储配置</p></blockquote></li><li><p>后端服务</p><blockquote><p>把后端服务当作附加资源</p></blockquote></li><li><p>构建，发布，运行</p><blockquote><p>严格分离构建和运行</p></blockquote></li><li><p>进程</p><blockquote><p>以一个或多个无状态进程运行应用</p></blockquote></li><li><p>端口绑定</p><blockquote><p>通过端口绑定提供服务</p></blockquote></li><li><p>并发</p><blockquote><p>通过进程模型进行扩展</p></blockquote></li><li><p>易处理</p><blockquote><p>快速启动和优雅终止可最大化健壮性</p></blockquote></li><li><p>开发环境与线上环境等价</p><blockquote><p>尽可能的保持开发，预发布，线上环境相同</p></blockquote></li><li><p>日志</p><blockquote><p>把日志当作事件流</p></blockquote></li><li><p>管理进程</p><blockquote><p>后台管理任务当作一次性进程运行</p></blockquote></li></ul><h1 id="转载自"><a href="#转载自" class="headerlink" title="转载自"></a>转载自</h1><ul><li><a href="https://www.12factor.net/zh_cn/" target="_blank" rel="noopener">THE TWELVE-FACTOR APP</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;12-Factor 为构建 SaaS 应用提供方法论。&lt;/p&gt;
    
    </summary>
    
      <category term="12factor" scheme="https://www.lengyuewusheng.com/categories/12factor/"/>
    
    
      <category term="12factor" scheme="https://www.lengyuewusheng.com/tags/12factor/"/>
    
  </entry>
  
  <entry>
    <title>git基础实践</title>
    <link href="https://www.lengyuewusheng.com/git%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5.html"/>
    <id>https://www.lengyuewusheng.com/git基础实践.html</id>
    <published>2018-12-28T14:38:26.000Z</published>
    <updated>2019-12-01T09:29:37.179Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Git 是 Linus Torvalds为了帮助管理Linux内核开发而开发的一个开放源码的版本控制软件。</p></blockquote><a id="more"></a><h1 id="git常用命令"><a href="#git常用命令" class="headerlink" title="git常用命令"></a>git常用命令</h1><ul><li><p>列出当前配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --list</span><br></pre></td></tr></table></figure></li><li><p>列出repository配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --local --list</span><br></pre></td></tr></table></figure></li><li><p>列出全局配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --list</span><br></pre></td></tr></table></figure></li><li><p>列出系统配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --system --list</span><br></pre></td></tr></table></figure></li><li><p>配置用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;your name&quot;</span><br></pre></td></tr></table></figure></li><li><p>配置用户邮箱</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;youremail@github.com&quot;</span><br></pre></td></tr></table></figure></li><li><p>配置git命令输出为彩色</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global color.ui auto</span><br></pre></td></tr></table></figure></li><li><p>查看当前工作区的所有文件的状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure></li><li><p>查看提交历史：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure></li><li><p>参数-p展开每次提交的内容差异，如-2显示最近的两次更新</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -p -2;</span><br></pre></td></tr></table></figure></li><li><p>提交工作区所有文件到暂存区</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure></li><li><p>删除工作区文件并且也从暂存区删除对应文件的记录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm &lt;file1&gt; &lt;file2&gt;</span><br></pre></td></tr></table></figure></li><li><p>比较工作区中当前文件和暂存区之间的差异</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;file-name&gt;</span><br></pre></td></tr></table></figure></li><li><p>隐藏当前变更</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure></li><li><p>查看当前所有的储藏</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash list</span><br></pre></td></tr></table></figure></li><li><p>应用最新的储藏</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash apply</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>将暂存区中的文件提交到本地仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;commit_info&quot;</span><br></pre></td></tr></table></figure></li><li><p>将所有已经使用git管理过的文件暂存并提交,相当于执行git add和git commit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m &quot;commit_info&quot;</span><br></pre></td></tr></table></figure></li><li><p>撤销上一次提交</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>比较暂存区与上一版本的差异</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br></pre></td></tr></table></figure></li><li><p>指定文件在暂存区和本地仓库的不同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;file-name&gt; --cached</span><br></pre></td></tr></table></figure></li><li><p>列出现在所有的标签</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure></li><li><p>使用特定的搜索模式列出符合条件的标签</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -l &quot;v1.*&quot;</span><br></pre></td></tr></table></figure></li><li><p>创建一个含附注类型的标签，加-a参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a v1.4 -m &quot;my version 1.4&quot;</span><br></pre></td></tr></table></figure></li><li><p>使用git show命令查看相应标签的版本信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show v2.0</span><br></pre></td></tr></table></figure></li><li><p>将标签推送到远程仓库中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push origin</span><br><span class="line">eg: git push origin v2.0</span><br></pre></td></tr></table></figure></li><li><p>将本地所有的标签全部推送到远程仓库中：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure></li><li><p>创建分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>切换分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>创建并切换到分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;new branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>删除分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>将当前分支与指定分支进行合并</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;another branch name&gt;</span><br></pre></td></tr></table></figure></li><li><p>显示本地仓库的所有分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure></li><li><p>显示各个分支最新一次提交对象的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -v</span><br></pre></td></tr></table></figure></li><li><p>查看哪些分支已经合并到了当前分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --merged</span><br></pre></td></tr></table></figure></li><li><p>查看哪些分支还没有合并到当前分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --no-merged</span><br></pre></td></tr></table></figure></li><li><p>把远程分支合并到当前分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;remote-name&gt;/&lt;branch name&gt;</span><br><span class="line">eg:</span><br><span class="line">git merge origin/devel</span><br></pre></td></tr></table></figure></li><li><p>在远程分支的基础上创建新的本地分支(跟踪分支)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b &lt;branch name&gt; &lt;remote-name&gt;/&lt;branch name&gt;</span><br><span class="line">eg:</span><br><span class="line">git checkout -b devel orgin/devel</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>查看本地仓库关联的远程仓库，-v参数会显示远程仓库的url地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br><span class="line">git remote -v</span><br></pre></td></tr></table></figure></li><li><p>添加远程仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git remote add &lt;remote-name&gt; &lt;url&gt;</span><br><span class="line">eg:</span><br><span class="line">git remote add blog https://github.com/blog/blog.git</span><br></pre></td></tr></table></figure></li><li><p>从远程仓库中拉取更新</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch &lt;remote-name&gt;</span><br><span class="line">git fetch origin</span><br></pre></td></tr></table></figure><ul><li>git fetch 只会讲远端数据拉到本地仓库，并不会自动合并到当前工作分支，需要人为合并，如果设置了某个分支关联到远程仓库的某个分支可以使用<code>git pull</code>来拉取远程分支的数据自动合并到当前分支；</li></ul></li><li><p>将本地仓库分支推送到远程仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote name&gt; &lt;branch name&gt;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></li><li><p>将本地分支推送到远程仓库不同名分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote name&gt; &lt;local branch&gt;:&lt;remote branch&gt;</span><br></pre></td></tr></table></figure></li><li><p>删除远程分支(本地内容为空)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote name&gt; :&lt;remote branch&gt;</span><br><span class="line">git push origin</span><br></pre></td></tr></table></figure></li><li><p>查看远程仓库的详细信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote show origin</span><br></pre></td></tr></table></figure></li><li><p>修改远程仓库在本地的简称</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote rename &lt;old name&gt; &lt;new name&gt;</span><br><span class="line">git remote rename origin ori</span><br></pre></td></tr></table></figure></li><li><p>移除远程仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote rm &lt;remote name&gt;</span><br></pre></td></tr></table></figure></li><li><p>git clone 指定分支:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b stable-2.2 https://github.com/ansible/ansible-modules-core.git</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>git 回滚版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard sha</span><br><span class="line">git push origin HEAD --force</span><br></pre></td></tr></table></figure></li><li><p>合并到主分支</p></li></ul><ul><li>git rebase和git merge的区别</li></ul><h1 id="常见报错处理"><a href="#常见报错处理" class="headerlink" title="常见报错处理"></a>常见报错处理</h1><ul><li><p>报错内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fatal: unable to access &apos;https://github.com/xxxx/xxxx.github.io.git/&apos;: SSL certificate problem: self signed certificate in certificate chain</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: fatal: unable to access &apos;https://github.com/xxxx/xxxx.github.io.git/&apos;: SSL certificate problem: self signed certificate in certificate chain</span><br><span class="line"></span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (H:\hexo-Blog\node_modules\hexo-util\lib\spawn.js:37:17)</span><br><span class="line">    at emitTwo (events.js:126:13)</span><br><span class="line">    at ChildProcess.emit (events.js:214:7)</span><br><span class="line">    at ChildProcess.cp.emit (H:\hexo-Blog\node_modules\cross-spawn\lib\enoent.js:40:29)</span><br><span class="line">    at maybeClose (internal/child_process.js:925:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:209:5)</span><br></pre></td></tr></table></figure><ul><li>解决方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify false</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>报错内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cloning into &apos;jplot&apos;...</span><br><span class="line">fatal: unable to access &apos;https://github.com/rs/jplot.git/&apos;: Peer certificate cannot be authenticated with known CA certificates</span><br></pre></td></tr></table></figure><ul><li>解决方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify false</span><br></pre></td></tr></table></figure></li></ul></li><li><p>.gitigore不生效</p></li></ul><blockquote><p>.gitignore只能忽略那些原来没有被track的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。</p></blockquote><ul><li><p>解决方法就是先把本地缓存删除（改变成未track状态）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cached .</span><br><span class="line">git add .</span><br><span class="line">git commit -m &apos;update .gitignore</span><br></pre></td></tr></table></figure></li><li><p>.gitginore规则示例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 注释内容          井号开头为注释内容</span><br><span class="line">*.md                # 忽略所有 .md 结尾的文件</span><br><span class="line">!readme.md             # 但 readme.md 除外</span><br><span class="line">/TODO              # 仅仅忽略项目根目录下的 TODO 文件，不包括 source/TODO</span><br><span class="line">node_modules/      # 忽略 node_modules/ 目录下的所有文件</span><br><span class="line">public/*.html      # 会忽略 public/index.html 但不包括 public/2019/index.html</span><br></pre></td></tr></table></figure></li></ul><h1 id="gitlab-api操作"><a href="#gitlab-api操作" class="headerlink" title="gitlab api操作"></a>gitlab api操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">https://git.sogou-inc.com/api/v4/projects?search=roadrescue1</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ee/api/projects.html#create-project</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ce/api/repository_files.html#update-existing-file-in-repository</span><br><span class="line"></span><br><span class="line">https://docs.gitlab.com/ce/api/tags.html#list-project-repository-tags</span><br></pre></td></tr></table></figure><h1 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h1><ul><li><p><a href="https://pcottle.github.com/learnGitBranching/?demo" target="_blank" rel="noopener">learn git branching</a></p></li><li><p><a href="https://git-scm.com/book/zh/v2" target="_blank" rel="noopener">git-fast-version-control</a></p></li><li><p><a href="http://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener">git - 简易指南</a></p></li><li><p><a href="https://githowto.com/" target="_blank" rel="noopener">githowto</a></p></li><li><p><a href="https://docs.gitlab.com/ce/api/repository_files.html#update-existing-file-in-repository" target="_blank" rel="noopener">update-existing-file-in-repository</a></p></li><li><p><a href="http://linuxwiki.github.io/ProductivityTools/git.html" target="_blank" rel="noopener">分布式管理系统 Git</a></p></li><li><p><a href="http://linuxwiki.github.io/ProductivityTools/svn.html" target="_blank" rel="noopener">版本管理工具: SVN</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Git 是 Linus Torvalds为了帮助管理Linux内核开发而开发的一个开放源码的版本控制软件。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="git" scheme="https://www.lengyuewusheng.com/categories/git/"/>
    
    
      <category term="git" scheme="https://www.lengyuewusheng.com/tags/git/"/>
    
      <category term="版本控制" scheme="https://www.lengyuewusheng.com/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>Linux OOM Killer 保护机制</title>
    <link href="https://www.lengyuewusheng.com/linux-oom-killer-%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6.html"/>
    <id>https://www.lengyuewusheng.com/linux-oom-killer-保护机制.html</id>
    <published>2018-12-25T14:47:57.000Z</published>
    <updated>2019-04-02T09:33:36.167Z</updated>
    
    <content type="html"><![CDATA[<p>OOM killer（Out Of Memory killer）</p><a id="more"></a><blockquote><p>linux下允许程序申请比系统可用内存更多的内存，这个特性叫Overcommit（过度分配）。在系统内存耗尽的情况下，OOM killer机制选择性的干掉一些进程以求释放一些内存。默认具体的记录日志是在/var/log/messages中。</p></blockquote><h1 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h1><ul><li>参数/proc/sys/vm/overcommit_memory可以控制进程对内存过量使用的应对策略</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">overcommit_memory=0，这是缺省值，表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程。</span><br><span class="line">overcommit_memory=1，内核会永远认为有充足的内存可用，进程申请内存时总是允许。</span><br><span class="line">overcommit_memory=2，表示系统所能分配的内存不会超过swap+RAM*系数（/proc/sys/vm/overcommit_ratio，默认50%，可以调整），如果这么多资源已经用光，那么后面任何尝试申请内存的行为都会返回错误，这通常意味着此时没法运行任何新程序。</span><br></pre></td></tr></table></figure><h1 id="内核决策依据"><a href="#内核决策依据" class="headerlink" title="内核决策依据"></a>内核决策依据</h1><ul><li><p>/proc/[pid]/oom_adj，该pid进程被oom killer杀掉的权重，一般介于 [-17,15]（具体具体权重的范围需要查看内核确认）之间，越高的权重，意味着更可能被oom killer选中，-17表示禁止被kill掉。</p></li><li><p>/proc/[pid]/oom_score，当前该pid进程的被kill的分数，越高的分数意味着越可能被kill，这个数值是根据oom_adj运算（2ⁿ，n就是oom_adj的值）后的结果，本身oom_score是不能修改值。</p></li></ul><h1 id="两种进程保护措施"><a href="#两种进程保护措施" class="headerlink" title="两种进程保护措施"></a>两种进程保护措施</h1><ul><li><p>修改权重</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -17 &gt; /proc/[PID]/oom_adj（输入-17，禁止被OOM机制处理）</span><br></pre></td></tr></table></figure></li><li><p>开启OOM较为的保险机制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo “vm.panic_on_oom=2” &gt;&gt; /etc/sysctl.conf</span><br><span class="line">systcl -p</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.linuxba.com/archives/7744" target="_blank" rel="noopener">https://www.linuxba.com/archives/7744</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OOM killer（Out Of Memory killer）&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="OOM" scheme="https://www.lengyuewusheng.com/tags/OOM/"/>
    
      <category term="kernel" scheme="https://www.lengyuewusheng.com/tags/kernel/"/>
    
  </entry>
  
  <entry>
    <title>Linux防火墙之iptables</title>
    <link href="https://www.lengyuewusheng.com/linux%E9%98%B2%E7%81%AB%E5%A2%99%E4%B9%8Biptables.html"/>
    <id>https://www.lengyuewusheng.com/linux防火墙之iptables.html</id>
    <published>2018-12-08T14:32:52.000Z</published>
    <updated>2019-04-01T06:56:30.852Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>iptables是Linux防火墙的管理工具，位于/sbin/iptables。真正实现防火墙功能的是位于内核空间的netfilter，它是Linux内核中实现包过滤的内部结构。</p></blockquote><a id="more"></a><blockquote><p>过滤 IPv4 数据包的代码已经内置于内核中，并且按照不同的目的被组织成<code>表</code>的集合。<br><code>表</code>由一组预先定义的<code>链</code>组成，<code>链</code>包含遍历顺序规则。<br>每一条规则包含一个谓词的潜在匹配和相应的动作(称为目标)，如果谓词为真，该动作会被执行。也就是说条件匹配。<br>iptables 是用户工具，允许用户使用<code>链</code>和<code>规则</code>。</p></blockquote><h1 id="iptables命令简介"><a href="#iptables命令简介" class="headerlink" title="iptables命令简介"></a>iptables命令简介</h1><blockquote><p>iptables [-t 表名: filter/nat/mangle/raw] 命令选项 [链名: PREROUTING/INPUT/OUTPUT/FORWARD/POSTROUTING] [条件匹配] [-j 目标动作或跳转: ACCEPT/DROP/REJECT/LOG/REDIRECT/SNAT/DNAT]</p></blockquote><ul><li>常用的命令选项<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-t：指定要操纵的表(四个表)；</span><br><span class="line">-A：向规则链中添加条目；</span><br><span class="line">-D：从规则链中删除条目；</span><br><span class="line">-i：向规则链中插入条目；</span><br><span class="line">-R：替换规则链中的条目；</span><br><span class="line">-L：显示规则链中已有的条目；</span><br><span class="line">-F：清楚规则链中已有的条目；</span><br><span class="line">-Z：清空规则链中的数据包计算器和字节计数器；</span><br><span class="line">-N：创建新的用户自定义规则链；</span><br><span class="line">-P：定义规则链中的默认目标；</span><br><span class="line">-h：显示帮助信息；</span><br><span class="line">-p：指定要匹配的数据包协议类型；</span><br><span class="line">-s：指定要匹配的数据包源；</span><br><span class="line"></span><br><span class="line">-i -in-interface 进入的网络接口</span><br><span class="line">-o --out-interface 输出的网络接口</span><br><span class="line">-m state 当与连接跟踪结合使用时，允许访问包的连接跟踪状态。</span><br><span class="line">--state state  state是一个逗号分割的匹配连接状态列表。</span><br><span class="line">    INVALID 表示包是未知连接，</span><br><span class="line">    ESTABLISHED 表示是双向传送的连接，</span><br><span class="line">    NEW 表示包 为新的连接，否则是非双向传送的，</span><br><span class="line">    RELATED 表示包由新连接开始，但是和一个已存在的连接在一起，如FTP数据传送，或者一个ICMP错误。</span><br></pre></td></tr></table></figure></li></ul><ul><li>常用的条件匹配：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、状态匹配：-m state --state 连接状态</span><br><span class="line">NEW：与任何连接无关的</span><br><span class="line">ESTABLISHED：响应请求或已建立连接的</span><br><span class="line">RELATED：与已有连接有相关性的，如FTP数据连接</span><br><span class="line"></span><br><span class="line">2、MAC地址匹配：-m mac --mac-source MAC地址</span><br><span class="line">eg：iptables -A INPUT -m mac --mac-source f0:1b:12:12:22:4f -j DROP</span><br><span class="line"></span><br><span class="line">3、IP范围匹配：-m iprange --src-range  IP范围</span><br><span class="line">eg：iptables -A FORWARD -p tcp -m iprange --src-range 192.168.0.1-192.168.0.10 -j ACCEPT</span><br><span class="line"></span><br><span class="line">4、多端口匹配：-m multiport --sports 源端口列表  和  -m multiport --sports 目的端口列表</span><br><span class="line">eg：iptables -A INPUT -p tcp -m multiport --dport 11,29,116,121 -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h1 id="iptables基础操作"><a href="#iptables基础操作" class="headerlink" title="iptables基础操作"></a>iptables基础操作</h1><blockquote><p>以下内容基于centos6系统环境。</p></blockquote><ul><li><p>服务安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install iptables</span><br></pre></td></tr></table></figure></li><li><p>保存iptables到文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables-save &gt; ~/iptables.rules</span><br><span class="line">或</span><br><span class="line">/etc/rc.d/init.d/iptables save 默认将规则写入/etc/sysconfig/iptables</span><br><span class="line">重启service iptables restart生效</span><br></pre></td></tr></table></figure></li><li><p>从文件中还原iptables规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-restore &lt; ~/iptables.rules</span><br></pre></td></tr></table></figure></li><li><p>监控iptables</p><ul><li><p>查看规则命中的次数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L -v -n --line-numbers</span><br></pre></td></tr></table></figure></li><li><p>删除不必要的规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL | grep -v &quot;0     0&quot;</span><br></pre></td></tr></table></figure></li><li><p>监控iptables活动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch --interval=5 &apos;iptables -nvL | grep -v &quot;0     0&quot;&apos;</span><br></pre></td></tr></table></figure></li><li><p>使用FWLogwatch分析iptables日志生成报告</p></li></ul></li></ul><ul><li><p>清空所有默认规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></li><li><p>清空所有自定义规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -X</span><br></pre></td></tr></table></figure></li><li><p>所有计数器归0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -Z</span><br></pre></td></tr></table></figure></li></ul><h1 id="iptables应用实例"><a href="#iptables应用实例" class="headerlink" title="iptables应用实例"></a>iptables应用实例</h1><h2 id="基本规则"><a href="#基本规则" class="headerlink" title="基本规则"></a>基本规则</h2><ul><li><p>预设规则（默认为ACCEPT）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line">iptables -P FORWARD DROP</span><br></pre></td></tr></table></figure></li><li><p>查看当前规则：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -nvL --line-number</span><br></pre></td></tr></table></figure></li><li><p>追加规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 10.1.1.1 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>插入规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT 3 -s 10.1.1.2 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>删除规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -D INPUT -s 10.1.1.1 -j DROP</span><br><span class="line">按行号删</span><br><span class="line">iptables -D INPUT 1</span><br></pre></td></tr></table></figure></li><li><p>修改规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">将第2条规则改为ACCEPT</span><br><span class="line">iptables -R INPUT 3 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>清空规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br></pre></td></tr></table></figure></li></ul><h2 id="规则案例"><a href="#规则案例" class="headerlink" title="规则案例"></a>规则案例</h2><h3 id="ACCEPT"><a href="#ACCEPT" class="headerlink" title="ACCEPT"></a>ACCEPT</h3><ul><li><p>放行ping</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p icmp -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许lookback</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i lo -p all -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -p all -j ACCEPT</span><br><span class="line">或</span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o lo -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>放行80端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT      //如果设置了iptables -P OUTPUT DROP，需要添加该条，否则远程无法连接</span><br></pre></td></tr></table></figure></li><li><p>允许防火墙转发除ICMP协议以外的所有数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -p ! icmp -j ACCEPT</span><br><span class="line">`</span><br></pre></td></tr></table></figure><ul><li>注：”!” 条件取反</li></ul></li><li><p>允许某个特定网络 rsync 进入本机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.1.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>仅允许来自指定网络的ssh连接请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i eth0 -p tcp -s 192.168.1.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>仅允许从本地发起到指定网络的SSH连接请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -o eth0 -p tcp -d 192.168.1.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许转发来自192.168.1.0/24局域网段的DNS解析请求数据包。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.1.0/24 -p udp --dport 53 -j ACCEPT</span><br><span class="line">iptables -A FORWARD -d 192.168.1.0/24 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许本机开放从TCP端口1000-1024提供的应用服务。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 1000:1024 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 1000:1024 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>使用Multiport放行多个端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT  -p tcp -m multiport --dports 22,80,443 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --sports 22,80,443 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许防火墙本机对外开放TCP端口20、21、25、110以及被动模式FTP端口1250-1280</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m multiport --dport 20,21,25,110,1250:1280 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>注意：这里用“-m multiport –dport”来指定多个目的端口</li></ul></li><li><p>针对端口访问的过滤。下面表示除了192.168.1.1-192.168.1.10之间的ip能访问192.168.0.1机器的80端口以外，其他ip都不可以访问！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -d 192.168.0.1 -p tcp --dport 80 -m iprange --src-range 192.168.1.1-192.168.1.10 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>只允许管理员从192.168.1.0/24网段使用SSH远程登录防火墙主机。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -s 202.13.0.0/16 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>允许192.168.1.0网段的服务器访问（-t filter表配置可以省略，默认就是这种表的配置）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s 192.168.1.0/24 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line">或者</span><br><span class="line">iptables -t filter -A INPUT -s 192.168.1.0/24 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>如果本地主机有两块网卡，一块连接内网(eth0)，一块连接外网(eth1)，那么可以使用下面的规则将eth0的数据路由到eht1：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>允许所有本机向外的访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h3 id="DROP"><a href="#DROP" class="headerlink" title="DROP"></a>DROP</h3><ul><li><p>屏蔽环回(loopback)访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i lo -j DROP</span><br><span class="line">iptables -A OUTPUT -o lo -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽 ping</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp -i eth0 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽来自外部的ping，即禁止外部机器ping本机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -A OUTPUT -p icmp --icmp-type echo-reply -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽从本机ping外部主机，禁止本机ping外部机器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -A INPUT -p icmp --icmp-type echo-reply -j DROP</span><br></pre></td></tr></table></figure><ul><li>–icmp-type 8 同样表示 Echo request（Ping回显请求）</li></ul></li><li><p>允许本机 ping 别的主机；但不开放别的主机 ping 本机；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -p icmp --icmp-type echo-request -j DROP</span><br><span class="line">iptables -I INPUT -p icmp --icmp-type echo-reply -j ACCEPT</span><br><span class="line">iptables -I INPUT -p icmp --icmp-type destination-Unreachable -j ACCEPT</span><br><span class="line">或者下面禁ping操作：</span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure></li><li><p>屏蔽指定mac地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m mac --mac-source 00:00:00:00:00:00 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>屏蔽某个IP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s xxx.xxx.xxx.xxx -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝转发来自192.168.0.1主机的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.0.1 -j REJECT</span><br></pre></td></tr></table></figure></li><li><p>屏蔽从192.168.0.1到192.168.0.254</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I INPUT -s 192.168.0.0/24 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>过滤源地址段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m iprange --src-range 192.168.1.1-192.168.1.10 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>过滤目标地址段：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m iprange --dst-range 192.168.1.11-192.168.1.20 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>丢弃无效的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m conntrack --ctstate INVALID -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝转发来自192.168.1.1主机的数据，允许转发来自192.168.0.0/24网段的数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -s 192.168.1.1 -j REJECT</span><br><span class="line">iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>说明：注意一定要把拒绝的放在前面不然就不起作用了！</li></ul></li><li><p>丢弃从外网接口（eth1）进入防火墙本机的源地址为私网地址的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP</span><br><span class="line">iptables -A INPUT -i eth1 -s 172.16.0.0/12 -j DROP</span><br><span class="line">iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>拒绝 TCP 标志位全部为 1 及全部为 0 的报文访问本机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP</span><br></pre></td></tr></table></figure></li><li><p>禁止转发来自MAC地址为<code>aa:aa:aa:45:75:d0</code>的和主机的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -m mac --mac-source aa:aa:aa:45:75:d0 -j DROP</span><br></pre></td></tr></table></figure><ul><li>iptables中使用“-m 模块关键字”的形式调用显示匹配。咱们这里用“-m mac –mac-source”来表示数据包的源MAC地址</li></ul></li><li><p>禁止转发源IP地址为192.168.1.1-192.168.1.100的TCP数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -p tcp -m iprange --src-range 192.168.1.1-192.168.1.100 -j DROP</span><br></pre></td></tr></table></figure><ul><li>此处用“-m iprange –src-range”指定IP范围</li></ul></li><li><p>禁止转发与正常TCP连接无关的非–syn请求数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -m state --state NEW -p tcp ! --syn -j DROP</span><br></pre></td></tr></table></figure><ul><li>“-m state”表示数据包的连接状态，“NEW”表示与任何连接无关的</li></ul></li><li><p>拒绝访问防火墙的新数据包，但允许响应连接或与已有连接相关的数据包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp -m state --state NEW -j DROP</span><br><span class="line">iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>“ESTABLISHED”表示已经响应请求或者已经建立连接的数据包，“RELATED”表示与已建立的连接有相关性的，比如FTP数据连接等</li></ul></li><li><p>为某个端口访问设置白名单</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -s &lt;YOUR_IP&gt; -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -D INPUT -p tcp -m tcp --dport 22 -j DROP</span><br><span class="line">eg:</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -s 113.128.0.0/16 -j ACCEPT;</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -s 120.0.0.0/8 -j ACCEPT;</span><br><span class="line">iptables -A INPUT -p tcp --dport 21 -j DROP</span><br></pre></td></tr></table></figure></li></ul><h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><ul><li><p>防止DoS攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT</span><br></pre></td></tr></table></figure><ul><li>-m limit: 启用limit扩展，限制速度。</li><li>–limit 25/minute: 允许最多每分钟25个连接</li><li>–limit-burst 100: 当达到100个连接后，才启用上述25/minute限制（连接上限）</li></ul></li><li><p>限制并发连接数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --syn --dport 22 -m connlimit --connlimit-above 3 -j REJECT  //限制每客户端不超过 3 个连接</span><br><span class="line">iptables -A INPUT -p tcp --syn -m multiport --dport http,https –m connlimit --connlimit-above 20 -j REJECT --reject-with-tcp-reset</span><br></pre></td></tr></table></figure></li><li><p>开放本机的ssh服务给192.168.1.1-192.168.1.100 中的主机；新请求建立的速率一分钟不得超过5个；仅允许响应报文通过其服务端口离开本机；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -m iprange --src-rang 192.168.1.1-192.168.1.100 -m limit --limit 5/m -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -m iprange --dst-rang 192.168.1.1-192.168.1.100 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h3 id="PREROUTING"><a href="#PREROUTING" class="headerlink" title="PREROUTING"></a>PREROUTING</h3><p>IPtables中可以灵活的做各种网络地址转换（NAT）。</p><ul><li><p>网络地址转换主要有两种：SNAT和DNAT</p><ul><li>SNAT是source network address translation的缩写，即源地址目标转换。<ul><li>MASQUERADE，地址伪装，在iptables中有着和SNAT相近的效果，但也有一些区别：使用SNAT的时候，出口ip的地址范围可以是一个，也可以是多个。</li></ul></li><li>DNAT是destination network address translation的缩写，即目标网络地址转换。</li></ul></li><li><p>把所有10.0.0.0网段的数据包SNAT成192.168.1.1的ip然后发出去</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j SNAT --to-source 192.168.1.1</span><br></pre></td></tr></table></figure></li><li><p>把所有10.0.0.0网段的数据包SNAT成192.168.1.1/192.168.1.2/192.168.1.3等几个ip然后发出去</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j SNAT --to-source 192.168.1.1-192.168.1.3</span><br></pre></td></tr></table></figure><ul><li>对于SNAT，不管是几个地址，必须明确的指定要SNAT的IP</li></ul></li><li><p>动态SNAT地址转换,不管现在eth0的出口获得了怎样的动态ip，MASQUERADE会自动读取eth0现在的ip地址然后做SNAT出去</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.0.0.0/255.255.255.0 -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure><ul><li>MASQUERADE的作用是，从服务器的网卡上，自动获取当前ip地址来做NAT</li></ul></li><li><p>8022映射22端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp -d 192.168.1.1 --dport 8022 -j DNAT --to-destination 192.168.1.1:22</span><br></pre></td></tr></table></figure></li><li><p>将所有到达eth0网卡80端口的流量重定向转发到8080端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 89 -j REDIRECT --to-port 8080</span><br></pre></td></tr></table></figure></li><li><p>设置 8080 端口转发到 80 端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp -d 10.1.1.1 --dport 8080 -j DNAT --to 10.1.1.1:80</span><br><span class="line">iptables -A INPUT -i eth0 -p tcp --dport 8080 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -o eth0 -p tcp --sport 8080 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li></ul><h2 id="实践场景"><a href="#实践场景" class="headerlink" title="实践场景"></a>实践场景</h2><ul><li><p>按时段限制(需要模块支持)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables –A OUTPUT -p tcp -m multiport --dport http,https -i eth0 -o eth1 -m time --timestart 12:00 –timestop 13:00 –d 10.0.0.0/8 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp -m time --timestart 02:00 --timestop 03:00 -j DROP</span><br><span class="line">iptables -A INPUT -p udp -m time --timestart 02:00 --timestop 03:00 -j DROP</span><br></pre></td></tr></table></figure></li><li><p>限制本机的web服务器在周一不允许访问；新请求的速率不能超过100个每秒；web服务器包含了admin字符串的页面不允许访问：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># web服务器仅允许响应报文离开本机；周一不允许访问</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m time ! --weekdays Mon -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"># 新请求速率不能超过100个每秒</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m limit --limit 100/s -j ACCEPT</span><br><span class="line"></span><br><span class="line"># web包含admin字符串的页面不允许访问，源端口：dport</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m string --algo bm --string &apos;admin&apos; -j REJECT</span><br><span class="line"></span><br><span class="line"># web服务器仅允许响应报文离开主机,放行端口（目标端口）：sport</span><br><span class="line">iptables -A OUTPUT -p tcp --dport 80 -m state --state ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure></li><li><p>在工作时间，即周一到周五的8:30-18:00，开放本机的ftp服务给 192.168.1.0网络中的主机访问；数据下载请求的次数每分钟不得超过5个；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 21 -s 192.168.1.0/24 -m time ! --weekdays 6,7 -m time --timestart 8:30 --timestop 18:00 -m connlimit --connlimit-above 5 -j ACCET</span><br></pre></td></tr></table></figure></li><li><p>屏蔽ssh和rsync端口，只允许白名单机器访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt; EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">iptables -A INPUT -s 10.0.0.1 -p tcp --dport 22 -j ACCEPT                                       # 中控白名单</span><br><span class="line">iptables -A OUTPUT -d 10.0.0.1 -p tcp --sport 22 -j ACCEPT</span><br><span class="line">iptables -A INPUT -s 10.0.0.2 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT      # 监控探针通过22端口连通性监控机器存活，开白名单。</span><br><span class="line">iptables -A INPUT  -p tcp -m multiport --dports 22,873 -j DROP</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --dports 22,873 -j DROP</span><br><span class="line">iptables -L -v -n --line-numbers</span><br><span class="line">EOF | bash</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://netfilter.org/projects/iptables/index.html" target="_blank" rel="noopener">iptables官方网站</a></li><li><a href="https://wiki.centos.org/zh/HowTos/Network/IPTables" target="_blank" rel="noopener">IPTables</a></li><li>整理过程中参考部分微信公众号文章</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;iptables是Linux防火墙的管理工具，位于/sbin/iptables。真正实现防火墙功能的是位于内核空间的netfilter，它是Linux内核中实现包过滤的内部结构。&lt;/p&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iptables" scheme="https://www.lengyuewusheng.com/categories/iptables/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="iptables" scheme="https://www.lengyuewusheng.com/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>rsync经典用例总结</title>
    <link href="https://www.lengyuewusheng.com/rsync%E7%BB%8F%E5%85%B8%E7%94%A8%E4%BE%8B%E6%80%BB%E7%BB%93.html"/>
    <id>https://www.lengyuewusheng.com/rsync经典用例总结.html</id>
    <published>2018-12-04T04:40:34.000Z</published>
    <updated>2019-08-27T04:46:01.311Z</updated>
    
    <content type="html"><![CDATA[<p>rsync是经典的数据传输工具，但本篇博客总结的既不细致，也不全面。惭愧，惭愧。。。</p><a id="more"></a><h1 id="更新策略"><a href="#更新策略" class="headerlink" title="更新策略"></a>更新策略</h1><ul><li><p>rsync默认通过比较文件修改时间(Modify)和大小进行启发式更新</p></li><li><p>策略验证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">mkdir /tmp/&#123;a,b&#125;</span><br><span class="line"># 文件内容不同，大小相同</span><br><span class="line">echo a &gt;/tmp/a/index.html</span><br><span class="line">sleep 1</span><br><span class="line">echo b &gt;/tmp/b/index.html</span><br><span class="line"># touch -d &quot;2019-08-27 11:35:00&quot; /tmp/&#123;a,b&#125;/*</span><br><span class="line"># 访问时间不同</span><br><span class="line">touch -ad &quot;2019-08-27 11:35:00&quot; /tmp/a/index.html</span><br><span class="line">touch -ad &quot;2019-08-27 11:36:00&quot; /tmp/b/index.html</span><br><span class="line"># Modify时间相同，change时间不同</span><br><span class="line">touch -md &quot;2019-08-27 11:35:00&quot; /tmp/a/index.html</span><br><span class="line">sleep 1</span><br><span class="line">touch -md &quot;2019-08-27 11:35:00&quot; /tmp/b/index.html</span><br><span class="line">stat /tmp/&#123;a,b&#125;/*</span><br><span class="line"># rsync没有覆盖</span><br><span class="line">rsync -avzP /tmp/a/index.html /tmp/b/index.html</span><br></pre></td></tr></table></figure></li><li><p>干预策略的参数：</p><ul><li>–size-only: 仅比较文件大小</li><li>–ignore-times或-I：无脑覆盖</li><li>–checksum或-c: 忽略时间，检查大小，大小相同时比较MD5</li><li>–whole-file或-w：禁用rsync delta算法，源和目的文件不同时，传输整个文件</li></ul></li></ul><h1 id="备份更新"><a href="#备份更新" class="headerlink" title="备份更新"></a>备份更新</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avzP -b --suffix=$(date &quot;+.bak%Y%m%d%H%M%S&quot;) --backup-dir=/data/backup/  $&#123;src&#125;  $&#123;dst&#125;</span><br></pre></td></tr></table></figure><ul><li>备份目录下如果存在同名文件会被新的备份文件强制覆盖</li><li>-b –suffix 既适用推送也适用于拉取，但是都是在dest侧备份</li><li>-b –backup-dir 仅适用于拉取，推送数据时适用会报错</li><li>另外mv命令也有备份实现方案<code>alias mv=&#39;mv -v -b -S &quot;$(date &quot;+.mvbak%Y%m%d_%H%M&quot;)&quot;&#39;</code></li></ul><h1 id="递归创建目录"><a href="#递归创建目录" class="headerlink" title="递归创建目录"></a>递归创建目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avzP -R src dest</span><br></pre></td></tr></table></figure><ul><li>-R 参数会在dest目录基础上递归创建src目录路径，如<code>rsync -avzP -R 10.0.0.1::data/data/test1/test2/test3 /data/test</code>,在本地会生成路径<code>/data/test/data/test1/test2/test3</code></li></ul><h1 id="慎用–delete"><a href="#慎用–delete" class="headerlink" title="慎用–delete"></a>慎用–delete</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test /data/test        //该种写法会在/data/test下再创建一层test目录，不会删除/data/test的其它目录</span><br><span class="line">和</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/ /data/test       //该种写法会将本地/data/test目录下的文件与src目录强一致</span><br><span class="line">的效果是截然不同的，自己体会下。细思极恐。。。</span><br><span class="line"></span><br><span class="line">另外，</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/ /data/test</span><br><span class="line">和</span><br><span class="line">rsync -avzP --delete 10.0.0.1::data/data/test/* /data/test      //该种写法会将src目录下的子文件和目录和本地/data/test中的同名子文件和目录进行强一致，本地/data/test中的其它文件目录不会被删除</span><br><span class="line">的效果也不同，使用时要十分谨慎。</span><br></pre></td></tr></table></figure><h1 id="rsync认证"><a href="#rsync认证" class="headerlink" title="rsync认证"></a>rsync认证</h1><ul><li><p>RSYNC_PASSWORD仅适用于rsync协议，rsync配置中指定的用户密码，rsync服务需要通过daemon方式启动；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export RSYNC_PASSWORD=&quot;passwd&quot;</span><br></pre></td></tr></table></figure></li><li><p>rsync协议使用的两种方式</p><ul><li><p>rsync 协议</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rsync rsync://username@1.2.3.4:/abc /def</span><br><span class="line">rsync 1.2.3.4::abc/ /def</span><br></pre></td></tr></table></figure></li><li><p>ssh 协议</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync 1.2.3.4:/abc/ /def</span><br></pre></td></tr></table></figure><ul><li>仅适用rsync客户端，通过ssh协议传输</li></ul></li></ul></li></ul><h1 id="rsync-日志"><a href="#rsync-日志" class="headerlink" title="rsync 日志"></a>rsync 日志</h1><ul><li><p>transfer logging</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transfer logging = yes</span><br></pre></td></tr></table></figure><ul><li>配置文件中开启transfer logging，可以使rsync使用ftp格式的文件来记录下载和上载操作在单独的日志文件中</li></ul></li><li><p>log format 格式定义符</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%h 远程主机名</span><br><span class="line">%a 远程IP地址</span><br><span class="line">%l 文件长度字符数</span><br><span class="line">%p 该次rsync会话的进程id</span><br><span class="line">%o 操作类型：&quot;send&quot;或&quot;recv&quot;</span><br><span class="line">%f 文件名</span><br><span class="line">%P 模块路径</span><br><span class="line">%m 模块名</span><br><span class="line">%t 当前时间</span><br><span class="line">%u 认证的用户名(匿名时是null)</span><br><span class="line">%b 实际传输的字节数</span><br><span class="line">%c 当发送文件时，该字段记录该文件的校验码</span><br><span class="line">默认log格式为：&quot;%o %h [%a] %m (%u) %f %l&quot;,通常,在每行的头上会添加&quot;%t [%p] &quot;。</span><br></pre></td></tr></table></figure><h1 id="配置文件范例"><a href="#配置文件范例" class="headerlink" title="配置文件范例"></a>配置文件范例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/rsyncd.conf</span><br><span class="line">address = 10.0.0.1</span><br><span class="line">uid = root</span><br><span class="line">gid = root</span><br><span class="line">use chroot = yes</span><br><span class="line">numeric ids = no</span><br><span class="line">read only = no</span><br><span class="line">max connections = 100</span><br><span class="line">pid file = /var/run/rsyncd.pid</span><br><span class="line">log file = /var/log/rsync.log</span><br><span class="line">lock file = /var/run/rsync.lock</span><br><span class="line"></span><br><span class="line">transfer logging = yes</span><br><span class="line"></span><br><span class="line">[data1]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    path = /data</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br><span class="line"></span><br><span class="line">[data2]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    path = /</span><br><span class="line">    exclude = *</span><br><span class="line">    include = data1/***</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br><span class="line"></span><br><span class="line">[data]</span><br><span class="line">    uid = nobody</span><br><span class="line">    gid = nobody</span><br><span class="line">    comment = data</span><br><span class="line">    path = /</span><br><span class="line">    exclude = *</span><br><span class="line">    include = data1/***</span><br><span class="line">    read only = false</span><br><span class="line">    list = false</span><br><span class="line">    hosts allow = 10.0.0.0/8 192.168.0.0/16</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><p><a href="http://linuxwiki.github.io/Services/rsync.html" target="_blank" rel="noopener">http://linuxwiki.github.io/Services/rsync.html</a></p></li><li><p><a href="https://www.cnblogs.com/shihuc/p/5628893.html" target="_blank" rel="noopener">https://www.cnblogs.com/shihuc/p/5628893.html</a></p></li><li><p><a href="https://unix.stackexchange.com/questions/111526/how-can-i-rsync-without-prompt-for-password-without-using-public-key-authentica" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/111526/how-can-i-rsync-without-prompt-for-password-without-using-public-key-authentica</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;rsync是经典的数据传输工具，但本篇博客总结的既不细致，也不全面。惭愧，惭愧。。。&lt;/p&gt;
    
    </summary>
    
      <category term="rsync" scheme="https://www.lengyuewusheng.com/categories/rsync/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="rsync" scheme="https://www.lengyuewusheng.com/tags/rsync/"/>
    
  </entry>
  
</feed>
