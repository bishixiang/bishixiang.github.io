<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>冷月无声</title>
  
  <subtitle>相信积累的力量！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.lengyuewusheng.com/"/>
  <updated>2018-11-08T11:29:56.650Z</updated>
  <id>https://www.lengyuewusheng.com/</id>
  
  <author>
    <name>冷月无声</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux环境中alias不生效问题</title>
    <link href="https://www.lengyuewusheng.com/2018/11/06/00052_Linux%E7%8E%AF%E5%A2%83%E4%B8%ADalias%E4%B8%8D%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98/"/>
    <id>https://www.lengyuewusheng.com/2018/11/06/00052_Linux环境中alias不生效问题/</id>
    <published>2018-11-06T14:56:10.000Z</published>
    <updated>2018-11-08T11:29:56.650Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>很多时候，实际结果往往和我们的预期不一致，其中必有蹊跷。。。</p></blockquote><a id="more"></a><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>由于公司hadoop集群迁移，需要对线上几百台历史遗留的脚本进行改造，变更hadoop客户端环境。</p><p>思虑再三，借鉴python装饰器的思想，部署一个绿色版的hadoop客户端环境。再将线上各式各样的脚本统一加一行<code>alias hadoop=&quot;/path/to/hadoop&quot;</code>成本最低。</p><p>无奈alias貌似并没有生效，实际操作结果和预期不一致。。。</p><h1 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h1><p>alias 在非交互shell环境中不生效，除非手动设置<code>shopt -s expand_aliases</code></p><h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><ul><li><p><code>cat aliasVerifi.sh</code></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#/bin/bash</span><br><span class="line">shopt |grep -i alias</span><br><span class="line">whoami</span><br><span class="line">which whoami</span><br><span class="line">echo &quot;================&quot;</span><br><span class="line">shopt -s expand_aliases</span><br><span class="line">shopt |grep -i alias</span><br><span class="line">alias whoami=&apos;date &quot;+%Y-%m-%d %H:%M:%S&quot;&apos;</span><br><span class="line">whoami</span><br><span class="line">which whoami</span><br></pre></td></tr></table></figure></li><li><p>通过cron调用脚本并将输出写入log文件aliasVerifi.log</p></li><li><p><code>cat aliasVerifi.log</code></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">expand_aliases off</span><br><span class="line">root</span><br><span class="line">/usr/bin/whoami</span><br><span class="line">================</span><br><span class="line">expand_aliases on</span><br><span class="line">2018-11-06 22:20:01</span><br><span class="line">/usr/bin/whoami</span><br></pre></td></tr></table></figure><ul><li>此处我们注意到expand_aliases在非交互shell中默认关闭，并且用which获取该命令的绝对路径并没有发生改变，但是执行结果已经符合预期。</li></ul></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://ss64.com/bash/alias.html" target="_blank" rel="noopener">alias</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/11/00015_存储空间计算/">存储空间计算</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/12/00016_Linux共享内存机制/">Linux系统中的tmpfs、/dev/shm、tmp以及共享内存机制</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/22/00021_Linux系统中的IO模型/">Linux系统中的IO模式</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/03/00026_tmux窗口管理/">tmux窗口管理</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/14/00029_Linux访问Windows共享/">Linux挂载Windows共享目录</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;很多时候，实际结果往往和我们的预期不一致，其中必有蹊跷。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="alias" scheme="https://www.lengyuewusheng.com/tags/alias/"/>
    
      <category term="cron" scheme="https://www.lengyuewusheng.com/tags/cron/"/>
    
  </entry>
  
  <entry>
    <title>nginx代理redmine with thin</title>
    <link href="https://www.lengyuewusheng.com/2018/09/10/00051_redmine-with-thin/"/>
    <id>https://www.lengyuewusheng.com/2018/09/10/00051_redmine-with-thin/</id>
    <published>2018-09-10T15:37:47.000Z</published>
    <updated>2018-09-16T10:55:30.778Z</updated>
    
    <content type="html"><![CDATA[<p>Redmine是基于Ruby开发的经典项目管理平台，功能强大。</p><p>thin, A fast and very simple Ruby web server。</p><a id="more"></a><p>本文档非操作手册只列出来关键信息，需要对ruby，redmine，nginx稍有些许了解。。。</p><h1 id="thin-安装"><a href="#thin-安装" class="headerlink" title="thin 安装"></a>thin 安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rake redmine:plugins:migrate RAILS_ENV=production</span><br><span class="line">bundle exec rake redmine:plugins:migrate RAILS_ENV=production --trace</span><br><span class="line"></span><br><span class="line">gem install thin</span><br><span class="line">thin install</span><br></pre></td></tr></table></figure><h1 id="创建logrotate配置-etc-logrotate-d-thin"><a href="#创建logrotate配置-etc-logrotate-d-thin" class="headerlink" title="创建logrotate配置/etc/logrotate.d/thin"></a>创建logrotate配置/etc/logrotate.d/thin</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/var/log/thin/*.log &#123;</span><br><span class="line">daily</span><br><span class="line">missingok</span><br><span class="line">rotate 52</span><br><span class="line">compress</span><br><span class="line">delaycompress</span><br><span class="line">notifempty</span><br><span class="line">create 640 root adm</span><br><span class="line">sharedscripts</span><br><span class="line">postrotate</span><br><span class="line">/etc/init.d/thin restart &gt;/dev/null</span><br><span class="line">endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="创建thin配置文件-etc-thin-redmine-yml"><a href="#创建thin配置文件-etc-thin-redmine-yml" class="headerlink" title="创建thin配置文件/etc/thin/redmine.yml"></a>创建thin配置文件/etc/thin/redmine.yml</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pid: /var/run/thin/thin.pid</span><br><span class="line">group: nginx</span><br><span class="line">wait: 30</span><br><span class="line">timeout: 30</span><br><span class="line">log: /var/log/thin/thin.log</span><br><span class="line">max_conns: 1024</span><br><span class="line"></span><br><span class="line">require: []</span><br><span class="line">environment: production</span><br><span class="line">max_persistent_conns: 512</span><br><span class="line">servers: 4</span><br><span class="line">daemonize: true</span><br><span class="line">user: nginx</span><br><span class="line">socket: /tmp/thin.sock</span><br><span class="line">chdir: /data/DevOps/redmine</span><br></pre></td></tr></table></figure><h1 id="创建thin启动文件-etc-init-d-thin"><a href="#创建thin启动文件-etc-init-d-thin" class="headerlink" title="创建thin启动文件/etc/init.d/thin"></a>创建thin启动文件/etc/init.d/thin</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">### BEGIN INIT INFO</span><br><span class="line"># Provides:          thin</span><br><span class="line"># Required-Start:    $local_fs $remote_fs</span><br><span class="line"># Required-Stop:     $local_fs $remote_fs</span><br><span class="line"># Default-Start:     2 3 4 5</span><br><span class="line"># Default-Stop:      S 0 1 6</span><br><span class="line"># Short-Description: thin initscript</span><br><span class="line"># Description:       thin</span><br><span class="line">### END INIT INFO</span><br><span class="line"></span><br><span class="line"># Original author: Forrest Robertson</span><br><span class="line"></span><br><span class="line"># Do NOT &quot;set -e&quot;</span><br><span class="line"></span><br><span class="line">DAEMON=/usr/local/rvm/gems/ruby-2.3.0/bin/thin</span><br><span class="line">SCRIPT_NAME=/etc/init.d/thin</span><br><span class="line">CONFIG_PATH=/etc/thin</span><br><span class="line"></span><br><span class="line"># Exit if the package is not installed</span><br><span class="line">[ -x &quot;$DAEMON&quot; ] || exit 0</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  start)</span><br><span class="line">$DAEMON start --all $CONFIG_PATH</span><br><span class="line">;;</span><br><span class="line">  stop)</span><br><span class="line">$DAEMON stop --all $CONFIG_PATH</span><br><span class="line">;;</span><br><span class="line">  restart)</span><br><span class="line">$DAEMON restart --all $CONFIG_PATH</span><br><span class="line">;;</span><br><span class="line">  *)</span><br><span class="line">echo &quot;Usage: $SCRIPT_NAME &#123;start|stop|restart&#125;&quot; &gt;&amp;2</span><br><span class="line">exit 3</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">:</span><br></pre></td></tr></table></figure><h1 id="nginx配置文件-etc-nginx-conf-d-redmine-conf"><a href="#nginx配置文件-etc-nginx-conf-d-redmine-conf" class="headerlink" title="nginx配置文件 /etc/nginx/conf.d/redmine.conf"></a>nginx配置文件 /etc/nginx/conf.d/redmine.conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">upstream thin_cluster &#123;</span><br><span class="line">server unix:/tmp/thin.0.sock;</span><br><span class="line">server unix:/tmp/thin.1.sock;</span><br><span class="line">server unix:/tmp/thin.2.sock;</span><br><span class="line">server unix:/tmp/thin.3.sock;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  redmine.server;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line">    access_log  /var/log/nginx/log/redmine.access.log  main;</span><br><span class="line"></span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    client_max_body_size 10m;</span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line">    proxy_connect_timeout 90;</span><br><span class="line">    proxy_send_timeout 90;</span><br><span class="line">    proxy_read_timeout 90;</span><br><span class="line">    proxy_buffer_size 4k;</span><br><span class="line">    proxy_buffers 4 32k;</span><br><span class="line">    proxy_busy_buffers_size 64k;</span><br><span class="line">    proxy_temp_file_write_size 64k;</span><br><span class="line">    #your redmine path</span><br><span class="line">    root /data/DevOps/redmine/public;</span><br><span class="line">    proxy_redirect off;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">try_files $uri/index.html $uri.html $uri @cluster;</span><br><span class="line">    &#125;</span><br><span class="line">    location @cluster &#123;</span><br><span class="line">proxy_pass http://thin_cluster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line">    #</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    proxy_pass   http://127.0.0.1;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">    #</span><br><span class="line">    #location ~ \.php$ &#123;</span><br><span class="line">    #    root           html;</span><br><span class="line">    #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    #    fastcgi_index  index.php;</span><br><span class="line">    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">    #    include        fastcgi_params;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    # deny access to .htaccess files, if Apache&apos;s document root</span><br><span class="line">    # concurs with nginx&apos;s one</span><br><span class="line">    #</span><br><span class="line">    #location ~ /\.ht &#123;</span><br><span class="line">    #    deny  all;</span><br><span class="line">    #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://code.macournoyer.com/thin/" target="_blank" rel="noopener">thin 官网</a></p></li><li><p><a href="http://www.redmine.org/boards/2/topics/37072" target="_blank" rel="noopener">Help with Ruby 2.0 + Redmine 2.30 + thin install</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Redmine是基于Ruby开发的经典项目管理平台，功能强大。&lt;/p&gt;
&lt;p&gt;thin, A fast and very simple Ruby web server。&lt;/p&gt;
    
    </summary>
    
      <category term="开源工具" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="redmine" scheme="https://www.lengyuewusheng.com/tags/redmine/"/>
    
      <category term="thin" scheme="https://www.lengyuewusheng.com/tags/thin/"/>
    
      <category term="项目管理" scheme="https://www.lengyuewusheng.com/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>sed 常见用例总结</title>
    <link href="https://www.lengyuewusheng.com/2018/09/08/00050_sed%E5%B8%B8%E8%A7%81%E7%94%A8%E4%BE%8B%E6%80%BB%E7%BB%93/"/>
    <id>https://www.lengyuewusheng.com/2018/09/08/00050_sed常见用例总结/</id>
    <published>2018-09-08T13:21:09.000Z</published>
    <updated>2019-02-21T12:44:00.931Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>sed 发行于1974年，作者 Lee E. McMahon。awk发行于1977年，作者 阿尔佛雷德·艾侯、彼得·温伯格以及布莱恩·柯林汉。</p><p>——源自维基百科</p></blockquote><a id="more"></a><h1 id="常见用例"><a href="#常见用例" class="headerlink" title="常见用例"></a>常见用例</h1><ul><li><p>文件最后追加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &apos;$ a\00 08 * * * /sbin/clock -w &gt;/dev/null 2&gt;&amp;1&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>输出满足正则的记录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &apos;/正则表达式/p&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>删除满足正则的记录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;/正则表达式/d&apos; /var/spool/cron/root</span><br></pre></td></tr></table></figure></li><li><p>sed删除多行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i &apos;/START/,/END/d&apos; /etc/rsyncd.conf</span><br><span class="line">eg:</span><br><span class="line">sed -i &apos;/\[root\]\s*/,/\s*hosts\s*allow\s*=\s*10.0.0.0\/8\s*192.168.0.0\/16\s*/d&apos; rsyncd.conf</span><br></pre></td></tr></table></figure></li><li><p>将所有数字版本号统一</p><ul><li>sed正则中{}()需要加转义，[]则不用</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /data/daemon/conf/ -name &quot;*.yaml&quot; -type f |xargs grep -irl &quot;version:v&quot; |xargs sed -i &apos;s/version:v[0-9]\&#123;1\&#125;/version:v9/g&apos;</span><br></pre></td></tr></table></figure><ul><li>将软件版本号去掉<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa |grep someone|sed &apos;s/\([0-9]\|\.\|_\|-\)\+\.el.\+\(.x86_64\|.noarch\)/\2/g&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="备注说明"><a href="#备注说明" class="headerlink" title="备注说明"></a>备注说明</h1><ul><li>有些版本的sed正则中不支持\d，小括号和加号都要加转义符  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eg:</span><br><span class="line">rpm -qa |grep php |sed &apos;s/-[0-9]\(.*\)\+$/-flag/g;s/^php-/php71-/g&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://www.gnu.org/software/sed/manual/sed.html" target="_blank" rel="noopener">sed, a stream editor·官方文档</a></p></li><li><p><a href="http://www.361way.com/sed-process-lines/2263.html" target="_blank" rel="noopener">linux下在某行的前一行或后一行添加内容·运维之路</a></p></li><li><p><a href="http://www.cnblogs.com/edwardlost/archive/2010/09/17/1829145.html" target="_blank" rel="noopener">sed命令详解</a></p></li><li><p><a href="http://www.cnblogs.com/emanlee/p/3307642.html" target="_blank" rel="noopener">linux中sed的用法</a></p></li><li><p><a href="https://segmentfault.com/q/1010000006118112" target="_blank" rel="noopener">sed 命令如何替换多行内容</a></p></li><li><p><a href="http://blog.fantasy.codes/shell/2013/05/21/learn-sed/" target="_blank" rel="noopener">sed与正则表达式</a></p></li><li><p><a href="http://www.178linux.com/71180" target="_blank" rel="noopener">sed命令的入门与进阶·Linux运维部落</a></p></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2018/03/12/00027_awk使用总结/">awk使用总结</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;sed 发行于1974年，作者 Lee E. McMahon。awk发行于1977年，作者 阿尔佛雷德·艾侯、彼得·温伯格以及布莱恩·柯林汉。&lt;/p&gt;
&lt;p&gt;——源自维基百科&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="文本处理" scheme="https://www.lengyuewusheng.com/categories/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/"/>
    
    
      <category term="sed" scheme="https://www.lengyuewusheng.com/tags/sed/"/>
    
      <category term="文本处理" scheme="https://www.lengyuewusheng.com/tags/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>MediaWiki配置文件</title>
    <link href="https://www.lengyuewusheng.com/2018/09/05/00049_MediaWiki%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"/>
    <id>https://www.lengyuewusheng.com/2018/09/05/00049_MediaWiki配置文件/</id>
    <published>2018-09-05T15:28:26.000Z</published>
    <updated>2018-09-12T05:30:58.494Z</updated>
    
    <content type="html"><![CDATA[<p>MediaWiki是一款优秀的开源文档系统。功能强大，插件众多，文档完善。</p><a id="more"></a><h1 id="配置文件参考"><a href="#配置文件参考" class="headerlink" title="配置文件参考"></a>配置文件参考</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br></pre></td><td class="code"><pre><span class="line"># mediawiki/LocalSettings.php</span><br><span class="line">&lt;?php</span><br><span class="line"># This file was automatically generated by the MediaWiki 1.26.2</span><br><span class="line"># installer. If you make manual changes, please keep track in case you</span><br><span class="line"># need to recreate them later.</span><br><span class="line">#</span><br><span class="line"># See includes/DefaultSettings.php for all configurable settings</span><br><span class="line"># and their default values, but don&apos;t forget to make changes in _this_</span><br><span class="line"># file, not there.</span><br><span class="line">#</span><br><span class="line"># Further documentation for configuration settings may be found at:</span><br><span class="line"># https://www.mediawiki.org/wiki/Manual:Configuration_settings</span><br><span class="line"></span><br><span class="line"># Protect against web entry</span><br><span class="line">if ( !defined( &apos;MEDIAWIKI&apos; ) ) &#123;</span><br><span class="line">exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## Uncomment this to disable output compression</span><br><span class="line"># $wgDisableOutputCompression = true;</span><br><span class="line"></span><br><span class="line">$wgSitename = &quot;WIKI&quot;;</span><br><span class="line"></span><br><span class="line">## The URL base path to the directory containing the wiki;</span><br><span class="line">## defaults for all runtime URL paths are based off of this.</span><br><span class="line">## For more information on customizing the URLs</span><br><span class="line">## (like /w/index.php/Page_title to /wiki/Page_title) please see:</span><br><span class="line">## https://www.mediawiki.org/wiki/Manual:Short_URL</span><br><span class="line">$wgScriptPath = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">## The protocol and server name to use in fully-qualified URLs</span><br><span class="line">$wgServer = &quot;http://wiki.domain-name.com&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## The URL path to static resources (images, scripts, etc.)</span><br><span class="line">$wgResourceBasePath = $wgScriptPath;</span><br><span class="line">$wgArticlePath = &quot;/wiki/$1&quot;;</span><br><span class="line">$wgUsePathInfo = true;        # Ǵԃ pretty URLs</span><br><span class="line"></span><br><span class="line">## The URL path to the logo.  Make sure you change this from the default,</span><br><span class="line">## or else you&apos;ll overwrite your logo when you upgrade!</span><br><span class="line">#$wgLogo = &quot;$wgResourceBasePath/resources/assets/wiki.png&quot;;</span><br><span class="line">$wgLogo = &quot;$wgResourceBasePath/resources/assets/logo.png&quot;;</span><br><span class="line"></span><br><span class="line">## UPO means: this is also a user preference option</span><br><span class="line"></span><br><span class="line">$wgEnableEmail = true;</span><br><span class="line">$wgEnableUserEmail = true; # UPO</span><br><span class="line"></span><br><span class="line">$wgEmergencyContact = &quot;mail@domain-name.com&quot;;</span><br><span class="line">$wgPasswordSender = &quot;username@domain-name.com&quot;;</span><br><span class="line"></span><br><span class="line">$wgEnotifUserTalk = true; # UPO</span><br><span class="line">$wgEnotifWatchlist = true; # UPO</span><br><span class="line">$wgEmailAuthentication = true;</span><br><span class="line"></span><br><span class="line">## Database settings</span><br><span class="line">$wgDBtype = &quot;mysql&quot;;</span><br><span class="line">$wgDBserver = &quot;10.0.0.1&quot;;</span><br><span class="line">$wgDBname = &quot;wiki&quot;;</span><br><span class="line">$wgDBuser = &quot;root&quot;;</span><br><span class="line">$wgDBpassword = &quot;passwd&quot;;</span><br><span class="line"></span><br><span class="line"># MySQL specific settings</span><br><span class="line">$wgDBprefix = &quot;&quot;;</span><br><span class="line"></span><br><span class="line"># MySQL table options to use during installation or update</span><br><span class="line">$wgDBTableOptions = &quot;ENGINE=InnoDB, DEFAULT CHARSET=binary&quot;;</span><br><span class="line"></span><br><span class="line"># Experimental charset support for MySQL 5.0.</span><br><span class="line">$wgDBmysql5 = false;</span><br><span class="line"></span><br><span class="line">## Shared memory settings</span><br><span class="line">$wgMainCacheType = CACHE_ACCEL;</span><br><span class="line">$wgMemCachedServers = array();</span><br><span class="line"></span><br><span class="line">## To enable image uploads, make sure the &apos;images&apos; directory</span><br><span class="line">## is writable, then set this to true:</span><br><span class="line">$wgEnableUploads = true;</span><br><span class="line">#$wgUseImageMagick = true;</span><br><span class="line">#$wgImageMagickConvertCommand = &quot;/usr/bin/convert&quot;;</span><br><span class="line"></span><br><span class="line"># InstantCommons allows wiki to use images from https://commons.wikimedia.org</span><br><span class="line">$wgUseInstantCommons = true;</span><br><span class="line"></span><br><span class="line">## If you use ImageMagick (or any other shell command) on a</span><br><span class="line">## Linux server, this will need to be set to the name of an</span><br><span class="line">## available UTF-8 locale</span><br><span class="line">$wgShellLocale = &quot;en_US.utf8&quot;;</span><br><span class="line"></span><br><span class="line">## If you want to use image uploads under safe mode,</span><br><span class="line">## create the directories images/archive, images/thumb and</span><br><span class="line">## images/temp, and make them all writable. Then uncomment</span><br><span class="line">## this, if it&apos;s not already uncommented:</span><br><span class="line">#$wgHashedUploadDirectory = false;</span><br><span class="line"></span><br><span class="line">## Set $wgCacheDirectory to a writable directory on the web server</span><br><span class="line">## to make your wiki go slightly faster. The directory should not</span><br><span class="line">## be publically accessible from the web.</span><br><span class="line">#$wgCacheDirectory = &quot;$IP/cache&quot;;</span><br><span class="line"></span><br><span class="line"># Site language code, should be one of the list in ./languages/Names.php</span><br><span class="line"># $wgLanguageCode = &quot;en&quot;;</span><br><span class="line">$wgLanguageCode = &quot;zh-cn&quot;;</span><br><span class="line"></span><br><span class="line">$wgSecretKey = &quot;xxxxxxxxxxxxx&quot;;</span><br><span class="line"></span><br><span class="line"># Site upgrade key. Must be set to a string (default provided) to turn on the</span><br><span class="line"># web installer while LocalSettings.php is in place</span><br><span class="line">$wgUpgradeKey = &quot;xxxxxx&quot;;</span><br><span class="line"></span><br><span class="line">## For attaching licensing metadata to pages, and displaying an</span><br><span class="line">## appropriate copyright notice / icon. GNU Free Documentation</span><br><span class="line">## License and Creative Commons licenses are supported so far.</span><br><span class="line">$wgRightsPage = &quot;&quot;; # Set to the title of a wiki page that describes your license/copyright</span><br><span class="line">$wgRightsUrl = &quot;&quot;;</span><br><span class="line">$wgRightsText = &quot;&quot;;</span><br><span class="line">$wgRightsIcon = &quot;&quot;;</span><br><span class="line"></span><br><span class="line"># Path to the GNU diff3 utility. Used for conflict resolution.</span><br><span class="line">$wgDiff3 = &quot;/usr/bin/diff3&quot;;</span><br><span class="line"></span><br><span class="line"># The following permissions were set based on your choice in the installer</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;createaccount&apos;] = true;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;edit&apos;] = false;</span><br><span class="line">$wgWhitelistRead = array (&quot;首页&quot;,&quot;特殊:创建账户&quot;);</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;read&apos;] = false;</span><br><span class="line">#$wgGroupPermissions[&apos;sysop&apos;][&apos;edit&apos;] = true;</span><br><span class="line">#$wgGroupPermissions[&apos;sysop&apos;][&apos;read&apos;] = true;</span><br><span class="line"></span><br><span class="line">## Default skin: you can change the default skin. Use the internal symbolic</span><br><span class="line">## names, ie &apos;vector&apos;, &apos;monobook&apos;:</span><br><span class="line"># $wgDefaultSkin = &quot;vector&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;BlueSky&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;BlueSky&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;foreground&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;foreground&quot;;</span><br><span class="line"></span><br><span class="line"># wfLoadSkin( &apos;Metrolook&apos; );</span><br><span class="line"># $wgDefaultSkin = &quot;Metrolook&quot;;</span><br><span class="line"></span><br><span class="line">wfLoadSkin( &apos;Timeless&apos; );</span><br><span class="line">$wgDefaultSkin = &quot;Timeless&quot;;</span><br><span class="line"></span><br><span class="line"># Enabled skins.</span><br><span class="line"># The following skins were automatically enabled:</span><br><span class="line">wfLoadSkin( &apos;CologneBlue&apos; );</span><br><span class="line">wfLoadSkin( &apos;Modern&apos; );</span><br><span class="line">wfLoadSkin( &apos;MonoBook&apos; );</span><br><span class="line">wfLoadSkin( &apos;Vector&apos; );</span><br><span class="line"></span><br><span class="line"># Enabled Extensions. Most extensions are enabled by including the base extension file here</span><br><span class="line"># but check specific extension documentation for more details</span><br><span class="line"># The following extensions were automatically enabled:</span><br><span class="line">wfLoadExtension( &apos;Cite&apos; );</span><br><span class="line">wfLoadExtension( &apos;CiteThisPage&apos; );</span><br><span class="line">wfLoadExtension( &apos;ConfirmEdit&apos; );</span><br><span class="line">wfLoadExtension( &apos;Gadgets&apos; );</span><br><span class="line">wfLoadExtension( &apos;ImageMap&apos; );</span><br><span class="line">wfLoadExtension( &apos;InputBox&apos; );</span><br><span class="line">wfLoadExtension( &apos;Interwiki&apos; );</span><br><span class="line">wfLoadExtension( &apos;LocalisationUpdate&apos; );</span><br><span class="line">wfLoadExtension( &apos;Nuke&apos; );</span><br><span class="line">wfLoadExtension( &apos;ParserFunctions&apos; );</span><br><span class="line">wfLoadExtension( &apos;PdfHandler&apos; );</span><br><span class="line">wfLoadExtension( &apos;Poem&apos; );</span><br><span class="line">wfLoadExtension( &apos;Renameuser&apos; );</span><br><span class="line">wfLoadExtension( &apos;SpamBlacklist&apos; );</span><br><span class="line">#wfLoadExtension( &apos;SyntaxHighlight_GeSHi&apos; );</span><br><span class="line">wfLoadExtension( &apos;TitleBlacklist&apos; );</span><br><span class="line">wfLoadExtension( &apos;WikiEditor&apos; );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># End of automatically generated settings.</span><br><span class="line"># Add more configuration options below.</span><br><span class="line"></span><br><span class="line">#VisualEditor</span><br><span class="line">/*require_once &quot;$IP/extensions/VisualEditor/VisualEditor.php&quot;;</span><br><span class="line">// Enable by default for everybody</span><br><span class="line">$wgDefaultUserOptions[&apos;visualeditor-enable&apos;] = 1;</span><br><span class="line"></span><br><span class="line">// Don&apos;t allow users to disable it</span><br><span class="line">$wgHiddenPrefs[] = &apos;visualeditor-enable&apos;;</span><br><span class="line"></span><br><span class="line">// OPTIONAL: Enable VisualEditor&apos;s experimental code features</span><br><span class="line">#$wgDefaultUserOptions[&apos;visualeditor-enable-experimental&apos;] = 1;</span><br><span class="line">$wgVirtualRestConfig[&apos;modules&apos;][&apos;parsoid&apos;] = array(</span><br><span class="line">  // URL to the Parsoid instance</span><br><span class="line">  // Use port 8142 if you use the Debian package</span><br><span class="line">  &apos;url&apos; =&gt; &apos;http://127.0.0.1:8182&apos;,</span><br><span class="line">  // Parsoid &quot;domain&quot;, see below (optional)</span><br><span class="line">  &apos;domain&apos; =&gt; &apos;localhost&apos;,</span><br><span class="line">  // Parsoid &quot;prefix&quot;, see below (optional)</span><br><span class="line">  &apos;prefix&apos; =&gt; &apos;mediawiki&apos;</span><br><span class="line">);*/</span><br><span class="line"></span><br><span class="line">require_once &apos;extensions/LdapAuthentication/LdapAuthentication.php&apos;;</span><br><span class="line">#require_once &apos;includes/AuthPlugin.php&apos;;</span><br><span class="line">$wgAuth = new LdapAuthenticationPlugin();</span><br><span class="line">$wgLDAPUseLocal = true;</span><br><span class="line">$wgLDAPDomainNames = array(&quot;domain-name&quot;);</span><br><span class="line">$wgLDAPServerNames = array(&quot;domain-name&quot; =&gt; &quot;ldap.domain-name.com&quot;);</span><br><span class="line">$wgLDAPPort = array(&quot;domain-name&quot; =&gt; 389);</span><br><span class="line">$wgLDAPEncryptionType = array( &quot;domain-name&quot; =&gt; &quot;clear&quot;);</span><br><span class="line"></span><br><span class="line">#$wgLDAPProxyAgent = array(&quot;domain-name&quot;=&gt;&quot;cn=username,ou=op,ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPProxyAgent = array(&quot;domain-name&quot;=&gt;&quot;cn=username,ou=Special_Account,ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPProxyAgentPassword = array( &quot;domain-name&quot;=&gt;&quot;passwd&quot;);</span><br><span class="line">$wgLDAPGroupUseRetrievedUsername = array(&quot;domain-name&quot;=&gt;true);</span><br><span class="line">#$wgLDAPSearchAttributes = array( &quot;domain-name&quot; =&gt; &quot;uid&quot;);</span><br><span class="line">$wgLDAPSearchAttributes = array( &quot;domain-name&quot; =&gt; &quot;sAMAccountName&quot;);</span><br><span class="line">$wgLDAPBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPGroupBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;ou=maillist,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line">$wgLDAPUserBaseDNs = array( &quot;domain-name&quot;=&gt;&quot;ou=user,ou=xxxxx,dc=domain-name,dc=com&quot;);</span><br><span class="line"></span><br><span class="line">$wgLDAPGroupUseFullDN = array( &quot;domain-name&quot;=&gt;true );</span><br><span class="line">$wgLDAPLowerCaseUsername = array( &quot;domain-name&quot;=&gt;true);</span><br><span class="line">$wgLDAPGroupObjectclass = array( &quot;domain-name&quot;=&gt;&quot;groupofuniquenames&quot; );</span><br><span class="line">$wgLDAPGroupAttribute = array( &quot;domain-name&quot;=&gt;&quot;uniquemember&quot; );</span><br><span class="line">$wgLDAPGroupNameAttribute = array( &quot;domain-name&quot;=&gt;&quot;cn&quot; );</span><br><span class="line"></span><br><span class="line">#$wgLDAPRequiredGroups = array( &quot;domain-name&quot; =&gt; array(&quot;&quot;));</span><br><span class="line">$wgLDAPGroupSearchNestedGroups = array( &quot;domain-name&quot;=&gt;false );</span><br><span class="line">$wgLDAPDebug = 5;</span><br><span class="line">$wgDebugLogGroups[&quot;ldap&quot;] = &quot;/tmp/ldap.log&quot;;</span><br><span class="line">$wgGroupPermissions[&apos;*&apos;][&apos;autocreateaccount&apos;] = true;</span><br><span class="line"></span><br><span class="line">#UserMerge</span><br><span class="line">require_once &quot;$IP/extensions/UserMerge/UserMerge.php&quot;;</span><br><span class="line">// By default nobody can use this function, enable for bureaucrat?</span><br><span class="line">$wgGroupPermissions[&apos;bureaucrat&apos;][&apos;usermerge&apos;] = true;</span><br><span class="line"></span><br><span class="line">// optional: default is array( &apos;sysop&apos; )</span><br><span class="line">//$wgUserMergeProtectedGroups = array( &apos;groupname&apos; );</span><br><span class="line"># Allow all users to be merged (by default, the &apos;sysop&apos; group is unmergeable)</span><br><span class="line">//$wgUserMergeProtectedGroups = array();</span><br><span class="line"></span><br><span class="line"># Disallow merging of the users in the &apos;sysop&apos; or &apos;awesomeusers&apos; groups</span><br><span class="line">//$wgUserMergeUnmergeable = array( &apos;sysop&apos;, &apos;awesomeusers&apos; );</span><br><span class="line">#Mail</span><br><span class="line">$wgSMTP = array(</span><br><span class="line">&quot;host&quot; =&gt; &apos;mail.domain-name.com&apos;,</span><br><span class="line">&quot;IDHost&quot; =&gt; &apos;domain-name.com&apos;,</span><br><span class="line">&quot;port&quot; =&gt; &quot;25&quot;,</span><br><span class="line">&quot;auth&quot; =&gt; true,</span><br><span class="line">&quot;username&quot; =&gt; &apos;username&apos;,</span><br><span class="line">&quot;password&quot; =&gt; &apos;passpwd&apos;);</span><br><span class="line">$wgEnableUserEmail = true;</span><br><span class="line">$wgEnableEmail = true;</span><br><span class="line"></span><br><span class="line"># target set.</span><br><span class="line">$wgExternalLinkTarget = &apos;_blank&apos;;</span><br><span class="line"></span><br><span class="line">#Extension:DynamicSidebar</span><br><span class="line">wfLoadExtension( &apos;DynamicSidebar&apos; );</span><br><span class="line">// Enable debugging</span><br><span class="line">$wgDebugLogGroups[&quot;dynamic-sidebar&quot;] = &quot;/tmp/sidebar-debug.log&quot;;</span><br><span class="line"></span><br><span class="line">// Allow users to create their own custom sidebars under User:&lt;username&gt;/Sidebar</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseUserpages = true;</span><br><span class="line"></span><br><span class="line">// Allow group sidebars under MediaWiki:Sidebar/Group:&lt;group&gt;</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseGroups = true;</span><br><span class="line"></span><br><span class="line">// Allow category based sidebars under MediaWiki:Sidebar/Category:&lt;category&gt;</span><br><span class="line">// Default: true</span><br><span class="line">$wgDynamicSidebarUseCategories = true;</span><br><span class="line"></span><br><span class="line">#Extension:CollapsibleVector &amp; TreeOfSiderbar</span><br><span class="line">wfLoadExtension( &apos;CollapsibleVector&apos; );</span><br><span class="line">$wgCollapsibleVectorFeatures[&apos;collapsiblenav&apos;][&apos;global&apos;] = true;</span><br><span class="line">$wgCollapsibleVectorFeatures[&apos;collapsiblenav&apos;][&apos;user&apos;] = true;</span><br><span class="line"></span><br><span class="line">#Extension:TreeAndMenu</span><br><span class="line">wfLoadExtension( &apos;TreeAndMenu&apos; );</span><br><span class="line"></span><br><span class="line">#MarkdownExtraParser</span><br><span class="line">/*require_once &quot;$IP/extensions/MarkdownExtraParser/MarkdownExtraParser.php&quot;;</span><br><span class="line">// MarkdownExtraParser</span><br><span class="line">$MarkdownExtraParserOptions = array(</span><br><span class="line">    &apos;use_raw_html&apos; =&gt; true,</span><br><span class="line">);*/</span><br><span class="line"></span><br><span class="line">#SimpleBatchUpload</span><br><span class="line">wfLoadExtension(&apos;SimpleBatchUpload&apos;);</span><br><span class="line"></span><br><span class="line">#Piwik</span><br><span class="line">/*</span><br><span class="line">require_once &quot;$IP/extensions/piwik-mediawiki/Piwik.php&quot;;</span><br><span class="line">$wgPiwikURL = &quot;piwik.domain-name.com/&quot;;</span><br><span class="line">$wgPiwikIDSite = &quot;1&quot;;</span><br><span class="line">$wgUseSiteJS = true;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"># MobileFrontend</span><br><span class="line">wfLoadExtension( &apos;MobileFrontend&apos; );</span><br><span class="line">$wgMFAutodetectMobileView = true;</span><br><span class="line">$wgMFNearbyEndpoint = &apos;http://en.m.wikipedia.org/w/api.php&apos;;</span><br><span class="line">$wgMFNearby = true;</span><br><span class="line"># MobileContext::singleton()-&gt;setForceMobileView( true );</span><br><span class="line"># $wgMFDefaultSkinClass = &apos;SkinVector&apos;; // use Vector skin</span><br><span class="line">$wgMFDefaultSkinClass = &apos;SkinTimeless&apos;; // use Timeless skin</span><br><span class="line"></span><br><span class="line"># GeoData</span><br><span class="line">require_once &quot;$IP/extensions/GeoData/GeoData.php&quot;;</span><br><span class="line"></span><br><span class="line"># PageImages</span><br><span class="line">require_once &quot;$IP/extensions/PageImages/PageImages.php&quot;;</span><br><span class="line"></span><br><span class="line"># Enable Semantic MediaWiki</span><br><span class="line"># require_once &quot;$IP/extensions/SemanticMediaWiki/SemanticMediaWiki.php&quot;;</span><br><span class="line">enableSemantics(&apos;wiki.domain-name.com&apos;);</span><br></pre></td></tr></table></figure><h1 id="插件列表参考"><a href="#插件列表参考" class="headerlink" title="插件列表参考"></a>插件列表参考</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap</span><br><span class="line">Cite</span><br><span class="line">CiteThisPage</span><br><span class="line">CollapsibleVector</span><br><span class="line">ConfirmEdit</span><br><span class="line">DynamicSidebar</span><br><span class="line">Gadgets</span><br><span class="line">GeoData</span><br><span class="line">ImageMap</span><br><span class="line">InputBox</span><br><span class="line">Interwiki</span><br><span class="line">LdapAuthentication</span><br><span class="line">LocalisationUpdate</span><br><span class="line">MarkdownExtraParser</span><br><span class="line">MobileFrontend</span><br><span class="line">Nuke</span><br><span class="line">OpenLayers</span><br><span class="line">PageImages</span><br><span class="line">ParserFunctions</span><br><span class="line">PdfHandler</span><br><span class="line">piwik-mediawiki</span><br><span class="line">Poem</span><br><span class="line">README</span><br><span class="line">Renameuser</span><br><span class="line">SemanticForms</span><br><span class="line">SemanticMediaWiki</span><br><span class="line">SimpleBatchUpload</span><br><span class="line">SpamBlacklist</span><br><span class="line">SyntaxHighlight_GeSHi</span><br><span class="line">TitleBlacklist</span><br><span class="line">TreeAndMenu</span><br><span class="line">UserMerge</span><br><span class="line">VisualEditor</span><br><span class="line">WikiEditor</span><br></pre></td></tr></table></figure><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/11/14/00023_MediaWiki导航菜单设置/">MediaWiki导航菜单设置</a></li><li><a href="https://www.lengyuewusheng.com/2017/12/26/00025_MediaWiki常见问题汇总/">MediaWiki常见问题汇总</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MediaWiki是一款优秀的开源文档系统。功能强大，插件众多，文档完善。&lt;/p&gt;
    
    </summary>
    
      <category term="开源工具" scheme="https://www.lengyuewusheng.com/categories/%E5%BC%80%E6%BA%90%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="MediaWiki" scheme="https://www.lengyuewusheng.com/tags/MediaWiki/"/>
    
      <category term="插件" scheme="https://www.lengyuewusheng.com/tags/%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Markdown格式备注</title>
    <link href="https://www.lengyuewusheng.com/2018/09/04/00048_Markdown%E6%A0%BC%E5%BC%8F%E5%A4%87%E6%B3%A8/"/>
    <id>https://www.lengyuewusheng.com/2018/09/04/00048_Markdown格式备注/</id>
    <published>2018-09-04T14:45:11.000Z</published>
    <updated>2018-09-14T06:04:35.800Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>好的文档不仅要内容精湛，更要格式优雅。</p></blockquote><a id="more"></a><blockquote class="blockquote-center"><p>基本格式就不介绍了，主要备忘一些特殊格式。对，肯定不全面，慢慢完善嘛。。。</p></blockquote><h1 id="表格设置"><a href="#表格设置" class="headerlink" title="表格设置"></a>表格设置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    table</span><br><span class="line">        width: 100%; /*表格宽度*/</span><br><span class="line">        max-width: 65em; /*表格最大宽度，避免表格过宽*/</span><br><span class="line">        border: 1px solid #dedede; /*表格外边框设置*/</span><br><span class="line">        margin: 15px auto; /*外边距*/</span><br><span class="line">        border-collapse: collapse; /*使用单一线条的边框*/</span><br><span class="line">        empty-cells: show; /*单元格无内容依旧绘制边框*/</span><br><span class="line">        tr:</span><br><span class="line">            hover &#123;background: #efefef;&#125;</span><br><span class="line">        td:</span><br><span class="line">            height: 35px; /*统一每一行的默认高度*/</span><br><span class="line">            border: 1px solid #dedede; /*内部边框样式*/</span><br><span class="line">            padding: 0 10px; /*内边距*/</span><br><span class="line">        th:</span><br><span class="line">            white-space: nowrap; /*表头内容强制在一行显示*/</span><br><span class="line">            font-weight: bold; /*加粗*/</span><br><span class="line">            text-align: center !important; /*内容居中，加上 !important 避免被 Markdown 样式覆盖*/</span><br><span class="line">            background: rgba(158,188,226,0.2); /*背景色*/</span><br><span class="line">            nth-of-type(1)&#123;width: 5%; white-space: nowrap;&#125;</span><br><span class="line">            nth-of-type(2)&#123;width: 15%;&#125;</span><br><span class="line">            nth-of-type(3)&#123;width: 70%;&#125;</span><br><span class="line">            nth-of-type(4)&#123;width: 10%;&#125;</span><br><span class="line">    tbody</span><br><span class="line">        tr:</span><br><span class="line">            nth-child(2n)&#123;background: rgba(158,188,226,0.12);&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h1 id="note-标签"><a href="#note-标签" class="headerlink" title="note 标签"></a>note 标签</h1><h2 id="官方"><a href="#官方" class="headerlink" title="官方"></a>官方</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用方式</span><br><span class="line">&#123;% note class_name %&#125; Content (md partial supported) &#123;% endnote %&#125;</span><br><span class="line">其中，class_name 可以是以下列表中的一个值：</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line">primary</span><br><span class="line">success</span><br><span class="line">info</span><br><span class="line">warning</span><br><span class="line">danger</span><br></pre></td></tr></table></figure><h2 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;p id=&quot;div-border-top-green&quot;&gt;</span><br><span class="line">内容</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p id=&quot;div-border-left-red&quot;&gt;</span><br><span class="line">内容</span><br><span class="line">[shell tag](/tags/shell)标签</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">default</span><br><span class="line">&lt;div class=&quot;note default&quot;&gt;&lt;p&gt;default&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">primary</span><br><span class="line">&lt;div class=&quot;note primary&quot;&gt;&lt;p&gt;primary&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">success</span><br><span class="line">&lt;div class=&quot;note success&quot;&gt;&lt;p&gt;success&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">info</span><br><span class="line">&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;info&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">warning</span><br><span class="line">&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;warning&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">danger</span><br><span class="line">&lt;div class=&quot;note danger&quot;&gt;&lt;p&gt;danger&lt;/p&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">danger no-icon</span><br><span class="line">&lt;div class=&quot;note danger no-icon&quot;&gt;&lt;p&gt;danger no-icon&lt;/p&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h1 id="可以收缩的内容"><a href="#可以收缩的内容" class="headerlink" title="可以收缩的内容"></a>可以收缩的内容</h1><ul><li><p>可以收缩的内容源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">## 标题1.1</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.1.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.1.2</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.1.3</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 标题1.2</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.2.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.2.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">* [链接2](https://www.baidu.com)</span><br><span class="line">* [链接3](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 标题1.3</span><br><span class="line">&lt;details&gt;</span><br><span class="line">&lt;summary&gt;查看详情&lt;/summary&gt;</span><br><span class="line">### 标题1.3.1</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">### 标题1.3.2</span><br><span class="line">* [链接1](https://www.baidu.com)</span><br><span class="line">* [链接2](https://www.baidu.com)</span><br><span class="line">&lt;/details&gt;</span><br></pre></td></tr></table></figure></li><li><p>可以收缩的内容效果</p></li></ul><h2 id="标题1-1"><a href="#标题1-1" class="headerlink" title="标题1.1"></a>标题1.1</h2><details><br>  <summary>查看详情</summary><br><br>### 标题1.1.1<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br><br>### 标题1.1.2<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br><br>### 标题1.1.3<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br></details><h2 id="标题1-2"><a href="#标题1-2" class="headerlink" title="标题1.2"></a>标题1.2</h2><details><br><summary>查看详情</summary><br><br>### 标题1.2.1<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br><br>### 标题1.221<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接2</a><br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接3</a><br></details><h2 id="标题1-3"><a href="#标题1-3" class="headerlink" title="标题1.3"></a>标题1.3</h2><details><br><summary>查看详情</summary><br><br>### 标题1.3.1<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br><br>### 标题1.3.2<br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接1</a><br>- <a href="https://www.baidu.com" target="_blank" rel="noopener">链接2</a><br></details><h1 id="网页表格"><a href="#网页表格" class="headerlink" title="网页表格"></a>网页表格</h1><table><br>  <tr><br>    <td align="center"><br>      <a href="https://crisp.chat/?ta=oR1nEv43TM" target="_blank"><img src="https://pbs.twimg.com/profile_images/651629444944273408/r5Kd_ifq_400x400.png" height="64"></a><br>    </td><br>    <td align="center"><br>      <a href="http://try.anyleads.com/secret" target="_blank"><img src="https://pbs.twimg.com/profile_images/838140522476761094/A4WpBe5M_400x400.jpg" height="64"></a><br>    </td><br>    <td align="center"><br>      <a href="https://hackr.io/" target="_blank"><img src="https://d1eq8vvyuam4eq.cloudfront.net/assets/images/code-images/code-apple-touch-icon-precomposed.png" height="64"></a><br>    </td><br>    <td align="center"><br>      <a href="https://learnk8s.io/" target="_blank"><img src="https://pbs.twimg.com/profile_images/925127335573114880/9yCkEIe3_400x400.jpg" height="64"></a><br>    </td><br>  </tr><br></table><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><p><a href="http://moxfive.xyz/2016/03/04/markdown-table-style/" target="_blank" rel="noopener">Markdown 表格样式调整与自适应优化</a></p></li><li><p><a href="https://labrick.cc/2015/07/28/markdown-problem-answer/" target="_blank" rel="noopener">Markdown使用问题及解决办法</a></p></li><li><p><a href="https://github.com/LeCoupa/awesome-cheatsheets/blob/master/README.md" target="_blank" rel="noopener">github·awesome-cheatsheets</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;好的文档不仅要内容精湛，更要格式优雅。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="技术文档" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="Markdown" scheme="https://www.lengyuewusheng.com/tags/Markdown/"/>
    
      <category term="Readme" scheme="https://www.lengyuewusheng.com/tags/Readme/"/>
    
  </entry>
  
  <entry>
    <title>Linux命令行环境下进行URL解码</title>
    <link href="https://www.lengyuewusheng.com/2018/09/03/00047_Linux-shell-urldecode/"/>
    <id>https://www.lengyuewusheng.com/2018/09/03/00047_Linux-shell-urldecode/</id>
    <published>2018-09-03T13:14:42.000Z</published>
    <updated>2018-09-14T05:58:14.497Z</updated>
    
    <content type="html"><![CDATA[<p>命令行环境解码url是运维的必备技能，尤其是在排查应用日志的时候。而最佳实践还是不依赖任何编程能直接敲个命令就搞定。。。</p><a id="more"></a><p>以下内容基于CentOS6.9系统环境。</p><h1 id="命令行软件包"><a href="#命令行软件包" class="headerlink" title="命令行软件包"></a>命令行软件包</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@test-204 ~]# rpm -qf /usr/bin/urlencode</span><br><span class="line">gridsite-clients-2.2.6-2.el6.x86_64</span><br><span class="line">[root@test-204 ~]#</span><br></pre></td></tr></table></figure><h1 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/g/gridsite-clients-2.2.6-2.el6.x86_64.rpm \</span><br><span class="line">http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/g/gridsite-libs-2.2.6-2.el6.x86_64.rpm \</span><br><span class="line">http://dl.fedoraproject.org/pub/epel/6/x86_64/Packages/c/canl-c-2.1.8-1.el6.x86_64.rpm</span><br></pre></td></tr></table></figure><h1 id="使用查看"><a href="#使用查看" class="headerlink" title="使用查看"></a>使用查看</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看归档日志</span><br><span class="line">urlencode -d decode $(zcat access.log.2018_09_01_22.log.gz |awk &apos;&#123;print $7&#125;&apos; |sort |uniq -c |sort -rn |head )</span><br><span class="line"></span><br><span class="line">#查看实时日志</span><br><span class="line">tailf access.log |awk &apos;&#123;print $7&#125;&apos;|xargs urlencode -d decode</span><br></pre></td></tr></table></figure><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ul><li><a href="https://www.urldecoder.net/linux-urldecode" target="_blank" rel="noopener">linux-urldecode</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/01/00006_shell脚本传参/">shell脚本传参</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/02/00007_shell的分批并发操作的简单实现/">shell的分批并发操作的简单实现</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/05/00009_shell-printf格式化输出/">shell printf格式化输出</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/10/00014_常用shell命令总结/">常用shell命令总结</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;命令行环境解码url是运维的必备技能，尤其是在排查应用日志的时候。而最佳实践还是不依赖任何编程能直接敲个命令就搞定。。。&lt;/p&gt;
    
    </summary>
    
      <category term="文本处理" scheme="https://www.lengyuewusheng.com/categories/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86/"/>
    
    
      <category term="shell" scheme="https://www.lengyuewusheng.com/tags/shell/"/>
    
      <category term="urldecode" scheme="https://www.lengyuewusheng.com/tags/urldecode/"/>
    
  </entry>
  
  <entry>
    <title>nginx访问频率限制</title>
    <link href="https://www.lengyuewusheng.com/2018/04/01/00046_nginx%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87%E9%99%90%E5%88%B6/"/>
    <id>https://www.lengyuewusheng.com/2018/04/01/00046_nginx访问频率限制/</id>
    <published>2018-04-01T14:45:29.000Z</published>
    <updated>2018-09-14T05:58:14.506Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>在nginx服务中通过限制访问频率的策略可以在一定程度上抵御DDoS攻击。</p></blockquote><a id="more"></a><h1 id="配置范例"><a href="#配置范例" class="headerlink" title="配置范例"></a>配置范例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 白名单</span><br><span class="line"># geo $remote_addr $limited</span><br><span class="line">geo $limited</span><br><span class="line">&#123;</span><br><span class="line">    default 1;</span><br><span class="line">    10.0.0.0/8 0;</span><br><span class="line">    123.207.144.100/32 0;</span><br><span class="line">    123.123.123.248/30 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map $limited $limit &#123;</span><br><span class="line">    1 $binary_remote_addr;</span><br><span class="line">    0 &quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># nginx.conf 中的http模块中定义limit_req_zone</span><br><span class="line">limit_req_zone $limit zone=reqzone1:10m rate=20r/s;</span><br><span class="line"></span><br><span class="line"># server模块中的location规则中应用limit_req_zone(也可以直接应用到server或者http模块中)</span><br><span class="line">server&#123;</span><br><span class="line">        ...</span><br><span class="line">        </span><br><span class="line">        #limit_req zone=reqzone3 burst=20 nodelay;</span><br><span class="line">        limit_req zone=reqzone3 burst=20;</span><br><span class="line">        location xxx1 &#123;</span><br><span class="line">            ...</span><br><span class="line">            #limit_req zone=reqzone1 burst=20 nodelay;</span><br><span class="line">            limit_req zone=reqzone1 burst=20;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        location xxx2 &#123;</span><br><span class="line">            ...</span><br><span class="line">            #limit_req zone=reqzone2 burst=20 nodelay;</span><br><span class="line">            limit_req zone=reqzone2 burst=20;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"># 在http, server, location中均可定义limit_req_status code，默认503；</span><br></pre></td></tr></table></figure><h1 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h1><ul><li><p>geo</p><ul><li>geo [$address] $variable { … } 定义从指定的变量获取客户端的IP地址。默认情况下，nginx从$remote_addr变量取得客户端IP地址，但也可以从其他变量获得。</li></ul></li><li><p>map</p><ul><li>map为一个变量设置的映射表，用来创建变量，映射表由两列组成，匹配模式和对应的值。但是仅在变量被接受的时候执行视图映射操作，对于处理没有引用变量的请求时，这个模块并没有性能上的缺失。</li></ul></li><li><p>limit_req_zone</p><ul><li>第一个字段定义为key，限制对象。$binary_remote_addr(\x0A\x64\xCE\x10)是4字节的IPv4地址，或者16字节的IPv6地址，32位系统上占用32或64个字节，64位系统上占用128字节，占用空间比$remote_addr少64字节。10M大概可以保存160,000条记录。<br>*limit_req_zone中如果key为””表示不对其进行频率限制，所以白名单将用户的key设置为””。</li><li>zone=reqzone1:10m，定义名为reqzone1大小为10M(漏桶算法桶的大小)的zone存储访问频率.共享内存空间被耗尽后则服务器将会对后续所有的请求返回503(Service Temporarily Unavailable)错误。</li><li>rate=20r/s，定义访问速率阈值，单位可以是r/s(次/秒)或者r/m(次/分钟)</li></ul></li><li><p>limit_req</p><ul><li>zone=reqzone1，选择应用的限制策略zone名称</li><li>burst=20，可选字段，缓冲请求数(特权令牌数，拥有特权令牌可以直接访问服务)</li><li>nodelay，可选字段，加入该字段后超出令牌数的请求直接返回503</li></ul></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://nginx.org/en/docs/http/ngx_http_limit_req_module.html" target="_blank" rel="noopener">nginx Module ngx_http_limit_req_module</a></li><li><a href="https://www.w3cschool.cn/nginxsysc/nginxsysc-limit-req.html" target="_blank" rel="noopener">w3cschool·Nginx 限制IP访问频率</a></li><li><a href="http://www.nginx.cn/446.html" target="_blank" rel="noopener">nginx限制某个IP同一时间段的访问次数</a></li><li><a href="https://www.cnblogs.com/biglittleant/p/8979915.html" target="_blank" rel="noopener">死磕nginx系列–nginx 限流配置</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/06/00010_nginx-rewrite指令中的flag参数/">nginx-rewrite指令中的flag参数</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/08/00012_nginx配置location匹配规则/">nginx配置location匹配规则</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/07/00011_nginx配置中的if指令/">nginx配置中的if指令</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/13/00017_基于生产环境的仿真流量测试/">基于生产环境的仿真流量测试</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;在nginx服务中通过限制访问频率的策略可以在一定程度上抵御DDoS攻击。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="nginx" scheme="https://www.lengyuewusheng.com/categories/nginx/"/>
    
    
      <category term="nginx" scheme="https://www.lengyuewusheng.com/tags/nginx/"/>
    
      <category term="DDoS" scheme="https://www.lengyuewusheng.com/tags/DDoS/"/>
    
  </entry>
  
  <entry>
    <title>进程、线程、协程</title>
    <link href="https://www.lengyuewusheng.com/2018/03/31/00045_%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E3%80%81%E5%8D%8F%E7%A8%8B/"/>
    <id>https://www.lengyuewusheng.com/2018/03/31/00045_进程、线程、协程/</id>
    <published>2018-03-31T14:05:43.000Z</published>
    <updated>2018-05-29T01:31:06.012Z</updated>
    
    <content type="html"><![CDATA[<p>概念可以帮助我们更好的思考和理解。</p><a id="more"></a><h2 id="进程-process"><a href="#进程-process" class="headerlink" title="进程(process)"></a>进程(process)</h2><p>进程是正在运行的程序的实例，广义上是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。<br>进程是<strong>系统进行资源分配和调度的基本单位</strong>，是操作系统结构的基础。<br>在面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，<strong>进程是程序的实体</strong>。</p><ul><li><p>特征：</p><ul><li>动态性: 动态产生、动态消亡</li><li>并发性: 并发执行 </li><li>独立性: 独立运行的基本单位，系统分配资源和调度的独立单位</li><li>异步性: 按各自独立不可预知的速度向前推进</li></ul></li><li><p>结构特征：</p><p>进程由程序、数据和进程控制块三部分组成。</p></li><li><p>三种状态</p><ul><li><p>就绪状态（Ready）：<br>进程已获得除处理器外的所需资源，等待分配处理器资源；只要分配了处理器进程就可执行。</p></li><li><p>运行状态(Running)：<br>进程占用处理器资源；处于此状态的进程的数目小于等于处理器的数目。</p></li><li><p>阻塞状态(Blocked)：<br>由于进程等待某种条件(如I/O操作或进程同步),在条件满足之前无法继续执行。该事件发生前即使把处理器资源分配给该进程，也无法运行。</p></li></ul></li></ul><h2 id="线程-thread"><a href="#线程-thread" class="headerlink" title="线程(thread)"></a>线程(thread)</h2><p>线程，有时被称为轻量级进程(Lightweight Process，LWP），是程序中一个单一的顺序控制流程，是<strong>程序执行流的最小单元</strong>。<br>也是系统独立调度和分派CPU的基本单位指令运行时的程序的调度单位。<br>一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。</p><ul><li>特征<ul><li>线程是进程中的实体，是被系统独立调度和分派的基本单位；</li><li>一个进程可以拥有多个线程，一个线程必须有一个父进程；</li><li>线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源；</li><li>一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行；</li><li>线程也有就绪、阻塞和运行三种基本状态；</li><li>每一个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。</li></ul></li></ul><h2 id="协程-coroutine"><a href="#协程-coroutine" class="headerlink" title="协程(coroutine)"></a>协程(coroutine)</h2><p>协程不是进程或线程，其执行过程更类似于子例程，或者说不带返回值的函数调用。<br>协程也是一种程序组件。相对子例程而言，协程更为一般和灵活。</p><ul><li>特征<ul><li>一个程序可以包含多个协程，可以对比与一个进程包含多个线程；</li><li>有自己的上下文，但是其切换由自己控制，由当前协程切换到其他协程由当前协程来控制；</li><li>协程的起始处是第一个入口点，在协程里，返回点之后是接下来的入口点；</li><li>协程的生命期完全由他们的使用的需要决定；</li><li>协程可以通过yield来调用其它协程。通过yield方式转移执行权的协程之间不是调用者与被调用者的关系，而是彼此对称、平等的；</li><li>协程更适合于用来实现彼此熟悉的程序组件，如合作式多任务，迭代器，无限列表和管道。</li></ul></li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/进程" target="_blank" rel="noopener">维基百科·进程</a></li><li><a href="https://zh.wikipedia.org/wiki/线程" target="_blank" rel="noopener">维基百科·线程</a></li><li><a href="https://zh.wikipedia.org/wiki/协程" target="_blank" rel="noopener">维基百科·协程</a></li><li><a href="https://baike.baidu.com/item/进程" target="_blank" rel="noopener">百度百科·进程</a></li><li><a href="https://baike.baidu.com/item/线程" target="_blank" rel="noopener">百度百科·线程</a></li><li><a href="https://baike.baidu.com/item/协程" target="_blank" rel="noopener">百度百科·协程</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;概念可以帮助我们更好的思考和理解。&lt;/p&gt;
    
    </summary>
    
      <category term="夯实基础" scheme="https://www.lengyuewusheng.com/categories/%E5%A4%AF%E5%AE%9E%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="进程" scheme="https://www.lengyuewusheng.com/tags/%E8%BF%9B%E7%A8%8B/"/>
    
      <category term="线程" scheme="https://www.lengyuewusheng.com/tags/%E7%BA%BF%E7%A8%8B/"/>
    
      <category term="协程" scheme="https://www.lengyuewusheng.com/tags/%E5%8D%8F%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>redis持久化策略</title>
    <link href="https://www.lengyuewusheng.com/2018/03/30/00044_redis%E6%8C%81%E4%B9%85%E5%8C%96%E7%AD%96%E7%95%A5/"/>
    <id>https://www.lengyuewusheng.com/2018/03/30/00044_redis持久化策略/</id>
    <published>2018-03-30T14:28:29.000Z</published>
    <updated>2018-05-28T02:42:30.176Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存也可以持久化的日志型、Key-Value数据库。</p></blockquote><a id="more"></a><h2 id="两种方式"><a href="#两种方式" class="headerlink" title="两种方式"></a>两种方式</h2><h3 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB(Redis DataBase)"></a>RDB(Redis DataBase)</h3><p>redis的默认持久化机制，在指定的时间间隔内将内存中的数据集快照写入磁盘。</p><h3 id="AOF-Append-Only-File"><a href="#AOF-Append-Only-File" class="headerlink" title="AOF(Append Only File)"></a>AOF(Append Only File)</h3><p>以日志的形式记录服务器所处理的每一个写操作，在Redis服务器启动之初会读取该文件来重新构建数据库，以保证启动后数据库中的数据是完整的。</p><p>Redis还可以同时使用AOF持久化和RDB持久化。<br>在这种情况下，当 Redis重启时，它会优先使用AOF文件来还原数据集，因为AOF文件保存的数据集通常比RDB文件所保存的数据集更完整。</p><h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><h3 id="RDB："><a href="#RDB：" class="headerlink" title="RDB："></a>RDB：</h3><ul><li>优点<ul><li>独立紧凑的数据文件，适用于备份和灾难恢复；</li><li>RDB在恢复大数据集时的速度比AOF的恢复速度要快。</li></ul></li><li>缺点<ul><li>服务器故障是可能丢失一个保存时间间隔的数据；</li></ul></li></ul><h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF:"></a>AOF:</h3><ul><li>优点<ul><li>AOF 的默认策略为每秒钟fsync一次，在这种配置下，Redis 仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据</li></ul></li><li>缺点:<ul><li>对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积。</li><li>根据所使用的fsync策略，AOF的速度可能会慢于RDB。</li></ul></li></ul><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="开启RDB"><a href="#开启RDB" class="headerlink" title="开启RDB"></a>开启RDB</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1            #在900秒(15分钟)内，如果至少有1个key发生变化，则dump内存快照。 </span><br><span class="line">save 300 10           #在300秒(5分钟)内，如果至少有10个key发生变化，则dump内存快照。 </span><br><span class="line">save 60 10000         #在60秒(1分钟)内，如果至少有10000个key发生变化，则dump内存快照。</span><br></pre></td></tr></table></figure><h3 id="关闭-RDB"><a href="#关闭-RDB" class="headerlink" title="关闭 RDB"></a>关闭 RDB</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config set save &quot;&quot;</span><br></pre></td></tr></table></figure><ul><li>或者变更配置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># save 900 1</span><br><span class="line"># save 300 10</span><br><span class="line"># save 60 10000</span><br></pre></td></tr></table></figure><h3 id="开启-AOF"><a href="#开启-AOF" class="headerlink" title="开启 AOF"></a>开启 AOF</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config set appendonly yes</span><br><span class="line">redis-cli config appendfsync always      #每次有数据修改发生时都会写入AOF文件。 </span><br><span class="line">或者</span><br><span class="line">redis-cli config appendfsync everysec   #每秒钟同步一次，该策略为AOF的缺省策略。</span><br></pre></td></tr></table></figure><h3 id="关闭AOF"><a href="#关闭AOF" class="headerlink" title="关闭AOF"></a>关闭AOF</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config set appendonly no</span><br><span class="line">appendfsync no           #从不同步。高效但是数据不会被持久化。</span><br></pre></td></tr></table></figure><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="http://redisdoc.com/topic/persistence.html" target="_blank" rel="noopener">redis持久化</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2018/03/15/00030_redis数据结构/">redis数据结构</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存也可以持久化的日志型、Key-Value数据库。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="redis" scheme="https://www.lengyuewusheng.com/categories/redis/"/>
    
    
      <category term="redis" scheme="https://www.lengyuewusheng.com/tags/redis/"/>
    
      <category term="持久化" scheme="https://www.lengyuewusheng.com/tags/%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
      <category term="缓存" scheme="https://www.lengyuewusheng.com/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>TCP连接过程</title>
    <link href="https://www.lengyuewusheng.com/2018/03/29/00043_TCP%E8%BF%9E%E6%8E%A5%E8%BF%87%E7%A8%8B/"/>
    <id>https://www.lengyuewusheng.com/2018/03/29/00043_TCP连接过程/</id>
    <published>2018-03-29T15:03:09.000Z</published>
    <updated>2018-05-13T16:14:44.951Z</updated>
    
    <content type="html"><![CDATA[<p>传输控制协议(TCP)是一种面向连接的、可靠的、基于字节流的传输层通信协议。</p><a id="more"></a><p><img src="https://www.lengyuewusheng.com/assets/images/00043-01.png" alt="TCP连接过程"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;传输控制协议(TCP)是一种面向连接的、可靠的、基于字节流的传输层通信协议。&lt;/p&gt;
    
    </summary>
    
      <category term="夯实基础" scheme="https://www.lengyuewusheng.com/categories/%E5%A4%AF%E5%AE%9E%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="tcp" scheme="https://www.lengyuewusheng.com/tags/tcp/"/>
    
      <category term="三次握手" scheme="https://www.lengyuewusheng.com/tags/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/"/>
    
      <category term="四次挥手" scheme="https://www.lengyuewusheng.com/tags/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/"/>
    
  </entry>
  
  <entry>
    <title>http协议头字段说明</title>
    <link href="https://www.lengyuewusheng.com/2018/03/28/00042_http%E5%8D%8F%E8%AE%AE%E5%A4%B4%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E/"/>
    <id>https://www.lengyuewusheng.com/2018/03/28/00042_http协议头字段说明/</id>
    <published>2018-03-28T14:56:06.000Z</published>
    <updated>2018-05-13T09:33:13.770Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>HTTP协议头字段定义了一个超文本传输协议事务中的操作参数。</p></blockquote><a id="more"></a><p>按照惯例，非标准的协议头字段是在字段名称前加上<code>X-</code>前缀来标识。</p><p>标准中没有对每个协议头字段的名称和值的大小设置任何限制，也没有限制字段的个数。在实际场景中出于安全性的考虑，大部分的服务器、客户端和代理软件都会实施一些限制。</p><h2 id="http请求字段"><a href="#http请求字段" class="headerlink" title="http请求字段"></a>http请求字段</h2><h3 id="请求字段"><a href="#请求字段" class="headerlink" title="请求字段"></a>请求字段</h3><table><thead><tr><th style="text-align:left">协议头字段名</th><th style="text-align:left">说明</th><th style="text-align:left">示例</th></tr></thead><tbody><tr><td style="text-align:left">Accept</td><td style="text-align:left">能够接受的回应内容类型(Content-Types)。</td><td style="text-align:left">Accept: text/plain</td></tr><tr><td style="text-align:left">Accept-Charset</td><td style="text-align:left">能够接受的字符集。</td><td style="text-align:left">Accept-Charset: utf-8</td></tr><tr><td style="text-align:left">Accept-Encoding</td><td style="text-align:left">能够接受的编码方式列表。</td><td style="text-align:left">Accept-Encoding: gzip, deflate</td></tr><tr><td style="text-align:left">Accept-Language</td><td style="text-align:left">能够接受的回应内容的自然语言列表。</td><td style="text-align:left">Accept-Language: en-US</td></tr><tr><td style="text-align:left">Accept-Datetime</td><td style="text-align:left">能够接受的按照时间来表示的版本。</td><td style="text-align:left">Accept-Datetime: Thu, 31 May 2007 20:35:00 GMT</td></tr><tr><td style="text-align:left">Authorization</td><td style="text-align:left">用于超文本传输协议的认证的认证信息。</td><td style="text-align:left">Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td style="text-align:left">Cache-Control</td><td style="text-align:left">用来指定在这次的请求/响应链中的所有缓存机制 都必须 遵守的指令。</td><td style="text-align:left">Cache-Control: no-cache</td></tr><tr><td style="text-align:left">Connection</td><td style="text-align:left">该浏览器想要优先使用的连接类型。</td><td style="text-align:left">Connection: keep-alive <br> Connection: Upgrade</td></tr><tr><td style="text-align:left">Cookie</td><td style="text-align:left">之前由服务器通过Set- Cookie发送的一个超文本传输协议Cookie。</td><td style="text-align:left">Cookie: $Version=1; Skin=new;</td></tr><tr><td style="text-align:left">Content-Length</td><td style="text-align:left">以八位字节数组(8位的字节)表示的请求体的长度。</td><td style="text-align:left">Content-Length: 348</td></tr><tr><td style="text-align:left">Content-MD5</td><td style="text-align:left">请求体的内容的二进制 MD5 散列值，以 Base64 编码的结果。</td><td style="text-align:left">Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td style="text-align:left">Content-Type</td><td style="text-align:left">请求体的多媒体类型(用于POST和PUT请求中)。</td><td style="text-align:left">Content-Type: application/x-www-form-urlencoded</td></tr><tr><td style="text-align:left">Date</td><td style="text-align:left">发送该消息的日期和时间(按照 RFC 7231 中定义的”超文本传输协议日期”格式来发送)。</td><td style="text-align:left">Date: Tue, 15 Nov 1994 08:12:31 GMT</td></tr><tr><td style="text-align:left">Expect</td><td style="text-align:left">表明客户端要求服务器做出特定的行为。</td><td style="text-align:left">Expect: 100-continue</td></tr><tr><td style="text-align:left">From</td><td style="text-align:left">发起此请求的用户的邮件地址。</td><td style="text-align:left">From: <a href="mailto:user@example.com" target="_blank" rel="noopener">user@example.com</a></td></tr><tr><td style="text-align:left">Host</td><td style="text-align:left">服务器的域名(用于虚拟主机)，以及服务器所监听的传输控制协议端口号。自HTTP/1.1开始成为必需字段。</td><td style="text-align:left">Host: lengyuewusheng.com:80 <br> Host: lengyuewusheng.com</td></tr><tr><td style="text-align:left">If-Match</td><td style="text-align:left">仅当客户端提供的实体与服务器上对应的实体相匹配时，才进行对应的操作。主要作用时，用作像 PUT 这样的方法中，仅当从用户上次更新某个资源以来，该资源未被修改的情况下，才更新该资源。</td><td style="text-align:left">If-Match: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td style="text-align:left">If-Modified-Since</td><td style="text-align:left">允许在对应的内容未被修改的情况下返回304未修改(304 Not Modified)。</td><td style="text-align:left">If-Modified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td style="text-align:left">If-None-Match</td><td style="text-align:left">允许在对应的内容未被修改的情况下返回304未修改(304 Not Modified)。</td><td style="text-align:left">If-None-Match: “a7dc0d7b8902e9c8c096c93eb431d19e”</td></tr><tr><td style="text-align:left">If-Range</td><td style="text-align:left">如果该实体未被修改过，则向我发送我所缺少的那一个或多个部分；否则，发送整个新的实体</td><td style="text-align:left">If-Range: “a7dc0d7b8902e9c8c096c93eb431d19e”</td></tr><tr><td style="text-align:left">If-Unmodified-Since</td><td style="text-align:left">仅当该实体自某个特定时间已来未被修改的情况下，才发送回应。</td><td style="text-align:left">If-Unmodified-Since: Sat, 29 Oct 1994 19:43:31 GMT</td></tr><tr><td style="text-align:left">Max-Forwards</td><td style="text-align:left">限制该消息可被代理及网关转发的次数。</td><td style="text-align:left">Max-Forwards: 10</td></tr><tr><td style="text-align:left">Origin</td><td style="text-align:left">发起一个针对跨来源资源共享的请求(要求服务器在回应中加入一个’访问控制-允许来源’(‘Access-Control-Allow-Origin’)字段)。</td><td style="text-align:left">Origin: <a href="http://www.example-social-network.com" target="_blank" rel="noopener">http://www.example-social-network.com</a></td></tr><tr><td style="text-align:left">Pragma</td><td style="text-align:left">报文指令，与具体的实现相关，这些字段可能在请求/回应链中的任何时候产生多种效果。不常用。</td><td style="text-align:left">Pragma: no-cache</td></tr><tr><td style="text-align:left">Proxy-Authorization</td><td style="text-align:left">用来向代理进行认证的认证信息。</td><td style="text-align:left">Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td style="text-align:left">Range</td><td style="text-align:left">仅请求某个实体的一部分。字节偏移以0开始。参见字节服务。</td><td style="text-align:left">Range: bytes=500-999</td></tr><tr><td style="text-align:left">Referer</td><td style="text-align:left">表示浏览器所访问的前一个页面，正是那个页面上的某个链接将浏览器带到了当前所请求的这个页面。</td><td style="text-align:left">Referer: <a href="https://www.lengyuewusheng.com">https://www.lengyuewusheng.com</a></td></tr><tr><td style="text-align:left">TE</td><td style="text-align:left">浏览器预期接受的传输编码方式：可使用回应协议头 Transfer-Encoding 字段中的值；另外还可用”trailers”(与”分块 “传输方式相关)这个值来表明浏览器希望在最后一个尺寸为0的块之后还接收到一些额外的字段。</td><td style="text-align:left">TE: trailers, deflate</td></tr><tr><td style="text-align:left">User-Agent</td><td style="text-align:left">浏览器的浏览器身份标识字符串。</td><td style="text-align:left">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36</td></tr><tr><td style="text-align:left">Upgrade</td><td style="text-align:left">要求服务器升级到另一个协议。</td><td style="text-align:left">Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td style="text-align:left">Via</td><td style="text-align:left">向服务器告知，这个请求是由哪些代理发出的。</td><td style="text-align:left">Via: 1.0 fred, 1.1 example.com (Apache/1.1)</td></tr><tr><td style="text-align:left">Warning</td><td style="text-align:left">一个一般性的警告，告知，在实体内容体中可能存在错误。</td><td style="text-align:left">Warning: 199 Miscellaneous warning</td></tr></tbody></table><h3 id="非标准请求字段"><a href="#非标准请求字段" class="headerlink" title="非标准请求字段"></a>非标准请求字段</h3><table><thead><tr><th style="text-align:left">协议头非标准字段名</th><th style="text-align:left">说明</th><th style="text-align:left">示例</th></tr></thead><tbody><tr><td style="text-align:left">X-Requested-With</td><td style="text-align:left">主要用于标识 Ajax 及可扩展标记语言 请求。大部分的JavaScript框架会发送这个字段，且将其值设置为 XMLHttpRequest。</td><td style="text-align:left">X-Requested-With: XMLHttpRequest</td></tr><tr><td style="text-align:left">DNT</td><td style="text-align:left">请求某个网页应用程序停止跟踪某个用户。在火狐浏览器中，相当于X-Do-Not-Track协议头字段(自 Firefox/4.0 Beta 11 版开始支持)。Safari和Internet Explorer 9也支持这个字段。</td><td style="text-align:left">启用：DNT: 1 <br> 禁用：DNT: 0</td></tr><tr><td style="text-align:left">X-Forwarded-For</td><td style="text-align:left">一个事实标准 ，用于标识某个通过超文本传输协议代理或负载均衡连接到某个网页服务器的客户端的原始互联网地址。</td><td style="text-align:left">X-Forwarded-For: client1, proxy1, proxy2 <br> X-Forwarded-For: 129.78.138.66, 129.78.64.103</td></tr><tr><td style="text-align:left">X-Forwarded-Host</td><td style="text-align:left">一个事实标准 ，用于识别客户端原本发出的 Host 请求头部。</td><td style="text-align:left">X-Forwarded-Host: lengyuewusheng.com:80 <br> X-Forwarded-Host: lengyuewusheng.com</td></tr><tr><td style="text-align:left">X-Forwarded-Proto</td><td style="text-align:left">一个事实标准，用于标识某个超文本传输协议请求最初所使用的协议。</td><td style="text-align:left">X-Forwarded-Proto: https</td></tr><tr><td style="text-align:left">Front-End-Https</td><td style="text-align:left">被微软的服务器和负载均衡器所使用的非标准头部字段。</td><td style="text-align:left">Front-End-Https: on</td></tr><tr><td style="text-align:left">X-Http-Method-Override</td><td style="text-align:left">请求某个网页应用程序使用该协议头字段中指定的方法(一般是PUT或DELETE)来覆盖掉在请求中所指定的方法(一般是POST)。当某个浏览器或防火墙阻止直接发送PUT 或DELETE 方法时，可使用这种方式。</td><td style="text-align:left">X-HTTP-Method-Override: DELETE</td></tr><tr><td style="text-align:left">X-ATT-DeviceId</td><td style="text-align:left">使服务器更容易解读AT&amp;T设备User-Agent字段中常见的设备型号、固件信息。</td><td style="text-align:left">X-Att-Deviceid: GT-P7320/P7320XXLPG</td></tr><tr><td style="text-align:left">X-Wap-Profile</td><td style="text-align:left">链接到互联网上的一个XML文件，其完整、仔细地描述了正在连接的设备。</td><td style="text-align:left">以为AT&amp;T Samsung Galaxy S2提供的XML文件为例：x-wap-profile: <a href="http://wap.samsungmobile.com/uaprof/SGH-I777.xml" target="_blank" rel="noopener">http://wap.samsungmobile.com/uaprof/SGH-I777.xml</a></td></tr><tr><td style="text-align:left">Proxy-Connection</td><td style="text-align:left">该字段源于早期超文本传输协议版本实现中的错误。与标准的连接(Connection)字段的功能完全相同。</td><td style="text-align:left">Proxy-Connection: keep-alive</td></tr><tr><td style="text-align:left">X-Csrf-Token</td><td style="text-align:left">用于防止 跨站请求伪造。辅助用的头部有 X-CSRFToken或 X-XSRF-TOKEN。</td><td style="text-align:left">X-Csrf-Token: i8XNjC4b8KVok4uw5RftR38Wgp2BFwql</td></tr></tbody></table><h2 id="http回应字段"><a href="#http回应字段" class="headerlink" title="http回应字段"></a>http回应字段</h2><h3 id="回应字段"><a href="#回应字段" class="headerlink" title="回应字段"></a>回应字段</h3><table><thead><tr><th style="text-align:left">协议头字段名</th><th style="text-align:left">说明</th><th style="text-align:left">示例</th></tr></thead><tbody><tr><td style="text-align:left">Access-Control-Allow-Origin</td><td style="text-align:left">指定哪些网站可参与到跨来源资源共享过程中。</td><td style="text-align:left">Access-Control-Allow-Origin: *</td></tr><tr><td style="text-align:left">Accept-Patch</td><td style="text-align:left">指定服务器支持的文件格式类型。</td><td style="text-align:left">Accept-Patch: text/example;charset=utf-8</td></tr><tr><td style="text-align:left">Accept-Ranges</td><td style="text-align:left">这个服务器支持哪些种类的部分内容范围。</td><td style="text-align:left">Accept-Ranges: bytes</td></tr><tr><td style="text-align:left">Age</td><td style="text-align:left">这个对象在代理缓存中存在的时间，以秒为单位。</td><td style="text-align:left">Age: 12</td></tr><tr><td style="text-align:left">Allow</td><td style="text-align:left">对于特定资源有效的动作。针对HTTP/405这一错误代码而使用。</td><td style="text-align:left">Allow: GET, HEAD</td></tr><tr><td style="text-align:left">Cache-Control</td><td style="text-align:left">向从服务器直到客户端在内的所有缓存机制告知，它们是否可以缓存这个对象。其单位为秒。</td><td style="text-align:left">Cache-Control: max-age=3600</td></tr><tr><td style="text-align:left">Connection</td><td style="text-align:left">针对该连接所预期的选项。</td><td style="text-align:left">Connection: close</td></tr><tr><td style="text-align:left">Content-Disposition</td><td style="text-align:left">一个可以让客户端下载文件并建议文件名的头部。文件名需要用双引号引起来。</td><td style="text-align:left">Content-Disposition: attachment; filename=”fname.ext”</td></tr><tr><td style="text-align:left">Content-Encoding</td><td style="text-align:left">在数据上使用的编码类型。</td><td style="text-align:left">Content-Encoding: gzip</td></tr><tr><td style="text-align:left">Content-Language</td><td style="text-align:left">内容所使用的语言。</td><td style="text-align:left">Content-Language: da</td></tr><tr><td style="text-align:left">Content-Length</td><td style="text-align:left">回应消息体的长度，以字节(8位为一字节)为单位。</td><td style="text-align:left">Content-Length: 348</td></tr><tr><td style="text-align:left">Content-Location</td><td style="text-align:left">所返回的数据的一个候选位置。</td><td style="text-align:left">Content-Location: /index.htm</td></tr><tr><td style="text-align:left">Content-MD5</td><td style="text-align:left">回应内容的二进制 MD5 散列，以 Base64 方式编码。</td><td style="text-align:left">Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td></tr><tr><td style="text-align:left">Content-Range</td><td style="text-align:left">这条部分消息是属于某条完整消息的哪个部分。</td><td style="text-align:left">Content-Range: bytes 21010-47021/47022</td></tr><tr><td style="text-align:left">Content-Type</td><td style="text-align:left">当前内容的MIME类型。</td><td style="text-align:left">Content-Type: text/html; charset=utf-8</td></tr><tr><td style="text-align:left">Date</td><td style="text-align:left">此条消息被发送时的日期和时间(按照 RFC 7231 中定义的“超文本传输协议日期”格式来表示)</td><td style="text-align:left">Date: Tue, 15 Nov 2017 08:12:31 GMT</td></tr><tr><td style="text-align:left">ETag</td><td style="text-align:left">对于某个资源的某个特定版本的一个标识符，通常是一个 消息散列。</td><td style="text-align:left">ETag: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td style="text-align:left">Expires</td><td style="text-align:left">指定一个日期/时间，超过该时间则认为此回应已经过期。</td><td style="text-align:left">Expires: Thu, 01 Dec 1994 16:00:00 GMT</td></tr><tr><td style="text-align:left">Last-Modified</td><td style="text-align:left">所请求的对象的最后修改日期(按照 RFC 7231 中定义的“超文本传输协议日期”格式来表示)</td><td style="text-align:left">Last-Modified: Tue, 15 Nov 1994 12:45:26 GMT</td></tr><tr><td style="text-align:left">Link</td><td style="text-align:left">用来表达与另一个资源之间的类型关系。</td><td style="text-align:left">Link: ; rel=”alternate”</td></tr><tr><td style="text-align:left">Location</td><td style="text-align:left">用来进行重定向，或者在创建了某个新资源时使用。</td><td style="text-align:left">Location: <a href="http://lengyuewusheng.com" target="_blank" rel="noopener">http://lengyuewusheng.com</a></td></tr><tr><td style="text-align:left">P3P</td><td style="text-align:left">用于支持设置P3P策略，标准格式为“P3P:CP=”your_compact_policy””。然而P3P规范并不成功，大部分现代浏览器没有完整实现该功能。</td><td style="text-align:left">P3P: CP=”This is not a P3P policy!”</td></tr><tr><td style="text-align:left">Pragma</td><td style="text-align:left">报文指令，与具体的实现相关，这些字段可能在请求/回应链中的任何时候产生多种效果。</td><td style="text-align:left">Pragma: no-cache</td></tr><tr><td style="text-align:left">Proxy-Authenticate</td><td style="text-align:left">要求在访问代理时提供身份认证信息。</td><td style="text-align:left">Proxy-Authenticate: Basic</td></tr><tr><td style="text-align:left">Public-Key-Pins</td><td style="text-align:left">用于缓解中间人攻击，声明网站认证使用的传输层安全协议证书的散列值。</td><td style="text-align:left">Public-Key-Pins: max-age=2592000; pin-sha256=”E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=”;</td></tr><tr><td style="text-align:left">Refresh</td><td style="text-align:left">用于设定可定时的重定向跳转。</td><td style="text-align:left">5秒后跳转，Refresh: 5; url=<a href="http://www.w3.org/pub/WWW/People.html" target="_blank" rel="noopener">http://www.w3.org/pub/WWW/People.html</a></td></tr><tr><td style="text-align:left">Retry-After</td><td style="text-align:left">如果某个实体临时不可用，则此协议头用来告知客户端日后重试。其值可以是一个特定的时间段(以秒为单位)或一个超文本传输协议日期。</td><td style="text-align:left">Example 1: Retry-After: 120 <br> Example 2: Retry-After: Fri, 07 Nov 2014 23:59:59 GMT</td></tr><tr><td style="text-align:left">Server</td><td style="text-align:left">服务器的名字。</td><td style="text-align:left">Server: Apache/2.4.1 (Unix)</td></tr><tr><td style="text-align:left">Set-Cookie</td><td style="text-align:left">HTTP cookie</td><td style="text-align:left">Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1</td></tr><tr><td style="text-align:left">Status</td><td style="text-align:left">通用网关接口 协议头字段，用来说明当前这个超文本传输协议回应的 状态 。</td><td style="text-align:left">Status: 200 OK</td></tr><tr><td style="text-align:left">Strict-Transport-Security</td><td style="text-align:left">HTTP严格传输安全这一头部告知客户端缓存这一强制 HTTPS 策略的时间，以及这一策略是否适用于其子域名。</td><td style="text-align:left">Strict-Transport-Security: max-age=16070400; includeSubDomains</td></tr><tr><td style="text-align:left">Trailer</td><td style="text-align:left">这个头部数值指示了在这一系列头部信息由由分块传输编码编码。</td><td style="text-align:left">Trailer: Max-Forwards</td></tr><tr><td style="text-align:left">Transfer-Encoding</td><td style="text-align:left">用来将实体安全地传输给用户的编码形式。当前定义的方法包括：分块（chunked）、compress、deflate、gzip和identity。</td><td style="text-align:left">Transfer-Encoding: chunked</td></tr><tr><td style="text-align:left">Upgrade</td><td style="text-align:left">要求客户端升级到另一个协议。</td><td style="text-align:left">Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td style="text-align:left">Vary</td><td style="text-align:left">告知下游的代理服务器，应当如何对未来的请求协议头进行匹配，以决定是否可使用已缓存的回应内容而不是重新从原始服务器请求新的内容。</td><td style="text-align:left">Vary: *</td></tr><tr><td style="text-align:left">Via</td><td style="text-align:left">告知代理服务器的客户端，当前回应是通过什么途径发送的。</td><td style="text-align:left">Via: 1.0 fred, 1.1 example.com (Apache/1.1)</td></tr><tr><td style="text-align:left">Warning</td><td style="text-align:left">一般性的警告，告知在实体内容体中可能存在错误。</td><td style="text-align:left">Warning: 199 Miscellaneous warning</td></tr><tr><td style="text-align:left">WWW-Authenticate</td><td style="text-align:left">表明在请求获取这个实体时应当使用的认证模式。</td><td style="text-align:left">WWW-Authenticate: Basic</td></tr><tr><td style="text-align:left">X-Frame-Options</td><td style="text-align:left">点击劫持保护： <br> deny：该页面不允许在 frame 中展示，即使是同域名内； <br> sameorigin：该页面允许同域名内在 frame 中展示。 <br> allow-from uri：该页面允许在指定uri的 frame 中展示。 <br> allowall：允许任意位置的frame显示，非标准值。</td><td style="text-align:left">X-Frame-Options: deny</td></tr></tbody></table><h3 id="非标准回应字段"><a href="#非标准回应字段" class="headerlink" title="非标准回应字段"></a>非标准回应字段</h3><table><thead><tr><th style="text-align:left">协议头字段名</th><th style="text-align:left">说明</th><th style="text-align:left">示例</th></tr></thead><tbody><tr><td style="text-align:left">X-XSS-Protection</td><td style="text-align:left">跨站脚本攻击(XSS)过滤器。</td><td style="text-align:left">X-XSS-Protection: 1; mode=block</td></tr><tr><td style="text-align:left">Content-Security-Policy, X-Content-Security-Policy, X-WebKit-CSP</td><td style="text-align:left">内容安全策略定义。</td><td style="text-align:left">X-WebKit-CSP: default-src ‘self’</td></tr><tr><td style="text-align:left">X-Content-Type-Options</td><td style="text-align:left">唯一允许的数值为”nosniff”，防止 Internet Explorer 对文件进行MIME类型嗅探。这也对 Google Chrome 下载扩展时适用。</td><td style="text-align:left">X-Content-Type-Options: nosniff</td></tr><tr><td style="text-align:left">X-Powered-By</td><td style="text-align:left">表明用于支持当前网页应用程序的技术。</td><td style="text-align:left">(例如：PHP)(版本号细节通常放置在X-Runtime或X-Version中) X-Powered-By: PHP/7.1.0</td></tr><tr><td style="text-align:left">X-UA-Compatible</td><td style="text-align:left">推荐指定的渲染引擎(通常是向后兼容模式)来显示内容。也用于激活Internet Explorer中的 Chrome Frame。</td><td style="text-align:left">X-UA-Compatible: IE=EmulateIE7 <br> X-UA-Compatible: IE=edge <br> X-UA-Compatible: Chrome=1</td></tr><tr><td style="text-align:left">X-Content-Duration</td><td style="text-align:left">指出音视频的长度，单位为秒。只受Gecko内核浏览器支持。</td><td style="text-align:left">X-Content-Duration: 42.666</td></tr></tbody></table><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/HTTP头字段" target="_blank" rel="noopener">wikipedia·http头字段</a></li><li><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/HTTP.md#%E5%9B%9Bhttp-%E9%A6%96%E9%83%A8" target="_blank" rel="noopener">http首部</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/09/00013_http不同版本及特性概括/">http不同版本及特性概括</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/13/00028_HTTP协议中的8种请求方法/">HTTP协议中的8种请求方法</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/26/00040_http请求常见状态码及解释/">http请求常见状态码及解释</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/13/00028_HTTP协议中的8种请求方法/">HTTP协议中的8种请求方法</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/16/00031_七层网络协议/">七层网络协议</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;HTTP协议头字段定义了一个超文本传输协议事务中的操作参数。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="夯实基础" scheme="https://www.lengyuewusheng.com/categories/%E5%A4%AF%E5%AE%9E%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="http" scheme="https://www.lengyuewusheng.com/tags/http/"/>
    
      <category term="协议" scheme="https://www.lengyuewusheng.com/tags/%E5%8D%8F%E8%AE%AE/"/>
    
  </entry>
  
  <entry>
    <title>RAID技术总结</title>
    <link href="https://www.lengyuewusheng.com/2018/03/27/00041_RAID%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/"/>
    <id>https://www.lengyuewusheng.com/2018/03/27/00041_RAID技术总结/</id>
    <published>2018-03-27T15:02:12.000Z</published>
    <updated>2018-05-12T18:13:16.015Z</updated>
    
    <content type="html"><![CDATA[<p>独立硬盘冗余阵列(RAID, Redundant Array of Independent Disks),简称磁盘阵列。简单来说，RAID把多个硬盘组合成为一个逻辑扇区，因此，操作系统只会把它当作一个硬盘。</p><a id="more"></a><style> table th:nth-of-type(7){width: 30%;} nth-of-type(8){width: 20%;} </style><h2 id="磁盘阵列比较表"><a href="#磁盘阵列比较表" class="headerlink" title="磁盘阵列比较表"></a>磁盘阵列比较表</h2><table><thead><tr><th style="text-align:left">RAID档次</th><th style="text-align:left">最少硬盘</th><th style="text-align:left">最大容错</th><th style="text-align:left">磁盘利用率</th><th style="text-align:left">读取性能</th><th style="text-align:left">写入性能</th><th style="text-align:left">安全性</th><th style="text-align:left">目的</th><th style="text-align:left">应用产业</th></tr></thead><tbody><tr><td style="text-align:left">0</td><td style="text-align:left">2</td><td style="text-align:left">0</td><td style="text-align:left">100%</td><td style="text-align:left">n</td><td style="text-align:left">n</td><td style="text-align:left">一个硬盘异常，全部硬盘都会异常</td><td style="text-align:left">追求最大容量、速度</td><td style="text-align:left">视频剪接缓存用途</td></tr><tr><td style="text-align:left">1</td><td style="text-align:left">2</td><td style="text-align:left">n-1</td><td style="text-align:left">1/n</td><td style="text-align:left">n</td><td style="text-align:left">1</td><td style="text-align:left">最高，一个正常即可</td><td style="text-align:left">追求最大安全性</td><td style="text-align:left">个人、企业备份</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left">3</td><td style="text-align:left">1</td><td style="text-align:left">(n-1)/n</td><td style="text-align:left">n-1</td><td style="text-align:left">n-1</td><td style="text-align:left">高</td><td style="text-align:left">追求最大容量、最小预算</td><td style="text-align:left">个人、企业备份</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left">4</td><td style="text-align:left">2</td><td style="text-align:left">(n-2)/n</td><td style="text-align:left">n-2</td><td style="text-align:left">n-2</td><td style="text-align:left">安全性较RAID 5高</td><td style="text-align:left">同RAID 5，但较安全</td><td style="text-align:left">个人、企业备份</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left">4</td><td style="text-align:left">n/2</td><td style="text-align:left">50%</td><td style="text-align:left">n/2</td><td style="text-align:left">n/2</td><td style="text-align:left">安全性高，但在同一个子组群中不能出现两颗毁损硬盘</td><td style="text-align:left">综合RAID 0/1优点，理论速度较快</td><td style="text-align:left">大型数据库、服务器</td></tr><tr><td style="text-align:left">50</td><td style="text-align:left">6</td><td style="text-align:left">n/m</td><td style="text-align:left">1-1/m</td><td style="text-align:left">n-n/m</td><td style="text-align:left">n-n/m</td><td style="text-align:left">安全性高，但在同一个子组群中不能出现两颗毁损硬盘</td><td style="text-align:left">高可靠性、高读取速度</td><td style="text-align:left">事务处理</td></tr></tbody></table><ul><li>n代表硬盘总数</li><li>m 代表 RAID 5 的组盘数量</li></ul><h2 id="特点总结"><a href="#特点总结" class="headerlink" title="特点总结"></a>特点总结</h2><ul><li>读写性能最高：RAID 0</li><li>磁盘利用率最低：RAID 1 (1/n)</li><li>可靠性最高：RAID 1</li></ul><h2 id="常见RAID级别"><a href="#常见RAID级别" class="headerlink" title="常见RAID级别"></a>常见RAID级别</h2><h3 id="RAID-0"><a href="#RAID-0" class="headerlink" title="RAID 0"></a>RAID 0</h3><p>RAID 0亦称为带区集。它将两个以上的磁盘并联起来，成为一个大容量的磁盘。</p><ul><li>读写速度最快：因为读写时都可以并行处理，所以在所有的级别中，RAID 0的速度是最快的；</li><li>无冗余无容错：RAID 0既没有冗余功能，也不具备容错能力，如果一个磁盘（物理）损坏，所有数据都会丢失。</li></ul><h3 id="RAID-1"><a href="#RAID-1" class="headerlink" title="RAID 1"></a>RAID 1</h3><p>两组以上的N个磁盘相互作镜像。在主硬盘上存放数据的同时也在镜像硬盘上写一样的数据。当主硬盘（物理）损坏时，镜像硬盘则代替主硬盘的工作。</p><ul><li>读写速度：在一些多线程操作系统中能有很好的读取速度，理论上读取速度等于硬盘数量的倍数，与RAID 0相同。写入速度有微小的降低；</li><li>可靠性最高：只要一个磁盘正常即可维持运作；</li><li>数据完全性最好：因为有镜像硬盘做数据备份；</li><li>磁盘利用率最低：无论用多少磁盘做RAID 1，仅算一个磁盘的容量；</li><li>不同大小磁盘的情况：如果用两个不同大小的磁盘建RAID 1，可用空间为较小的那个磁盘，较大的磁盘多出来的空间也可以分区成一个区来使用，不会造成浪费。</li></ul><h2 id="RAID-5"><a href="#RAID-5" class="headerlink" title="RAID 5"></a>RAID 5</h2><p>RAID 5是一种储存性能、数据安全和存储成本兼顾的存储解决方案。它使用的是Disk Striping（硬盘分区）技术。RAID 5可以理解为是RAID 0和RAID 1的折衷方案。</p><ul><li>RAID 5至少需要三个硬盘，RAID 5不是对存储的数据进行备份，而是把数据和相对应的奇偶校验信息分别存储于不同的磁盘上；</li><li>可靠性：数据保障程度要比RAID 1低；</li><li>读写速度：RAID 5具有和RAID 0相近似的数据读取速度，由于多一个奇偶校验信息，写入数据的速度相对单独写入一块硬盘的速度略慢，使用“回写缓存”可以让性能改善；</li><li>磁盘利用率：RAID 5的磁盘空间利用率要比RAID 1高。因为多个数据对应一个奇偶校验信息；</li><li>RAID 5最多支持坏一块盘。</li></ul><h3 id="RAID-6"><a href="#RAID-6" class="headerlink" title="RAID 6"></a>RAID 6</h3><p>与RAID 5相比，RAID 6增加第二个独立的奇偶校验信息块。两个独立的奇偶系统使用不同的算法。</p><ul><li>RAID 6必须具备四个以上的磁盘才能生效。</li><li>数据的可靠性：非常高，任意两块磁盘同时失效时不会影响数据完整性。</li><li>通常通过硬件方式实现：RAID 6需要分配给奇偶校验信息更大的磁盘空间和额外的校验计算，相对于RAID 5有更大的IO操作量和计算量，因此其“写性能”强烈取决于具体的实现方案。</li><li>磁盘利用率：可使用的容量为硬盘总数减去2的差，乘以最小容量。</li><li>最多容许两个磁盘损坏。</li></ul><h3 id="RAID-10-01"><a href="#RAID-10-01" class="headerlink" title="RAID 10/01"></a>RAID 10/01</h3><p>RAID 10是先镜像再分区数据，再将所有硬盘分为两组，视为是RAID 0的最低组合，然后将这两组各自视为RAID 1运作。</p><p>RAID 01则是先分区再将数据镜像到两组硬盘。它将所有的硬盘分为两组，变成RAID 1的最低组合，并将两组硬盘各自视为RAID 0运作。</p><ul><li>RAID 10有一个硬盘受损，其余硬盘会继续运作。</li><li>RAID 01只要有一个硬盘受损，同组RAID 0的所有硬盘都会停止运作，只剩下其他组的硬盘运作，可靠性较低。如果以六块硬盘建RAID 01，镜像后再用三块盘建RAID 0，那么坏一块硬盘便会有三个硬盘离线。</li><li>RAID 10远较RAID 01常用。</li></ul><h3 id="RAID-50"><a href="#RAID-50" class="headerlink" title="RAID 50"></a>RAID 50</h3><p>RAID 5与RAID 0的组合，先作RAID 5，再作RAID 0，也就是对多组RAID 5彼此构成Stripe访问。以RAID 50最小的6颗硬盘配置为例，先把6颗硬盘分为2组，每组3颗构成RAID 5，如此就得到两组RAID 5，然后再把两组RAID 5构成RAID 0。</p><ul><li>RAID 50，至少需要6颗硬盘；</li><li>数据可靠性：RAID 50在底层的任一组或多组RAID 5中出现1颗硬盘损坏时，仍能维持运作，不过如果任一组RAID 5中出现2颗或2颗以上硬盘损毁，整组RAID 50就会失效；</li><li>读写性能：RAID 50由于在上层把多组RAID 5构成Stripe，性能比起单纯的RAID 5高；</li><li>磁盘利用率：((n-m)/n)，比RAID5((n-1)/n)要低。</li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/RAID" target="_blank" rel="noopener">wikipedia·RAID</a></li><li><a href="https://baike.baidu.com/item/RAID%2050?fromtitle=raid50&amp;fromid=8245636" target="_blank" rel="noopener">百度百科·RAID50</a></li><li><a href="http://www.hack520.com/169.html" target="_blank" rel="noopener">RAID技术全解</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;独立硬盘冗余阵列(RAID, Redundant Array of Independent Disks),简称磁盘阵列。简单来说，RAID把多个硬盘组合成为一个逻辑扇区，因此，操作系统只会把它当作一个硬盘。&lt;/p&gt;
    
    </summary>
    
      <category term="夯实基础" scheme="https://www.lengyuewusheng.com/categories/%E5%A4%AF%E5%AE%9E%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="RAID" scheme="https://www.lengyuewusheng.com/tags/RAID/"/>
    
      <category term="磁盘阵列" scheme="https://www.lengyuewusheng.com/tags/%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97/"/>
    
      <category term="高可用" scheme="https://www.lengyuewusheng.com/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>http请求常见状态码及解释</title>
    <link href="https://www.lengyuewusheng.com/2018/03/26/00040_http%E8%AF%B7%E6%B1%82%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E7%A0%81%E5%8F%8A%E8%A7%A3%E9%87%8A/"/>
    <id>https://www.lengyuewusheng.com/2018/03/26/00040_http请求常见状态码及解释/</id>
    <published>2018-03-26T13:59:42.000Z</published>
    <updated>2018-05-12T18:13:16.005Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>在http请求中，服务器返回的响应报文的第一行包含了状态码以及原因短语，用来告知客户端请求的结果。</p></blockquote><a id="more"></a><style> table th:nth-of-type(1){width: 10%;} nth-of-type(2){width: 30%;} </style><h2 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h2><table><thead><tr><th style="text-align:left">状态码</th><th style="text-align:left">含义</th><th style="text-align:left">解释</th></tr></thead><tbody><tr><td style="text-align:left">1XX</td><td style="text-align:left">Informational（信息性状态码）</td><td style="text-align:left">接收的请求正在处理</td></tr><tr><td style="text-align:left">100</td><td style="text-align:left">Continue</td><td style="text-align:left">表明到目前为止都很正常，客户端可以继续发送请求或者忽略这个响应。</td></tr><tr><td style="text-align:left">101</td><td style="text-align:left">Switching Protocols</td><td style="text-align:left">切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，如，切换到HTTP的新版本协议。</td></tr><tr><td style="text-align:left">102</td><td style="text-align:left">Processing</td><td style="text-align:left">WebDAV请求可能包含许多涉及文件操作的子请求，需要很长时间才能完成请求。该代码表示​​服务器已经收到并正在处理请求，但无响应可用。这样可以防止客户端超时，并假设请求丢失。</td></tr><tr><td style="text-align:left">2XX</td><td style="text-align:left">Success（成功状态码）</td><td style="text-align:left">请求被成功接收并处理</td></tr><tr><td style="text-align:left">200</td><td style="text-align:left">OK</td><td style="text-align:left">请求已成功，请求所希望的响应头或数据体将随此响应返回。实际的响应将取决于所使用的请求方法。在GET请求中，响应将包含与请求的资源相对应的实体。在POST请求中，响应将包含描述或操作结果的实体。</td></tr><tr><td style="text-align:left">201</td><td style="text-align:left">Created</td><td style="text-align:left">已创建。成功请求并创建了新的资源。</td></tr><tr><td style="text-align:left">202</td><td style="text-align:left">Accepted</td><td style="text-align:left">已接受。已经接受请求，但未处理完成。</td></tr><tr><td style="text-align:left">203</td><td style="text-align:left">Non-Authoritative Information</td><td style="text-align:left">非授权信息。请求成功。但返回的Meta信息不在原始的服务器，而是一个副本。</td></tr><tr><td style="text-align:left">204</td><td style="text-align:left">No Content</td><td style="text-align:left">请求已经成功处理，但未返回内容，即返回的响应报文不包含实体的主体部分。一般在只需要从客户端往服务器发送信息，而不需要返回数据时使用。</td></tr><tr><td style="text-align:left">205</td><td style="text-align:left">Reset Content</td><td style="text-align:left">重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域。</td></tr><tr><td style="text-align:left">206</td><td style="text-align:left">Partial Content</td><td style="text-align:left">部分内容，表示客户端进行了范围请求。服务器成功处理了部分GET请求，响应报文包含由 Content-Range 指定范围的实体内容。</td></tr><tr><td style="text-align:left">207</td><td style="text-align:left">Multi-Status（WebDAV；RFC 4918）</td><td style="text-align:left">代表之后的消息体将是一个XML消息，并且可能依照之前子请求数量的不同，包含一系列独立的响应代码。</td></tr><tr><td style="text-align:left">208</td><td style="text-align:left">Already Reported （WebDAV；RFC 5842）</td><td style="text-align:left">DAV绑定的成员已经在（多状态）响应之前的部分被列举，且未被再次包含。</td></tr><tr><td style="text-align:left">226</td><td style="text-align:left">IM Used （RFC 3229）</td><td style="text-align:left">服务器已经满足了对资源的请求，对实体请求的一个或多个实体操作的结果表示。</td></tr><tr><td style="text-align:left">3XX</td><td style="text-align:left">Redirection（重定向状态码）</td><td style="text-align:left">重定向，需要进一步的操作以完成请求</td></tr><tr><td style="text-align:left">300</td><td style="text-align:left">Multiple Choices</td><td style="text-align:left">多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择。</td></tr><tr><td style="text-align:left">301</td><td style="text-align:left">Moved Permanently</td><td style="text-align:left">永久性重定向。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替。</td></tr><tr><td style="text-align:left">302</td><td style="text-align:left">Found</td><td style="text-align:left">临时性重定向。与301类似。但资源只是临时被移动。客户端应继续使用原有URI。</td></tr><tr><td style="text-align:left">303</td><td style="text-align:left">See Other</td><td style="text-align:left">查看其它地址。和302有着相同的功能，但是303明确要求客户端应该采用GET方法获取资源。</td></tr><tr><td style="text-align:left">304</td><td style="text-align:left">Not Modified</td><td style="text-align:left">未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源。</td></tr><tr><td style="text-align:left">305</td><td style="text-align:left">Use Proxy</td><td style="text-align:left">使用代理。所请求的资源必须通过代理访问。</td></tr><tr><td style="text-align:left">306</td><td style="text-align:left">Unused</td><td style="text-align:left">已经被废弃的HTTP状态码。</td></tr><tr><td style="text-align:left">307</td><td style="text-align:left">Temporary Redirect</td><td style="text-align:left">临时重定向。与302类似。但是307要求浏览器不会把重定向请求的POST方法改成GET方法。</td></tr><tr><td style="text-align:left">308</td><td style="text-align:left">Permanent Redirect (RFC 7538)</td><td style="text-align:left">请求和所有将来的请求应该使用另一个URI重复。 307和308重复302和301的行为，但不允许HTTP方法更改。 例如，将表单提交给永久重定向的资源可能会顺利进行。</td></tr><tr><td style="text-align:left">4XX</td><td style="text-align:left">Client Error（客户端错误状态码）</td><td style="text-align:left">服务器无法处理请求</td></tr><tr><td style="text-align:left">400</td><td style="text-align:left">Bad Request</td><td style="text-align:left">请求报文中存在语法错误，服务器无法理解。</td></tr><tr><td style="text-align:left">401</td><td style="text-align:left">Unauthorized</td><td style="text-align:left">该状态码表示发送的请求需要有认证信息（BASIC 认证、DIGEST 认证）。如果之前已进行过一次请求，则表示用户认证失败。</td></tr><tr><td style="text-align:left">402</td><td style="text-align:left">Payment Required</td><td style="text-align:left">保留，将来使用。</td></tr><tr><td style="text-align:left">403</td><td style="text-align:left">Forbidden</td><td style="text-align:left">服务器理解请求客户端的请求，但是拒绝执行此请求。服务器端没有必要给出拒绝的详细理由。</td></tr><tr><td style="text-align:left">404</td><td style="text-align:left">Not Found</td><td style="text-align:left">服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置”您所请求的资源无法找到”的个性页面。</td></tr><tr><td style="text-align:left">405</td><td style="text-align:left">Method Not Allowed</td><td style="text-align:left">客户端请求中的方法被禁止。</td></tr><tr><td style="text-align:left">406</td><td style="text-align:left">Not Acceptable</td><td style="text-align:left">服务器无法根据客户端请求的内容特性完成请求。</td></tr><tr><td style="text-align:left">407</td><td style="text-align:left">Proxy Authentication Required</td><td style="text-align:left">请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权。</td></tr><tr><td style="text-align:left">408</td><td style="text-align:left">Request Time-out</td><td style="text-align:left">服务器等待客户端发送的请求时间过长，超时。</td></tr><tr><td style="text-align:left">409</td><td style="text-align:left">Conflict</td><td style="text-align:left">服务器完成客户端的PUT请求是可能返回此代码，服务器处理请求时发生了冲突。</td></tr><tr><td style="text-align:left">410</td><td style="text-align:left">Gone</td><td style="text-align:left">客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置。</td></tr><tr><td style="text-align:left">411</td><td style="text-align:left">Length Required</td><td style="text-align:left">服务器无法处理客户端发送的不带Content-Length的请求信息。</td></tr><tr><td style="text-align:left">412</td><td style="text-align:left">Precondition Failed</td><td style="text-align:left">客户端请求信息的先决条件错误。</td></tr><tr><td style="text-align:left">413</td><td style="text-align:left">Request Entity Too Large</td><td style="text-align:left">由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息。</td></tr><tr><td style="text-align:left">414</td><td style="text-align:left">Request-URI Too Large</td><td style="text-align:left">请求的URI过长（URI通常为网址），服务器无法处理。</td></tr><tr><td style="text-align:left">415</td><td style="text-align:left">Unsupported Media Type</td><td style="text-align:left">服务器无法处理请求附带的媒体格式。</td></tr><tr><td style="text-align:left">416</td><td style="text-align:left">Requested range not satisfiable</td><td style="text-align:left">客户端请求的范围无效。</td></tr><tr><td style="text-align:left">417</td><td style="text-align:left">Expectation Failed</td><td style="text-align:left">服务器无法满足Expect的请求头信息。</td></tr><tr><td style="text-align:left">421</td><td style="text-align:left">Misdirected Request （RFC 7540）</td><td style="text-align:left">该请求针对的是无法产生响应的服务器（例如因为连接重用）。</td></tr><tr><td style="text-align:left">422</td><td style="text-align:left">Unprocessable Entity（WebDAV；RFC 4918 ）</td><td style="text-align:left">请求格式正确，但是由于含有语义错误，无法响应。</td></tr><tr><td style="text-align:left">423</td><td style="text-align:left">Locked（WebDAV；RFC 4918）</td><td style="text-align:left">当前资源被锁定。</td></tr><tr><td style="text-align:left">424</td><td style="text-align:left">Failed Dependency（WebDAV；RFC 4918）</td><td style="text-align:left">由于之前的某个请求发生的错误，导致当前请求失败，例如PROPPATCH。</td></tr><tr><td style="text-align:left">426</td><td style="text-align:left">Upgrade Required（RFC 2817）</td><td style="text-align:left">客户端应当切换到TLS/1.0，并在HTTP/1.1 Upgrade header中给出。</td></tr><tr><td style="text-align:left">428</td><td style="text-align:left">Precondition Required (RFC 6585)</td><td style="text-align:left">原服务器要求该请求满足一定条件。这是为了防止‘未更新’问题，即客户端读取（GET）一个资源的状态，更改它，并将它写（PUT）回服务器，但这期间第三方已经在服务器上更改了该资源的状态，因此导致了冲突。</td></tr><tr><td style="text-align:left">429</td><td style="text-align:left">Too Many Requests （RFC 6585）</td><td style="text-align:left">用户在给定的时间内发送了太多的请求。旨在用于网络限速。</td></tr><tr><td style="text-align:left">431</td><td style="text-align:left">Request Header Fields Too Large （RFC 6585）</td><td style="text-align:left">服务器不愿处理请求，因为一个或多个头字段过大。</td></tr><tr><td style="text-align:left">444</td><td style="text-align:left">No Response</td><td style="text-align:left">Nginx上HTTP服务器扩展。服务器不向客户端返回任何信息，并关闭连接（有助于阻止恶意软件）。</td></tr><tr><td style="text-align:left">450</td><td style="text-align:left">Blocked by Windows Parental Controls</td><td style="text-align:left">这是一个由Windows家庭控制（Microsoft）HTTP阻止的450状态代码的示例，用于信息和测试。</td></tr><tr><td style="text-align:left">451</td><td style="text-align:left">Unavailable For Legal Reasons</td><td style="text-align:left">该访问因法律的要求而被拒绝，由IETF在2015核准后新增加。</td></tr><tr><td style="text-align:left">494</td><td style="text-align:left">Request Header Too Large</td><td style="text-align:left">在错误代码431提出之前Nginx上使用的扩展HTTP代码。</td></tr><tr><td style="text-align:left">499</td><td style="text-align:left">Client has Closed Connection</td><td style="text-align:left">客户端已经断开链接。可能是客户端主动断开，也有可能是超时断开。</td></tr><tr><td style="text-align:left">5XX</td><td style="text-align:left">Server Error（服务器错误状态码）</td><td style="text-align:left">服务器处理请求出错</td></tr><tr><td style="text-align:left">500</td><td style="text-align:left">Internal Server Error</td><td style="text-align:left">服务器内部错误，无法完成请求。</td></tr><tr><td style="text-align:left">501</td><td style="text-align:left">Not Implemented</td><td style="text-align:left">服务器不支持请求的功能，无法完成请求。通常出现在nginx没有定义对应的server配置时出现。</td></tr><tr><td style="text-align:left">502</td><td style="text-align:left">Bad Gateway</td><td style="text-align:left">充当网关或代理的服务器，从远端服务器接收到了一个无效的请求。</td></tr><tr><td style="text-align:left">503</td><td style="text-align:left">Service Unavailable</td><td style="text-align:left">服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。延时的长度可包含在服务器的Retry-After头信息中。</td></tr><tr><td style="text-align:left">504</td><td style="text-align:left">Gateway Time-out</td><td style="text-align:left">充当网关或代理的服务器，未及时从远端服务器获取请求。</td></tr><tr><td style="text-align:left">505</td><td style="text-align:left">HTTP Version not supported</td><td style="text-align:left">服务器不支持请求的HTTP协议的版本，无法完成处理。</td></tr><tr><td style="text-align:left">506</td><td style="text-align:left">Variant Also Negotiates（RFC 2295）</td><td style="text-align:left">由《透明内容协商协议》（RFC 2295）扩展，代表服务器存在内部配置错误，被请求的协商变元资源被配置为在透明内容协商中使用自己，因此在一个协商处理中不是一个合适的重点。</td></tr><tr><td style="text-align:left">507</td><td style="text-align:left">Insufficient Storage（WebDAV；RFC 4918）</td><td style="text-align:left">服务器无法存储完成请求所必须的内容。这个状况被认为是临时的。</td></tr><tr><td style="text-align:left">508</td><td style="text-align:left">Loop Detected （WebDAV；RFC 5842）</td><td style="text-align:left">服务器在处理请求时陷入死循环。（可代替 208状态码）</td></tr><tr><td style="text-align:left">510</td><td style="text-align:left">Not Extended（RFC 2774）</td><td style="text-align:left">获取资源所需要的策略并没有被满足。</td></tr><tr><td style="text-align:left">511</td><td style="text-align:left">Network Authentication Required （RFC 6585）</td><td style="text-align:left">客户端需要进行身份验证才能获得网络访问权限，旨在限制用户群访问特定网络。（例如连接WiFi热点时的强制网络门户）</td></tr></tbody></table><ul><li>虽然 HTTP 协议规定 301、302 状态下重定向时不允许把 POST 方法改成 GET 方法，但是大多数浏览器都会在 301、302 和 303 状态下的重定向把 POST 方法改成 GET 方法。</li><li>WebDAV是基于Web的分布式编写和版本控制，是超文本传输协议（HTTP）的扩展。有利于用户间协同编辑和管理存储在万维网服务器文档。许多现代操作系统为WebDAV提供了内置的客户端支持。</li></ul><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://zh.wikipedia.org/wiki/HTTP状态码" target="_blank" rel="noopener">WikiPedia·http状态码</a></li><li><a href="http://www.runoob.com/http/http-status-codes.html" target="_blank" rel="noopener">菜鸟教程·http状态码</a></li><li><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/HTTP.md#%E4%B8%89http-%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener">Interview-Notebook</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/09/00013_http不同版本及特性概括/">http不同版本及特性概括</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/13/00028_HTTP协议中的8种请求方法/">HTTP协议中的8种请求方法</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/28/00042_http协议头字段说明/">http协议头字段说明</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/13/00028_HTTP协议中的8种请求方法/">HTTP协议中的8种请求方法</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/16/00031_七层网络协议/">七层网络协议</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;在http请求中，服务器返回的响应报文的第一行包含了状态码以及原因短语，用来告知客户端请求的结果。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="夯实基础" scheme="https://www.lengyuewusheng.com/categories/%E5%A4%AF%E5%AE%9E%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="http" scheme="https://www.lengyuewusheng.com/tags/http/"/>
    
      <category term="协议" scheme="https://www.lengyuewusheng.com/tags/%E5%8D%8F%E8%AE%AE/"/>
    
      <category term="状态码" scheme="https://www.lengyuewusheng.com/tags/%E7%8A%B6%E6%80%81%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>通过Zabbix API在告警邮件中插入趋势图</title>
    <link href="https://www.lengyuewusheng.com/2018/03/25/00039_Zabbix%E5%91%8A%E8%AD%A6%E9%82%AE%E4%BB%B6%E4%B8%AD%E6%8F%92%E5%85%A5%E8%B6%8B%E5%8A%BF%E5%9B%BE/"/>
    <id>https://www.lengyuewusheng.com/2018/03/25/00039_Zabbix告警邮件中插入趋势图/</id>
    <published>2018-03-25T13:18:36.000Z</published>
    <updated>2018-05-08T03:32:12.142Z</updated>
    
    <content type="html"><![CDATA[<p>告警邮件中嵌入趋势图是非常人性化的设计，只有有温度的告警邮件才会嵌入趋势图。。。</p><a id="more"></a><p>以下内容基于zabbix 3.0.2 测试有效，想必其它版本应该也问题不大。</p><p>话不多说，直接上代码：</p><h2 id="邮件告警脚本"><a href="#邮件告警脚本" class="headerlink" title="邮件告警脚本"></a>邮件告警脚本</h2><ul><li><p>cat mailAlarm.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Description: 获取某一个监控项在某个时间段的graph</span></span><br><span class="line"><span class="comment"># Date:        </span></span><br><span class="line"><span class="comment"># Author:      </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=========================================</span></span><br><span class="line">ALERT_SENDTO=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">ALERT_SUBJECT=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">ALERT_MESSAGE=<span class="string">"<span class="variable">$(echo -e "$3"|sed -e '$d' -e 's/$/&lt;br\/&gt;/g')</span>"</span></span><br><span class="line">ITEMID=<span class="string">"<span class="variable">$(echo -e "$3"|tail -n1|awk -F":" '&#123;print $2&#125;'|sed s/[[:space:]]//g)</span>"</span></span><br><span class="line">USERNAME=<span class="string">"<span class="variable">$4</span>"</span></span><br><span class="line">PASSWORD=<span class="string">"<span class="variable">$5</span>"</span></span><br><span class="line">STIME=<span class="string">"<span class="variable">$(date -d "1 hour ago" "+%Y%m%d%H%M%S")</span>"</span></span><br><span class="line">PERIOD=3600</span><br><span class="line">WIDTH=800</span><br><span class="line"><span class="comment">#=========================================</span></span><br><span class="line">ROOTPATH=<span class="string">"<span class="variable">$(cd $(dirname $0)</span> &amp;&amp; pwd)"</span></span><br><span class="line">LOGFILE=<span class="string">"<span class="variable">$&#123;ROOTPATH&#125;</span>/logs/<span class="variable">$(basename $0)</span>.log.<span class="variable">$(date "+%Y-%m-%d")</span>"</span></span><br><span class="line"><span class="comment"># 在zabbix-web根目录下创建一个graphs目录用来存放趋势图图片文件</span></span><br><span class="line">GRAPH_DIR=<span class="string">"/usr/local/zabbix-web/graphs"</span></span><br><span class="line">COOKIE=<span class="string">"<span class="variable">$&#123;ROOTPATH&#125;</span>/.zabbixCookie.<span class="variable">$&#123;USERNAME&#125;</span>"</span></span><br><span class="line">CURL=<span class="string">"/usr/bin/curl -s"</span></span><br><span class="line">ZBX_URL=<span class="string">"http://zabbix.server.url"</span></span><br><span class="line">INDEX_URL=<span class="string">"<span class="variable">$ZBX_URL</span>/index.php"</span></span><br><span class="line">CHART_URL=<span class="string">"<span class="variable">$ZBX_URL</span>/chart.php"</span></span><br><span class="line">PNG_PATH=<span class="string">"<span class="variable">$GRAPH_DIR</span>/<span class="variable">$STIME</span>.<span class="variable">$PERIOD</span>.<span class="variable">$&#123;WIDTH&#125;</span>.<span class="variable">$ITEMID</span>.png"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="built_in">help</span>()</span><br><span class="line">&#123;</span><br><span class="line">    cat &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">sh <span class="variable">$0</span> ALERT_SENDTO ALERT_SUBJECT ALERT_MESSAGE USERNAME PASSWORD</span><br><span class="line"></span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单记一下日志</span></span><br><span class="line"><span class="keyword">function</span> writeLogs()</span><br><span class="line">&#123;</span><br><span class="line">[ ! -d <span class="string">"<span class="variable">$(dirname "$&#123;LOGFILE&#125;")</span>"</span> ] &amp;&amp; mkdir -p <span class="string">"<span class="variable">$(dirname "$&#123;LOGFILE&#125;")</span>"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t<span class="variable">$1</span>"</span> &gt;&gt;<span class="string">"<span class="variable">$&#123;LOGFILE&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> check_integer()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">local</span> ret=`<span class="built_in">echo</span> <span class="string">"$*"</span> | sed <span class="string">'s/[0-9]//g'</span>`</span><br><span class="line">    [ -n <span class="string">"<span class="variable">$ret</span>"</span> ] &amp;&amp; <span class="built_in">return</span> 1</span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单校验参数</span></span><br><span class="line"><span class="keyword">function</span> ParametersVerification()</span><br><span class="line">&#123;</span><br><span class="line">[ -d <span class="string">"<span class="variable">$GRAPH_DIR</span>"</span> ] || mkdir -p <span class="string">"<span class="variable">$GRAPH_DIR</span>"</span></span><br><span class="line">        check_integer <span class="string">"<span class="variable">$ITEMID</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'ITEMID' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$STIME</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'STIME' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$PERIOD</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'PERIOD' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        check_integer <span class="string">"<span class="variable">$WIDTH</span>"</span> || &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Field 'WIDTH' is not integer."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">        [ <span class="variable">$PERIOD</span> -lt 3600 -o <span class="variable">$PERIOD</span> -gt 63072000 ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Incorrect value <span class="variable">$PERIOD</span> for PERIOD field: must be between 3600 and 63072000."</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line"><span class="comment"># USERNAME、PASSWORD、ITEMID为必需参数</span></span><br><span class="line">[ -z <span class="string">"<span class="variable">$USERNAME</span>"</span> -o -z <span class="string">"<span class="variable">$PASSWORD</span>"</span> -o -z <span class="string">"<span class="variable">$ITEMID</span>"</span> ] &amp;&amp; &#123; <span class="built_in">echo</span> <span class="string">"ERROR: Missing mandatory parameter."</span>; <span class="built_in">help</span>;&#125;</span><br><span class="line"><span class="comment"># 如果没有传入STIME参数，STIME的值为当前时间减去PERIOD</span></span><br><span class="line">[ <span class="string">"<span class="variable">$STIME</span>"</span> == <span class="string">""</span> ] &amp;&amp; STIME=`date -d <span class="string">"now -<span class="variable">$&#123;PERIOD&#125;</span> second"</span> +%Y%m%d%H%M%S`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键步骤，获取cookie并写入文件</span></span><br><span class="line"><span class="keyword">function</span> getCookie()</span><br><span class="line">&#123;</span><br><span class="line">/usr/bin/chattr -i <span class="variable">$&#123;COOKIE&#125;</span></span><br><span class="line"><span class="variable">$&#123;CURL&#125;</span> -c <span class="variable">$&#123;COOKIE&#125;</span> -d <span class="string">"name=<span class="variable">$&#123;USERNAME&#125;</span>&amp;password=<span class="variable">$&#123;PASSWORD&#125;</span>&amp;autologin=1&amp;enter=Sign+in"</span> <span class="variable">$INDEX_URL</span> | egrep -o <span class="string">"(Login name or passwordis incorrect|Account is blocked.*seconds)"</span></span><br><span class="line"><span class="comment"># 如果登录失败则退出脚本，并清空cookie文件</span></span><br><span class="line">[ <span class="variable">$&#123;PIPESTATUS[1]&#125;</span> -eq 0 ] &amp;&amp; &#123; <span class="built_in">echo</span> &gt;<span class="string">"<span class="variable">$COOKIE</span>"</span>; <span class="built_in">exit</span> 1;&#125;</span><br><span class="line">/usr/bin/chattr +i <span class="variable">$&#123;COOKIE&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取趋势图文件</span></span><br><span class="line"><span class="keyword">function</span> getGraph()</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment"># zabbix3.0-</span></span><br><span class="line"><span class="comment">#$&#123;CURL&#125; -b $&#123;COOKIE&#125; -d "itemid=$&#123;ITEMID&#125;&amp;period=$&#123;PERIOD&#125;&amp;stime=$&#123;STIME&#125;&amp;width=$&#123;WIDTH&#125;" $CHART_URL &gt; "$PNG_PATH"</span></span><br><span class="line"><span class="comment"># zabbix3.0+</span></span><br><span class="line"><span class="variable">$&#123;CURL&#125;</span> -b <span class="variable">$&#123;COOKIE&#125;</span> -d <span class="string">"itemids%5B0%5D=<span class="variable">$&#123;ITEMID&#125;</span>&amp;period=<span class="variable">$&#123;PERIOD&#125;</span>&amp;stime=<span class="variable">$&#123;STIME&#125;</span>&amp;width=<span class="variable">$&#123;WIDTH&#125;</span>"</span> <span class="variable">$&#123;CHART_URL&#125;</span> &gt; <span class="string">"<span class="variable">$&#123;PNG_PATH&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送告警</span></span><br><span class="line"><span class="keyword">function</span> sendMessage()</span><br><span class="line">&#123;</span><br><span class="line">/usr/bin/php <span class="variable">$&#123;ROOTPATH&#125;</span>/mailer/sendmail.php <span class="string">"<span class="variable">$&#123;ALERT_SENDTO&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;ALERT_MESSAGE&#125;</span>"</span> <span class="string">"<span class="variable">$(basename $&#123;PNG_PATH&#125;)</span>"</span> <span class="string">"<span class="variable">$&#123;ITEMID&#125;</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> main()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -s <span class="string">"<span class="variable">$&#123;COOKIE&#125;</span>"</span> ];<span class="keyword">then</span></span><br><span class="line">getCookie</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">getGraph</span><br><span class="line"><span class="keyword">if</span> [ -s <span class="string">"<span class="variable">$&#123;PNG_PATH&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">sendMessage</span><br><span class="line">writeLogs <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t send to <span class="variable">$&#123;ALERT_SENDTO&#125;</span>\t subject:<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>\t transmit status:$?"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">writeLogs <span class="string">"<span class="variable">$(date "+%Y-%m-%d %H:%M:%S")</span>\t send to <span class="variable">$&#123;ALERT_SENDTO&#125;</span>\t subject:<span class="variable">$&#123;ALERT_SUBJECT&#125;</span>\t transmit status:$? \t <span class="variable">$PNG_PATH</span> doesn't exist."</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[[ <span class="string">"<span class="variable">$1</span>"</span> =~ <span class="string">"help"</span> ]] &amp;&amp; &#123; <span class="built_in">help</span> ; <span class="built_in">exit</span> 0; &#125;</span><br><span class="line"></span><br><span class="line">main</span><br></pre></td></tr></table></figure><ul><li>邮件告警脚本，同目录下创建一个mailer目录，mailer目录下存放swiftmailer源码</li></ul></li></ul><h2 id="邮件模板及smtp服务"><a href="#邮件模板及smtp服务" class="headerlink" title="邮件模板及smtp服务"></a>邮件模板及smtp服务</h2><ul><li>cat mailer/sendmail.php<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">''</span>. dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line">$sendto = $argv[<span class="number">1</span>];</span><br><span class="line">$subject = $argv[<span class="number">2</span>];</span><br><span class="line">$content = $argv[<span class="number">3</span>];</span><br><span class="line">$graphName = $argv[<span class="number">4</span>];</span><br><span class="line">$itemId = $argv[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the Transport</span></span><br><span class="line">$transport = (<span class="keyword">new</span> Swift_SmtpTransport(<span class="string">'smtp.xxxmail.com'</span>, <span class="number">25</span>))</span><br><span class="line">  -&gt;setUsername(<span class="string">'AuthenticatedUser@xxxmail.com'</span>)</span><br><span class="line">  -&gt;setPassword(<span class="string">'password'</span>)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the Mailer using your created Transport</span></span><br><span class="line">$mailer = <span class="keyword">new</span> Swift_Mailer($transport);</span><br><span class="line"></span><br><span class="line"><span class="comment">// To use the ArrayLogger</span></span><br><span class="line"><span class="comment">#$logger = new Swift_Plugins_Loggers_ArrayLogger();</span></span><br><span class="line"><span class="comment">#$mailer-&gt;registerPlugin(new Swift_Plugins_LoggerPlugin($logger));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Or to use the Echo Logger</span></span><br><span class="line"><span class="comment">#$logger = new Swift_Plugins_Loggers_EchoLogger();</span></span><br><span class="line"><span class="comment">#$mailer-&gt;registerPlugin(new Swift_Plugins_LoggerPlugin($logger));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a message</span></span><br><span class="line">$message = (<span class="keyword">new</span> Swift_Message($subject))</span><br><span class="line">  -&gt;setFrom([<span class="string">'Admin@xxxmail.com'</span> =&gt; <span class="string">'Notice'</span>])</span><br><span class="line">  -&gt;setTo([ $sendto =&gt; <span class="string">'Swift Mailer'</span>]);</span><br><span class="line">$message-&gt;setBody(</span><br><span class="line"><span class="string">'</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;!-- So that mobile will display zoomed in --&gt;</span></span><br><span class="line"><span class="string">  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;!-- enable media queries for windows phone 8 --&gt;</span></span><br><span class="line"><span class="string">  &lt;meta name="format-detection" content="telephone=no"&gt; &lt;!-- disable auto telephone linking in iOS --&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;Two Columns to Rows (Simple)&lt;/title&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;style type="text/css"&gt;</span></span><br><span class="line"><span class="string">body &#123;</span></span><br><span class="line"><span class="string">  margin: 0;</span></span><br><span class="line"><span class="string">  padding: 0;</span></span><br><span class="line"><span class="string">  -ms-text-size-adjust: 100%;</span></span><br><span class="line"><span class="string">  -webkit-text-size-adjust: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table &#123;</span></span><br><span class="line"><span class="string">  border-spacing: 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table td &#123;</span></span><br><span class="line"><span class="string">  border-collapse: collapse;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ExternalClass &#123;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ExternalClass,</span></span><br><span class="line"><span class="string">.ExternalClass p,</span></span><br><span class="line"><span class="string">.ExternalClass span,</span></span><br><span class="line"><span class="string">.ExternalClass font,</span></span><br><span class="line"><span class="string">.ExternalClass td,</span></span><br><span class="line"><span class="string">.ExternalClass div &#123;</span></span><br><span class="line"><span class="string">  line-height: 100%;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ReadMsgBody &#123;</span></span><br><span class="line"><span class="string">  width: 100%;</span></span><br><span class="line"><span class="string">  background-color: #ebebeb;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">table &#123;</span></span><br><span class="line"><span class="string">  mso-table-lspace: 0pt;</span></span><br><span class="line"><span class="string">  mso-table-rspace: 0pt;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">img &#123;</span></span><br><span class="line"><span class="string">  -ms-interpolation-mode: bicubic;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.yshortcuts a &#123;</span></span><br><span class="line"><span class="string">  border-bottom: none !important;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">@media screen and (max-width: 599px) &#123;</span></span><br><span class="line"><span class="string">  .force-row,</span></span><br><span class="line"><span class="string">  .container &#123;</span></span><br><span class="line"><span class="string">    width: 100% !important;</span></span><br><span class="line"><span class="string">    max-width: 100% !important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">@media screen and (max-width: 400px) &#123;</span></span><br><span class="line"><span class="string">  .container-padding &#123;</span></span><br><span class="line"><span class="string">    padding-left: 12px !important;</span></span><br><span class="line"><span class="string">    padding-right: 12px !important;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.ios-footer a &#123;</span></span><br><span class="line"><span class="string">  color: #aaaaaa !important;</span></span><br><span class="line"><span class="string">  text-decoration: underline;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;body style="margin:0; padding:0;" bgcolor="#F0F0F0" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0"&gt;</span></span><br><span class="line"><span class="string">&lt;!-- 100% background wrapper (grey background) --&gt;</span></span><br><span class="line"><span class="string">&lt;table border="0" width="100%" height="100%" cellpadding="0" cellspacing="0" bgcolor="#F0F0F0"&gt;</span></span><br><span class="line"><span class="string">  &lt;tr&gt;</span></span><br><span class="line"><span class="string">    &lt;td align="center" valign="top" bgcolor="#F0F0F0" style="background-color: #F0F0F0;"&gt;</span></span><br><span class="line"><span class="string">      &lt;br&gt;</span></span><br><span class="line"><span class="string">      &lt;!-- 600px container (white background) --&gt;</span></span><br><span class="line"><span class="string">      &lt;table border="0" width="600" cellpadding="0" cellspacing="0" class="container" style="width:600px;max-width:600px"&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding header" align="left" style="font-family:Helvetica, Arial, sans-serif;font-size:24px;font-weight:bold;padding-bottom:12px;color:#DF4726;padding-left:24px;padding-right:24px"&gt;</span></span><br><span class="line"><span class="string">            告警/恢复信息:</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding content" align="left" style="padding-left:24px;padding-right:24px;padding-top:12px;padding-bottom:12px;background-color:#ffffff"&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="title" style="font-family:Helvetica, Arial, sans-serif;font-size:18px;font-weight:600;color:#374550"&gt;</span></span><br><span class="line"><span class="string">  '</span> . $subject . <span class="string">'</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class="body-text" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333"&gt;</span></span><br><span class="line"><span class="string">  &lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc;clear: both;"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;div class="subtitle" style="font-family:Helvetica, Arial, sans-serif;font-size:16px;font-weight:600;color:#2469A0"&gt;</span></span><br><span class="line"><span class="string">  详细信息：</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="body-text" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333"&gt;</span></span><br><span class="line"><span class="string">  &lt;ol&gt;</span></span><br><span class="line"><span class="string">    '</span> . $content . <span class="string">'</span></span><br><span class="line"><span class="string">  &lt;/ol&gt;</span></span><br><span class="line"><span class="string">&lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">    &lt;table width="264" border="0" cellpadding="0" cellspacing="0" align="left" class="force-row"&gt;</span></span><br><span class="line"><span class="string">      &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td class="col" valign="top" style="font-family:Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;text-align:left;color:#333333;width:100%"&gt;</span></span><br><span class="line"><span class="string">          &lt;strong&gt;趋势图&lt;/strong&gt;</span></span><br><span class="line"><span class="string">          &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;a href="http://zabbix.server.url/history.php?action=showgraph&amp;itemids[]='</span> . $itemId . <span class="string">'"&gt;</span></span><br><span class="line"><span class="string">  &lt;img src=http://zabbix.server.url/graphs/'</span> . $graphName . <span class="string">' /&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">          &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">        &lt;/td&gt;</span></span><br><span class="line"><span class="string">      &lt;/tr&gt;</span></span><br><span class="line"><span class="string">    &lt;/table&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="hr" style="height:1px;border-bottom:1px solid #cccccc;clear: both;"&gt;&amp;nbsp;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">  &lt;br&gt;</span></span><br><span class="line"><span class="string">  &lt;em&gt;&lt;small&gt;Last updated: 08 April 2018&lt;/small&gt;&lt;/em&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">          &lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td class="container-padding footer-text" align="left" style="font-family:Helvetica, Arial, sans-serif;font-size:12px;line-height:16px;color:#aaaaaa;padding-left:24px;padding-right:24px"&gt;</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            Serviced provider: © 2018 XXX-INC.</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            You are receiving this email because you  used our team\'s monitoring system. Update your &lt;a href="#" style="color:#aaaaaa"&gt;alarm configuration&lt;/a&gt; or &lt;a href="#" style="color:#aaaaaa"&gt;to unsubscribe.&lt;/a&gt;.</span></span><br><span class="line"><span class="string">            &lt;br&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;team@xxxmail.om&lt;/strong&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;span class="ios-footer"&gt;</span></span><br><span class="line"><span class="string">              department signature.&lt;br&gt;</span></span><br><span class="line"><span class="string">              team signature&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="http://www.Your Company'</span>s Official network.com<span class="string">" style="</span>color:<span class="comment">#aaaaaa"&gt;www.Your Company's Official network.com&lt;/a&gt;&lt;br&gt;</span></span><br><span class="line">            &lt;br&gt;&lt;br&gt;</span><br><span class="line">          &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">&lt;!--/<span class="number">600</span>px container --&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;!--/<span class="number">100</span>% background wrapper--&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="string">','</span>text/html<span class="string">'</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Send the message</span></span><br><span class="line"><span class="string">$result = $mailer-&gt;send($message);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// Dump the log contents</span></span><br><span class="line"><span class="string">// NOTE: The EchoLogger dumps in realtime so dump() does nothing for it</span></span><br><span class="line"><span class="string">#echo $logger-&gt;dump();</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="swiftmailer安装"><a href="#swiftmailer安装" class="headerlink" title="swiftmailer安装"></a>swiftmailer安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir mailer</span><br><span class="line"><span class="built_in">cd</span> mailer</span><br><span class="line">composer require <span class="string">"swiftmailer/swiftmailer:^6.0"</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://swiftmailer.symfony.com/docs/introduction.html" target="_blank" rel="noopener">swiftmailer官方文档</a></li></ul><p>至此基本差不多了，剩下的就是在zabbix web页面上配置下了。</p><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2018/03/18/00032_influxdb-telegraf-Grafana监控解决方案与zabbix监控的对比/">influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/24/00038_zabbix实现自定义主机名/">zabbix实现自定义主机名</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/18/00032_influxdb-telegraf-Grafana监控解决方案与zabbix监控的对比/">influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/24/00038_zabbix实现自定义主机名/">zabbix实现自定义主机名</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/23/00037_zabbix分区优化/">zabbix表分区优化</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;告警邮件中嵌入趋势图是非常人性化的设计，只有有温度的告警邮件才会嵌入趋势图。。。&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="监控" scheme="https://www.lengyuewusheng.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
      <category term="zabbix" scheme="https://www.lengyuewusheng.com/tags/zabbix/"/>
    
      <category term="告警" scheme="https://www.lengyuewusheng.com/tags/%E5%91%8A%E8%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>zabbix实现自定义主机名</title>
    <link href="https://www.lengyuewusheng.com/2018/03/24/00038_zabbix%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E6%9C%BA%E5%90%8D/"/>
    <id>https://www.lengyuewusheng.com/2018/03/24/00038_zabbix实现自定义主机名/</id>
    <published>2018-03-24T14:39:22.000Z</published>
    <updated>2018-05-02T13:39:14.561Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>主机名作为监控系统的关键信息，一定不能太死板。。。</p></blockquote><a id="more"></a><p>生产环境中通常系统的Hostname定义没有严格规范，一般在做系统时，很少在Hostname定义上花时间。但是Hostname作为关键信息在很多场景下具有非常重要的意义。</p><p>zabbix agent的默认配置文件中Hostname配置为<code># HostnameItem=system.hostname</code>,但是<a href="https://www.zabbix.com/documentation/3.0/manual/config/items/itemtypes/zabbix_agent" target="_blank" rel="noopener">zabbix官方文档</a>中有对<code>system.run[command,&lt;mode&gt;]</code>的描述，从2.2版本开始即支持通过该参数在主机上执行指定命令定义监控项的值。我们可以通过该参数实现对Hostname属性的重写。</p><p>配置样例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HostnameItem=system.run[/bin/bash /path/to/hostname.sh]</span><br></pre></td></tr></table></figure><h2 id="zabbix相关资源"><a href="#zabbix相关资源" class="headerlink" title="zabbix相关资源"></a>zabbix相关资源</h2><ul><li><p><a href="https://share.zabbix.com/" target="_blank" rel="noopener">Zabbix社区资源共享</a></p></li><li><p><a href="https://www.zabbix.org/wiki/Main_Page" target="_blank" rel="noopener">Zabbix官方WIKI</a></p></li><li><p><a href="https://www.zabbix.com/manuals" target="_blank" rel="noopener">Zabbix官方文档</a></p></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2018/03/18/00032_influxdb-telegraf-Grafana监控解决方案与zabbix监控的对比/">influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/25/00039_Zabbix告警邮件中插入趋势图/">通过Zabbix API在告警邮件中插入趋势图</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/18/00032_influxdb-telegraf-Grafana监控解决方案与zabbix监控的对比/">influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/23/00037_zabbix分区优化/">zabbix表分区优化</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/25/00039_Zabbix告警邮件中插入趋势图/">通过Zabbix API在告警邮件中插入趋势图</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;主机名作为监控系统的关键信息，一定不能太死板。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="技术" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="监控" scheme="https://www.lengyuewusheng.com/tags/%E7%9B%91%E6%8E%A7/"/>
    
      <category term="zabbix" scheme="https://www.lengyuewusheng.com/tags/zabbix/"/>
    
      <category term="优化" scheme="https://www.lengyuewusheng.com/tags/%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>zabbix表分区优化</title>
    <link href="https://www.lengyuewusheng.com/2018/03/23/00037_zabbix%E5%88%86%E5%8C%BA%E4%BC%98%E5%8C%96/"/>
    <id>https://www.lengyuewusheng.com/2018/03/23/00037_zabbix分区优化/</id>
    <published>2018-03-23T14:58:13.000Z</published>
    <updated>2018-05-02T13:39:49.437Z</updated>
    
    <content type="html"><![CDATA[<p>Zabbix是一款非常优秀的开源监控系统。</p><a id="more"></a><h2 id="MySQL存储过程定义"><a href="#MySQL存储过程定义" class="headerlink" title="MySQL存储过程定义"></a>MySQL存储过程定义</h2><ul><li><p>cat zabbixPartition.sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ======partition_create========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_create`</span>(SCHEMANAME <span class="built_in">varchar</span>(<span class="number">64</span>), TABLENAME <span class="built_in">varchar</span>(<span class="number">64</span>), PARTITIONNAME <span class="built_in">varchar</span>(<span class="number">64</span>), CLOCK <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           PARTITIONNAME = The name of the partition to create</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Verify that the partition does not already exist</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_description &gt;= CLOCK;</span><br><span class="line"></span><br><span class="line">        IF RETROWS = 0 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Print a message indicating that a partition was created.</span></span><br><span class="line"><span class="comment">                   2. Create the SQL to create the partition.</span></span><br><span class="line"><span class="comment">                   3. Execute the SQL from #2.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>( <span class="string">"partition_create("</span>, SCHEMANAME, <span class="string">","</span>, TABLENAME, <span class="string">","</span>, PARTITIONNAME, <span class="string">","</span>, CLOCK, <span class="string">")"</span> ) <span class="keyword">AS</span> msg;</span><br><span class="line">                <span class="keyword">SET</span> @<span class="keyword">sql</span> = <span class="keyword">CONCAT</span>( <span class="string">'ALTER TABLE '</span>, SCHEMANAME, <span class="string">'.'</span>, TABLENAME, <span class="string">' ADD PARTITION (PARTITION '</span>, PARTITIONNAME, <span class="string">' VALUES LESS THAN ('</span>, CLOCK, <span class="string">'));'</span> );</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @<span class="keyword">sql</span>;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_drop==========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_drop`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), DELETE_BELOW_PARTITION_DATE <span class="built_in">BIGINT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           SCHEMANAME = The DB schema in which to make changes</span></span><br><span class="line"><span class="comment">           TABLENAME = The table with partitions to potentially delete</span></span><br><span class="line"><span class="comment">           DELETE_BELOW_PARTITION_DATE = Delete any partitions with names that are dates older than this one (yyyy-mm-dd)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> done <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> drop_part_name <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Get a list of all the partitions that are older than the date</span></span><br><span class="line"><span class="comment">           in DELETE_BELOW_PARTITION_DATE.  All partitions are prefixed with</span></span><br><span class="line"><span class="comment">           a "p", so use SUBSTRING TO get rid of that character.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">DECLARE</span> myCursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">                <span class="keyword">SELECT</span> partition_name</span><br><span class="line">                <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">                <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> <span class="keyword">CAST</span>(<span class="keyword">SUBSTRING</span>(partition_name <span class="keyword">FROM</span> <span class="number">2</span>) <span class="keyword">AS</span> <span class="keyword">UNSIGNED</span>) &lt; DELETE_BELOW_PARTITION_DATE;</span><br><span class="line">        <span class="keyword">DECLARE</span> CONTINUE <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">NOT</span> <span class="keyword">FOUND</span> <span class="keyword">SET</span> done = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Create the basics for when we need to drop the partition.  Also, create</span></span><br><span class="line"><span class="comment">           @drop_partitions to hold a comma-delimited list of all partitions that</span></span><br><span class="line"><span class="comment">           should be deleted.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">SET</span> @alter_header = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE "</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">" DROP PARTITION "</span>);</span><br><span class="line">        <span class="keyword">SET</span> @drop_partitions = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           Start looping through all the partitions that are too old.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        OPEN myCursor;</span><br><span class="line">        read_loop: LOOP</span><br><span class="line">                FETCH myCursor INTO drop_part_name;</span><br><span class="line">                IF done THEN</span><br><span class="line">                        LEAVE read_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @drop_partitions = <span class="keyword">IF</span>(@drop_partitions = <span class="string">""</span>, drop_part_name, <span class="keyword">CONCAT</span>(@drop_partitions, <span class="string">","</span>, drop_part_name));</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line">        IF @drop_partitions != "" THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   1. Build the SQL to drop all the necessary partitions.</span></span><br><span class="line"><span class="comment">                   2. Run the SQL to drop the partitions.</span></span><br><span class="line"><span class="comment">                   3. Print out the table partitions that were deleted.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SET</span> @full_sql = <span class="keyword">CONCAT</span>(@alter_header, @drop_partitions, <span class="string">";"</span>);</span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @full_sql;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, @drop_partitions <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        ELSE</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   No partitions are being deleted, so print out "N/A" (Not applicable) to indicate</span></span><br><span class="line"><span class="comment">                   that no changes were made.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(SCHEMANAME, <span class="string">"."</span>, TABLENAME) <span class="keyword">AS</span> <span class="string">`table`</span>, <span class="string">"N/A"</span> <span class="keyword">AS</span> <span class="string">`partitions_deleted`</span>;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_maintenance===================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_maintenance`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), TABLE_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>), KEEP_DATA_DAYS <span class="built_in">INT</span>, HOURLY_INTERVAL <span class="built_in">INT</span>, CREATE_NEXT_INTERVALS <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> OLDER_THAN_PARTITION_DATE <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> OLD_PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> LESS_THAN_TIMESTAMP <span class="built_in">INT</span>;</span><br><span class="line">        <span class="keyword">DECLARE</span> CUR_TIME <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">CALL</span> partition_verify(SCHEMA_NAME, TABLE_NAME, HOURLY_INTERVAL);</span><br><span class="line">        <span class="keyword">SET</span> CUR_TIME = <span class="keyword">UNIX_TIMESTAMP</span>(<span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'%Y-%m-%d 00:00:00'</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> @__interval = <span class="number">1</span>;</span><br><span class="line">        create_loop: LOOP</span><br><span class="line">                IF @__interval &gt; CREATE_NEXT_INTERVALS THEN</span><br><span class="line">                        LEAVE create_loop;</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">SET</span> LESS_THAN_TIMESTAMP = CUR_TIME + (HOURLY_INTERVAL * @__interval * <span class="number">3600</span>);</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = FROM_UNIXTIME(CUR_TIME + HOURLY_INTERVAL * (@__interval - <span class="number">1</span>) * <span class="number">3600</span>, <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line">                IF(PARTITION_NAME != OLD_PARTITION_NAME) THEN</span><br><span class="line">                        <span class="keyword">CALL</span> partition_create(SCHEMA_NAME, TABLE_NAME, PARTITION_NAME, LESS_THAN_TIMESTAMP);</span><br><span class="line">                <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">                <span class="keyword">SET</span> @__interval=@__interval+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">SET</span> OLD_PARTITION_NAME = PARTITION_NAME;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">LOOP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">SET</span> OLDER_THAN_PARTITION_DATE=<span class="keyword">DATE_FORMAT</span>(<span class="keyword">DATE_SUB</span>(<span class="keyword">NOW</span>(), <span class="built_in">INTERVAL</span> KEEP_DATA_DAYS <span class="keyword">DAY</span>), <span class="string">'%Y%m%d0000'</span>);</span><br><span class="line">        <span class="keyword">CALL</span> partition_drop(SCHEMA_NAME, TABLE_NAME, OLDER_THAN_PARTITION_DATE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ======partition_verify========================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_verify`</span>(SCHEMANAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), TABLENAME <span class="built_in">VARCHAR</span>(<span class="number">64</span>), HOURLYINTERVAL <span class="built_in">INT</span>(<span class="number">11</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> PARTITION_NAME <span class="built_in">VARCHAR</span>(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> RETROWS <span class="built_in">INT</span>(<span class="number">11</span>);</span><br><span class="line">        <span class="keyword">DECLARE</span> FUTURE_TIMESTAMP <span class="built_in">TIMESTAMP</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Check if any partitions exist for the given SCHEMANAME.TABLENAME.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">INTO</span> RETROWS</span><br><span class="line">        <span class="keyword">FROM</span> information_schema.partitions</span><br><span class="line">        <span class="keyword">WHERE</span> table_schema = SCHEMANAME <span class="keyword">AND</span> table_name = TABLENAME <span class="keyword">AND</span> partition_name <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * If partitions do not exist, go ahead and partition the table</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        IF RETROWS = 1 THEN</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * Take the current date at 00:00:00 and add HOURLYINTERVAL to it.  This is the timestamp below which we will store values.</span></span><br><span class="line"><span class="comment">                 * We begin partitioning based on the beginning of a day.  This is because we don't want to generate a random partition</span></span><br><span class="line"><span class="comment">                 * that won't necessarily fall in line with the desired partition naming (ie: if the hour interval is 24 hours, we could</span></span><br><span class="line"><span class="comment">                 * end up creating a partition now named "p201403270600" when all other partitions will be like "p201403280000").</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">SET</span> FUTURE_TIMESTAMP = <span class="keyword">TIMESTAMPADD</span>(<span class="keyword">HOUR</span>, HOURLYINTERVAL, <span class="keyword">CONCAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">" "</span>, <span class="string">'00:00:00'</span>));</span><br><span class="line">                <span class="keyword">SET</span> PARTITION_NAME = <span class="keyword">DATE_FORMAT</span>(<span class="keyword">CURDATE</span>(), <span class="string">'p%Y%m%d%H00'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Create the partitioning query</span></span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(<span class="string">"ALTER TABLE "</span>, SCHEMANAME, <span class="string">"."</span>, TABLENAME, <span class="string">" PARTITION BY RANGE(`clock`)"</span>);</span><br><span class="line">                <span class="keyword">SET</span> @__PARTITION_SQL = <span class="keyword">CONCAT</span>(@__PARTITION_SQL, <span class="string">"(PARTITION "</span>, PARTITION_NAME, <span class="string">" VALUES LESS THAN ("</span>, <span class="keyword">UNIX_TIMESTAMP</span>(FUTURE_TIMESTAMP), <span class="string">"));"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">-- Run the partitioning query</span></span><br><span class="line">                <span class="keyword">PREPARE</span> STMT <span class="keyword">FROM</span> @__PARTITION_SQL;</span><br><span class="line">                <span class="keyword">EXECUTE</span> STMT;</span><br><span class="line">                <span class="keyword">DEALLOCATE</span> <span class="keyword">PREPARE</span> STMT;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#======partition_maintenance_all================================================</span></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> <span class="string">`partition_maintenance_all`</span>(SCHEMA_NAME <span class="built_in">VARCHAR</span>(<span class="number">32</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_log'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_str'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_text'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'history_uint'</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">90</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends'</span>, <span class="number">730</span>, <span class="number">24</span>, <span class="number">365</span>);</span><br><span class="line">                <span class="keyword">CALL</span> partition_maintenance(SCHEMA_NAME, <span class="string">'trends_uint'</span>, <span class="number">730</span>, <span class="number">24</span>, <span class="number">365</span>);</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></li><li><p>参数说明</p><ul><li>SCHEMA_NAME = 数据库</li><li>TABLE_NAME = 表</li><li>KEEP_DATA_DAYS = 要保留的分区的最大天数。所有超过此天数的分区将被删除。</li><li>HOURLY_INTERVAL = 分区的时间间隔(小时为单位)</li><li>CREATE_NEXT_INTERVALS = 创建的未来分区数</li></ul></li></ul><h2 id="Housekeeper配置修改"><a href="#Housekeeper配置修改" class="headerlink" title="Housekeeper配置修改"></a>Housekeeper配置修改</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Administration"</span> -&gt; <span class="string">"General"</span> -&gt; <span class="string">"Housekeeping"</span></span><br><span class="line">将History&amp;Trends <span class="string">"Enable internal housekeeping"</span>取消，勾选<span class="string">"Override item trend period"</span>,</span><br><span class="line">将<span class="string">"Data storage period (in days)"</span>的值改成和存储过程中变量KEEP_DATA_DAYS的值一致。</span><br></pre></td></tr></table></figure><h2 id="存储过程导入"><a href="#存储过程导入" class="headerlink" title="存储过程导入"></a>存储过程导入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql -uroot -p zabbix &lt; zabbixPartition.sql</span><br></pre></td></tr></table></figure><h2 id="crontab配置"><a href="#crontab配置" class="headerlink" title="crontab配置"></a>crontab配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 01 01 * *  /usr/bin/mysql  -uroot -pPASSWD zabbix -e<span class="string">"CALL partition_maintenance_all('zabbix')"</span> &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="查看分区结果"><a href="#查看分区结果" class="headerlink" title="查看分区结果"></a>查看分区结果</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; showcreate table <span class="built_in">history</span>;</span><br></pre></td></tr></table></figure><p>以上在zabbix3.0.2版本上执行通过，其它版本根据实际情况判断是否微调。。。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.zabbix.org/wiki/Docs/howto/mysql_partition" target="_blank" rel="noopener">Zabbix wiki</a></li><li><a href="https://cloud.tencent.com/community/article/463810" target="_blank" rel="noopener">Zabbix 分区优化</a></li><li><a href="https://www.kancloud.cn/devops-centos/centos-linux-devops/375488" target="_blank" rel="noopener">Zabbix数据库优化(Zabbix分区表)</a></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/02/00022_MySQL常见的两种数据库引擎比较/">MySQL常见的两种数据库引擎比较</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/18/00032_influxdb-telegraf-Grafana监控解决方案与zabbix监控的对比/">influxdb+telegraf+Grafana监控解决方案与zabbix监控的对比</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/24/00038_zabbix实现自定义主机名/">zabbix实现自定义主机名</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/25/00039_Zabbix告警邮件中插入趋势图/">通过Zabbix API在告警邮件中插入趋势图</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Zabbix是一款非常优秀的开源监控系统。&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MySQL" scheme="https://www.lengyuewusheng.com/tags/MySQL/"/>
    
      <category term="zabbix" scheme="https://www.lengyuewusheng.com/tags/zabbix/"/>
    
      <category term="表分区" scheme="https://www.lengyuewusheng.com/tags/%E8%A1%A8%E5%88%86%E5%8C%BA/"/>
    
  </entry>
  
  <entry>
    <title>yum/rpm常用命令总结</title>
    <link href="https://www.lengyuewusheng.com/2018/03/22/00036_yum%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <id>https://www.lengyuewusheng.com/2018/03/22/00036_yum常用命令总结/</id>
    <published>2018-03-22T13:21:45.000Z</published>
    <updated>2019-01-23T07:29:04.988Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>Yum (Yellow dog Updater, Modified) ,Fedora、RedHat以及CentOS中的Shell前端软件包管理器，基于RPM。</p></blockquote><a id="more"></a><h2 id="yum常用命令"><a href="#yum常用命令" class="headerlink" title="yum常用命令"></a>yum常用命令</h2><ul><li><p>显示可用的yum仓库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist</span><br></pre></td></tr></table></figure></li><li><p>指定某一个repo内搜索某个rpm包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum --disablerepo=* --enablerepo=xxx search xxxx</span><br></pre></td></tr></table></figure></li><li><p>列出某个yum源中可用的rpm包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum --disablerepo=&quot;*&quot; --enablerepo=&quot;xxxx&quot; list available</span><br></pre></td></tr></table></figure></li><li><p>查找某条命令的yum源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum whatprovides &quot;*/whoami&quot;</span><br></pre></td></tr></table></figure></li><li><p>查找某条命令由什么包提供</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum provides $&#123;cmd&#125;</span><br></pre></td></tr></table></figure></li><li><p>替换安装某个rpm包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-plugin-replace</span><br><span class="line">yum replace php-common --replace-with=php56-common</span><br></pre></td></tr></table></figure></li><li><p>降级安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum downgrade packages</span><br></pre></td></tr></table></figure></li><li><p>安装程序组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &apos;Development Tools’</span><br></pre></td></tr></table></figure></li><li><p>从yum源中下载rpm包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install yum-utils</span><br><span class="line">yumdownloader xxxx</span><br></pre></td></tr></table></figure></li><li><p>yum下载依赖文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">方法一：</span><br><span class="line">  yumdownloader 下载包名称 --resolve --destdir=/tmp/openresty</span><br><span class="line">  </span><br><span class="line">参考：</span><br><span class="line">  http://www.cnblogs.com/toSeek/p/6093679.html</span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">  1.安装yum-plugin-downloadonly</span><br><span class="line">    yum -y install ftp://ftp.pbone.net/mirror/ftp5.gwdg.de/pub/opensuse/repositories/Virtualization:/Appliances/CentOS_CentOS-6/noarch/yum-plugin-downloadonly-1.1.31-2.2.noarch.rpm</span><br><span class="line">  2.下载：</span><br><span class="line">    yum install -y --downloadonly --downloaddir=/tmp/php  php</span><br><span class="line">    </span><br><span class="line">参考：</span><br><span class="line">  http://graybull.is-programmer.com/posts/37702.html</span><br><span class="line">  http://www.jianshu.com/p/5930545b5591</span><br></pre></td></tr></table></figure></li><li><p>yum 查看so库文件所在的rpm包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum whatprovides  libXpm.so.4</span><br></pre></td></tr></table></figure></li></ul><h2 id="rpm常用命令"><a href="#rpm常用命令" class="headerlink" title="rpm常用命令"></a>rpm常用命令</h2><ul><li><p>强制降级</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh oldpackage.rpm --oldpackage </span><br><span class="line">或</span><br><span class="line">rpm -Uvh oldpackage.rpm --force</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包安装前后执行的脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qp --scripts xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>rpm包安装前后执行脚本被传入参数$1的意义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0:卸载</span><br><span class="line">1:安装、升级卸载</span><br><span class="line">2:升级</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包提供的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qp --provides xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包注册的冲突信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qp --conflicts xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包注册的依赖信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qpR xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包中注册的配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qpc xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看rpm包的打包信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qpi xxxx.rpm</span><br></pre></td></tr></table></figure></li><li><p>查看打包spec文件中的tag信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -q --qf %&#123;tag&#125; rpm_name</span><br><span class="line"></span><br><span class="line">tag list: Name|Version|Release|Summary|Group|License|URL</span><br><span class="line">eg：</span><br><span class="line">rpm -q --qf %&#123;Version&#125; rpm_name</span><br></pre></td></tr></table></figure></li></ul><h2 id="内网yum源维护"><a href="#内网yum源维护" class="headerlink" title="内网yum源维护"></a>内网yum源维护</h2><ul><li><p>创建repodata</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install createrepo</span><br><span class="line">createrepo /path/to/RPMS/epel/7/x86_64/</span><br></pre></td></tr></table></figure></li><li><p>更新repodata</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createrepo --update /path/to/RPMS/epel/7/x86_64</span><br></pre></td></tr></table></figure></li><li><p>镜像yum源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">reposync -r &quot;repoid&quot;</span><br><span class="line">eg:</span><br><span class="line">reposync -r webtatic-archive -nu</span><br><span class="line"></span><br><span class="line">-r  指定镜像源</span><br><span class="line">-n 只下载最新镜像</span><br><span class="line">-u 只列出，不下载</span><br></pre></td></tr></table></figure></li><li><p>自定义yum源配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[epel.xxx]</span><br><span class="line">name=repo.xxx.xxx</span><br><span class="line">baseurl=http://repo.xxx/epel/$releasever/$basearch</span><br><span class="line">skip_if_unavailable=True        # 在CentOS7系统上测试当前yum源如果不可用，会直接跳过，默认False，提示错误.</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[epel-archive.xxx]</span><br><span class="line">name=archive.xxx.xxx</span><br><span class="line">baseurl=http://repo.xxx/archive/$releasever/$basearch</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=0</span><br></pre></td></tr></table></figure></li><li><p>配置文件中$releasever变量是取redhat-release-server(redhat)或centos-release(centos) rpm包的属性 %{version} 的值。验证方法:<code>rpm -q --qf %{version} redhat-release-server</code></p></li><li>rh和centos的$releasever稍有不同，一般rh的$releasever值是${Version}Server,centos的$releasever值直接是${Version}数值，所以在定义配置文件的时候要注意验证。</li></ul><h2 id="常见yum报错处理"><a href="#常见yum报错处理" class="headerlink" title="常见yum报错处理"></a>常见yum报错处理</h2><ul><li>yum报错：<code>Rpmdb checksum is invalid: dCDPT(pkg checksums)</code></li><li>解决方案<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --rebuilddb</span><br><span class="line">yum clean all</span><br></pre></td></tr></table></figure></li></ul><div><h1>推荐文章<span style="font-size:0.45em; color:gray">（由<a href="https://github.com/huiwang/hexo-recommended-posts">hexo文章推荐插件</a>驱动）</span></h1><ul><li><a href="https://www.lengyuewusheng.com/2017/08/11/00015_存储空间计算/">存储空间计算</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/12/00016_Linux共享内存机制/">Linux系统中的tmpfs、/dev/shm、tmp以及共享内存机制</a></li><li><a href="https://www.lengyuewusheng.com/2017/08/22/00021_Linux系统中的IO模型/">Linux系统中的IO模式</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/03/00026_tmux窗口管理/">tmux窗口管理</a></li><li><a href="https://www.lengyuewusheng.com/2018/03/14/00029_Linux访问Windows共享/">Linux挂载Windows共享目录</a></li></ul></div>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;Yum (Yellow dog Updater, Modified) ,Fedora、RedHat以及CentOS中的Shell前端软件包管理器，基于RPM。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="技术" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux" scheme="https://www.lengyuewusheng.com/tags/Linux/"/>
    
      <category term="yum" scheme="https://www.lengyuewusheng.com/tags/yum/"/>
    
      <category term="rpm" scheme="https://www.lengyuewusheng.com/tags/rpm/"/>
    
  </entry>
  
  <entry>
    <title>drupal应用部署</title>
    <link href="https://www.lengyuewusheng.com/2018/03/21/00035_drupal%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/"/>
    <id>https://www.lengyuewusheng.com/2018/03/21/00035_drupal应用部署/</id>
    <published>2018-03-21T13:20:28.000Z</published>
    <updated>2018-05-02T13:43:33.327Z</updated>
    
    <content type="html"><![CDATA[<p>Drupal是一款诞生于2000年的基于PHP语言编写的经典开源内容管理框架。</p><a id="more"></a><p>坊间传说drupal使用成本比wp高，偶然的机会看到一个基于drupal搭建的网站还不赖。兴趣使然，简单研究了一下drupal的搭建和使用。<br>以下简单给出搭建的关键步骤：</p><h2 id="composer工具准备"><a href="#composer工具准备" class="headerlink" title="composer工具准备"></a>composer工具准备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php</span><br><span class="line">mv composer.phar /usr/sbin/</span><br><span class="line">composer self-update</span><br></pre></td></tr></table></figure><h2 id="以lightning为例部署"><a href="#以lightning为例部署" class="headerlink" title="以lightning为例部署"></a>以lightning为例部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer create-project acquia/lightning-project drupal</span><br><span class="line">chown -R nobody:nobody drupal</span><br></pre></td></tr></table></figure><ul><li>drupal/docroot为应用根目录</li><li>drupal默认使用sqlite数据库不需要单独配置</li></ul><h2 id="nginx配置"><a href="#nginx配置" class="headerlink" title="nginx配置"></a>nginx配置</h2><p>以上方式部署完成后，用nginx的默认php应用配置会导致除了首页能访问，其它所有页面全部404，<br>根据drupal的路由特点需要简单配置rewrite规则，nginx应用的基本配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       *:80;</span><br><span class="line">    # include vhosts/vhosts.listen.addr;</span><br><span class="line">    # server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #charset koi8-r;</span><br><span class="line"></span><br><span class="line">    access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   html/drupal/docroot;</span><br><span class="line">        index  index.php index.htm;</span><br><span class="line">        try_files $uri $uri/ @rewrite;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ ^/sites/.*/private/ &#123;</span><br><span class="line">        access_log  off;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location @rewrite &#123;</span><br><span class="line">            rewrite ^/(.*)$ /index.php?q=$1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">    # redirect server error pages to the static page /50x.html</span><br><span class="line"></span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root           html/drupal/docroot;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /\.ht &#123;</span><br><span class="line">        deny  all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如此一来，基本上就可以用了。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Drupal是一款诞生于2000年的基于PHP语言编写的经典开源内容管理框架。&lt;/p&gt;
    
    </summary>
    
      <category term="搭建文档" scheme="https://www.lengyuewusheng.com/categories/%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/"/>
    
    
      <category term="drupal" scheme="https://www.lengyuewusheng.com/tags/drupal/"/>
    
      <category term="CMS" scheme="https://www.lengyuewusheng.com/tags/CMS/"/>
    
      <category term="搭建部署" scheme="https://www.lengyuewusheng.com/tags/%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>confluence 自动备份策略不生效</title>
    <link href="https://www.lengyuewusheng.com/2018/03/20/00034_confluence-%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5%E4%B8%8D%E7%94%9F%E6%95%88/"/>
    <id>https://www.lengyuewusheng.com/2018/03/20/00034_confluence-自动备份策略不生效/</id>
    <published>2018-03-20T13:02:48.000Z</published>
    <updated>2018-05-02T13:43:33.337Z</updated>
    
    <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>一切问题都有答案。。。</p></blockquote><a id="more"></a><p>##问题现象</p><p>confluence从备份文件中降级恢复后，配置没有任何错误提示，但是发现备份策略不生效，备份目录为空。查看日志后发现，没有取到backupPath，但是实际配置中是有显示配置路径的。</p><h2 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">backupAttachmentsDaily = true</span><br><span class="line">dailyBackupFilePrefix = backup-</span><br><span class="line">backupDaily = true</span><br><span class="line">backupPath = null</span><br><span class="line">2018-03-20 02:00:00,022 WARN [Caesium-1-2] [confluence.importexport.impl.BackupJob] runJob No daily backup directory specified to store the backups. Taking no action!</span><br><span class="line">2018-03-20 02:00:00,038 WARN [Caesium-1-2] [impl.schedule.caesium.JobRunnerWrapper] runJob Scheduled job BackupJob#BackupJob completed unsuccessfully with response JobRunnerResponse[runOutcome=ABORTED,message=&apos;No daily backup directory specified to store the backups. Taking no action!&apos;]</span><br></pre></td></tr></table></figure><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><p>参考了一些<a href="https://confluence.atlassian.com/confkb/cannot-create-xml-backup-with-the-warn-message-no-daily-backup-directory-specified-to-store-the-backups-in-the-logs-737772474.html" target="_blank" rel="noopener">官网给出的case</a>,<br>将 ${CONFLUENCE_HOME}目录下的配置文件confluence.cfg.xml中的<code>&lt;property name=&quot;admin.ui.allow.daily.backup.custom.location&quot;&gt;false&lt;/property&gt;</code>属性值变更为<code>true</code>,<br>重启confluence，<br>然后将<code>每日备份管理-&gt;备份设置-&gt;备份路径</code>设置为<code>默认</code>,<br>最后重新手动触发备份任务，<br>成功生成备份文件。</p><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>由于之前有过confluence从备份文件中降级恢复操作，怀疑是由于恢复操作，导致备份路径没有生效，猜测不用修改confluence.cfg.xml，直接重新提交一下备份路径设置也是可以的，因为问题的根本原因是<code>backupPath = null</code>。由于生产环境不便于验证，反复修改验证。有兴趣的读者可以验证一下，以后有机会也会再做验证。</p><p>confluence的备份恢复机制还是很好用的。wiki作为团队的重要资源，做好备份恢复还是非常重要和必要的。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;p&gt;一切问题都有答案。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="填坑指南" scheme="https://www.lengyuewusheng.com/categories/%E5%A1%AB%E5%9D%91%E6%8C%87%E5%8D%97/"/>
    
    
      <category term="confluence" scheme="https://www.lengyuewusheng.com/tags/confluence/"/>
    
      <category term="wiki" scheme="https://www.lengyuewusheng.com/tags/wiki/"/>
    
      <category term="备份" scheme="https://www.lengyuewusheng.com/tags/%E5%A4%87%E4%BB%BD/"/>
    
  </entry>
  
  <entry>
    <title>xshell常用快捷键</title>
    <link href="https://www.lengyuewusheng.com/2018/03/19/00033_xshell%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <id>https://www.lengyuewusheng.com/2018/03/19/00033_xshell常用快捷键/</id>
    <published>2018-03-19T13:30:49.000Z</published>
    <updated>2018-04-18T08:32:29.307Z</updated>
    
    <content type="html"><![CDATA[<p>常用但不全面，会持续总结完善。。。</p><a id="more"></a><style> table th:nth-of-type(1){width: 30%;} nth-of-type(2){width: 70%;}</style><table><thead><tr><th style="text-align:left">快捷键</th><th style="text-align:left">功能</th></tr></thead><tbody><tr><td style="text-align:left">ctrl + k</td><td style="text-align:left">删除光标后面所有字符</td></tr><tr><td style="text-align:left">ctrl + u</td><td style="text-align:left">删除光标前面所有字符</td></tr><tr><td style="text-align:left">ctrl + w</td><td style="text-align:left">删除光标前一个单词相当于VIM里db</td></tr><tr><td style="text-align:left">ctrl + y</td><td style="text-align:left">粘贴ctrl+u上次执行时删除的字符</td></tr><tr><td style="text-align:left">ctrl + ?</td><td style="text-align:left">撤消前一次输入</td></tr><tr><td style="text-align:left">ctrl + 方向键</td><td style="text-align:left">光标以单词为单位移动</td></tr><tr><td style="text-align:left">ctrl + s</td><td style="text-align:left">锁住终端</td></tr><tr><td style="text-align:left">ctrl + q</td><td style="text-align:left">解锁终端</td></tr><tr><td style="text-align:left">alt  + 数字</td><td style="text-align:left">切换到第N个标签页</td></tr><tr><td style="text-align:left">alt  + r</td><td style="text-align:left">透明窗口切换</td></tr><tr><td style="text-align:left">Shift + Home</td><td style="text-align:left">顶部</td></tr><tr><td style="text-align:left">Shift + End</td><td style="text-align:left">底部</td></tr><tr><td style="text-align:left">Shift + PgUp</td><td style="text-align:left">向上翻页</td></tr><tr><td style="text-align:left">Shift + PgDn</td><td style="text-align:left">向下翻页</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;常用但不全面，会持续总结完善。。。&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="https://www.lengyuewusheng.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="xshell" scheme="https://www.lengyuewusheng.com/tags/xshell/"/>
    
      <category term="快捷键" scheme="https://www.lengyuewusheng.com/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
</feed>
